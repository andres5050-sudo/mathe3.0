<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>Unidad Did√°ctica Gamificada - Matem√°ticas 8¬∞</title>
    <style>

/* Estilo para item bloqueado en learning-list */
.learning-list-item.locked-item {
    opacity: 0.5;
    cursor: not-allowed;
    background: linear-gradient(135deg, #bdc3c7, #95a5a6) !important;
}
        /* ================================================= */
        /* === ESTILOS BASE DEL PROYECTO ORIGINAL === */
        /* ================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* Animaci√≥n de fondo degradado */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* REGLA 1: ESTRELLAS Y PART√çCULAS FIJAS EN TODAS LAS PANTALLAS (z-index: 0) */
        .stars-container, .particles {
            position: fixed; /* Asegura que se vean en todas las pantallas */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            font-size: 20px;
            animation: fall linear infinite;
            opacity: 0;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8); /* Efecto ne√≥n suave */
        }

        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Part√≠culas brillantes flotantes */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
            border-radius: 50%;
            animation: float 20s infinite;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); /* Brillo ne√≥n */
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0) translateX(0) scale(1); 
                opacity: 0; 
            }
            10% { opacity: 1; }
            50% { 
                transform: translateY(-50vh) translateX(50px) scale(1.5); 
                opacity: 1; 
            }
            90% { opacity: 1; }
            100% { 
                transform: translateY(-100vh) translateX(100px) scale(0.5); 
                opacity: 0; 
            }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Pantallas */
        .screen {
            display: none;
            animation: fadeInScale 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeInScale {
            from { 
                opacity: 0; 
                transform: scale(0.95) translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0);
            }
        }

        /* PANTALLA DE INICIO */
        .home-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .logo-container {
            margin-bottom: 50px;
            animation: bounceIn 1.2s ease-out;
            position: relative;
        }

        @keyframes bounceIn {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .logo {
            /* ICONO DEL GAMEPAD RESTAURADO */
            font-size: 7em;
            margin-bottom: 20px;
            animation: rotate3d 4s infinite, glow 2s infinite alternate;
            display: inline-block;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
        }

        @keyframes rotate3d {
            0%, 100% { transform: rotateY(0deg) rotateZ(0deg); }
            25% { transform: rotateY(180deg) rotateZ(5deg); }
            50% { transform: rotateY(360deg) rotateZ(0deg); }
            75% { transform: rotateY(180deg) rotateZ(-5deg); }
        }

        @keyframes glow {
            0% { filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 5px #f093fb); } /* Brillo ne√≥n a√±adido */
            100% { filter: drop-shadow(0 0 30px rgba(255, 255, 255, 1)) drop-shadow(0 0 15px #667eea); }
        }

        /* REGLA 2: S√çMBOLOS MATEM√ÅTICOS FLOTANTES */
        @keyframes floatMath {
          0% { transform: translate(0, 0) rotate(0deg); opacity: 0.5; }
          25% { transform: translate(-10px, -20px) rotate(10deg); opacity: 0.8; }
          50% { transform: translate(0, -40px) rotate(0deg); opacity: 0.6; }
          75% { transform: translate(10px, -20px) rotate(-10deg); opacity: 0.9; }
          100% { transform: translate(0, 0) rotate(0deg); opacity: 0.5; }
        }

        .math-symbol-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .math-symbol {
            position: absolute;
            font-size: 2.5em;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 10px #f093fb, 0 0 5px #667eea;
            animation: floatMath 8s ease-in-out infinite alternate;
            pointer-events: none;
            display: inline-block;
        }

        h1 {
            color: white;
            font-size: 4em;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.6), 
                         0 0 15px rgba(255, 255, 255, 0.5), /* M√°s brillo */
                         0 4px 20px rgba(0, 0, 0, 0.3);
            font-weight: 900;
            letter-spacing: -1px;
            animation: titlePulse 3s infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.8em;
            margin-bottom: 50px;
            font-weight: 300;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            animation: subtitleFloat 3s infinite;
        }

        @keyframes subtitleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* TARJETAS DEL MEN√ö PRINCIPAL (Mejora visual) */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 40px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .menu-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.88)); /* M√°s opacidad */
            border-radius: 30px;
            padding: 50px 40px;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), /* Sombra m√°s difusa */
                        0 0 0 2px rgba(255, 255, 255, 0.5) inset; /* Borde interno sutil */
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
            touch-action: manipulation;
            backdrop-filter: blur(5px); /* Toque futurista */
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 215, 0, 0.4), 
                rgba(255, 255, 255, 0.5), 
                rgba(255, 215, 0, 0.4), 
                transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0.8;
        }

        .menu-card:hover::before,
        .menu-card:active::before {
            left: 100%;
        }

        .menu-card:hover,
        .menu-card:active {
            transform: translateY(-20px) scale(1.08) rotate(2deg);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5), /* Sombra m√°s intensa */
                        0 0 30px rgba(102, 126, 234, 0.8); /* Brillo ne√≥n de hover */
            border-color: rgba(255, 215, 0, 0.8);
        }

        .menu-card::after {
            content: '‚ú®';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2em;
            opacity: 0;
            transition: all 0.4s;
            animation: sparkle 1s infinite;
            text-shadow: 0 0 10px #FFD700;
        }

        .menu-card:hover::after,
        .menu-card:active::after {
            opacity: 1;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .card-icon {
            font-size: 5em;
            margin-bottom: 25px;
            display: block;
            animation: iconBounce 2s infinite;
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.3));
        }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        .menu-card:hover .card-icon,
        .menu-card:active .card-icon {
            animation: iconSpin 0.6s ease-in-out;
        }

        @keyframes iconSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

/* === ESTILO PARA EL POSTEST BLOQUEADO === */
        .menu-card.postest-locked {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            opacity: 0.6;
            position: relative;
        }

        .menu-card.postest-locked::before {
            content: 'üîí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            opacity: 0.3;
            animation: lockShake 2s infinite;
        }

        .menu-card.postest-locked:hover,
        .menu-card.postest-locked:active {
            transform: none;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border-color: transparent;
        }

        .card-title {
            font-size: 2em;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            margin-bottom: 20px;
            animation: titleShimmer 3s infinite;
        }

        @keyframes titleShimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .card-description {
            color: #333; /* Color m√°s oscuro para mejor contraste */
            font-size: 1.15em;
            line-height: 1.8;
            font-weight: 500;
        }

        /* PANTALLAS DE CONTENIDO (Mejora visual) */
        .content-screen {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.99), rgba(255, 255, 255, 0.95)); /* M√°s opacidad */
            border-radius: 40px; /* Bordes m√°s suaves */
            padding: 60px;
            max-width: 950px;
            margin: 40px auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4), /* Sombra m√°s profunda */
                        0 0 0 3px rgba(255, 255, 255, 0.5) inset;
            animation: slideUpFade 0.7s ease-out;
            border: 4px solid rgba(102, 126, 234, 0.5); /* Borde m√°s visible */
            backdrop-filter: blur(8px);
            position: relative; /* Necesario para el aura flotante */
            overflow: visible; /* Necesario para que el aura se extienda */
        }

        @keyframes slideUpFade {
            from { transform: translateY(80px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        /* BOT√ìN DE REGRESO MEJORADO (M√°s luminoso) */
        .back-button {
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.15em;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 35px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.7), /* M√°s brillo de sombra */
                        0 0 20px rgba(255, 255, 255, 0.5) inset,
                        0 0 15px #f093fb; /* Efecto ne√≥n en bot√≥n */
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .back-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5); /* M√°s brillo al click/hover */
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .back-button:hover::before,
        .back-button:active::before {
            width: 300px;
            height: 300px;
        }

        .back-button:hover,
        .back-button:active {
            transform: translateY(-7px) scale(1.05);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.9),
                        0 0 30px rgba(255, 255, 255, 0.7) inset,
                        0 0 20px #4facfe; /* Ne√≥n m√°s fuerte */
        }

        .back-button:active {
            transform: translateY(-3px) scale(1.02);
        }

        /* REGLA 3: ANIMACI√ìN PARA ENCABEZADOS DE SESI√ìN 1 */
        @keyframes bounceGlow {
            0%, 100% { transform: translateY(0) scale(1); filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
            50% { transform: translateY(-5px) scale(1.05); filter: drop-shadow(0 0 10px #FFD700); }
        }

        @keyframes spinGlow {
            0% { transform: rotate(0deg) scale(1); filter: drop-shadow(0 0 5px #764ba2); }
            50% { transform: rotate(180deg) scale(1.1); filter: drop-shadow(0 0 15px #f093fb); }
            100% { transform: rotate(360deg) scale(1); filter: drop-shadow(0 0 5px #764ba2); }
        }

        .content-screen h2 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3em;
            margin-bottom: 35px;
            font-weight: 900;
            text-shadow: 0 5px 20px rgba(102, 126, 234, 0.3); /* Sombra de texto suave */
        }

        .content-screen h3 {
            color: #764ba2;
            font-size: 2em;
            margin-top: 35px;
            margin-bottom: 20px;
            font-weight: 700;
            position: relative;
            padding-left: 45px;
        }

        .content-screen h3::before {
            content: '‚≠ê';
            position: absolute;
            left: 0;
            /* ANIMACI√ìN COMBINADA PARA BRILLO Y MOVIMIENTO */
            animation: starTwinkle 2s infinite, spinGlow 8s linear infinite;
            text-shadow: 0 0 8px #FFD700;
            display: inline-block; /* Permitir transformaciones */
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.15); }
        }

        .content-screen p {
            color: #333;
            font-size: 1.25em;
            line-height: 2;
            margin-bottom: 25px;
            font-weight: 400;
        }

        .content-screen ul {
            margin-left: 40px;
            margin-bottom: 25px;
        }

        .content-screen li {
            color: #444;
            font-size: 1.2em;
            line-height: 2;
            margin-bottom: 15px;
            position: relative;
            padding-left: 10px;
        }

        .content-screen li::before {
            content: 'üí´';
            position: absolute;
            left: -30px;
            text-shadow: 0 0 5px #f093fb;
        }

        /* SECCIONES CON EFECTO MEJORADO */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .section-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: sectionGradient 5s ease infinite;
            border-radius: 25px;
            padding: 40px;
            color: white;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5),
                        0 0 10px rgba(255, 255, 255, 0.5) inset; /* Borde interno brillante */
            border: 3px solid rgba(255, 255, 255, 0.5);
            touch-action: manipulation;
            backdrop-filter: blur(3px);
        }

        @keyframes sectionGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .section-card::before {
            content: '‚ú®';
            position: absolute;
            font-size: 4em;
            opacity: 0.2;
            top: 10px;
            left: 10px;
            animation: starFloat 3s infinite;
            text-shadow: 0 0 10px white;
        }

        @keyframes starFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(180deg); }
        }

        .section-card.locked {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            opacity: 0.6; /* Un poco m√°s de opacidad en bloqueado */
        }

        .section-card:not(.locked):hover,
        .section-card:not(.locked):active {
            transform: translateY(-15px) scale(1.05) rotate(-1deg);
            box-shadow: 0 30px 70px rgba(102, 126, 234, 0.8), /* Sombra hover m√°s fuerte */
                        0 0 40px rgba(255, 255, 255, 0.6);
            border-color: rgba(255, 215, 0, 0.9);
        }

        .section-card:not(.locked):active {
            transform: translateY(-10px) scale(1.02);
        }

        .section-number {
            font-size: 4em;
            font-weight: 900;
            margin-bottom: 15px;
            opacity: 0.3;
            position: absolute;
            top: 15px;
            right: 20px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .section-title {
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
        }

        .section-status {
            font-size: 1em;
            opacity: 0.95;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .lock-icon {
            font-size: 3em;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.5;
            z-index: 0;
            animation: lockShake 2s infinite;
        }

        @keyframes lockShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        /* Animaci√≥n de desbloqueo */
        @keyframes unlock {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .section-card.unlocked {
            animation: unlock 0.8s ease-out;
        }

        /* BADGE DE PROGRESO */
        .progress-badge {
            position: fixed;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.98));
            padding: 20px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4),
                        0 0 0 3px rgba(102, 126, 234, 0.5);
            font-weight: 700;
            color: #667eea;
            z-index: 100;
            animation: badgeSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        @keyframes badgeSlideIn {
            from { transform: translateX(200px) rotate(180deg); opacity: 0; }
            to { transform: translateX(0) rotate(0deg); opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 12px; /* Un poco m√°s grueso */
            background: rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            margin-top: 12px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2) inset;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            background-size: 200% 100%;
            animation: progressShine 2s linear infinite;
            border-radius: 12px;
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.8);
        }

        @keyframes progressShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        /* FOOTER */
        .footer {
            text-align: center;
            padding: 50px 20px;
            color: white;
            font-size: 1em;
            margin-top: 80px;
        }

        .footer-info {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            max-width: 750px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3),
                        0 0 0 2px rgba(255, 255, 255, 0.3) inset;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* EFECTOS DE CONFETI */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            position: absolute;
            animation: confettiFall 3s linear;
            pointer-events: none;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }


        /* ================================================= */
        /* === ESTILOS NUEVOS Y MODIFICADOS PARA SESI√ìN 1 === */
        /* ================================================= */
        
        #session1Screen .content-screen {
            max-width: 1000px;
            padding: 50px 30px;
        }

        #session1Screen .back-button {
            position: absolute; 
            top: 20px; 
            left: 20px;
            margin-bottom: 0; /* Anula el margen del back-button general */
        }
        
        /* REGLA 3: Icono principal de Sesi√≥n 1 con glow */
        .session-header-icon {
            font-size: 5em; 
            color: #764ba2; 
            animation: pulse 2s infinite alternate, bounceGlow 6s ease-in-out infinite; /* Combinaci√≥n de animaciones */
            display: inline-block;
        }
        
        .session-title-gradient {
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
            font-size: 3.5em; 
            margin-top: 10px; 
            font-weight: 900; 
            line-height: 1.2; 
            margin-bottom: 10px;
        }
        
        .content-grid-session1 {
            display: grid; 
            grid-template-columns: 1fr 1.5fr; 
            gap: 30px; 
            margin-top: 30px;
        }

        .card-session {
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); /* Sombra m√°s fuerte */
            border: 2px solid #ddd;
            height: fit-content;
        }

        .objective-card {
            background: linear-gradient(135deg, #e6e9f0, #eef1f5);
            border-left: 8px solid #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3); /* Brillo azul */
        }

        .learning-card {
            background: linear-gradient(135deg, #f093fb30, #fff); /* Degradado m√°s transparente */
            border-right: 8px solid #f093fb;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(240, 147, 251, 0.3); /* Brillo rosa */
        }

        .card-session h3 {
            display: flex;
            align-items: center;
            font-size: 1.8em;
            color: #667eea;
            font-weight: 800;
            margin-bottom: 20px;
            padding-left: 0; /* Anular el padding del h3 general */
            text-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }
        
        .card-session h3::before {
            content: none; /* Anular el icono de estrella del h3 general */
        }

        .card-session p {
            color: #444;
            font-size: 1.1em;
            line-height: 1.7;
        }
        
        .learning-list {
            list-style: none;
            padding: 0;
        }

        .learning-list-item {
            background: rgba(255, 255, 255, 0.85); /* M√°s opacidad */
            padding: 15px 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 1.15em;
            color: #555;
            font-weight: 600;
            display: flex;
            align-items: flex-start;
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 5px solid #764ba2;
        }
        
        .learning-list-item span {
            font-size: 1.2em;
            margin-right: 15px;
            color: #FFD700; 
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.8)); /* Brillo de estrella */
            animation: starJiggle 1s infinite alternate;
        }

        /* Estilos de Botones de Navegaci√≥n de Sesi√≥n 1 */
        .session1-nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 50px;
        }

        .session-nav-card {
            background: linear-gradient(135deg, #fff, #f0f3ff);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            border: 2px solid #ddd;
        }

        .session-nav-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25),
                        0 0 10px #667eea; /* Ne√≥n sutil */
            border-color: #667eea;
        }

        .session-nav-card-icon {
            font-size: 3em;
            color: #764ba2;
            margin-bottom: 10px;
        }

        .session-nav-card h4 {
            font-size: 1.4em;
            font-weight: 800;
            color: #667eea;
        }


        /* Animaciones Espec√≠ficas de Sesi√≥n 1 */
        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 10px rgba(118, 75, 162, 0.5); }
            100% { transform: scale(1.05); text-shadow: 0 0 20px rgba(118, 75, 162, 0.8); }
        }

        @keyframes starJiggle {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(15deg); }
        }

        /* ================================================= */
        /* === NUEVOS ESTILOS PARA DRAG & DROP Y QUIZ === */
        /* ================================================= */
        
        /* Estilos para el juego Drag & Drop (Sesi√≥n 1) */ 
        .drag-pool { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            padding: 20px; 
            background: #f0f3ff; 
            border-radius: 20px; 
            min-height: 150px; 
            align-items: center; 
            justify-content: center; 
            margin-bottom: 40px; 
            border: 3px dashed #667eea; /* Borde m√°s grueso */ 
        } 
        
       .drag-zones { 
    display: grid; 
    grid-template-columns: 1fr 1fr 1fr; /* <--- CAMBIAR A TRES COLUMNAS */
    gap: 30px; 
}
        
        .token { 
            background: linear-gradient(135deg, #FFD700, #FFC700); 
            color: #444; 
            padding: 15px 25px; 
            border-radius: 12px; 
            font-size: 1.5em; 
            font-weight: 800; 
            cursor: grab; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 8px rgba(255, 215, 0, 0.8); /* Brillo dorado */ 
            transition: transform 0.3s, opacity 0.3s, box-shadow 0.3s; 
            touch-action: none; /* Mejorar el arrastre en m√≥vil */ 
        } 
        
        .token:hover { 
            transform: scale(1.1) rotate(2deg); 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4); 
        } 
        
        .token.dragging { 
            opacity: 0.8; 
            transform: scale(1.15) rotate(5deg); 
        } 
        
        .token.correct { 
            cursor: default; 
            background: linear-gradient(135deg, #2ecc71, #27ae60); 
            color: white; 
            box-shadow: 0 0 15px rgba(46, 204, 113, 1); /* Brillo verde fuerte */ 
            transform: none !important; 
        } 
        
        .dropzone { 
            background: #e6e9f0; 
            border: 3px dashed #764ba2; 
            border-radius: 20px; 
            padding: 25px; 
            text-align: center; 
            min-height: 250px; 
            transition: all 0.3s;
        } 
        
        .dropzone:hover {
            background: #f0f3ff;
        }
        
        .dropzone.drag-over { 
            background: #dcdfe6; 
            border-color: #667eea; 
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5); 
        } 
        
        .dropzone.correct-zone {
            background: linear-gradient(135deg, #d4edda, #e2ffe8);
            border-color: #2ecc71;
        }
        
        .drag-pool-title {
            font-size: 1.8em; 
            font-weight: 800; 
            color: #764ba2; 
            margin-bottom: 20px; 
            text-align: center;
        }

        .completion-message {
            margin-top: 30px; 
            padding: 20px; 
            border-radius: 15px; 
            background: linear-gradient(90deg, #f093fb, #4facfe); 
            color: white; 
            font-size: 1.5em; 
            font-weight: 700; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
        }

        /* Estilos para el Quiz */
        .quiz-container {
            margin-top: 30px;
            padding: 40px;
            border-radius: 30px;
            background: linear-gradient(135deg, #f0f3ff, #e9edff);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .quiz-item {
            padding: 20px 25px;
            margin-bottom: 20px;
            border-radius: 15px;
            background: #ffffff;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .quiz-item:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            border-color: #764ba2;
        }

        .quiz-item label {
            font-size: 1.25em;
            font-weight: 600;
            color: #2c3e50;
        }

        .quiz-input {
            padding: 12px 18px;
            border-radius: 10px;
            border: 2px solid #ccc;
            font-size: 1.15em;
            width: 180px; 
            text-align: right;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .quiz-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            outline: none;
        }

        .submit-quiz-button {
            margin-top: 30px; 
            width: 100%; 
            background: linear-gradient(45deg, #00f2fe, #4facfe); 
            color: #333; 
            border: none; 
            font-size: 1.3em; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.4s; 
            box-shadow: 0 10px 30px rgba(0, 242, 254, 0.6), 0 0 15px #ffffff inset; 
        } 
        
        .submit-quiz-button:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 40px rgba(0, 242, 254, 0.8), 0 0 20px #ffffff inset; 
        } 
        
        .quiz-results { 
            margin-top: 30px; 
            padding: 25px; 
            border-radius: 15px; 
            background: linear-gradient(135deg, #fff0f7, #ffffff); /* Fondo rosa claro */
            border: 4px solid #f093fb; /* Borde rosa ne√≥n */
            display: none; 
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4); 
            text-align: left;
        } 
        
        .correct-text { 
            color: #2ecc71; 
            font-weight: 700; 
        } 
        
        .incorrect-text { 
            color: #e74c3c; 
            font-weight: 700; 
        } 
        
        .result-list { 
            list-style: none; 
            padding: 0; 
            margin: 20px 0 0 0; 
            text-align: left; 
        } 
        
        @media (max-width: 768px) { 
            .drag-zones { 
                grid-template-columns: 1fr; 
            } 
        } 

        /* ================================================= */
        /* === MEJORAS VISUALES ADICIONALES (SOLICITADAS) === */
        /* ================================================= */

        /* 1. MEJORA GENERAL DE LECTURA DE CONTENIDO (P, LI) */
        .content-screen p {
            color: #2c3e50; /* Color de texto m√°s profundo para mayor legibilidad */
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7); /* Sombra de texto suave */
        }

        /* 2. TEOR√çA: Bloques de Conceptos (Enteros Positivos, Cero, Negativos) */
        #session1TheoryScreen ul li {
            margin-bottom: 25px; 
            padding: 25px; 
            border-radius: 25px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); 
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 2px solid transparent;
            list-style: none;
            font-weight: 500;
        }

        #session1TheoryScreen ul li:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            border-color: #f093fb; /* Borde de enfoque */
        }

        /* Enteros Positivos (Verde Did√°ctico) */
        #session1TheoryScreen ul li:nth-child(1) {
            background: linear-gradient(135deg, #d4edda, #f3fff5); 
            border-left: 10px solid #2ecc71;
        }
        #session1TheoryScreen ul li:nth-child(1) strong {
            color: #27ae60;
        }
        /* REGLA 3: Animaci√≥n para el icono de li */
        #session1TheoryScreen ul li:nth-child(1)::before {
            content: '‚úÖ';
            left: -35px;
            text-shadow: 0 0 5px #2ecc71;
            display: inline-block;
            animation: bounceGlow 4s ease-in-out infinite alternate;
        }

        /* El Cero (Gris/Blanco Neutro) */
        #session1TheoryScreen ul li:nth-child(2) {
            background: linear-gradient(135deg, #f0f4f7, #ffffff);
            border-left: 10px solid #95a5a6;
        }
        #session1TheoryScreen ul li:nth-child(2) strong {
            color: #7f8c8d;
        }
        /* REGLA 3: Animaci√≥n para el icono de li */
        #session1TheoryScreen ul li:nth-child(2)::before {
            content: '‚ö™';
            left: -35px;
            text-shadow: 0 0 5px #95a5a6;
            display: inline-block;
            animation: bounceGlow 4.5s ease-in-out infinite alternate;
        }

        /* Enteros Negativos (Rojo Alerta) */
        #session1TheoryScreen ul li:nth-child(3) {
            background: linear-gradient(135deg, #f8d7da, #fff7f7); 
            border-left: 10px solid #e74c3c;
        }
        #session1TheoryScreen ul li:nth-child(3) strong {
            color: #c0392b;
        }
        /* REGLA 3: Animaci√≥n para el icono de li */
        #session1TheoryScreen ul li:nth-child(3)::before {
            content: '‚ùå';
            left: -35px;
            text-shadow: 0 0 5px #e74c3c;
            display: inline-block;
            animation: bounceGlow 5s ease-in-out infinite alternate;
        }

        /* 3. Bloque de Datos Curiosos */
        #session1TheoryScreen .content-screen p:nth-of-type(4) {
            margin-top: 40px;
            padding: 30px;
            border-radius: 20px;
            background: linear-gradient(135deg, #fceabb, #f8b500); /* Degradado Dorado */
            border: 5px solid #ffcc00;
            box-shadow: 0 15px 40px rgba(255, 198, 0, 0.5);
            font-size: 1.15em;
            line-height: 1.8;
            color: #6d4c41; /* Marr√≥n oscuro para contraste */
            position: relative;
            overflow: hidden;
            font-weight: 600;
            animation: knowledgeGlow 3s infinite alternate;
        }

        #session1TheoryScreen .content-screen p:nth-of-type(4)::after {
            content: 'üìú'; /* √çcono de pergamino/historia */
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 4em;
            opacity: 0.5;
            text-shadow: 0 0 10px #FFD700;
        }

        @keyframes knowledgeGlow {
            0% { transform: scale(1); box-shadow: 0 15px 40px rgba(255, 198, 0, 0.4); }
            100% { transform: scale(1.01); box-shadow: 0 15px 40px rgba(255, 198, 0, 0.7); }
        }

        /* 4. DRAG & DROP: Mejora de Zonas de Soltar */
        #session1DragScreen .dropzone {
            border: 4px dashed; /* Borde m√°s llamativo */
            border-color: #764ba2;
            background: linear-gradient(145deg, #f8faff, #ebedf7); /* Fondo m√°s claro */
            transition: background 0.3s, border-color 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        #session1DragScreen .dropzone h3 {
            background: none;
            color: #764ba2;
        }
        
        #session1DragScreen .dropzone p {
            font-size: 1.05em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        #session1DragScreen .dropzone.drag-over {
            border-color: #f093fb;
            background: linear-gradient(145deg, #f0f3ff, #f3e9f5);
            transform: scale(1.02);
            box-shadow: 0 15px 30px rgba(240, 147, 251, 0.3);
        }

        /* 5. DRAG & DROP: Token de Arrastre */
        .token {
            background: linear-gradient(135deg, #FFD700, #ffc400); /* Dorado m√°s intenso */
            color: #333;
            font-size: 1.6em; /* Un poco m√°s grande */
            border: 2px solid #a88d00;
        }

        .token:hover {
            transform: scale(1.1) rotate(0deg); /* Menos rotaci√≥n en hover para mejor UX */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4), 0 0 15px #FFD700;
        }

        .token.correct {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: 2px solid #1e8449;
            animation: correctPulse 0.5s;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* 6. OPERACIONES: Reglas de la Suma/Resta */
        #session1OperationsScreen .content-screen ul {
            list-style: none;
            padding: 0;
        }

        #session1OperationsScreen .content-screen li {
            background: linear-gradient(135deg, #e6f7ff, #f0f8ff); /* Fondo azul beb√© suave */
            color: #0d47a1;
            border-left: 8px solid #42a5f5;
            margin-bottom: 20px;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            line-height: 1.7;
        }

        #session1OperationsScreen .content-screen li:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Regla 1: Signos Iguales */
        #session1OperationsScreen .content-screen ul:nth-of-type(1) li {
            border-left-color: #ff9800; /* Naranja */
            background: linear-gradient(135deg, #fff3e0, #fff9f0);
            color: #e65100;
        }

        /* Regla 2: Signos Diferentes */
        #session1OperationsScreen .content-screen ul:nth-of-type(2) li {
            border-left-color: #66bb6a; /* Verde lima */
            background: linear-gradient(135deg, #e8f5e9, #f5fff6);
            color: #2e7d32;
        }

        /* Resta como suma del opuesto */
        #session1OperationsScreen .content-screen ul:nth-of-type(3) li {
            border-left-color: #f06292; /* Rosa */
            background: linear-gradient(135deg, #fce4ec, #fff0f5);
            color: #ad1457;
        }

        /* REGLA 3: Animaci√≥n para el icono de li en Operaciones */
        #session1OperationsScreen .content-screen li::before {
            content: '‚û°Ô∏è'; /* Icono de flecha en vez de estrella */
            text-shadow: 0 0 5px #f093fb;
            display: inline-block;
            animation: bounceGlow 4s ease-in-out infinite alternate;
        }

        /* 7. QUIZ: Mejora de Items y Campos de Texto */
        #session1QuizScreen .quiz-container {
            padding: 30px;
            border-radius: 30px;
            background: linear-gradient(135deg, #ffffff, #f7f9ff);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        #session1QuizScreen .quiz-item {
            background: #fdfdff;
            padding: 20px 25px;
            margin-bottom: 15px;
            border-radius: 15px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
            display: flex; /* Para alinear label e input */
            align-items: center;
            justify-content: space-between;
        }

        #session1QuizScreen .quiz-item:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        #session1QuizScreen .quiz-item label {
            font-size: 1.2em;
            font-weight: 600;
            color: #444;
        }

        #session1QuizScreen .quiz-input {
            padding: 12px 18px;
            border-radius: 10px;
            border: 2px solid #ccc;
            font-size: 1.1em;
            width: 180px; /* Ancho fijo para inputs */
            text-align: right;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #session1QuizScreen .quiz-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            outline: none;
        }
        
        /* 8. FONDOS ESPEC√çFICOS PARA CADA PANTALLA DE SESI√ìN 1 (Solicitado) */

        /* REGLA 4: Aura flotante base para todos los content-screen de la sesi√≥n 1 */
        .content-screen::before {
            content: '';
            position: absolute;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            border-radius: 40px; 
            z-index: -1;
            animation: subtleFloat 15s ease-in-out infinite alternate;
            pointer-events: none;
            filter: blur(40px); /* Soft glow effect */
            opacity: 0.5;
        }

        @keyframes subtleFloat {
            0% { transform: translateY(0) scale(1); opacity: 0.5; }
            100% { transform: translateY(15px) scale(1.02); opacity: 0.8; }
        }

        /* √çndice de Sesi√≥n 1 (Azul suave) */
        #session1Screen .content-screen {
            background: linear-gradient(135deg, #f0f4ff, #e9edff); 
            border: 4px solid rgba(102, 126, 234, 0.5); 
        }
        #session1Screen .content-screen::before {
            background: #667eea; 
        }

        /* Teor√≠a: El Mundo de los N√∫meros Enteros (Rosa/Lila suave) */
        #session1TheoryScreen .content-screen {
            background: linear-gradient(135deg, #fff0f5, #fcf5ff); 
            border: 4px solid rgba(240, 147, 251, 0.5);
        }
        #session1TheoryScreen .content-screen::before {
            background: #f093fb;
            animation-duration: 16s;
        }

        /* Drag & Drop: Clasificaci√≥n (Amarillo/Oro suave) */
        #session1DragScreen .content-screen {
            background: linear-gradient(135deg, #fffcf0, #fffddf); 
            border: 4px solid rgba(255, 215, 0, 0.5);
        }
        #session1DragScreen .content-screen::before {
            background: #FFD700;
            animation-duration: 14s;
        }

        /* Valor Absoluto: Desaf√≠o (Aqua/Menta suave) */
        #session1ChallengeScreen .content-screen {
            background: linear-gradient(135deg, #e6fff4, #f0fff8); 
            border: 4px solid rgba(0, 242, 254, 0.5);
        }
        #session1ChallengeScreen .content-screen::before {
            background: #00f2fe;
            animation-duration: 17s;
        }

        /* Operaciones: Suma y Resta (Naranja/Melocot√≥n suave) */
        #session1OperationsScreen .content-screen {
            background: linear-gradient(135deg, #fff5e6, #fffbf0); 
            border: 4px solid rgba(255, 165, 0, 0.5);
        }
        #session1OperationsScreen .content-screen::before {
            background: #ffa500;
            animation-duration: 18s;
        }

        /* Quiz Final (Blanco puro/Gris claro) */
        #session1QuizScreen .content-screen {
            background: linear-gradient(135deg, #f7f7f7, #ffffff); 
            border: 4px solid rgba(127, 140, 141, 0.5);
        }
        #session1QuizScreen .content-screen::before {
            background: #95a5a6;
            animation-duration: 13s;
        }
/* FONDOS DE COLOR PARA SESI√ìN 2 */

/* Teor√≠a: Multiplicaci√≥n y Divisi√≥n (Verde menta) */
#session2TheoryScreen .content-screen {
    background: linear-gradient(135deg, #e8f5e9, #f1f8f4); 
    border: 4px solid rgba(76, 175, 80, 0.5);
}
#session2TheoryScreen .content-screen::before {
    background: #4caf50;
    animation-duration: 16s;
}

/* Juego en Clase: Batalla de Signos (Naranja) */
#session2GameClassScreen .content-screen {
    background: linear-gradient(135deg, #fff3e0, #fffaf0); 
    border: 4px solid rgba(255, 152, 0, 0.5);
}
#session2GameClassScreen .content-screen::before {
    background: #ff9800;
    animation-duration: 14s;
}

/* Juego Arcade (Morado oscuro) */
#session2ArcadeScreen .content-screen {
    background: linear-gradient(135deg, #f3e5f5, #faf0fc); 
    border: 4px solid rgba(156, 39, 176, 0.5);
}
#session2ArcadeScreen .content-screen::before {
    background: #9c27b0;
    animation-duration: 17s;
}

/* Jerarqu√≠a de Operaciones (Azul √≠ndigo) */
#session2HierarchyScreen .content-screen {
    background: linear-gradient(135deg, #e8eaf6, #f0f1ff); 
    border: 4px solid rgba(63, 81, 181, 0.5);
}
#session2HierarchyScreen .content-screen::before {
    background: #3f51b5;
    animation-duration: 18s;
}

/* Reto 5: Pr√°ctica con Jerarqu√≠a (Naranja/Salm√≥n) */
#session2PracticeScreen .content-screen {
    background: linear-gradient(135deg, #fff3e6, #fffaf5); 
    border: 4px solid rgba(255, 128, 0, 0.5);
}
#session2PracticeScreen .content-screen::before {
    background: #ff8000;
    animation-duration: 15s;
}

/* ========== ESTILOS CULEBRITA ========== */
</style>
</head>
<body>
<div class="stars-container" id="stars-container"></div>
<div class="particles" id="particles"></div>
<div class="progress-badge" id="progressBadge" style="display: none;">
    Progreso Total: <span id="progressText">0%</span>
    <div class="progress-bar">
        <div class="progress-fill" id="progressBarFill" style="width: 0%;"></div>
    </div>
</div>
<div class="container">
    
    <div class="screen active" id="homeScreen">
        <div class="home-screen">
            <div class="logo-container">
                <div class="logo">üéÆ</div>
                <div class="math-symbol-wrapper" id="mathSymbolsWrapper">
                    </div>
            </div>
            <h1>Unidad Did√°ctica Gamificada</h1>
            <p class="subtitle">Matem√°ticas | Grado 8¬∞</p>

            <div class="menu-grid">
                <div class="menu-card" onclick="showScreen('introScreen')">
                    <span class="card-icon">üí°</span>
                    <h2 class="card-title">Misi√≥n Z: Introducci√≥n</h2>
                    <p class="card-description">Descubre el prop√≥sito de esta unidad y la metodolog√≠a de aprendizaje gamificado.</p>
                </div>
                <div class="menu-card" onclick="showScreen('objectivesScreen')">
                    <span class="card-icon">üéØ</span>
                    <h2 class="card-title">Objetivos</h2>
                    <p class="card-description">Conoce las metas espec√≠ficas que alcanzar√°s y c√≥mo ser√° evaluado tu progreso.</p>
                </div>
<div class="menu-card" onclick="window.open('https://andres5050-sudo.github.io/Pretest-Octavo2/', '_blank')">
        <span class="card-icon">üìù</span>
        <h2 class="card-title">Pretest</h2>
        <p class="card-description">Realiza la evaluaci√≥n diagn√≥stica inicial para medir tu nivel antes de comenzar.</p>
    </div>

                <div class="menu-card" onclick="showScreen('sectionsScreen')">
                    <span class="card-icon">üöÄ</span>
                    <h2 class="card-title">Comenzar Aventura</h2>
                    <p class="card-description">Accede a las 6 sesiones de aprendizaje. ¬°Cada sesi√≥n desbloquea la siguiente!</p>
                </div>

<div class="menu-card" id="postestCard" onclick="openPostest()">
        <span class="card-icon">üèÜ</span>
        <h2 class="card-title">Postest</h2>
        <p class="card-description">Evaluaci√≥n final para medir tu progreso despu√©s de completar todas las sesiones.</p>
    </div>
            </div>
        </div>
    </div>

    <div class="screen" id="introScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('homeScreen')">‚Üê Volver al inicio</button>
            <h2>üí° Misi√≥n Z: Introducci√≥n a la Unidad</h2>

            <h3>¬øQu√© aprender√°s?</h3>
            <p>Esta unidad did√°ctica se enfoca en afianzar tus conocimientos sobre los conjuntos num√©ricos fundamentales, espec√≠ficamente:</p>
            <ul>
                <li><strong>N√∫meros Enteros (‚Ñ§):</strong> Valor absoluto, representaci√≥n y operaciones b√°sicas (suma, resta, multiplicaci√≥n y divisi√≥n).</li>
                <li><strong>N√∫meros Racionales (Fracciones):</strong> Concepto, equivalencia, simplificaci√≥n y las 4 operaciones fundamentales con signos.</li>
            </ul>

            <h3>Estructura de las Sesiones</h3>
            <p>La unidad est√° dividida en 6 sesiones, cada una con una serie de retos y actividades que deber√°s completar para avanzar. ¬°El √©xito en una sesi√≥n desbloquea la siguiente!</p>
            <ul>
                <li><strong>Sesi√≥n 1:</strong> N√∫meros enteros (I): concepto, valor absoluto, suma y resta con signos.</li>
                <li><strong>Sesi√≥n 2:</strong> N√∫meros enteros (II): multiplicaci√≥n, divisi√≥n y jerarqu√≠a de operaciones (b√°sica).</li>
                <li><strong>Sesi√≥n 3:</strong> Jerarqu√≠a completa de operaciones combinadas con n√∫meros enteros.</li>
                <li><strong>Sesi√≥n 4:</strong> Fracciones (I): simplificaci√≥n, amplificaci√≥n y las 4 operaciones fundamentales.</li>
                <li><strong>Sesi√≥n 5:</strong> Fracciones (II): operaciones con 3+ t√©rminos, MCM y operaciones combinadas avanzadas.</li>
                <li><strong>Sesi√≥n 6:</strong> Fracciones (III): jerarqu√≠a de operaciones con fracciones y repaso integral.</li>
            </ul>

            <h3>¬øPor qu√© es diferente esta unidad?</h3>
            <ul>
                <li><strong>üéÆ Aprendizaje Activo:</strong> No ser√°s un espectador pasivo. Resolver√°s desaf√≠os, completar√°s misiones y subir√°s de nivel mientras aprendes.</li>
                <li><strong>üí° Aprendizaje Significativo:</strong> Conectar√°s los nuevos conceptos matem√°ticos con lo que ya sabes.</li>
                <li><strong>üöÄ Progreso Visible:</strong> Sabr√°s exactamente cu√°nto has avanzado y qu√© te falta por lograr.</li>
            </ul>

            <p>Esta experiencia no es solo una clase, es una Misi√≥n Z. Tu participaci√≥n en este proyecto es fundamental, ya que esta investigaci√≥n busca evaluar c√≥mo las estrategias gamificadas mediadas por tecnolog√≠a pueden mejorar tu aprendizaje significativo en matem√°ticas.</p>

            <p>No est√°s solo en este viaje. Tu participaci√≥n activa, tus opiniones y tus avances son fundamentales para transformar la ense√±anza de las matem√°ticas, no solo en nuestro colegio, sino potencialmente en muchos otros.</p>

            <h3>¬øListo para comenzar?</h3>
            <p>Explora los objetivos y luego sum√©rgete en las 6 sesiones dise√±adas para ti. Recuerda: cada sesi√≥n debe completarse antes de desbloquear la siguiente. ¬°El desaf√≠o te espera!</p>
        </div>
    </div>

    <div class="screen" id="objectivesScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('homeScreen')">‚Üê Volver al inicio</button>
            <h2>üéØ Objetivos de la Unidad Did√°ctica</h2>

            <h3>Objetivo General</h3>
            <p>Evaluar los efectos de la implementaci√≥n de estrategias de gamificaci√≥n mediadas por tecnolog√≠a en el aprendizaje significativo de matem√°ticas en estudiantes de grado octavo, transformando tu experiencia educativa en algo memorable y efectivo.</p>

            <h3>Objetivos Espec√≠ficos</h3>

            <h3>1Ô∏è‚É£ Diagnosticar tu Punto de Partida (Pretest)</h3>
            <p>Antes de comenzar las sesiones, realizar√°s una <strong>evaluaci√≥n inicial (pretest)</strong> que nos permitir√° identificar tu nivel actual de comprensi√≥n matem√°tica sobre n√∫meros enteros y fracciones. Esta prueba diagn√≥stica nos ayuda a:</p>
            <ul>
                <li>üìä Conocer tus conocimientos previos sobre el tema.</li>
                <li>üéØ Ajustar la unidad did√°ctica a tus necesidades.</li>
                <li>üõ†Ô∏è Servir como l√≠nea base para medir tu progreso.</li>
            </ul>

            <h3>2Ô∏è‚É£ Inmersi√≥n en las Sesiones (Gamificaci√≥n)</h3>
            <p>Durante las 6 sesiones, participar√°s en actividades dise√±adas bajo el marco de la gamificaci√≥n, que incluyen:</p>
            <ul>
                <li>üìö <strong>Recursos Digitales Interactivos:</strong> Videos, infograf√≠as y simulaciones para una mejor comprensi√≥n.</li>
                <li>üí° <strong>Retos y Misiones:</strong> Actividades de arrastrar y soltar, minijuegos y desaf√≠os de c√°lculo que te dar√°n puntos y medir√°n tu progreso.</li>
                <li>üìà <strong>Feedback Inmediato:</strong> Sabr√°s al instante si tus respuestas son correctas o incorrectas, acelerando tu aprendizaje.</li>
                <li>ü§ù <strong>Trabajo Colaborativo:</strong> Actividades en equipo que enriquecen tu comprensi√≥n mediante la interacci√≥n con tus compa√±eros.</li>
            </ul>

            <h3>3Ô∏è‚É£ Evaluar el Cambio (Postest)</h3>
            <p>Al finalizar las 6 sesiones, realizar√°s la <strong>misma evaluaci√≥n (postest)</strong> que hiciste al inicio. Esto nos permitir√°:</p>
            <ul>
                <li>‚úÖ Medir objetivamente cu√°nto has avanzado en tu aprendizaje.</li>
                <li>‚úÖ Comparar tu nivel inicial con tu nivel final.</li>
                <li>‚úÖ Evaluar la efectividad de la gamificaci√≥n en tu caso particular.</li>
                <li>‚úÖ Identificar los aspectos donde nuestra intervenci√≥n ha tenido mayor impacto.</li>
            </ul>

            <h3>El Aprendizaje Significativo</h3>
            <p>Buscamos que tu aprendizaje sea <strong>significativo</strong>, lo que implica:</p>
            <ul>
                <li>üí° Poder explicar los conceptos con tus propias palabras.</li>
                <li>üîó Relacionar ideas nuevas con conocimientos que ya ten√≠as.</li>
                <li>üéØ Aplicar lo aprendido en situaciones diferentes a las vistas en clase.</li>
                <li>üß† Comprender el "por qu√©" detr√°s de cada procedimiento matem√°tico.</li>
            </ul>

            <h3>üåü Tu Rol es Fundamental</h3>
            <p>No eres un "sujeto de estudio", sino un <strong>participante activo</strong> cuya voz importa. Tus opiniones, dudas, descubrimientos y sugerencias ser√°n escuchadas y valoradas durante todo el proceso. Tu experiencia ayudar√° a mejorar la ense√±anza de las matem√°ticas para futuras generaciones.</p>

            <h3>üî¨ Enfoque de Investigaci√≥n-Acci√≥n</h3>
            <p>Esta unidad did√°ctica se basa en un modelo de investigaci√≥n-acci√≥n, lo que significa que:</p>
            <ul>
                <li>üìä Se monitorea constantemente qu√© funciona y qu√© puede mejorar.</li>
                <li>üîÑ Se realizan ajustes sobre la marcha para optimizar tu experiencia.</li>
                <li>ü§ù Docentes y estudiantes colaboran en la construcci√≥n del conocimiento.</li>
                <li>üéì El objetivo final es transformar positivamente tu aprendizaje.</li>
                <li>üìù El pretest y postest proporcionan evidencia cient√≠fica del impacto de la gamificaci√≥n.</li>
            </ul>

            <p style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border-radius: 20px; border-left: 6px solid #667eea; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);"> <strong>üí™ ¬°Tu esfuerzo es parte de esta gran misi√≥n!</strong></p>
        </div>
    </div>
    
    <div class="screen" id="sectionsScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('homeScreen')">‚Üê Volver al inicio</button>
            <h2>üó∫Ô∏è Mapa de Sesiones: Misi√≥n Z</h2>
            <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;">Selecciona una sesi√≥n para comenzar. Debes completar cada una para desbloquear la siguiente y avanzar en la Misi√≥n Z. ¬°Prep√°rate para subir de nivel!</p>

            <div class="sections-grid">
                <div class="section-card" data-section="1" onclick="enterSection(1)">
                    <div class="section-number">01</div>
                    <div class="section-title">üéØ Sesi√≥n 1</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">N√∫meros enteros y operaciones b√°sicas (I).</div>
                    <div class="section-status">
                        <span>‚óè</span> Disponible - ¬°Comienza aqu√≠!
                    </div>
                </div>

                <div class="section-card locked" data-section="2">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">02</div>
                    <div class="section-title">‚ú® Sesi√≥n 2</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Operaciones con enteros (II): multiplicaci√≥n, divisi√≥n y jerarqu√≠a b√°sica.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 1.
                    </div>
                </div>

                <div class="section-card locked" data-section="3">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">03</div>
                    <div class="section-title">üß† Sesi√≥n 3</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Jerarqu√≠a completa de operaciones combinadas con enteros.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 2.
                    </div>
                </div>

                <div class="section-card locked" data-section="4">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">04</div>
                    <div class="section-title">‚ö° Sesi√≥n 4</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Fracciones (I): concepto, equivalencia y simplificaci√≥n.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 3.
                    </div>
                </div>

                <div class="section-card locked" data-section="5">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">05</div>
                    <div class="section-title">üé® Sesi√≥n 5</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Fracciones (II): operaciones con 3+ t√©rminos, MCM y combinadas (con signos).</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 4.
                    </div>
                </div>

                <div class="section-card locked" data-section="6">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">06</div>
                    <div class="section-title">üèÜ Sesi√≥n 6</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Fracciones (III): multiplicaci√≥n, divisi√≥n y expresiones combinadas.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 5.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="screen" id="session1Screen">
        <div class="content-screen" style="position: relative;">
            <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
            <div style="text-align: center; margin-top: 30px;">
                <div class="session-header-icon">üéØ</div>
                <h2 class="session-title-gradient">Sesi√≥n 1: N√∫meros Enteros (I)</h2>
                <p style="font-size: 1.3em; color: #555; font-weight: 500;">¬°Tu aventura con los n√∫meros enteros comienza aqu√≠!</p>
            </div>

            <div class="content-grid-session1">
                <div class="card-session objective-card">
                    <h3>Objetivo de Sesi√≥n</h3>
                    <p>Al finalizar esta sesi√≥n, ser√°s capaz de identificar y clasificar los n√∫meros enteros, calcular su valor absoluto y aplicar las reglas de la suma y la resta con precisi√≥n en cualquier situaci√≥n.</p>
                </div>
                <div class="card-session learning-card">
                    <h3>Ruta de Aprendizaje</h3>
                    <ul class="learning-list">
                        <li class="learning-list-item" onclick="showScreen('session1TheoryScreen')"><span>üìö</span> Teor√≠a: El Mundo de los N√∫meros (Reto Inicial).</li>
                        <li class="learning-list-item" onclick="showScreen('session1DragScreen')"><span>üí°</span> Clasificaci√≥n de N√∫meros (Reto de Arrastre).</li>
                        <li class="learning-list-item" onclick="showScreen('session1ChallengeScreen')"><span>üèÜ</span> Valor Absoluto: El Desaf√≠o de la Distancia al Cero.</li>
                        <li class="learning-list-item" onclick="showScreen('session1OperationsScreen')"><span>üéÆ</span> Suma y Resta de Enteros + Juego Caza de Enteros.</li>
                        <li class="learning-list-item" onclick="showScreen('session1QuizScreen')"><span>üìù</span> Quiz Final: Prueba de Dominio de Enteros.</li>
                    </ul>
                </div>
            </div>

            <div class="session1-nav-grid">
                <div class="session-nav-card" onclick="showScreen('session1TheoryScreen')">
                    <div class="session-nav-card-icon">üìö</div>
                    <h4>1. Teor√≠a</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1DragScreen')">
                    <div class="session-nav-card-icon">üí°</div>
                    <h4>2. Clasificaci√≥n de N√∫meros</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1ChallengeScreen')">
                    <div class="session-nav-card-icon">üìè</div>
                    <h4>3. Valor Absoluto</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1OperationsScreen')">
                    <div class="session-nav-card-icon">üéÆ</div>
                    <h4>4. Operaciones + Juego</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1QuizScreen')">
                    <div class="session-nav-card-icon">‚úÖ</div>
                    <h4>5. Quiz Final</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="screen" id="session1TheoryScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üìñ</span>
                    <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üßÆ</span>
                    <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üìê</span>
                    <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚úèÔ∏è</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üìö Teor√≠a: El Mundo de los N√∫meros Enteros (‚Ñ§)</h2>
            </div>

            <h3>¬øQu√© son los N√∫meros Enteros (‚Ñ§)?</h3>
            <p>Imagina una l√≠nea infinita con un punto central marcado como cero (0). A la derecha del cero est√°n los n√∫meros positivos: 1, 2, 3, 4... que van creciendo sin l√≠mite. A la izquierda del cero est√°n sus "hermanos opuestos", los n√∫meros negativos: -1, -2, -3, -4... que van decreciendo infinitamente. Todos ellos juntos forman la familia de los n√∫meros enteros, representada con el s√≠mbolo <strong>‚Ñ§</strong>.</p>
            
            <p>Piensa en el cero como el "punto de equilibrio" de una balanza. Todo lo que est√° a la derecha es ganancia, avance o lo positivo. Todo lo que est√° a la izquierda es p√©rdida, retroceso o lo negativo. Pero ambos lados son igual de importantes en matem√°ticas y en la vida real.</p>
            
            <h3>Los Tres Grupos de la Familia Entera</h3>
            <ul>
                <li><strong>Enteros Positivos (‚Ñ§‚Å∫ o ‚Ñï - N√∫meros Naturales):</strong> Son todos los n√∫meros mayores que cero. Cuando cuentas objetos, est√°s usando n√∫meros positivos. Por ejemplo: 1 manzana, 2 libros, 100 pesos de ganancia, 15 grados sobre cero. Se escriben con el signo + adelante o sin signo (ya que se asume que son positivos). Ejemplos: +5, +10, 20, 3.</li>
                
                <li><strong>El Cero (0):</strong> Es el n√∫mero neutral, el punto de referencia. No es positivo ni negativo. Representa "nada", pero tambi√©n significa el punto de partida. Es como estar en el piso 0 de un edificio (la planta baja), tener 0 grados Celsius (punto de congelaci√≥n del agua), o tener un saldo bancario de $0 (ni debes ni te sobra nada).</li>
                
                <li><strong>Enteros Negativos (‚Ñ§‚Åª):</strong> Son todos los n√∫meros menores que cero. Representan lo opuesto a los positivos. Siempre llevan el signo menos (-) adelante. Por ejemplo: si subes 3 pisos, escribes +3; si bajas 3 pisos, escribes -3. Otros ejemplos: -5¬∞C (5 grados bajo cero), -$1000 (debo mil pesos), -20 metros (20 metros bajo el nivel del mar).</li>
            </ul>

            <h3>¬øPor qu√© son importantes en la vida real?</h3>
            <p>Los n√∫meros negativos no son solo una invenci√≥n matem√°tica abstracta. Los usamos constantemente sin darnos cuenta:</p>
            <ul>
                <li><strong>üå°Ô∏è Temperatura:</strong> En Bogot√°, si la temperatura baja a 5 grados, la escribimos como +5¬∞C. Pero en pa√≠ses fr√≠os como Rusia o Canad√°, las temperaturas pueden ser de -15¬∞C (quince grados bajo cero). El cero es el punto de congelaci√≥n del agua.</li>
                
                <li><strong>üí∏ Dinero y Deudas:</strong> Si tienes $50.000 en tu cuenta bancaria, tu saldo es +$50.000. Pero si gastas $70.000 cuando solo ten√≠as $50.000, ahora tu saldo es -$20.000 (debes veinte mil pesos al banco). El banco te muestra este n√∫mero negativo para que sepas que est√°s en deuda.</li>
                
                <li><strong>üèîÔ∏è Altura y Profundidad:</strong> El nivel del mar es nuestro cero de referencia. El Pico Crist√≥bal Col√≥n en la Sierra Nevada tiene +5775 metros sobre el nivel del mar. Pero si un submarino est√° explorando el oc√©ano a 300 metros de profundidad, su altitud es de -300 metros (bajo el nivel del mar).</li>
                
                <li><strong>üéÆ Videojuegos:</strong> Tu personaje tiene 100 puntos de vida (+100). Si recibe un ataque de 30 puntos, el cambio es -30, dej√°ndote con 70 puntos. Los n√∫meros negativos representan p√©rdidas o da√±os.</li>
                
                <li><strong>üè¢ Edificios:</strong> Imagina que est√°s en un edificio. El piso 0 es la planta baja. Los pisos superiores son +1, +2, +3 (primer piso, segundo, tercero). Pero muchos edificios tienen s√≥tanos o parqueaderos subterr√°neos: piso -1, piso -2, piso -3. El signo negativo indica que est√°n bajo tierra.</li>
            </ul>

            <h3>üìñ ¬øSab√≠as que...?</h3>
            <p>Durante muchos siglos en Europa, los matem√°ticos rechazaban los n√∫meros negativos porque pensaban que "no ten√≠an sentido". ¬øC√≥mo puedes tener menos de cero manzanas? Pero los comerciantes chinos de la antigua Dinast√≠a Han (200 a.C. - 220 d.C.) ya los usaban hace m√°s de 2000 a√±os. Usaban varillas rojas para representar ganancias (n√∫meros positivos) y varillas negras para representar deudas (n√∫meros negativos). De ah√≠ viene la expresi√≥n "estar en n√∫meros rojos" cuando una empresa tiene p√©rdidas. ¬°Los n√∫meros negativos tienen una historia milenaria y han ayudado a la humanidad a entender mejor el mundo!</p>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>15 min</strong> (Teor√≠a + Ejemplos).</p>

            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(1, 1); showScreen('session1DragScreen');">Continuar al Reto 2 ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1DragScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 12%; top: 25%; font-size: 2.5em; animation: floatMath 6.5s ease-in-out infinite;">üéØ</span>
                    <span class="math-symbol" style="position: absolute; left: 82%; top: 35%; font-size: 2em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 0.7s;">üî¢</span>
                    <span class="math-symbol" style="position: absolute; left: 18%; top: 55%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1.2s;">üé≤</span>
                    <span class="math-symbol" style="position: absolute; left: 78%; top: 65%; font-size: 2.3em; animation: floatMath 7s ease-in-out infinite; animation-delay: 1.8s;">üß©</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üí° Reto de Clasificaci√≥n de N√∫meros</h2>
            </div>

            <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;"><strong>¬°Misi√≥n de Clasificaci√≥n!</strong> Arrastra cada uno de los 15 n√∫meros de la piscina inferior a la zona de destino correcta: Enteros Positivos o Enteros Negativos.</p>
            
            <p class="drag-pool-title">Piscina de N√∫meros (Arrastra los tokens)</p>
            <div id="dragPool" class="drag-pool">
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_pi" data-value="œÄ">œÄ</div>
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_root2" data-value="‚àö2">‚àö2</div>
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_nonperiodic" data-value="2.718...">2.718...</div>
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_periodic" data-value="-0.1212...">-0.1212...</div>
                </div>

         <div class="drag-zones">
    <div id="dropPositivos" class="dropzone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event)">
        <h3>Enteros Positivos (‚Ñ§‚Å∫)</h3>
        <p style="color: #27ae60; font-weight: 700;">(N√∫meros mayores que 0)</p>
    </div>

    <div id="dropNoEnteros" class="dropzone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event)">
        <h3 style="color: #4facfe;">N√∫meros No Enteros </h3>
        <p style="color: #4facfe; font-weight: 700;">(Racionales no enteros e Irracionales)</p>
    </div>

    <div id="dropNegativos" class="dropzone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event)">
        <h3>Enteros Negativos (‚Ñ§‚Åª)</h3>
        <p style="color: #e74c3c; font-weight: 700;">(N√∫meros menores que 0)</p>
    </div>
</div>
            <p id="completionMessage" class="completion-message"></p>

            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(1, 2); showScreen('session1ChallengeScreen');">Continuar al Reto 3 ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1ChallengeScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 8%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üéñÔ∏è</span>
                    <span class="math-symbol" style="position: absolute; left: 88%; top: 30%; font-size: 2em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 0.6s;">üìè</span>
                    <span class="math-symbol" style="position: absolute; left: 10%; top: 58%; font-size: 2.2em; animation: floatMath 8.5s ease-in-out infinite; animation-delay: 1.1s;">üé™</span>
                    <span class="math-symbol" style="position: absolute; left: 85%; top: 68%; font-size: 2.3em; animation: floatMath 7.2s ease-in-out infinite; animation-delay: 1.7s;">‚öñÔ∏è</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üèÜ Valor Absoluto: El Desaf√≠o de la Distancia al Cero</h2>
            </div>

            <h3>¬øQu√© es el Valor Absoluto?</h3>
            <p>El valor absoluto de un n√∫mero entero se refiere a la <strong>distancia</strong> que existe entre ese n√∫mero y el cero (0) en la recta num√©rica. Se representa con barras verticales: <strong>|a|</strong>.</p>
            <ul>
                <li>El valor absoluto de un n√∫mero positivo es el mismo n√∫mero: <strong>|+a| = a</strong>.</li>
                <li>El valor absoluto de un n√∫mero negativo es su opuesto (el n√∫mero positivo): <strong>|‚àía| = a</strong>.</li>
                <li>El valor absoluto de cero es cero: <strong>|0| = 0</strong>.</li>
            </ul>

            <p>En esencia, el valor absoluto siempre es una cantidad **positiva** o **cero**, porque una distancia nunca puede ser negativa.</p>

            <h3>Valor Absoluto en la vida real</h3>
            <p>Piensa en el valor absoluto como la magnitud, sin considerar la direcci√≥n:</p>
            <ul>
                <li><strong>Nivel del Mar:</strong> Un submarino est√° a -20 metros (-20m) y un dron vuela a +20 metros (+20m). La distancia de ambos al nivel del mar (0) es <strong>20 metros</strong>. <strong>|-20| = 20</strong> y <strong>|20| = 20</strong>.</li>
                <li><strong>Carrera Este/Oeste:</strong> Si un corredor se desplaza 5 km al Este (+5 km) y otro 5 km al Oeste (-5 km), ambos han recorrido una distancia de <strong>5 km</strong> desde el punto de partida (0).</li>
                <li><strong>Diferencia de Goles:</strong> Un equipo con +3 goles y otro con -3 goles tienen una diferencia de <strong>3 goles</strong> respecto al punto de equilibrio (0).</li>
            </ul>

            

<!-- üèÅ MINIJUEGO: CARRERA DE DISTANCIAS -->
<div style="background: linear-gradient(135deg, #b2ebf2, #e1f5fe);
            border-left: 8px solid #00acc1;
            border-radius: 25px;
            padding: 35px 40px;
            margin-top: 40px;
            color: #0d47a1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            animation: fadeInBox 1s ease-in-out;">

  <h2 style="color:#00796b; font-size:2em; margin-bottom:10px;">
    ‚≠ê Minijuego: Carrera de Distancias
  </h2>

  <p style="font-size:1.1em; color:#004d40; margin-bottom:15px;">
    <strong>Din√°mica en el Aula (Apoyo Visual en Pantalla):</strong>
  </p>

  <ul style="font-size:1.05em; line-height:1.8; margin-left:25px; color:#01579b;">
    <li>üè´ El docente mostrar√° o repartir√° tarjetas con n√∫meros enteros (positivos, negativos y el cero).</li>
    <li>üß© Los grupos deber√°n <strong>ordenar los n√∫meros desde el m√°s cercano al 0 hasta el m√°s lejano</strong>, aplicando el concepto de <strong>valor absoluto</strong>.</li>
    <li>üèÉ‚Äç‚ôÇÔ∏è El n√∫mero m√°s cercano al 0 ‚Äúva ganando la carrera‚Äù, y los m√°s alejados ‚Äúvan atr√°s‚Äù.</li>
  </ul>

  <h3 style="color:#00796b; margin-top:25px;">üí° Ejemplo:</h3>
  <p>Si las tarjetas son: <strong>‚àí4, ‚àí1, 3, 0, 2, ‚àí3</strong></p>

  <p>El orden correcto por <strong>valor absoluto</strong> ser√≠a:</p>

  <div style="background: rgba(255,255,255,0.9);
              padding: 15px;
              border-radius: 15px;
              text-align: center;
              font-size: 1.2em;
              color: #1565c0;
              margin: 12px 0;
              box-shadow: 0 4px 15px rgba(0,0,0,0.1);
              border: 2px dashed #81d4fa;">
      0, ‚àí1, 2, ‚àí3, 3, ‚àí4
  </div>

  <p><strong style="color:#d81b60;">Puntuaci√≥n:</strong>
     <span style="color:#1a237e;">+10 puntos</span> por cada posici√≥n correcta en la secuencia y
     <span style="color:#1a237e;">+20 puntos extra</span> si toda la secuencia est√° perfecta al primer intento.
  </p>

  <p><strong style="color:#004d40;">Objetivo:</strong> Comprender el
     <strong style="color:#f57f17;">valor absoluto</strong> como la distancia al cero y aplicarlo para comparar n√∫meros positivos y negativos.
  </p>

  <p style="font-size: 1em; color: #6a1b9a; font-weight: 600; margin-top: 20px;">
    ‚è±Ô∏è <strong>Tiempo Sugerido:</strong> 10 min (Juego)
  </p>
</div>

<!-- Peque√±a animaci√≥n para que aparezca suave -->
<style>
@keyframes fadeInBox {
  from {opacity: 0; transform: translateY(20px);}
  to {opacity: 1; transform: translateY(0);}
}
</style>




            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(1, 3); showScreen('session1OperationsScreen');">Continuar al Reto 4 ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1OperationsScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 13%; top: 22%; font-size: 2.5em; animation: floatMath 6.8s ease-in-out infinite;">‚ûï</span>
                    <span class="math-symbol" style="position: absolute; left: 80%; top: 32%; font-size: 2em; animation: floatMath 7.3s ease-in-out infinite; animation-delay: 0.8s;">‚ûñ</span>
                    <span class="math-symbol" style="position: absolute; left: 15%; top: 52%; font-size: 2.2em; animation: floatMath 8.2s ease-in-out infinite; animation-delay: 1.3s;">üé≠</span>
                    <span class="math-symbol" style="position: absolute; left: 83%; top: 72%; font-size: 2.3em; animation: floatMath 7.7s ease-in-out infinite; animation-delay: 1.9s;">‚ö°</span>
                </div>
                <h2 style="position: relative; z-index: 1;">‚öîÔ∏è Suma y Resta de Enteros: La Batalla de Operaciones</h2>
            </div>

            <h3>üìê Reglas para la SUMA de N√∫meros Enteros</h3>

            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 20px; border-radius: 15px; margin: 15px 0; border-left: 5px solid #4CAF50;">
                <h4 style="color: #2E7D32; margin-bottom: 10px;">REGLA 1: Signos IGUALES ‚Üí Se SUMAN y se conserva el signo</h4>
                <p style="color: #1B5E20;">Cuando los dos n√∫meros tienen el <strong>MISMO signo</strong> (ambos + o ambos ‚àí), sumas sus valores absolutos y le pones el signo que comparten.</p>
                <div style="background: white; padding: 12px; border-radius: 10px; margin-top: 10px;">
                    <p style="font-family: 'Courier New', monospace; color: #333; line-height: 2;">
                        <strong>(+3) + (+5) = +8</strong> &nbsp; ‚Üí Ambos positivos: 3+5=8, signo +<br>
                        <strong>(‚àí4) + (‚àí6) = ‚àí10</strong> &nbsp; ‚Üí Ambos negativos: 4+6=10, signo ‚àí<br>
                        <strong>(+10) + (+7) = +17</strong> &nbsp; ‚Üí Ambos positivos: 10+7=17, signo +<br>
                        <strong>(‚àí2) + (‚àí8) = ‚àí10</strong> &nbsp; ‚Üí Ambos negativos: 2+8=10, signo ‚àí
                    </p>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 20px; border-radius: 15px; margin: 15px 0; border-left: 5px solid #FF9800;">
                <h4 style="color: #E65100; margin-bottom: 10px;">REGLA 2: Signos DIFERENTES ‚Üí Se RESTAN y se pone el signo del MAYOR</h4>
                <p style="color: #BF360C;">Cuando tienen signo <strong>DIFERENTE</strong> (uno + y otro ‚àí), restas el menor del mayor (valores absolutos) y le pones el signo del que tenga MAYOR valor absoluto.</p>
                <div style="background: white; padding: 12px; border-radius: 10px; margin-top: 10px;">
                    <p style="font-family: 'Courier New', monospace; color: #333; line-height: 2;">
                        <strong>(+8) + (‚àí3) = +5</strong> &nbsp; ‚Üí |8|&gt;|3| ‚Üí 8‚àí3=5, signo del +8 ‚Üí <strong>+5</strong><br>
                        <strong>(‚àí7) + (+4) = ‚àí3</strong> &nbsp; ‚Üí |7|&gt;|4| ‚Üí 7‚àí4=3, signo del ‚àí7 ‚Üí <strong>‚àí3</strong><br>
                        <strong>(+2) + (‚àí9) = ‚àí7</strong> &nbsp; ‚Üí |9|&gt;|2| ‚Üí 9‚àí2=7, signo del ‚àí9 ‚Üí <strong>‚àí7</strong><br>
                        <strong>(‚àí5) + (+5) = 0</strong> &nbsp; ‚Üí |5|=|5| ‚Üí 5‚àí5=0 ‚Üí ¬°Son opuestos!
                    </p>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 18px; border-radius: 15px; margin: 15px 0; border: 2px dashed #2196F3;">
                <h4 style="color: #1565C0; margin-bottom: 10px;">üìã Paso a paso SIEMPRE:</h4>
                <p style="color: #0D47A1; line-height: 2;">
                    <strong>Paso 1:</strong> Mira los SIGNOS de los dos n√∫meros.<br>
                    <strong>Paso 2:</strong> ¬øSon IGUALES? ‚Üí Suma valores absolutos, conserva signo. ¬øSon DIFERENTES? ‚Üí Resta valores absolutos.<br>
                    <strong>Paso 3:</strong> Si eran diferentes, pon el signo del que tiene MAYOR valor absoluto.
                </p>
                <div style="background: white; padding: 12px; border-radius: 10px; margin-top: 10px;">
                    <p style="color: #333;"><strong>Ejemplo detallado:</strong> (‚àí15) + (+9) = ?</p>
                    <p style="color: #555; line-height: 1.8;">
                        Paso 1: Signos ‚Üí uno negativo (‚àí15) y uno positivo (+9) ‚Üí <strong>DIFERENTES</strong><br>
                        Paso 2: Resto valores absolutos ‚Üí |15| ‚àí |9| = 15 ‚àí 9 = <strong>6</strong><br>
                        Paso 3: ¬øQui√©n tiene mayor valor absoluto? |‚àí15|=15 &gt; |+9|=9 ‚Üí gana el <strong>negativo</strong><br>
                        <strong style="color: #1565C0; font-size: 1.1em;">Resultado: ‚àí6</strong>
                    </p>
                </div>
            </div>

            <h4 style="margin-top: 20px;">Ejemplos con 3 o m√°s t√©rminos</h4>
            <p>Cuando hay m√°s de dos n√∫meros, se resuelve <strong>de izquierda a derecha</strong>, paso a paso:</p>
            <div style="background: #F5F5F5; padding: 15px; border-radius: 10px; margin: 10px 0;">
                <p style="font-family: 'Courier New', monospace; color: #333; line-height: 2.2;">
                    <strong>(+3) + (‚àí3) + (+7) = ?</strong> ‚Üí Primero: 3+(‚àí3)=0, luego: 0+7=<strong>+7</strong><br>
                    <strong>(‚àí4) + (‚àí6) + (+15) = ?</strong> ‚Üí Primero: (‚àí4)+(‚àí6)=‚àí10, luego: ‚àí10+15=<strong>+5</strong><br>
                    <strong>(+8) + (‚àí12) + (+3) = ?</strong> ‚Üí Primero: 8+(‚àí12)=‚àí4, luego: ‚àí4+3=<strong>‚àí1</strong><br>
                    <strong>(+6) + (‚àí11) + (+8) + (‚àí2) = ?</strong> ‚Üí 6+(‚àí11)=‚àí5, ‚àí5+8=+3, 3+(‚àí2)=<strong>+1</strong><br>
                    <strong>(‚àí3) + (+5) + (‚àí8) + (+2) + (‚àí1) = ?</strong> ‚Üí ‚àí3+5=+2, 2+(‚àí8)=‚àí6, ‚àí6+2=‚àí4, ‚àí4+(‚àí1)=<strong>‚àí5</strong>
                </p>
            </div>

            <h3>üìê Regla para la RESTA de N√∫meros Enteros</h3>

            <div style="background: linear-gradient(135deg, #FCE4EC, #F8BBD0); padding: 20px; border-radius: 15px; margin: 15px 0; border: 3px solid #E91E63;">
                <h4 style="color: #880E4F; margin-bottom: 10px;">‚ö†Ô∏è LA REGLA DE ORO DE LA RESTA</h4>
                <p style="color: #AD1457; font-size: 1.15em; font-weight: 600; text-align: center; padding: 10px; background: white; border-radius: 10px;">
                    RESTAR un n√∫mero es lo mismo que SUMAR su OPUESTO.<br>
                    <strong style="font-size: 1.2em;">a ‚àí b = a + (‚àíb)</strong>
                </p>
                <p style="color: #880E4F; margin-top: 10px;">Es decir: cambias el signo de la resta (‚àí) por suma (+) y le cambias el signo al segundo n√∫mero. ¬°Despu√©s aplicas las reglas de la suma!</p>
            </div>

            <h4>Los 4 casos de la resta</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                <div style="background: #E8F5E9; padding: 14px; border-radius: 12px; border: 2px solid #4CAF50;">
                    <p style="font-weight: 700; color: #2E7D32; margin-bottom: 6px;">Caso 1: (+) ‚àí (+)</p>
                    <p style="font-family: 'Courier New', monospace; color: #333; font-size: 0.9em;">(+7) ‚àí (+3)<br>‚Üí (+7) + (‚àí3) = <strong>+4</strong></p>
                </div>
                <div style="background: #FFF3E0; padding: 14px; border-radius: 12px; border: 2px solid #FF9800;">
                    <p style="font-weight: 700; color: #E65100; margin-bottom: 6px;">Caso 2: (+) ‚àí (‚àí)</p>
                    <p style="font-family: 'Courier New', monospace; color: #333; font-size: 0.9em;">(+5) ‚àí (‚àí2)<br>‚Üí (+5) + (+2) = <strong>+7</strong><br><em style="font-size:0.85em;">¬°menos por menos = m√°s!</em></p>
                </div>
                <div style="background: #E3F2FD; padding: 14px; border-radius: 12px; border: 2px solid #2196F3;">
                    <p style="font-weight: 700; color: #1565C0; margin-bottom: 6px;">Caso 3: (‚àí) ‚àí (+)</p>
                    <p style="font-family: 'Courier New', monospace; color: #333; font-size: 0.9em;">(‚àí4) ‚àí (+6)<br>‚Üí (‚àí4) + (‚àí6) = <strong>‚àí10</strong></p>
                </div>
                <div style="background: #F3E5F5; padding: 14px; border-radius: 12px; border: 2px solid #9C27B0;">
                    <p style="font-weight: 700; color: #6A1B9A; margin-bottom: 6px;">Caso 4: (‚àí) ‚àí (‚àí)</p>
                    <p style="font-family: 'Courier New', monospace; color: #333; font-size: 0.9em;">(‚àí8) ‚àí (‚àí3)<br>‚Üí (‚àí8) + (+3) = <strong>‚àí5</strong><br><em style="font-size:0.85em;">¬°menos por menos = m√°s!</em></p>
                </div>
            </div>

            <h4>Ley de signos (resumen)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                <div style="background: #E8F5E9; padding: 12px; border-radius: 10px; text-align: center;">
                    <p style="font-weight: 700; color: #2E7D32;">Signos IGUALES = <span style="font-size: 1.3em;">+</span></p>
                    <p style="color: #555; font-family: 'Courier New', monospace;">+ con + = + &nbsp;&nbsp; ‚àí con ‚àí = +</p>
                </div>
                <div style="background: #FFEBEE; padding: 12px; border-radius: 10px; text-align: center;">
                    <p style="font-weight: 700; color: #C62828;">Signos DIFERENTES = <span style="font-size: 1.3em;">‚àí</span></p>
                    <p style="color: #555; font-family: 'Courier New', monospace;">+ con ‚àí = ‚àí &nbsp;&nbsp; ‚àí con + = ‚àí</p>
                </div>
            </div>

            <h4>Ejemplos mixtos (suma y resta con varios t√©rminos)</h4>
            <div style="background: #F5F5F5; padding: 15px; border-radius: 10px; margin: 10px 0;">
                <p style="font-family: 'Courier New', monospace; color: #333; line-height: 2.2; font-size: 0.95em;">
                    <strong>(‚àí8) + (+12) ‚àí (+5)</strong> ‚Üí ‚àí8+12=+4, convertir: 4+(‚àí5)=<strong>‚àí1</strong><br>
                    <strong>(+15) ‚àí (‚àí3) + (‚àí10)</strong> ‚Üí convertir: 15+(+3)=18, 18+(‚àí10)=<strong>+8</strong><br>
                    <strong>(+6) ‚àí (+14) + (+3) ‚àí (‚àí5)</strong> ‚Üí 6+(‚àí14)=‚àí8, ‚àí8+3=‚àí5, ‚àí5+(+5)=<strong>0</strong><br>
                    <strong>(‚àí3) + (‚àí7) ‚àí (‚àí15) + (+2) ‚àí (+8)</strong> ‚Üí ‚àí3+(‚àí7)=‚àí10, ‚àí10+15=+5, 5+2=+7, 7+(‚àí8)=<strong>‚àí1</strong>
                </p>
            </div>

            <h3>‚ö†Ô∏è Errores comunes ‚Äî ¬°Ev√≠talos!</h3>
            <div style="background: #FFF8E1; padding: 15px; border-radius: 12px; border: 2px solid #FFC107; margin: 10px 0;">
                <p style="color: #E65100; line-height: 2; font-size: 0.95em;">
                    ‚ùå <strong>Olvidar convertir la resta en suma del opuesto</strong><br>
                    &nbsp;&nbsp;&nbsp;Mal: (‚àí5) ‚àí (‚àí3) = ‚àí8 &nbsp;&nbsp; ‚úÖ Bien: (‚àí5) + (+3) = <strong>‚àí2</strong><br><br>
                    ‚ùå <strong>Confundir signos iguales con diferentes</strong><br>
                    &nbsp;&nbsp;&nbsp;Mal: (‚àí4) + (‚àí6) = +10 &nbsp;&nbsp; ‚úÖ Bien: (‚àí4) + (‚àí6) = <strong>‚àí10</strong><br><br>
                    ‚ùå <strong>No respetar qu√© signo "gana"</strong><br>
                    &nbsp;&nbsp;&nbsp;Mal: (+3) + (‚àí8) = +5 &nbsp;&nbsp; ‚úÖ Bien: (+3) + (‚àí8) = <strong>‚àí5</strong> (|8|&gt;|3|, gana negativo)<br><br>
                    ‚ùå <strong>Pensar que (‚àí) ‚àí (‚àí) siempre da negativo</strong><br>
                    &nbsp;&nbsp;&nbsp;Mal: (‚àí2) ‚àí (‚àí7) = ‚àí9 &nbsp;&nbsp; ‚úÖ Bien: (‚àí2) + (+7) = <strong>+5</strong>
                </p>
            </div>

            <h3>üí° Trucos para recordar</h3>
            <div style="background: linear-gradient(135deg, #E8EAF6, #C5CAE9); padding: 15px; border-radius: 12px; margin: 10px 0;">
                <p style="color: #283593; line-height: 2; font-size: 0.95em;">
                    ü•ä <strong>"Pelea de signos":</strong> Imagina que + y ‚àí pelean. Gana el m√°s fuerte (mayor valor absoluto). Si son iguales, cooperan (se suman).<br>
                    üå°Ô∏è <strong>"Term√≥metro mental":</strong> Positivos = caliente (arriba). Negativos = fr√≠o (abajo). Sumar positivo = subir. Sumar negativo = bajar.<br>
                    üîÑ <strong>"Doble negativo = positivo":</strong> Como en espa√±ol: "No es NO bonito" = "Es bonito". Doble negaci√≥n = afirmaci√≥n.<br>
                    ‚úÖ <strong>"Siempre convierte":</strong> TODA resta se convierte en suma del opuesto. Despu√©s aplica las reglas de suma. ¬°As√≠ nunca fallas!
                </p>
            </div>

                <h3>üéÆ Juego: Entero Runner</h3>
            <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 25px; border-radius: 20px; margin: 20px 0; border: 3px solid #2196F3; box-shadow: 0 10px 30px rgba(33, 150, 243, 0.25);">
                <p style="font-size: 1.1em; color: #1565C0; margin-bottom: 15px;">
                    <strong>üïπÔ∏è ¬°Pon a prueba lo que aprendiste!</strong><br>
                    Corre, esquiva obst√°culos y resuelve operaciones con enteros cada vez que choques.
                </p>
                <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                    <p style="color: #1976D2; font-size: 1em; margin-bottom: 10px;"><strong>¬øC√≥mo jugar?</strong></p>
                    <ul style="color: #1565C0; font-size: 0.95em; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li>üèÉ Tu personaje corre autom√°ticamente</li>
                        <li>‚¨ÜÔ∏è Presiona <strong>ESPACIO</strong> o toca la pantalla para <strong>saltar</strong></li>
                        <li>üöß Esquiva los obst√°culos que aparecen</li>
                        <li>‚ù§Ô∏è Tienes <strong>4 vidas</strong> ‚Äî cada choque te presenta una pregunta</li>
                        <li>üß† <strong>Responde correctamente</strong> para seguir jugando</li>
                        <li>‚ùå Si fallas la pregunta, <strong>pierdes una vida</strong></li>
                    </ul>
                </div>
                <button onclick="showScreen('session1CatchGameScreen')" style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; border: none; padding: 18px 40px; font-size: 1.3em; font-weight: 700; border-radius: 50px; cursor: pointer; box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4); display: block; margin: 0 auto; transition: all 0.3s;">
                    üéÆ ¬°JUGAR ENTERO RUNNER!
                </button>
            </div>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>20-25 min</strong> (Teor√≠a + Juego).</p>

            <div style="text-align: right; margin-top: 40px;">
               <button class="start-activity-button back-button" onclick="completeSubActivity(1, 4); showScreen('session1QuizScreen');">Continuar al Quiz Final ‚Üí</button>
            </div>
        </div>
    </div>


  <!-- ========== PANTALLA DEL JUEGO ENTERO RUNNER ========== -->
    <div class="screen" id="session1CatchGameScreen">
        <div class="content-screen" style="background: linear-gradient(180deg, #0d1b2a 0%, #1b263b 100%); min-height: 100vh; padding: 15px; max-width: 100%; border-radius: 0;">
            <button class="back-button" onclick="exitDinoGame(); showScreen('session1OperationsScreen')" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);"> ‚Üê Volver </button>
            
            <!-- PANTALLA DE INICIO -->
            <div id="dinoStartScreen" style="text-align: center; padding: 30px 15px;">
                <div style="margin-bottom: 15px;">
                    <span style="font-size: 4.5em; display: inline-block; animation: dinoFloat 2s ease-in-out infinite;">ü¶ñ</span>
                </div>
                <h2 style="font-family: 'Segoe UI', sans-serif; font-size: 2.2em; font-weight: 900; color: #fff; margin-bottom: 5px; text-shadow: 0 0 30px rgba(33, 150, 243, 0.5);">
                    ENTERO RUNNER
                </h2>
                <p style="font-size: 1em; color: #64B5F6; margin-bottom: 25px; letter-spacing: 2px;">OPERACIONES CON ENTEROS</p>
                
                <div style="background: linear-gradient(145deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05)); padding: 25px; border-radius: 20px; max-width: 500px; margin: 0 auto 25px auto; border: 2px solid rgba(33, 150, 243, 0.3);">
                    <h4 style="color: #64B5F6; margin-bottom: 15px; font-size: 1.1em;">üìã ¬øC√≥mo Jugar?</h4>
                    <div style="text-align: left; font-size: 0.95em; color: #B3E5FC; line-height: 2;">
                        <p style="margin-bottom: 8px;">ü¶ñ Tu dinosaurio <strong style="color: #69F0AE;">corre autom√°ticamente</strong></p>
                        <p style="margin-bottom: 8px;">‚¨ÜÔ∏è Presiona <strong style="color: #fff;">ESPACIO</strong> o toca la pantalla para saltar</p>
                        <p style="margin-bottom: 8px;">‚¨áÔ∏è Presiona <strong style="color: #fff;">‚Üì</strong> para agacharte</p>
                        <p style="margin-bottom: 8px;">üöß Esquiva los <strong style="color: #FF5252;">obst√°culos</strong> ‚Äî ¬°la velocidad aumenta!</p>
                        <p style="margin-bottom: 8px;">‚ù§Ô∏è Tienes <strong style="color: #FF5252;">4 vidas</strong></p>
                        <p style="margin-bottom: 8px;">üß† Al chocar ‚Üí <strong style="color: #FFD740;">pregunta de enteros</strong></p>
                        <p style="margin-bottom: 8px;">‚úÖ Respuesta correcta ‚Üí <strong style="color: #69F0AE;">No pierdes vida</strong></p>
                        <p style="margin-bottom: 8px;">‚ùå Respuesta incorrecta ‚Üí <strong style="color: #FF5252;">Pierdes una vida</strong></p>
                        <p>üîÑ Tienes <strong style="color: #40C4FF;">3 intentos</strong> m√°ximo</p>
                    </div>
                </div>
                
                <div id="dinoAttemptsInfo" style="display: none; background: rgba(255, 152, 0, 0.15); padding: 12px 20px; border-radius: 12px; max-width: 400px; margin: 0 auto 20px auto; border: 2px solid rgba(255, 152, 0, 0.4);">
                    <p style="color: #FFB74D; font-size: 1em; font-weight: 600;" id="dinoAttemptsText"></p>
                </div>
                
                <button onclick="startDinoGame()" style="background: linear-gradient(135deg, #00C853, #69F0AE); color: #1a237e; border: none; padding: 20px 60px; font-size: 1.4em; font-weight: 800; border-radius: 30px; cursor: pointer; box-shadow: 0 8px 25px rgba(0, 200, 83, 0.4); transition: transform 0.2s; animation: dinoStartPulse 2s infinite;">
                    üöÄ ¬°COMENZAR!
                </button>
                
                <div style="margin-top: 15px;">
                    <label style="color: #90CAF9; font-size: 0.9em; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="dinoMusicToggle" checked style="margin-right: 8px; cursor: pointer;"> üîä M√∫sica y sonidos
                    </label>
                </div>
            </div>
            
            <!-- PANTALLA DE JUEGO -->
            <div id="dinoGameScreen" style="display: none; text-align: center; padding: 10px;">
                <!-- HUD -->
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 8px; max-width: 700px; margin: 0 auto 10px auto; padding: 12px 15px; background: linear-gradient(135deg, rgba(26, 35, 126, 0.9), rgba(40, 53, 147, 0.9)); border-radius: 15px; border: 2px solid rgba(92, 107, 192, 0.5);">
                    <div style="text-align: center;">
                        <div style="font-size: 0.7em; color: #90CAF9; margin-bottom: 2px;">PUNTOS</div>
                        <div style="color: #FFD700; font-weight: 800; font-size: 1.3em;" id="dinoScore">0</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.7em; color: #90CAF9; margin-bottom: 2px;">R√âCORD</div>
                        <div style="color: #69F0AE; font-weight: 800; font-size: 1.3em;" id="dinoHighScore">0</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.7em; color: #90CAF9; margin-bottom: 2px;">VELOCIDAD</div>
                        <div style="color: #40C4FF; font-weight: 800; font-size: 1.3em;" id="dinoSpeedDisplay">1x</div>
                    </div>
                    <div id="dinoLives" style="display: flex; gap: 4px; font-size: 1.2em;">
                        <span class="dinoHeart">‚ù§Ô∏è</span>
                        <span class="dinoHeart">‚ù§Ô∏è</span>
                        <span class="dinoHeart">‚ù§Ô∏è</span>
                        <span class="dinoHeart">‚ù§Ô∏è</span>
                    </div>
                    <button onclick="toggleDinoMusic()" id="dinoMuteBtn" style="background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 5px 10px; border-radius: 10px; cursor: pointer; font-size: 1em;">üîä</button>
                </div>
                
                <div style="position: relative; display: inline-block; width: 100%; max-width: 700px;">
                    <canvas id="dinoCanvas" style="border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.5), 0 0 50px rgba(33,150,243,0.15); border: 3px solid rgba(33,150,243,0.4); width: 100%; display: block; touch-action: none;"></canvas>
                </div>
                
                <div style="margin-top: 12px; color: #64B5F6; font-size: 0.85em;">
                    ‚å®Ô∏è ESPACIO o ‚¨ÜÔ∏è = Saltar &nbsp;|&nbsp; ‚¨áÔ∏è = Agacharse &nbsp;|&nbsp; üì± Toca para saltar
                </div>
            </div>

            <!-- MODAL DE PREGUNTA -->
            <div id="dinoQuestionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13, 27, 42, 0.95); z-index: 9999; justify-content: center; align-items: center; backdrop-filter: blur(8px); overflow-y: auto;">
                <div style="background: linear-gradient(145deg, #1a237e, #283593); padding: 30px; border-radius: 25px; border: 4px solid #5C6BC0; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); text-align: center; margin: auto;">
                    <div style="font-size: 2.5em; margin-bottom: 8px;">üß†</div>
                    <h3 style="color: #FFD740; font-size: 1.3em; margin-bottom: 5px;">¬°Chocaste! Responde correctamente</h3>
                    <p style="color: #90CAF9; font-size: 0.9em; margin-bottom: 15px;" id="dinoLivesRemaining"></p>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 18px; border-radius: 15px; margin-bottom: 18px; border: 2px solid rgba(92,107,192,0.5);">
                        <p style="font-size: 1.4em; color: #fff; font-weight: 700;" id="dinoQuestionContent"></p>
                    </div>
                    
                    <div id="dinoAnswerOptions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;"></div>
                    
                    <div id="dinoQuestionFeedback" style="display: none; padding: 15px; border-radius: 12px; margin-top: 12px;">
                        <p id="dinoFeedbackText" style="font-size: 1.1em; font-weight: 700;"></p>
                        <p id="dinoFeedbackExplanation" style="font-size: 0.9em; margin-top: 6px;"></p>
                    </div>
                    
                    <button id="dinoContinueBtn" onclick="dinoContinueAfterQuestion()" style="display: none; margin-top: 15px; background: linear-gradient(135deg, #00C853, #69F0AE); color: #1a237e; border: none; padding: 15px 40px; font-size: 1.15em; font-weight: 800; border-radius: 25px; cursor: pointer; box-shadow: 0 6px 20px rgba(0,200,83,0.4); animation: dinoStartPulse 1.5s infinite;">
                        ‚ñ∂ Continuar Jugando
                    </button>
                </div>
            </div>
            
            <!-- PANTALLA DE VICTORIA (cuando completa el juego desde game over 3 intentos) -->
            <div id="dinoWinScreen" style="display: none; text-align: center; padding: 40px 20px;">
                <div style="font-size: 5em; margin-bottom: 20px; animation: dinoFloat 0.6s infinite;">üèÜ</div>
                <h2 style="font-size: 2.5em; color: #FFD700; text-shadow: 0 0 30px rgba(255,215,0,0.5); margin-bottom: 15px;">¬°GRAN TRABAJO!</h2>
                <p style="font-size: 1.3em; color: #69F0AE; margin-bottom: 10px;">¬°Demostraste tus habilidades con enteros!</p>
                <p style="font-size: 1.2em; color: #64B5F6; margin-bottom: 5px;">Mejor puntuaci√≥n: <span id="dinoFinalScore" style="font-weight: 800; color: #FFD700;">0</span></p>
                <p style="font-size: 1.1em; color: #B3E5FC; margin-bottom: 10px;">Preguntas correctas: <span id="dinoQuestionsAnswered" style="font-weight: 800; color: #69F0AE;">0</span></p>
                
                <div style="background: rgba(76,175,80,0.15); padding: 25px; border-radius: 20px; max-width: 400px; margin: 0 auto 30px auto; border: 2px solid rgba(76,175,80,0.3);">
                    <p style="color: #A5D6A7; font-size: 1.1em; line-height: 1.6;">üéâ ¬°Excelente!<br>Has practicado suma y resta de enteros.</p>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="resetDinoGame()" style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; border: none; padding: 15px 35px; font-size: 1.1em; font-weight: 700; border-radius: 30px; cursor: pointer;">üîÑ Jugar de Nuevo</button>
                    <button onclick="exitDinoGame(); completeSubActivity(1, 4); showScreen('session1QuizScreen')" style="background: linear-gradient(135deg, #4CAF50, #43A047); color: white; border: none; padding: 15px 35px; font-size: 1.1em; font-weight: 700; border-radius: 30px; cursor: pointer;">Continuar al Quiz ‚Üí</button>
                </div>
            </div>
            
            <!-- PANTALLA DE GAME OVER -->
            <div id="dinoGameOverScreen" style="display: none; text-align: center; padding: 40px 20px;">
                <div style="font-size: 5em; margin-bottom: 20px;">üíî</div>
                <h2 style="font-size: 2.3em; color: #F44336; margin-bottom: 15px;">¬°SIGUE INTENTANDO!</h2>
                <p style="font-size: 1.1em; color: #FFCDD2; margin-bottom: 10px;">Puntuaci√≥n: <span id="dinoGameOverScore" style="font-weight: 800; color: #FFD700;">0</span></p>
                <p style="font-size: 1em; color: #90CAF9; margin-bottom: 10px;">Preguntas correctas: <span id="dinoGameOverCorrect" style="font-weight: 700;">0</span></p>
                <p style="font-size: 1em; color: #FFB74D; margin-bottom: 25px;" id="dinoGameOverAttempts"></p>
                <div style="background: rgba(244,67,54,0.1); padding: 25px; border-radius: 20px; max-width: 400px; margin: 0 auto 25px auto; border: 2px solid rgba(244,67,54,0.3);">
                    <p style="color: #FFCDD2; font-size: 1.05em; line-height: 1.6;" id="dinoGameOverMessage"></p>
                </div>
                <div id="dinoGameOverButtons" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;"></div>
            </div>
        </div>
        
        <style>
            @keyframes dinoFloat { 0%, 100% { transform: translateY(0) rotate(-3deg); } 50% { transform: translateY(-15px) rotate(3deg); } }
            @keyframes dinoStartPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        </style>
    </div>
    <div class="screen" id="session1QuizScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 11%; top: 24%; font-size: 2.5em; animation: floatMath 6.3s ease-in-out infinite;">üìù</span>
                    <span class="math-symbol" style="position: absolute; left: 84%; top: 34%; font-size: 2em; animation: floatMath 7.8s ease-in-out infinite; animation-delay: 0.9s;">üéì</span>
                    <span class="math-symbol" style="position: absolute; left: 14%; top: 56%; font-size: 2.2em; animation: floatMath 8.4s ease-in-out infinite; animation-delay: 1.4s;">üåü</span>
                    <span class="math-symbol" style="position: absolute; left: 81%; top: 66%; font-size: 2.3em; animation: floatMath 7.6s ease-in-out infinite; animation-delay: 2s;">üíØ</span>
                </div>
                <h2 style="position: relative; z-index: 1;">‚úÖ Quiz Final: Prueba de Dominio de Enteros</h2>
            </div>

            <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;"><strong>¬°Hora de la Prueba!</strong> Resuelve las siguientes <strong>15 operaciones</strong>. La dificultad va subiendo: empiezas con 2 t√©rminos y terminas con 5. ¬°Demuestra tu dominio de los n√∫meros enteros!</p>

            <h3 style="color: #4CAF50; margin-bottom: 10px;">üü¢ Nivel 1: Dos t√©rminos (4 preguntas)</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="q1">1. (‚àí15) + (+8) =</label>
                    <input type="text" id="q1" class="quiz-input" data-correct="-7" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q2">2. (+12) ‚àí (‚àí9) =</label>
                    <input type="text" id="q2" class="quiz-input" data-correct="21" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q3">3. (‚àí20) ‚àí (+13) =</label>
                    <input type="text" id="q3" class="quiz-input" data-correct="-33" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q4">4. (+25) + (‚àí30) =</label>
                    <input type="text" id="q4" class="quiz-input" data-correct="-5" placeholder="Escribe el resultado" />
                </div>
            </div>

            <h3 style="color: #FF9800; margin-bottom: 10px;">üü° Nivel 2: Tres t√©rminos (5 preguntas)</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="q5">5. (‚àí8) + (+12) ‚àí (+5) =</label>
                    <input type="text" id="q5" class="quiz-input" data-correct="-1" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q6">6. (+15) ‚àí (‚àí3) + (‚àí10) =</label>
                    <input type="text" id="q6" class="quiz-input" data-correct="8" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q7">7. (‚àí20) + (+7) ‚àí (‚àí4) =</label>
                    <input type="text" id="q7" class="quiz-input" data-correct="-9" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q8">8. (+18) ‚àí (+25) + (‚àí3) =</label>
                    <input type="text" id="q8" class="quiz-input" data-correct="-10" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q9">9. (‚àí12) ‚àí (‚àí8) + (+15) =</label>
                    <input type="text" id="q9" class="quiz-input" data-correct="11" placeholder="Escribe el resultado" />
                </div>
            </div>

            <h3 style="color: #F44336; margin-bottom: 10px;">üî¥ Nivel 3: Cuatro t√©rminos (4 preguntas)</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="q10">10. (+6) ‚àí (+14) + (+3) ‚àí (‚àí5) =</label>
                    <input type="text" id="q10" class="quiz-input" data-correct="0" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q11">11. (‚àí9) + (+15) ‚àí (‚àí7) + (‚àí20) =</label>
                    <input type="text" id="q11" class="quiz-input" data-correct="-7" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q12">12. (+30) ‚àí (+12) + (‚àí18) ‚àí (‚àí5) =</label>
                    <input type="text" id="q12" class="quiz-input" data-correct="5" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q13">13. (‚àí11) ‚àí (+6) + (+22) ‚àí (‚àí3) =</label>
                    <input type="text" id="q13" class="quiz-input" data-correct="8" placeholder="Escribe el resultado" />
                </div>
            </div>

            <h3 style="color: #9C27B0; margin-bottom: 10px;">üü£ Nivel 4: Cinco t√©rminos (2 preguntas)</h3>
            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="q14">14. (‚àí3) + (‚àí7) ‚àí (‚àí15) + (+2) ‚àí (+8) =</label>
                    <input type="text" id="q14" class="quiz-input" data-correct="-1" placeholder="Escribe el resultado" />
                </div>
                <div class="quiz-item">
                    <label for="q15">15. (+10) ‚àí (+18) + (‚àí5) ‚àí (‚àí12) + (+6) =</label>
                    <input type="text" id="q15" class="quiz-input" data-correct="5" placeholder="Escribe el resultado" />
                </div>
            </div>

            <button class="submit-quiz-button back-button" onclick="submitQuiz(1)">Comprobar Resultados y Finalizar Sesi√≥n</button>
            
            <div id="quizResults" class="quiz-results">
                <h3>Resultados del Quiz:</h3>
                <p>Puntuaci√≥n: <span id="quizScore">0/15</span></p>
                <ul class="result-list" id="resultList">
                    </ul>
            </div>
            
            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>10 min</strong> (Quiz).</p>
<div id="nextSessionButton" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
                <div style="background: linear-gradient(135deg, rgba(0, 242, 254, 0.2), rgba(79, 172, 254, 0.2)); padding: 30px; border-radius: 25px; border: 3px solid #00f2fe; box-shadow: 0 0 30px rgba(0, 242, 254, 0.5);">
                    <h3 style="color: #00f2fe; font-size: 2em; margin-bottom: 20px;">üéâ ¬°Felicidades! Sesi√≥n 1 Completada</h3>
                    <button class="back-button" onclick="showScreen('session2Screen')" style="background: linear-gradient(135deg, #00f2fe, #4facfe, #00c9ff); font-size: 1.5em; padding: 25px 60px; box-shadow: 0 15px 40px rgba(0, 242, 254, 0.6), 0 0 25px #00f2fe;">
                        üöÄ ¬°Comenzar Sesi√≥n 2: Multiplicaci√≥n y Divisi√≥n! ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>


        <div class="screen" id="session2Screen">
    <div class="content-screen" style="position: relative;">
        <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
        <div style="text-align: center; margin-top: 30px;">
            <div class="session-header-icon">‚ú®</div>
            <h2 class="session-title-gradient">Sesi√≥n 2: N√∫meros Enteros (II)</h2>
            <p style="font-size: 1.3em; color: #555; font-weight: 500;">¬°Multipliquemos y dividamos con signos!</p>
        </div>
        <div class="content-grid-session1">
            <div class="card-session objective-card">
                <h3>Objetivo de Sesi√≥n</h3>
                <p>Dominar las reglas de multiplicaci√≥n y divisi√≥n de n√∫meros enteros, comprendiendo la ley de los signos y aplicando la jerarqu√≠a b√°sica de operaciones en expresiones combinadas.</p>
            </div>
            <div class="card-session learning-card">
                <h3>Ruta de Aprendizaje</h3>
                <ul class="learning-list">
                    <li class="learning-list-item" onclick="showScreen('session2TheoryScreen')"><span>üìö</span> Teor√≠a: Multiplicaci√≥n y Divisi√≥n</li>
                    <li class="learning-list-item" onclick="showScreen('session2HierarchyScreen')"><span>üèóÔ∏è</span> Jerarqu√≠a de Operaciones + Pr√°ctica</li>
                    <li class="learning-list-item" onclick="showScreen('session2GameClassScreen')"><span>üé≤</span> Juego en Clase: Stop Matem√°tico</li>
                    <li class="learning-list-item" onclick="showScreen('session2ArcadeScreen')"><span>üöÄ</span> Juego Arcade: Nave Multiplicadora</li>
                    <li class="learning-list-item" onclick="showScreen('session2PracticeScreen')"><span>üìù</span> Quiz Final</li>
                </ul>
            </div>
        </div>
        <div class="session1-nav-grid">
            <div class="session-nav-card" onclick="showScreen('session2TheoryScreen')">
                <div class="session-nav-card-icon">üìö</div><h4>1. Teor√≠a</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2HierarchyScreen')">
                <div class="session-nav-card-icon">üèóÔ∏è</div><h4>2. Jerarqu√≠a</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2GameClassScreen')">
                <div class="session-nav-card-icon">üé≤</div><h4>3. Stop Matem√°tico</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2ArcadeScreen')">
                <div class="session-nav-card-icon">üöÄ</div><h4>4. Nave Multiplicadora</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2PracticeScreen')">
                <div class="session-nav-card-icon">üìù</div><h4>5. Quiz Final</h4>
            </div>
        </div>
    </div>
</div>

<div class="screen" id="session2TheoryScreen">
        <div class="content-screen">
            <button class="back-button" onclick="completeSubActivity(2, 1); showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
            
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">‚úñÔ∏è</span>
                    <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">‚ûó</span>
                    <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üéØ</span>
                    <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚ö°</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üìö Multiplicaci√≥n y Divisi√≥n: La Ley de los Signos</h2>
            </div>

            <h3>La Magia de Multiplicar y Dividir Enteros</h3>
            <p>En la sesi√≥n anterior aprendiste a sumar y restar n√∫meros enteros. Ahora vamos a multiplicar y dividir, y descubrir√°s algo fascinante: <strong>el resultado depende de los signos que est√©s combinando</strong>.</p>
            
            <p>Piensa en los signos como "personalidades matem√°ticas". Cuando dos n√∫meros positivos se multiplican, es como dos amigos trabajando juntos: el resultado es positivo. Pero cuando un positivo y un negativo se encuentran, entran en conflicto y el resultado es negativo. ¬øY qu√© pasa cuando dos negativos se multiplican? ¬°Se neutralizan y dan positivo!</p>

            <h3>üé≠ La Ley de los Signos: Las 4 Reglas de Oro</h3>
            
            <div style="background: linear-gradient(135deg, #d4edda, #f3fff5); padding: 30px; border-radius: 20px; border-left: 10px solid #2ecc71; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #27ae60; font-size: 1.6em; margin-bottom: 15px;">‚úÖ REGLA 1: Positivo √ó Positivo = Positivo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #2d5016;"><strong>Ejemplo:</strong> (+5) √ó (+3) = +15</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #2d5016;">Si ganas $5.000 por cada hora trabajada y trabajas 3 horas, ganas $15.000 (positivo). Dos cantidades positivas multiplicadas siempre dan un resultado positivo.</p>
            </div>

            <div style="background: linear-gradient(135deg, #fff3cd, #fffdf0); padding: 30px; border-radius: 20px; border-left: 10px solid #ffc107; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #f57f17; font-size: 1.6em; margin-bottom: 15px;">‚ö†Ô∏è REGLA 2: Positivo √ó Negativo = Negativo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #6d4c41;"><strong>Ejemplo:</strong> (+4) √ó (‚àí2) = ‚àí8</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #6d4c41;">Si cada d√≠a gastas $4.000 en transporte, en 2 d√≠as has gastado $8.000. Si consideramos los gastos como negativos, ser√≠a: (+4) √ó (‚àí2) = ‚àí8. Un signo positivo multiplicado por uno negativo siempre da negativo.</p>
            </div>

            <div style="background: linear-gradient(135deg, #ffe0e0, #fff5f5); padding: 30px; border-radius: 20px; border-left: 10px solid #ff9800; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #e65100; font-size: 1.6em; margin-bottom: 15px;">‚ö†Ô∏è REGLA 3: Negativo √ó Positivo = Negativo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #5d1f00;"><strong>Ejemplo:</strong> (‚àí6) √ó (+2) = ‚àí12</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #5d1f00;">El orden no importa: si tienes una deuda de $6.000 (‚àí6) y esa deuda se duplica (+2), ahora tienes una deuda de $12.000 (‚àí12). Sigue siendo negativo.</p>
            </div>

            <div style="background: linear-gradient(135deg, #e3f2fd, #f0f8ff); padding: 30px; border-radius: 20px; border-left: 10px solid #2196f3; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #0d47a1; font-size: 1.6em; margin-bottom: 15px;">üéâ REGLA 4: Negativo √ó Negativo = Positivo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #01579b;"><strong>Ejemplo:</strong> (‚àí5) √ó (‚àí3) = +15</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #01579b;">Esta es la m√°s sorprendente: ¬°dos negativos dan positivo! Pi√©nsalo as√≠: si cada d√≠a cancelas una deuda de $5.000 (‚àí5 significa "eliminar deuda"), y lo haces durante 3 d√≠as (‚àí3 veces), en realidad has ganado $15.000. Los dos negativos se "cancelan" y dan positivo.</p>
            </div>

            <h3>üìè Resumen Visual de la Ley de los Signos</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
                <div style="background: #2ecc71; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);">
                    (+) √ó (+) = <span style="font-size: 1.5em;">+</span>
                </div>
                <div style="background: #e74c3c; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);">
                    (+) √ó (‚àí) = <span style="font-size: 1.5em;">‚àí</span>
                </div>
                <div style="background: #e74c3c; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);">
                    (‚àí) √ó (+) = <span style="font-size: 1.5em;">‚àí</span>
                </div>
                <div style="background: #2ecc71; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);">
                    (‚àí) √ó (‚àí) = <span style="font-size: 1.5em;">+</span>
                </div>
            </div>

            <h3>‚ûó La Divisi√≥n Sigue las Mismas Reglas</h3>
            <p>¬°Buenas noticias! La divisi√≥n usa exactamente las mismas reglas que la multiplicaci√≥n:</p>
            <ul style="list-style: none; padding: 0; margin: 20px 0;">
                <li style="background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #2196f3; color: #01579b; font-weight: 500;">
                    <strong>(+12) √∑ (+3) = +4</strong> ‚Üí Signos iguales = resultado positivo
                </li>
                <li style="background: #fff0f5; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #e74c3c; color: #c0392b; font-weight: 500;">
                    <strong>(+12) √∑ (‚àí3) = ‚àí4</strong> ‚Üí Signos diferentes = resultado negativo
                </li>
                <li style="background: #fff0f5; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #e74c3c; color: #c0392b; font-weight: 500;">
                    <strong>(‚àí12) √∑ (+3) = ‚àí4</strong> ‚Üí Signos diferentes = resultado negativo
                </li>
                <li style="background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #2196f3; color: #01579b; font-weight: 500;">
                    <strong>(‚àí12) √∑ (‚àí3) = +4</strong> ‚Üí Signos iguales = resultado positivo
                </li>
            </ul>

            <h3>üéØ Regla Mnemot√©cnica: "Amigos y Enemigos"</h3>
            <div style="background: linear-gradient(135deg, #fceabb, #f8b500); padding: 30px; border-radius: 20px; margin: 30px 0; border: 5px solid #ffcc00; box-shadow: 0 15px 40px rgba(255, 198, 0, 0.4);">
                <p style="font-size: 1.2em; line-height: 1.8; color: #6d4c41; font-weight: 600;">
                    üíö <strong>Signos IGUALES = Amigos = POSITIVO</strong><br>
                    Cuando dos signos iguales se multiplican o dividen (dos positivos o dos negativos), se llevan bien y el resultado es positivo.
                </p>
                <p style="font-size: 1.2em; line-height: 1.8; color: #6d4c41; font-weight: 600; margin-top: 20px;">
                    üíî <strong>Signos DIFERENTES = Conflicto = NEGATIVO</strong><br>
                    Cuando un positivo y un negativo se multiplican o dividen, est√°n en conflicto y el resultado es negativo.
                </p>
            </div>

            <h3>üìñ ¬øSab√≠as que...?</h3>
            <p>El matem√°tico alem√°n Michael Stifel (1487-1567) fue uno de los primeros en usar los s√≠mbolos + y ‚àí para representar cantidades positivas y negativas en su libro "Arithmetica Integra" (1544). Antes de √©l, los matem√°ticos describ√≠an las operaciones con palabras largas. ¬°Imagina tener que escribir "multiplica el n√∫mero que es menos de cero con otro n√∫mero menos de cero" en lugar de simplemente escribir (‚àí3) √ó (‚àí2)!</p>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>20 min</strong> (Teor√≠a + Ejemplos).</p>

            <div style="text-align: right; margin-top: 40px;">
<button class="start-activity-button back-button" onclick="completeSubActivity(2, 1); showScreen('session2HierarchyScreen');">Continuar a Jerarqu√≠a de Operaciones ‚Üí</button>
            </div>
        </div>
    </div>

<!-- JERARQU√çA DE OPERACIONES + PR√ÅCTICA -->
    <div class="screen" id="session2HierarchyScreen">
        <div class="content-screen">
            <button class="back-button" onclick="completeSubActivity(2, 2); showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
            <div style="text-align: center; margin-bottom: 25px;">
                <h2>üèóÔ∏è Jerarqu√≠a de Operaciones: El Orden Correcto</h2>
            </div>

            <h3>¬øPor qu√© necesitamos un orden?</h3>
            <p>Imagina: <strong>5 + 3 √ó 2</strong>. Si haces de izquierda a derecha: 5+3=8, 8√ó2=16. Pero si primero multiplicas: 3√ó2=6, luego 5+6=<strong>11</strong>. La respuesta correcta es 11 porque la multiplicaci√≥n tiene mayor prioridad.</p>

            <h3>üéØ La Jerarqu√≠a</h3>
            <div style="background: linear-gradient(135deg, #e8eaf6, #c5cae9); padding: 25px; border-radius: 20px; margin: 15px 0; border: 4px solid #5c6bc0;">
                <div style="display: grid; gap: 12px;">
                    <div style="background: #fff; padding: 16px; border-radius: 12px; border-left: 7px solid #f44336;">
                        <h4 style="color: #c62828;">1Ô∏è‚É£ Par√©ntesis ( )</h4>
                        <p style="color: #555;">Siempre primero. Si hay par√©ntesis dentro de par√©ntesis, empieza por el m√°s interno.</p>
                    </div>
                    <div style="background: #fff; padding: 16px; border-radius: 12px; border-left: 7px solid #ff9800;">
                        <h4 style="color: #e65100;">2Ô∏è‚É£ Exponentes y Ra√≠ces</h4>
                        <p style="color: #555;">Potencias y ra√≠ces cuadradas.</p>
                    </div>
                    <div style="background: #fff; padding: 16px; border-radius: 12px; border-left: 7px solid #4caf50;">
                        <h4 style="color: #2e7d32;">3Ô∏è‚É£ Multiplicaci√≥n √ó y Divisi√≥n √∑</h4>
                        <p style="color: #555;"><strong>Misma prioridad.</strong> Se resuelven <strong>de izquierda a derecha</strong>, la que aparezca primero.</p>
                    </div>
                    <div style="background: #fff; padding: 16px; border-radius: 12px; border-left: 7px solid #2196f3;">
                        <h4 style="color: #0d47a1;">4Ô∏è‚É£ Suma + y Resta ‚àí</h4>
                        <p style="color: #555;"><strong>Misma prioridad.</strong> De izquierda a derecha.</p>
                    </div>
                </div>
            </div>

            <h3>üìù Ejemplos Paso a Paso</h3>

            <div style="background: #f0f4c3; padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #aed581;">
                <h4 style="color: #33691e;">Ejemplo 1: 5 + 3 √ó 2</h4>
                <p style="color: #1b5e20; line-height: 2;">
                    <strong>Paso 1:</strong> √ó primero ‚Üí 3 √ó 2 = 6<br>
                    <strong>Paso 2:</strong> + ‚Üí 5 + 6 = <strong style="font-size: 1.2em;">11</strong>
                </p>
            </div>

            <div style="background: #e1f5fe; padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #4fc3f7;">
                <h4 style="color: #01579b;">Ejemplo 2: (8 ‚àí 3) √ó 4 + 2</h4>
                <p style="color: #0277bd; line-height: 2;">
                    <strong>Paso 1:</strong> Par√©ntesis ‚Üí (8 ‚àí 3) = 5<br>
                    <strong>Paso 2:</strong> √ó ‚Üí 5 √ó 4 = 20<br>
                    <strong>Paso 3:</strong> + ‚Üí 20 + 2 = <strong style="font-size: 1.2em;">22</strong>
                </p>
            </div>

            <div style="background: #fce4ec; padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #f48fb1;">
                <h4 style="color: #880e4f;">Ejemplo 3: 20 √∑ (‚àí4) + 3 √ó (‚àí2) ‚àí 1</h4>
                <p style="color: #ad1457; line-height: 2;">
                    <strong>Paso 1:</strong> √ó y √∑ de izquierda a derecha:<br>
                    &nbsp;&nbsp;20 √∑ (‚àí4) = ‚àí5 &nbsp;&nbsp;y&nbsp;&nbsp; 3 √ó (‚àí2) = ‚àí6<br>
                    <strong>Paso 2:</strong> + y ‚àí ‚Üí (‚àí5) + (‚àí6) ‚àí 1 = <strong style="font-size: 1.2em;">‚àí12</strong>
                </p>
            </div>

            <div style="background: #fff3e0; padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #ffb74d;">
                <h4 style="color: #e65100;">Ejemplo 4: (‚àí3) √ó (4 ‚àí 7) + 18 √∑ (‚àí6)</h4>
                <p style="color: #bf360c; line-height: 2;">
                    <strong>Paso 1:</strong> Par√©ntesis ‚Üí (4 ‚àí 7) = ‚àí3<br>
                    <strong>Paso 2:</strong> √ó y √∑ ‚Üí (‚àí3) √ó (‚àí3) = 9 &nbsp;y&nbsp; 18 √∑ (‚àí6) = ‚àí3<br>
                    <strong>Paso 3:</strong> + ‚Üí 9 + (‚àí3) = <strong style="font-size: 1.2em;">6</strong>
                </p>
            </div>

            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #E53935;">
                <h4 style="color: #B71C1C;">‚ö†Ô∏è Ejemplo 5 (CLAVE): Divisi√≥n SEGUIDA de Multiplicaci√≥n</h4>
                <h4 style="color: #C62828; font-size: 1.1em; margin-bottom: 5px;">(‚àí24) √∑ 4 √ó (‚àí3) + 5</h4>
                <p style="color: #C62828; line-height: 2.2;">
                    <strong>‚ö° ATENCI√ìN:</strong> Hay una <strong>√∑ seguida de √ó</strong>. ¬øCu√°l se hace primero?<br>
                    <strong>REGLA:</strong> √ó y √∑ tienen la <strong>MISMA prioridad</strong>, se resuelven <strong>DE IZQUIERDA A DERECHA</strong>.<br><br>
                    <strong>Paso 1:</strong> Primero la √∑ (aparece antes, est√° m√°s a la izquierda):<br>
                    &nbsp;&nbsp;&nbsp;(‚àí24) √∑ 4 = <strong>‚àí6</strong><br>
                    <strong>Paso 2:</strong> Luego la √ó (viene despu√©s):<br>
                    &nbsp;&nbsp;&nbsp;(‚àí6) √ó (‚àí3) = <strong>+18</strong><br>
                    <strong>Paso 3:</strong> Finalmente la + :<br>
                    &nbsp;&nbsp;&nbsp;18 + 5 = <strong style="font-size: 1.3em; color: #1B5E20;">23</strong><br><br>
                    ‚ùå <strong>ERROR COM√öN:</strong> Hacer primero 4 √ó (‚àí3) = ‚àí12, luego (‚àí24) √∑ (‚àí12) = 2, y 2 + 5 = 7. <strong>¬°INCORRECTO!</strong> La √∑ aparece ANTES.
                </p>
            </div>

            <div style="background: linear-gradient(135deg, #EDE7F6, #D1C4E9); padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #7E57C2;">
                <h4 style="color: #4527A0;">‚ö†Ô∏è Ejemplo 6 (CLAVE): Multiplicaci√≥n SEGUIDA de Divisi√≥n</h4>
                <h4 style="color: #5E35B1; font-size: 1.1em; margin-bottom: 5px;">(‚àí8) √ó 3 √∑ (‚àí6) √ó (‚àí2) + 7</h4>
                <p style="color: #4527A0; line-height: 2.2;">
                    Ahora al rev√©s: la <strong>√ó aparece primero</strong>, luego √∑, luego otra √ó. Se resuelven en orden.<br><br>
                    <strong>Paso 1:</strong> Primera √ó (m√°s a la izquierda):<br>
                    &nbsp;&nbsp;&nbsp;(‚àí8) √ó 3 = <strong>‚àí24</strong><br>
                    <strong>Paso 2:</strong> Luego la √∑:<br>
                    &nbsp;&nbsp;&nbsp;(‚àí24) √∑ (‚àí6) = <strong>+4</strong><br>
                    <strong>Paso 3:</strong> Luego la segunda √ó:<br>
                    &nbsp;&nbsp;&nbsp;(+4) √ó (‚àí2) = <strong>‚àí8</strong><br>
                    <strong>Paso 4:</strong> Finalmente la +:<br>
                    &nbsp;&nbsp;&nbsp;(‚àí8) + 7 = <strong style="font-size: 1.3em; color: #1B5E20;">‚àí1</strong><br><br>
                    ‚ùå <strong>ERROR:</strong> Hacer primero (‚àí6) √ó (‚àí2) = 12 y luego √∑. ¬°NO! Se va <strong>de izquierda a derecha</strong>, sin importar si es √ó o √∑.
                </p>
            </div>

            <div style="background: #E8F5E9; padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #66BB6A;">
                <h4 style="color: #1B5E20;">Ejemplo 7 (5 t√©rminos, √∑ antes de √ó):</h4>
                <h4 style="color: #2E7D32; font-size: 1.1em; margin-bottom: 5px;">36 √∑ (‚àí6) √∑ (‚àí2) √ó 5 ‚àí 10</h4>
                <p style="color: #2E7D32; line-height: 2.2;">
                    Tres operaciones de √ó y √∑ seguidas. Se resuelven <strong>todas de izquierda a derecha</strong>:<br><br>
                    <strong>Paso 1:</strong> Primera √∑ ‚Üí 36 √∑ (‚àí6) = <strong>‚àí6</strong><br>
                    <strong>Paso 2:</strong> Segunda √∑ ‚Üí (‚àí6) √∑ (‚àí2) = <strong>+3</strong><br>
                    <strong>Paso 3:</strong> Luego √ó ‚Üí (+3) √ó 5 = <strong>+15</strong><br>
                    <strong>Paso 4:</strong> Finalmente ‚àí ‚Üí 15 ‚àí 10 = <strong style="font-size: 1.3em;">5</strong>
                </p>
            </div>

            <div style="background: #FFF3E0; padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #FFB74D;">
                <h4 style="color: #E65100;">Ejemplo 8 (5 t√©rminos con par√©ntesis, √ó antes de √∑):</h4>
                <h4 style="color: #BF360C; font-size: 1.1em; margin-bottom: 5px;">(‚àí5) √ó 2 + (3 ‚àí 8) √ó (‚àí4) √∑ 2 ‚àí 1</h4>
                <p style="color: #BF360C; line-height: 2.2;">
                    <strong>Paso 1:</strong> Par√©ntesis primero ‚Üí (3 ‚àí 8) = <strong>‚àí5</strong><br>
                    <strong>Paso 2:</strong> √ó y √∑ de izquierda a derecha:<br>
                    &nbsp;&nbsp;&nbsp;(‚àí5) √ó 2 = <strong>‚àí10</strong><br>
                    &nbsp;&nbsp;&nbsp;(‚àí5) √ó (‚àí4) = <strong>+20</strong><br>
                    &nbsp;&nbsp;&nbsp;(+20) √∑ 2 = <strong>+10</strong><br>
                    <strong>Paso 3:</strong> + y ‚àí de izquierda a derecha:<br>
                    &nbsp;&nbsp;&nbsp;(‚àí10) + 10 ‚àí 1 = <strong style="font-size: 1.3em;">‚àí1</strong>
                </p>
            </div>

            <div style="background: linear-gradient(135deg, #E1F5FE, #B3E5FC); padding: 22px; border-radius: 16px; margin: 12px 0; border: 3px solid #29B6F6;">
                <h4 style="color: #01579B;">Ejemplo 9 (5 t√©rminos completo):</h4>
                <h4 style="color: #0277BD; font-size: 1.1em; margin-bottom: 5px;">10 ‚àí 2 √ó (‚àí3) + (‚àí12) √∑ 4 √ó (‚àí1)</h4>
                <p style="color: #0277BD; line-height: 2.2;">
                    <strong>Paso 1:</strong> √ó y √∑ de izquierda a derecha (hay 3 operaciones de este nivel):<br>
                    &nbsp;&nbsp;&nbsp;2 √ó (‚àí3) = <strong>‚àí6</strong><br>
                    &nbsp;&nbsp;&nbsp;(‚àí12) √∑ 4 = <strong>‚àí3</strong> ‚Üí luego (‚àí3) √ó (‚àí1) = <strong>+3</strong><br>
                    <strong>Paso 2:</strong> Reemplazar en la expresi√≥n original:<br>
                    &nbsp;&nbsp;&nbsp;10 ‚àí (‚àí6) + 3<br>
                    <strong>Paso 3:</strong> + y ‚àí (recuerda: restar negativo = sumar):<br>
                    &nbsp;&nbsp;&nbsp;10 + 6 + 3 = <strong style="font-size: 1.3em;">19</strong>
                </p>
            </div>

            <h3>‚ö†Ô∏è Resumen: ¬øCu√°ndo √ó y √∑ van seguidas?</h3>
            <div style="background: #FFEBEE; padding: 18px; border-radius: 14px; border: 3px solid #E53935; margin: 12px 0;">
                <p style="color: #B71C1C; line-height: 2; font-size: 1.05em;">
                    üìå √ó y √∑ tienen <strong>IGUAL prioridad</strong> ‚Üí se resuelven <strong>DE IZQUIERDA A DERECHA</strong><br>
                    üìå No importa si primero viene √∑ o √ó, se hace <strong>la que est√© m√°s a la izquierda</strong><br>
                    üìå Lo mismo aplica para + y ‚àí ‚Üí <strong>misma prioridad, izquierda a derecha</strong><br>
                    ‚ùå NUNCA hagas primero la √ó solo porque "es m√°s fuerte" ‚Üí ¬°tienen el MISMO nivel!
                </p>
            </div>

            <h3>üí° Regla Mnemot√©cnica</h3>
            <p style="font-size: 1.1em; background: #fceabb; padding: 18px; border-radius: 12px; color: #6d4c41; font-weight: 600; text-align: center; border: 3px solid #ffcc00;">
                <strong>"Por Eso Mi Dulce Se√±ora Rosa"</strong><br>
                <span style="font-size: 0.9em;">(Par√©ntesis, Exponentes, Multiplicaci√≥n/Divisi√≥n, Suma/Resta)</span>
            </p>

            <!-- PR√ÅCTICA INTERACTIVA -->
            <h3 style="margin-top: 35px; color: #5C6BC0; font-size: 1.4em;">üß† Pr√°ctica Interactiva</h3>
            <p>Resuelve estos 8 ejercicios combinando <strong>multiplicaci√≥n, divisi√≥n y jerarqu√≠a</strong>:</p>

            <div class="quiz-container">
                <div class="quiz-item"><label for="h1">1. (‚àí5) √ó (+3) + 10 √∑ (‚àí2) =</label><input type="text" id="h1" class="quiz-input s2h-input" data-correct="-20" placeholder="" /></div>
                <div class="quiz-item"><label for="h2">2. 18 √∑ (‚àí3) + (‚àí4) √ó 2 =</label><input type="text" id="h2" class="quiz-input s2h-input" data-correct="-14" placeholder="" /></div>
                <div class="quiz-item"><label for="h3">3. (7 ‚àí 10) √ó (‚àí4) + 6 =</label><input type="text" id="h3" class="quiz-input s2h-input" data-correct="18" placeholder="" /></div>
                <div class="quiz-item"><label for="h4">4. (‚àí8) √∑ 2 + 3 √ó (‚àí3) ‚àí 1 =</label><input type="text" id="h4" class="quiz-input s2h-input" data-correct="-14" placeholder="" /></div>
                <div class="quiz-item"><label for="h5">5. 12 ‚àí (‚àí3) √ó 4 + (‚àí20) √∑ 5 =</label><input type="text" id="h5" class="quiz-input s2h-input" data-correct="20" placeholder="" /></div>
                <div class="quiz-item"><label for="h6">6. (‚àí2) √ó (5 ‚àí 8) + 15 √∑ (‚àí3) =</label><input type="text" id="h6" class="quiz-input s2h-input" data-correct="1" placeholder="" /></div>
                <div class="quiz-item"><label for="h7">7. (‚àí6) √ó (‚àí3) √∑ 2 + (‚àí4) √ó 3 ‚àí 5 =</label><input type="text" id="h7" class="quiz-input s2h-input" data-correct="-8" placeholder="" /></div>
                <div class="quiz-item"><label for="h8">8. 10 ‚àí 2 √ó (‚àí3) + (‚àí12) √∑ 4 √ó (‚àí1) =</label><input type="text" id="h8" class="quiz-input s2h-input" data-correct="19" placeholder="" /></div>
            </div>

            <button class="submit-quiz-button back-button" onclick="checkS2Hierarchy()">‚úÖ Comprobar Respuestas</button>
            <div id="s2hResults" style="display: none; margin-top: 15px; padding: 15px; border-radius: 12px; border: 3px solid #5c6bc0; background: #f5f5f5;"></div>

            <div style="text-align: right; margin-top: 30px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(2, 2); showScreen('session2GameClassScreen');">üé≤ Continuar al Juego en Clase ‚Üí</button>
            </div>
        </div>
    </div>

<!-- JUEGO EN CLASE: STOP MATEM√ÅTICO -->
    <div class="screen" id="session2GameClassScreen">
        <div class="content-screen">
            <button class="back-button" onclick="completeSubActivity(2, 3); showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
            <div style="text-align: center; margin-bottom: 25px;">
                <h2>üé≤ Juego en Clase: ¬°STOP Matem√°tico!</h2>
            </div>

            <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 25px; border-radius: 20px; margin-bottom: 20px; border: 3px solid #2196F3;">
                <h3 style="color: #1565C0; margin-bottom: 12px;">üìã ¬øQu√© es el Stop Matem√°tico?</h3>
                <p style="color: #0D47A1; line-height: 1.8;">Es un juego de <strong>velocidad y precisi√≥n</strong>. Se da un <strong>n√∫mero objetivo</strong> y cada jugador debe completar una tabla con operaciones que den ese resultado. El primero en terminar grita <strong>"¬°STOP!"</strong> y todos se detienen. Se revisan las respuestas: cada respuesta correcta vale <strong>10 puntos</strong>, incorrecta vale <strong>0</strong>.</p>
            </div>

            <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 25px; border-radius: 20px; margin-bottom: 20px; border: 3px solid #FF9800;">
                <h3 style="color: #E65100; margin-bottom: 12px;">üéØ Preparaci√≥n del Profesor</h3>
                <p style="color: #BF360C; line-height: 1.8; margin-bottom: 12px;">
                    <strong>1.</strong> Divida el curso en equipos de 3-4 estudiantes.<br>
                    <strong>2.</strong> Cada equipo recibe una <strong>hoja de STOP</strong> (tabla impresa o dibujada).<br>
                    <strong>3.</strong> El profesor dice un <strong>n√∫mero objetivo</strong> y los equipos completan las columnas.<br>
                    <strong>4.</strong> Se juegan <strong>5-8 rondas</strong> con n√∫meros diferentes.
                </p>
            </div>

            <h3 style="color: #1565C0;">üìä Formato de la Tabla STOP</h3>
            <p style="margin-bottom: 10px;">Cada ronda tiene un <strong>n√∫mero objetivo</strong>. Los equipos deben encontrar operaciones que den ese n√∫mero:</p>

            <div style="overflow-x: auto; margin: 15px 0;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em; min-width: 600px;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #1565C0, #1976D2); color: white;">
                            <th style="padding: 12px; border: 2px solid #0D47A1; text-align: center;">N√öMERO<br>OBJETIVO</th>
                            <th style="padding: 12px; border: 2px solid #0D47A1; text-align: center;">A √ó B<br><span style="font-size:0.8em;">(Multiplicaci√≥n)</span></th>
                            <th style="padding: 12px; border: 2px solid #0D47A1; text-align: center;">A √∑ B<br><span style="font-size:0.8em;">(Divisi√≥n)</span></th>
                            <th style="padding: 12px; border: 2px solid #0D47A1; text-align: center;">Operaci√≥n<br>combinada<br><span style="font-size:0.8em;">(√ó, √∑, +, ‚àí)</span></th>
                            <th style="padding: 12px; border: 2px solid #0D47A1; text-align: center;">Con<br>par√©ntesis</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E3F2FD;">
                            <td style="padding: 12px; border: 2px solid #90CAF9; text-align: center; font-weight: 700; font-size: 1.3em; color: #1565C0;">‚àí12</td>
                            <td style="padding: 12px; border: 2px solid #90CAF9; text-align: center; color: #2E7D32;">(‚àí3) √ó 4</td>
                            <td style="padding: 12px; border: 2px solid #90CAF9; text-align: center; color: #2E7D32;">36 √∑ (‚àí3)</td>
                            <td style="padding: 12px; border: 2px solid #90CAF9; text-align: center; color: #2E7D32;">(‚àí2)√ó3+(‚àí6)</td>
                            <td style="padding: 12px; border: 2px solid #90CAF9; text-align: center; color: #2E7D32;">(‚àí4)√ó(1+2)</td>
                        </tr>
                        <tr style="background: #FFF8E1;">
                            <td style="padding: 12px; border: 2px solid #FFE082; text-align: center; font-weight: 700; font-size: 1.3em; color: #E65100;">+20</td>
                            <td style="padding: 12px; border: 2px solid #FFE082; text-align: center; color: #888;">___</td>
                            <td style="padding: 12px; border: 2px solid #FFE082; text-align: center; color: #888;">___</td>
                            <td style="padding: 12px; border: 2px solid #FFE082; text-align: center; color: #888;">___</td>
                            <td style="padding: 12px; border: 2px solid #FFE082; text-align: center; color: #888;">___</td>
                        </tr>
                        <tr style="background: #FCE4EC;">
                            <td style="padding: 12px; border: 2px solid #F48FB1; text-align: center; font-weight: 700; font-size: 1.3em; color: #C62828;">‚àí6</td>
                            <td style="padding: 12px; border: 2px solid #F48FB1; text-align: center; color: #888;">___</td>
                            <td style="padding: 12px; border: 2px solid #F48FB1; text-align: center; color: #888;">___</td>
                            <td style="padding: 12px; border: 2px solid #F48FB1; text-align: center; color: #888;">___</td>
                            <td style="padding: 12px; border: 2px solid #F48FB1; text-align: center; color: #888;">___</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="color: #E65100;">üèÜ N√∫meros Objetivo Sugeridos por Ronda</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin: 15px 0;">
                <div style="background: #E8F5E9; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #4CAF50;"><span style="font-size: 0.8em; color: #666;">Ronda 1</span><br><strong style="font-size: 1.5em; color: #2E7D32;">‚àí12</strong></div>
                <div style="background: #FFF3E0; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #FF9800;"><span style="font-size: 0.8em; color: #666;">Ronda 2</span><br><strong style="font-size: 1.5em; color: #E65100;">+20</strong></div>
                <div style="background: #FCE4EC; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #E91E63;"><span style="font-size: 0.8em; color: #666;">Ronda 3</span><br><strong style="font-size: 1.5em; color: #C2185B;">‚àí6</strong></div>
                <div style="background: #E3F2FD; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #2196F3;"><span style="font-size: 0.8em; color: #666;">Ronda 4</span><br><strong style="font-size: 1.5em; color: #1565C0;">+36</strong></div>
                <div style="background: #F3E5F5; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #9C27B0;"><span style="font-size: 0.8em; color: #666;">Ronda 5</span><br><strong style="font-size: 1.5em; color: #7B1FA2;">‚àí18</strong></div>
                <div style="background: #E0F7FA; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #00BCD4;"><span style="font-size: 0.8em; color: #666;">Ronda 6</span><br><strong style="font-size: 1.5em; color: #00838F;">+8</strong></div>
                <div style="background: #FBE9E7; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #FF5722;"><span style="font-size: 0.8em; color: #666;">Ronda 7</span><br><strong style="font-size: 1.5em; color: #D84315;">‚àí30</strong></div>
                <div style="background: #FFFDE7; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #FDD835;"><span style="font-size: 0.8em; color: #666;">Ronda 8</span><br><strong style="font-size: 1.5em; color: #F57F17;">+15</strong></div>
            </div>

            <h3 style="color: #2E7D32;">‚úÖ Reglas de Puntuaci√≥n</h3>
            <div style="background: #E8F5E9; padding: 20px; border-radius: 15px; border: 2px solid #4CAF50; margin: 15px 0;">
                <p style="color: #1B5E20; line-height: 2;">
                    üéØ Respuesta <strong>correcta y √∫nica</strong> (nadie m√°s la tiene) ‚Üí <strong style="color: #2E7D32;">20 puntos</strong><br>
                    ‚úÖ Respuesta <strong>correcta repetida</strong> (otro equipo igual) ‚Üí <strong style="color: #FF9800;">10 puntos</strong><br>
                    ‚ùå Respuesta <strong>incorrecta</strong> ‚Üí <strong style="color: #E53935;">0 puntos</strong><br>
                    ‚¨ú Casilla <strong>vac√≠a</strong> ‚Üí <strong style="color: #888;">0 puntos</strong><br>
                    üèÜ El equipo que grita <strong>"¬°STOP!"</strong> y tiene todo correcto ‚Üí <strong style="color: #6A1B9A;">+5 puntos bonus</strong>
                </p>
            </div>

            <h3 style="color: #5C6BC0;">üí° Tips para el Profesor</h3>
            <div style="background: #E8EAF6; padding: 18px; border-radius: 12px; margin: 15px 0;">
                <p style="color: #283593; line-height: 1.9;">
                    üìå Empiece con n√∫meros f√°ciles (‚àí12, +20) y vaya subiendo.<br>
                    üìå Pida que en la columna "combinada" usen <strong>al menos 3 operaciones</strong>.<br>
                    üìå Revise en voz alta las respuestas para que todos aprendan.<br>
                    üìå Premie la creatividad: si un equipo usa 4+ operaciones y est√° correcto, doble puntaje.<br>
                    üìå Tiempo sugerido: <strong>20-25 min</strong> (6-8 rondas de 2-3 min cada una).
                </p>
            </div>

            <p style="margin-top: 25px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>20-25 min</strong></p>

            <div style="text-align: right; margin-top: 30px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(2, 3); showScreen('session2ArcadeScreen');">üöÄ Continuar al Juego Arcade ‚Üí</button>
            </div>
        </div>
    </div>

<div class="screen" id="session2ArcadeScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, #0a0025 0%, #1a0040 50%, #2d1060 100%); min-height: 100vh; padding: 15px; max-width: 100%; border-radius: 0;">
        <button class="back-button" onclick="exitArcade2(); completeSubActivity(2, 4); showScreen('session2Screen')" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);"> ‚Üê Volver a Sesi√≥n 2 </button>
        
        <!-- PANTALLA DE INICIO -->
        <div id="arcade2StartScreen" style="text-align: center; padding: 30px 15px;">
            <div style="margin-bottom: 15px;">
                <span style="font-size: 4.5em; display: inline-block; animation: a2Float 2s ease-in-out infinite;">üöÄ</span>
            </div>
            <h2 style="font-family: 'Segoe UI', sans-serif; font-size: 2.2em; font-weight: 900; color: #fff; margin-bottom: 5px; text-shadow: 0 0 30px rgba(156, 39, 176, 0.6);">
                NAVE MULTIPLICADORA
            </h2>
            <p style="font-size: 1em; color: #CE93D8; margin-bottom: 25px; letter-spacing: 2px;">MULTIPLICACI√ìN Y DIVISI√ìN DE ENTEROS</p>
            
            <div style="background: linear-gradient(145deg, rgba(156, 39, 176, 0.15), rgba(156, 39, 176, 0.05)); padding: 25px; border-radius: 20px; max-width: 500px; margin: 0 auto 25px auto; border: 2px solid rgba(156, 39, 176, 0.4);">
                <h4 style="color: #CE93D8; margin-bottom: 15px; font-size: 1.1em;">üìã ¬øC√≥mo Jugar?</h4>
                <div style="text-align: left; font-size: 0.95em; color: #E1BEE7; line-height: 2;">
                    <p style="margin-bottom: 8px;">üöÄ Tu nave <strong style="color: #69F0AE;">esquiva asteroides</strong> en el espacio</p>
                    <p style="margin-bottom: 8px;">‚¨ÖÔ∏è‚û°Ô∏è Usa <strong style="color: #fff;">flechas</strong> o toca los lados de la pantalla</p>
                    <p style="margin-bottom: 8px;">‚≠ê Recoge <strong style="color: #FFD740;">estrellas</strong> para ganar energ√≠a</p>
                    <p style="margin-bottom: 8px;">‚òÑÔ∏è Esquiva los <strong style="color: #FF5252;">asteroides</strong></p>
                    <p style="margin-bottom: 8px;">‚ù§Ô∏è Tienes <strong style="color: #FF5252;">4 vidas</strong></p>
                    <p style="margin-bottom: 8px;">üß† Al chocar ‚Üí <strong style="color: #FFD740;">pregunta de √ó y √∑</strong></p>
                    <p style="margin-bottom: 8px;">‚úÖ Respuesta correcta ‚Üí <strong style="color: #69F0AE;">No pierdes vida</strong></p>
                    <p>‚ùå Respuesta incorrecta ‚Üí <strong style="color: #FF5252;">Pierdes una vida</strong></p>
                </div>
            </div>
            
            <div id="arcade2AttemptsInfo" style="display: none; background: rgba(255, 152, 0, 0.15); padding: 12px 20px; border-radius: 12px; max-width: 400px; margin: 0 auto 20px auto; border: 2px solid rgba(255, 152, 0, 0.4);">
                <p style="color: #FFB74D; font-size: 1em; font-weight: 600;" id="arcade2AttemptsText"></p>
            </div>
            
            <button onclick="startArcade2Game()" style="background: linear-gradient(135deg, #9C27B0, #E040FB); color: white; border: none; padding: 20px 60px; font-size: 1.4em; font-weight: 800; border-radius: 30px; cursor: pointer; box-shadow: 0 8px 25px rgba(156, 39, 176, 0.5); transition: transform 0.2s; animation: a2Pulse 2s infinite;">
                üöÄ ¬°DESPEGAR!
            </button>
            
            <div style="margin-top: 15px;">
                <label style="color: #CE93D8; font-size: 0.9em; cursor: pointer;">
                    <input type="checkbox" id="arcade2MusicToggle" checked style="margin-right: 8px; cursor: pointer;"> üîä M√∫sica y sonidos
                </label>
            </div>
        </div>
        
        <!-- PANTALLA DE JUEGO -->
        <div id="arcade2GameScreen" style="display: none; text-align: center; padding: 10px;">
            <!-- HUD -->
            <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 6px; max-width: 700px; margin: 0 auto 8px auto; padding: 10px 12px; background: linear-gradient(135deg, rgba(74, 20, 140, 0.9), rgba(106, 27, 154, 0.9)); border-radius: 15px; border: 2px solid rgba(186, 104, 200, 0.5);">
                <div style="text-align: center;">
                    <div style="font-size: 0.65em; color: #CE93D8;">PUNTOS</div>
                    <div style="color: #FFD700; font-weight: 800; font-size: 1.2em;" id="arcade2Score">0</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.65em; color: #CE93D8;">VELOCIDAD</div>
                    <div style="color: #40C4FF; font-weight: 800; font-size: 1.2em;" id="arcade2SpeedDisplay">1x</div>
                </div>
                <div id="arcade2Lives" style="display: flex; gap: 4px; font-size: 1.1em;">
                    <span class="a2Heart">‚ù§Ô∏è</span>
                    <span class="a2Heart">‚ù§Ô∏è</span>
                    <span class="a2Heart">‚ù§Ô∏è</span>
                    <span class="a2Heart">‚ù§Ô∏è</span>
                </div>
                <button onclick="toggleArcade2Music()" id="arcade2MuteBtn" style="background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 10px; cursor: pointer; font-size: 0.9em;">üîä</button>
            </div>
            <!-- Barra de combustible -->
            <div style="max-width: 700px; margin: 0 auto 8px auto; padding: 6px 12px; background: rgba(74, 20, 140, 0.6); border-radius: 10px; border: 1px solid rgba(186, 104, 200, 0.3);">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="color: #FFD740; font-size: 0.85em; font-weight: 700;">‚õΩ COMBUSTIBLE</span>
                    <div style="flex: 1; height: 16px; background: rgba(0,0,0,0.4); border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.2);">
                        <div id="arcade2FuelBar" style="width: 100%; height: 100%; background: linear-gradient(90deg, #FF5252, #FF9800, #4CAF50); border-radius: 8px; transition: width 0.3s;"></div>
                    </div>
                    <span id="arcade2FuelText" style="color: #FFD740; font-size: 0.8em; font-weight: 700; min-width: 40px;">100%</span>
                </div>
            </div>
            
            <div style="position: relative; display: inline-block; width: 100%; max-width: 700px;">
                <canvas id="arcade2Canvas" style="border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.5), 0 0 50px rgba(156,39,176,0.2); border: 3px solid rgba(156,39,176,0.5); width: 100%; display: block; touch-action: none;"></canvas>
            </div>
            
            <div style="margin-top: 10px; color: #CE93D8; font-size: 0.85em;">
                ‚¨ÖÔ∏è‚û°Ô∏è Flechas para mover &nbsp;|&nbsp; üì± Toca los lados &nbsp;|&nbsp; ‚õΩ ¬°Recoge estrellas para recargar!
            </div>
        </div>

        <!-- MODAL DE PREGUNTA -->
        <div id="arcade2QuestionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 0, 37, 0.95); z-index: 9999; justify-content: center; align-items: center; backdrop-filter: blur(8px); overflow-y: auto;">
            <div style="background: linear-gradient(145deg, #4A148C, #6A1B9A); padding: 30px; border-radius: 25px; border: 4px solid #BA68C8; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); text-align: center; margin: auto;">
                <div style="font-size: 2.5em; margin-bottom: 8px;">üß†</div>
                <h3 style="color: #FFD740; font-size: 1.3em; margin-bottom: 5px;">¬°Chocaste! Responde correctamente</h3>
                <p style="color: #CE93D8; font-size: 0.9em; margin-bottom: 15px;" id="arcade2LivesRemaining"></p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 18px; border-radius: 15px; margin-bottom: 18px; border: 2px solid rgba(186,104,200,0.5);">
                    <p style="font-size: 1.4em; color: #fff; font-weight: 700;" id="arcade2QuestionContent"></p>
                </div>
                
                <div id="arcade2AnswerOptions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;"></div>
                
                <div id="arcade2QuestionFeedback" style="display: none; padding: 15px; border-radius: 12px; margin-top: 12px;">
                    <p id="arcade2FeedbackText" style="font-size: 1.1em; font-weight: 700;"></p>
                    <p id="arcade2FeedbackExplanation" style="font-size: 0.9em; margin-top: 6px;"></p>
                </div>
                
                <button id="arcade2ContinueBtn" onclick="arcade2ContinueAfterQuestion()" style="display: none; margin-top: 15px; background: linear-gradient(135deg, #9C27B0, #E040FB); color: white; border: none; padding: 15px 40px; font-size: 1.15em; font-weight: 800; border-radius: 25px; cursor: pointer; box-shadow: 0 6px 20px rgba(156,39,176,0.4); animation: a2Pulse 1.5s infinite;">
                    ‚ñ∂ Continuar Jugando
                </button>
            </div>
        </div>
        
        <!-- PANTALLA DE RESUMEN / FINAL -->
        <div id="arcade2WinScreen" style="display: none; text-align: center; padding: 40px 20px;">
            <div style="font-size: 5em; margin-bottom: 20px; animation: a2Float 0.6s infinite;">üèÜ</div>
            <h2 style="font-size: 2.5em; color: #FFD700; text-shadow: 0 0 30px rgba(255,215,0,0.5); margin-bottom: 15px;">¬°GRAN TRABAJO!</h2>
            <p style="font-size: 1.3em; color: #69F0AE; margin-bottom: 10px;">¬°Demostraste tu dominio en multiplicaci√≥n y divisi√≥n!</p>
            <p style="font-size: 1.2em; color: #CE93D8; margin-bottom: 5px;">Mejor puntuaci√≥n: <span id="arcade2FinalScore" style="font-weight: 800; color: #FFD700;">0</span></p>
            <p style="font-size: 1.1em; color: #E1BEE7; margin-bottom: 10px;">Preguntas correctas: <span id="arcade2FinalQuestions" style="font-weight: 800; color: #69F0AE;">0</span></p>
            
            <div style="background: rgba(76,175,80,0.15); padding: 25px; border-radius: 20px; max-width: 400px; margin: 0 auto 30px auto; border: 2px solid rgba(76,175,80,0.3);">
                <p style="color: #A5D6A7; font-size: 1.1em; line-height: 1.6;">üéâ ¬°Excelente!<br>Has practicado multiplicaci√≥n y divisi√≥n de enteros.</p>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resetArcade2Game()" style="background: linear-gradient(135deg, #9C27B0, #E040FB); color: white; border: none; padding: 15px 35px; font-size: 1.1em; font-weight: 700; border-radius: 30px; cursor: pointer;">üîÑ Jugar de Nuevo</button>
                <button onclick="exitArcade2(); finalizeSession2Arcade()" style="background: linear-gradient(135deg, #4CAF50, #43A047); color: white; border: none; padding: 15px 35px; font-size: 1.1em; font-weight: 700; border-radius: 30px; cursor: pointer;">Continuar a Jerarqu√≠a ‚Üí</button>
            </div>
        </div>
        
        <!-- PANTALLA DE GAME OVER -->
        <div id="arcade2GameOverScreen" style="display: none; text-align: center; padding: 40px 20px;">
            <div style="font-size: 5em; margin-bottom: 20px;">üíî</div>
            <h2 style="font-size: 2.3em; color: #F44336; margin-bottom: 15px;">¬°SIGUE INTENTANDO!</h2>
            <p style="font-size: 1.1em; color: #FFCDD2; margin-bottom: 10px;">Puntuaci√≥n: <span id="arcade2GameOverScore" style="font-weight: 800; color: #FFD700;">0</span></p>
            <p style="font-size: 1em; color: #CE93D8; margin-bottom: 10px;">Preguntas correctas: <span id="arcade2GameOverCorrect" style="font-weight: 700;">0</span></p>
            <p style="font-size: 1em; color: #FFB74D; margin-bottom: 25px;" id="arcade2GameOverAttempts"></p>
            <div style="background: rgba(244,67,54,0.1); padding: 25px; border-radius: 20px; max-width: 400px; margin: 0 auto 25px auto; border: 2px solid rgba(244,67,54,0.3);">
                <p style="color: #FFCDD2; font-size: 1.05em; line-height: 1.6;" id="arcade2GameOverMessage"></p>
            </div>
            <div id="arcade2GameOverButtons" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;"></div>
        </div>
    </div>
    
    <style>
        @keyframes a2Float { 0%, 100% { transform: translateY(0) rotate(-3deg); } 50% { transform: translateY(-15px) rotate(3deg); } }
        @keyframes a2Pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    </style>
</div>

<!-- QUIZ FINAL SESI√ìN 2 -->
<div class="screen" id="session2PracticeScreen">
    <div class="content-screen">
        <button class="back-button" onclick="completeSubActivity(2, 5); showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
        <div style="text-align: center; margin-bottom: 25px;">
            <h2>üìù Quiz Final: Dominio de Operaciones con Enteros</h2>
        </div>

        <p style="font-size: 1.15em; line-height: 1.8; margin-bottom: 15px;"><strong>¬°Demuestra tu dominio!</strong> 18 operaciones con dificultad progresiva.</p>

        <h3 style="color: #4CAF50; margin-bottom: 10px;">üü¢ Nivel 1: Dos t√©rminos (4 preguntas)</h3>
        <div class="quiz-container">
            <div class="quiz-item"><label for="p1">1. (‚àí9) √ó (+7) =</label><input type="text" id="p1" class="quiz-input" data-correct="-63" placeholder="" /></div>
            <div class="quiz-item"><label for="p2">2. (‚àí48) √∑ (‚àí6) =</label><input type="text" id="p2" class="quiz-input" data-correct="8" placeholder="" /></div>
            <div class="quiz-item"><label for="p3">3. (+12) √ó (‚àí5) =</label><input type="text" id="p3" class="quiz-input" data-correct="-60" placeholder="" /></div>
            <div class="quiz-item"><label for="p4">4. (‚àí72) √∑ (+8) =</label><input type="text" id="p4" class="quiz-input" data-correct="-9" placeholder="" /></div>
        </div>

        <h3 style="color: #FF9800; margin-bottom: 10px;">üü° Nivel 2: Tres t√©rminos (4 preguntas)</h3>
        <div class="quiz-container">
            <div class="quiz-item"><label for="p5">5. (‚àí3) √ó (+5) + (‚àí10) =</label><input type="text" id="p5" class="quiz-input" data-correct="-25" placeholder="" /></div>
            <div class="quiz-item"><label for="p6">6. 20 √∑ (‚àí4) √ó (+3) =</label><input type="text" id="p6" class="quiz-input" data-correct="-15" placeholder="" /></div>
            <div class="quiz-item"><label for="p7">7. (‚àí8) √ó (‚àí2) ‚àí (+10) =</label><input type="text" id="p7" class="quiz-input" data-correct="6" placeholder="" /></div>
            <div class="quiz-item"><label for="p8">8. (‚àí36) √∑ 6 + 4 √ó (‚àí2) =</label><input type="text" id="p8" class="quiz-input" data-correct="-14" placeholder="" /></div>
        </div>

        <h3 style="color: #F44336; margin-bottom: 10px;">üî¥ Nivel 3: Cuatro t√©rminos con jerarqu√≠a (5 preguntas)</h3>
        <div class="quiz-container">
            <div class="quiz-item"><label for="p9">9. 15 ‚àí (‚àí3) √ó 4 + (‚àí6) =</label><input type="text" id="p9" class="quiz-input" data-correct="21" placeholder="" /></div>
            <div class="quiz-item"><label for="p10">10. (‚àí2) √ó 5 + 30 √∑ (‚àí6) ‚àí 3 =</label><input type="text" id="p10" class="quiz-input" data-correct="-18" placeholder="" /></div>
            <div class="quiz-item"><label for="p11">11. (8 ‚àí 12) √ó (‚àí3) + 7 =</label><input type="text" id="p11" class="quiz-input" data-correct="19" placeholder="" /></div>
            <div class="quiz-item"><label for="p12">12. (‚àí24) √∑ 4 + (‚àí3) √ó (‚àí5) ‚àí 2 =</label><input type="text" id="p12" class="quiz-input" data-correct="7" placeholder="" /></div>
            <div class="quiz-item"><label for="p13">13. (‚àí3) √ó (4 ‚àí 7) + 18 √∑ (‚àí6) ‚àí 2 =</label><input type="text" id="p13" class="quiz-input" data-correct="4" placeholder="" /></div>
        </div>

        <h3 style="color: #9C27B0; margin-bottom: 10px;">üü£ Nivel 4: Combinados avanzados (2 preguntas)</h3>
        <div class="quiz-container">
            <div class="quiz-item"><label for="p14">14. 10 ‚àí 2 √ó (‚àí3) + (‚àí12) √∑ 4 √ó (‚àí1) =</label><input type="text" id="p14" class="quiz-input" data-correct="19" placeholder="" /></div>
            <div class="quiz-item"><label for="p15">15. (‚àí5) √ó 2 + (3 ‚àí 8) √ó (‚àí4) √∑ 2 ‚àí 1 =</label><input type="text" id="p15" class="quiz-input" data-correct="-1" placeholder="" /></div>
        </div>

        <h3 style="color: #D84315; margin-bottom: 10px;">üî• Nivel 5: √ó y √∑ seguidas + combinados avanzados (5 preguntas)</h3>
        <div class="quiz-container">
            <div class="quiz-item"><label for="p16">16. (‚àí24) √∑ 4 √ó (‚àí3) + 5 =</label><input type="text" id="p16" class="quiz-input" data-correct="23" placeholder="" /></div>
            <div class="quiz-item"><label for="p17">17. 36 √∑ (‚àí6) √∑ (‚àí2) √ó 5 ‚àí 10 =</label><input type="text" id="p17" class="quiz-input" data-correct="5" placeholder="" /></div>
            <div class="quiz-item"><label for="p18">18. (‚àí8) √ó 3 √∑ (‚àí6) √ó (‚àí2) + 7 =</label><input type="text" id="p18" class="quiz-input" data-correct="-1" placeholder="" /></div>
            <div class="quiz-item"><label for="p19">19. (‚àí2) √ó (5 ‚àí 9) + 24 √∑ (‚àí3) √ó 2 ‚àí 3 =</label><input type="text" id="p19" class="quiz-input" data-correct="-11" placeholder="" /></div>
            <div class="quiz-item"><label for="p20">20. 15 √∑ (‚àí5) √ó (‚àí4) + (2 ‚àí 7) √ó (‚àí3) ‚àí 1 =</label><input type="text" id="p20" class="quiz-input" data-correct="26" placeholder="" /></div>
        </div>

        <button class="submit-quiz-button back-button" onclick="submitPracticeQuiz(2)">‚úÖ Comprobar Resultados y Finalizar Sesi√≥n</button>
        
        <div id="practiceResults" class="quiz-results" style="display: none; border-color: #ff8000; box-shadow: 0 10px 30px rgba(255, 128, 0, 0.4);">
            <h3>Resultados del Quiz Final:</h3>
            <p>Puntuaci√≥n: <span id="practiceScore">0/20</span></p>
            <ul class="result-list" id="practiceResultList"></ul>
        </div>
        
        <div id="completeSession2Button" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
            <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(52, 152, 219, 0.2)); padding: 30px; border-radius: 25px; border: 3px solid #2ecc71;">
                <h3 style="color: #27ae60; font-size: 2em; margin-bottom: 20px;">üéâ ¬°Sesi√≥n 2 COMPLETADA!</h3>
                <button class="back-button" onclick="showScreen('session3Screen')" style="background: linear-gradient(135deg, #2ecc71, #27ae60); font-size: 1.5em; padding: 25px 60px;">
                    üöÄ ¬°Comenzar Sesi√≥n 3! ‚Üí
                </button>
            </div>
        </div>
    </div>
</div>


<!-- ============================================== -->
<!-- SESI√ìN 3: JERARQU√çA COMPLETA DE OPERACIONES -->
<!-- ============================================== -->

<div class="screen" id="session3Screen">
    <div class="content-screen" style="position: relative;">
        <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
        <div style="text-align: center; margin-top: 30px;">
            <div class="session-header-icon">üß†</div>
            <h2 class="session-title-gradient">Sesi√≥n 3: Jerarqu√≠a Completa de Operaciones</h2>
            <p style="font-size: 1.3em; color: #555; font-weight: 500;">¬°Domina las operaciones combinadas con par√©ntesis, corchetes y llaves!</p>
        </div>

        <div class="content-grid-session1">
            <div class="card-session objective-card">
                <h3>Objetivo de Sesi√≥n</h3>
                <p>Dominar la jerarqu√≠a completa de operaciones con n√∫meros enteros, aplicando correctamente el orden de par√©ntesis ( ), corchetes [ ] y llaves { }, y resolviendo expresiones matem√°ticas complejas con precisi√≥n.</p>
            </div>
            <div class="card-session learning-card">
                <h3>Ruta de Aprendizaje</h3>
                <ul class="learning-list">
                    <li class="learning-list-item" onclick="showScreen('session3TheoryScreen')"><span>üìö</span> Teor√≠a: Jerarqu√≠a Completa con S√≠mbolos de Agrupaci√≥n</li>
                    <li class="learning-list-item" onclick="showScreen('session3PracticeScreen')"><span>‚úçÔ∏è</span> Pr√°ctica Progresiva: 20 Ejercicios Secuenciales</li>
                    <li class="learning-list-item" onclick="openEscapeRoom()"><span>üîê</span> Escape Room: Desaf√≠o Final</li>
                </ul>
            </div>
        </div>

        <div class="session1-nav-grid">
            <div class="session-nav-card" onclick="showScreen('session3TheoryScreen')">
                <div class="session-nav-card-icon">üìö</div>
                <h4>1. Teor√≠a</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session3PracticeScreen')">
                <div class="session-nav-card-icon">‚úçÔ∏è</div>
                <h4>2. Pr√°ctica (20 ejercicios)</h4>
            </div>
            <div class="session-nav-card" onclick="openEscapeRoom()">
                <div class="session-nav-card-icon">üîê</div>
                <h4>3. Escape Room</h4>
            </div>
        </div>
    </div>
</div>



<!-- TEOR√çA SESI√ìN 3 - VERSI√ìN MEJORADA -->
<div class="screen" id="session3TheoryScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session3Screen')"> ‚Üê Volver a Sesi√≥n 3 </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 30px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üî¢</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üìê</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üéØ</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚ö°</span>
            </div>
            <h2 style="position: relative; z-index: 1;">üìö Jerarqu√≠a Completa: Par√©ntesis, Corchetes y Llaves</h2>
        </div>

        <!-- INTRODUCCI√ìN CON FONDO -->
        <div style="background: linear-gradient(135deg, #e1f5fe, #b3e5fc); padding: 30px; border-radius: 25px; margin: 30px 0; border: 4px solid #03a9f4; box-shadow: 0 15px 40px rgba(3, 169, 244, 0.3);">
            <h3 style="color: #01579b; font-size: 1.8em; margin-bottom: 15px;">üéØ ¬øPor qu√© necesitamos s√≠mbolos de agrupaci√≥n?</h3>
            <p style="font-size: 1.2em; line-height: 1.8; color: #0277bd;">En la Sesi√≥n 2 aprendiste la jerarqu√≠a b√°sica (PEMDSR). Ahora vamos a <strong>nivel EXPERTO</strong>. Cuando tienes expresiones muy complejas con m√∫ltiples operaciones anidadas, necesitas s√≠mbolos de agrupaci√≥n para indicar claramente QU√â se debe resolver PRIMERO.</p>
            
            <p style="font-size: 1.15em; line-height: 1.8; color: #01579b; margin-top: 20px;">üí° Piensa en los s√≠mbolos de agrupaci√≥n como <strong>"cajas dentro de cajas"</strong>. Primero abres la caja m√°s peque√±a (par√©ntesis), luego la mediana (corchetes), y finalmente la m√°s grande (llaves).</p>
        </div>

        <h3 style="color: #9c27b0; font-size: 2em; text-align: center; margin: 40px 0 30px 0;">üîë La Jerarqu√≠a COMPLETA: De adentro hacia afuera</h3>
        
        <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 40px; border-radius: 30px; margin: 30px 0; border: 5px solid #9c27b0; box-shadow: 0 20px 50px rgba(156, 39, 176, 0.4);">
            <h3 style="color: #4a148c; text-align: center; font-size: 2.2em; margin-bottom: 30px; text-shadow: 0 2px 5px rgba(0,0,0,0.1);">üìã Orden COMPLETO de Operaciones</h3>
            
            <div style="display: grid; gap: 20px;">
                <div style="background: linear-gradient(135deg, #fff, #f3e5f5); padding: 25px; border-radius: 20px; border-left: 10px solid #9c27b0; box-shadow: 0 8px 20px rgba(156, 39, 176, 0.2); transition: transform 0.3s;">
                    <h4 style="color: #6a1b9a; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="background: #9c27b0; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2em;">1</span>
                        Par√©ntesis Internos ( )
                    </h4>
                    <p style="color: #4a148c; line-height: 1.9; font-size: 1.1em; padding-left: 55px;">Siempre resuelve <strong>PRIMERO</strong> lo que est√° dentro de par√©ntesis. Si hay par√©ntesis anidados (uno dentro de otro), empieza por el <strong>M√ÅS INTERNO</strong>.</p>
                    <div style="background: rgba(156, 39, 176, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; margin-left: 55px;">
                        <p style="color: #6a1b9a; font-weight: 600; font-size: 1.1em;">üìù Ejemplo: 5 √ó (3 + (8 ‚àí 2))</p>
                        <p style="color: #4a148c; margin-top: 8px;">‚Üí Primero resuelve <span style="background: #ffeb3b; padding: 3px 8px; border-radius: 5px; font-weight: 700;">(8 ‚àí 2) = 6</span></p>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff, #e8eaf6); padding: 25px; border-radius: 20px; border-left: 10px solid #3f51b5; box-shadow: 0 8px 20px rgba(63, 81, 181, 0.2);">
                    <h4 style="color: #1a237e; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="background: #3f51b5; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2em;">2</span>
                        Corchetes [ ]
                    </h4>
                    <p style="color: #283593; line-height: 1.9; font-size: 1.1em; padding-left: 55px;">Despu√©s de resolver <strong>TODO</strong> lo que hay en par√©ntesis, resuelves lo que est√° dentro de corchetes.</p>
                    <div style="background: rgba(63, 81, 181, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; margin-left: 55px;">
                        <p style="color: #1a237e; font-weight: 600; font-size: 1.1em;">üìù Ejemplo: [10 ‚àí (3 + 2)]</p>
                        <p style="color: #283593; margin-top: 8px;">‚Üí Primero <span style="background: #ffeb3b; padding: 3px 8px; border-radius: 5px; font-weight: 700;">(3 + 2) = 5</span>, luego <span style="background: #a5d6a7; padding: 3px 8px; border-radius: 5px; font-weight: 700;">[10 ‚àí 5] = 5</span></p>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff, #e0f2f1); padding: 25px; border-radius: 20px; border-left: 10px solid #00bcd4; box-shadow: 0 8px 20px rgba(0, 188, 212, 0.2);">
                    <h4 style="color: #006064; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="background: #00bcd4; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2em;">3</span>
                        Llaves { }
                    </h4>
                    <p style="color: #00695c; line-height: 1.9; font-size: 1.1em; padding-left: 55px;">Finalmente, despu√©s de resolver par√©ntesis y corchetes, resuelves lo que est√° dentro de llaves.</p>
                    <div style="background: rgba(0, 188, 212, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; margin-left: 55px;">
                        <p style="color: #006064; font-weight: 600; font-size: 1.1em;">üìù Ejemplo: {20 ‚àí [5 + (2 √ó 3)]}</p>
                        <p style="color: #00695c; margin-top: 8px;">‚Üí Resuelves de <strong>adentro hacia afuera</strong></p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #fff, #fff3e0); padding: 20px; border-radius: 15px; border-left: 8px solid #ff9800;">
                    <h4 style="color: #e65100; font-size: 1.4em; margin-bottom: 10px;">4Ô∏è‚É£ Multiplicaci√≥n √ó y Divisi√≥n √∑</h4>
                    <p style="color: #ef6c00; line-height: 1.8; font-size: 1.05em;">De izquierda a derecha. Tienen la misma prioridad.</p>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff, #e3f2fd); padding: 20px; border-radius: 15px; border-left: 8px solid #2196f3;">
                    <h4 style="color: #0d47a1; font-size: 1.4em; margin-bottom: 10px;">5Ô∏è‚É£ Suma + y Resta ‚àí</h4>
                    <p style="color: #1565c0; line-height: 1.8; font-size: 1.05em;">De izquierda a derecha. Tambi√©n tienen la misma prioridad.</p>
                </div>
            </div>
        </div>

        <!-- REGLA DE ORO -->
        <div style="background: linear-gradient(135deg, #fff9c4, #fff59d); padding: 35px; border-radius: 25px; margin: 40px 0; border: 5px solid #fbc02d; box-shadow: 0 20px 50px rgba(251, 192, 45, 0.4); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -20px; right: -20px; font-size: 8em; opacity: 0.1;">üèÜ</div>
            <h3 style="color: #f57f17; font-size: 2em; margin-bottom: 25px; text-align: center; position: relative; z-index: 1;">üéì Regla de Oro: "De ADENTRO hacia AFUERA"</h3>
            <div style="position: relative; z-index: 1;">
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #f57f17; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 1</span> Busca el s√≠mbolo M√ÅS INTERNO (generalmente par√©ntesis)
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #ff9800; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 2</span> Resuelve TODO lo que est√° dentro de ese s√≠mbolo
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #fbc02d; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 3</span> Elimina ese s√≠mbolo y contin√∫a hacia AFUERA
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #f9a825; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 4</span> Repite hasta que no queden s√≠mbolos de agrupaci√≥n
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #f57c00; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 5</span> Aplica PEMDSR (Multiplicaci√≥n/Divisi√≥n, luego Suma/Resta)
                </p>
            </div>
        </div>

        <h3 style="color: #1976d2; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üìù Ejemplos Resueltos Paso a Paso</h3>

        <!-- EJEMPLO 1 -->
        <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #2196f3; box-shadow: 0 15px 40px rgba(33, 150, 243, 0.3);">
            <h4 style="color: #0d47a1; font-size: 1.8em; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="background: #2196f3; color: white; padding: 10px 20px; border-radius: 15px; margin-right: 15px;">1</span>
                {15 ‚àí [8 + (3 √ó 2)]}
            </h4>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 1:</strong> Identificar el s√≠mbolo M√ÅS INTERNO ‚Üí <span style="background: #ffeb3b; padding: 5px 12px; border-radius: 8px; font-weight: 700;">(3 √ó 2)</span>
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 2:</strong> Resolver ‚Üí 3 √ó 2 = <strong style="color: #2e7d32; font-size: 1.3em;">6</strong>
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 3:</strong> Reemplazar ‚Üí {15 ‚àí [8 + <strong style="color: #2e7d32;">6</strong>]}
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 4:</strong> Resolver corchetes ‚Üí [8 + 6] = <strong style="color: #2e7d32; font-size: 1.3em;">14</strong>
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 5:</strong> Reemplazar ‚Üí {15 ‚àí <strong style="color: #2e7d32;">14</strong>}
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 6:</strong> Resolver llaves ‚Üí 15 ‚àí 14 = <strong style="font-size: 1.5em; color: #1565c0;">1</strong>
                </p>
            </div>
            <div style="background: linear-gradient(135deg, #4caf50, #388e3c); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.5em; font-weight: 700; margin-top: 20px; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);">
                ‚úÖ RESPUESTA FINAL: 1
            </div>
        </div>

        <!-- EJEMPLO 2 -->
        <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #9c27b0; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.3);">
            <h4 style="color: #6a1b9a; font-size: 1.8em; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="background: #9c27b0; color: white; padding: 10px 20px; border-radius: 15px; margin-right: 15px;">2</span>
                20 √∑ [10 ‚àí (3 + 2)] + 5
            </h4>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 1:</strong> Par√©ntesis interno ‚Üí <span style="background: #ffeb3b; padding: 5px 12px; border-radius: 8px; font-weight: 700;">(3 + 2)</span> = <strong style="color: #2e7d32; font-size: 1.3em;">5</strong>
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 2:</strong> Reemplazar ‚Üí 20 √∑ [10 ‚àí <strong style="color: #2e7d32;">5</strong>] + 5
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 3:</strong> Corchetes ‚Üí [10 ‚àí 5] = <strong style="color: #2e7d32; font-size: 1.3em;">5</strong>
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 4:</strong> Reemplazar ‚Üí 20 √∑ <strong style="color: #2e7d32;">5</strong> + 5
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 5:</strong> Divisi√≥n primero ‚Üí 20 √∑ 5 = <strong style="color: #2e7d32; font-size: 1.3em;">4</strong>
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 6:</strong> Suma ‚Üí 4 + 5 = <strong style="font-size: 1.5em; color: #6a1b9a;">9</strong>
                </p>
            </div>
            <div style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.5em; font-weight: 700; margin-top: 20px; box-shadow: 0 8px 20px rgba(156, 39, 176, 0.4);">
                ‚úÖ RESPUESTA FINAL: 9
            </div>
        </div>

        <!-- EJEMPLO 3 CON NEGATIVOS -->
        <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #ff9800; box-shadow: 0 15px 40px rgba(255, 152, 0, 0.3);">
            <h4 style="color: #e65100; font-size: 1.8em; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="background: #ff9800; color: white; padding: 10px 20px; border-radius: 15px; margin-right: 15px;">3</span>
                {(‚àí5) √ó [(‚àí8) √∑ (‚àí2)]} + 10
            </h4>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 1:</strong> Par√©ntesis m√°s interno ‚Üí <span style="background: #ffeb3b; padding: 5px 12px; border-radius: 8px; font-weight: 700;">(‚àí8) √∑ (‚àí2)</span>
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 2:</strong> Aplicar ley de signos ‚Üí (‚àí) √∑ (‚àí) = (+) ‚Üí 8 √∑ 2 = <strong style="color: #2e7d32; font-size: 1.3em;">4</strong>
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 3:</strong> Reemplazar ‚Üí {(‚àí5) √ó [<strong style="color: #2e7d32;">4</strong>]} + 10
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 4:</strong> Corchetes ‚Üí [4] = 4
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 5:</strong> Llaves ‚Üí (‚àí5) √ó 4 = <strong style="color: #c62828; font-size: 1.3em;">‚àí20</strong>
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 6:</strong> Suma ‚Üí (‚àí20) + 10 = <strong style="font-size: 1.5em; color: #d84315;">‚àí10</strong>
                </p>
            </div>
            <div style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.5em; font-weight: 700; margin-top: 20px; box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);">
                ‚úÖ RESPUESTA FINAL: ‚àí10
            </div>
        </div>

        <!-- ERRORES COMUNES -->
        <div style="background: linear-gradient(135deg, #ffebee, #ffcdd2); padding: 30px; border-radius: 20px; border-left: 10px solid #f44336; margin: 40px 0; box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);">
            <h3 style="color: #c62828; font-size: 1.8em; margin-bottom: 20px;">‚ö†Ô∏è Errores Comunes que DEBES Evitar</h3>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 1:</strong> Resolver de afuera hacia adentro (INCORRECTO)</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 2:</strong> No respetar la jerarqu√≠a dentro de cada agrupaci√≥n</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 3:</strong> Olvidar aplicar la ley de signos en multiplicaciones/divisiones</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 4:</strong> Saltarse s√≠mbolos de agrupaci√≥n por impaciencia</p>
            </div>
        </div>

        <!-- CONSEJO DE MAESTRO -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 40px; border-radius: 25px; margin: 40px 0; box-shadow: 0 20px 50px rgba(102, 126, 234, 0.5); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; right: -30px; font-size: 10em; opacity: 0.1;">üë®‚Äçüè´</div>
            <h3 style="font-size: 2em; margin-bottom: 25px; text-align: center; text-shadow: 0 2px 5px rgba(0,0,0,0.3); position: relative; z-index: 1;">üí° Consejo de Maestro</h3>
            <div style="position: relative; z-index: 1;">
                <p style="font-size: 1.3em; line-height: 2; font-weight: 500; margin: 15px 0;">
                    üìù <strong>Cuando te enfrentes a una expresi√≥n compleja:</strong>
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    1Ô∏è‚É£ Respira profundo y NO te apresures üßò
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    2Ô∏è‚É£ Encierra con colores diferentes cada nivel de agrupaci√≥n
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    3Ô∏è‚É£ Trabaja SIEMPRE de adentro hacia afuera
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    4Ô∏è‚É£ Escribe CADA PASO (no lo hagas todo en tu cabeza)
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    5Ô∏è‚É£ Verifica tu respuesta sustituyendo hacia atr√°s
                </p>
                <p style="font-size: 1.3em; line-height: 2; font-weight: 600; margin-top: 25px; text-align: center; background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px;">
                    üéØ La clave es la PACIENCIA y el ORDEN. ¬°Los expertos no son r√°pidos, son PRECISOS!
                </p>
            </div>
        </div>

        <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>25 min</strong> (Teor√≠a + Ejemplos).</p>

        <div style="text-align: right; margin-top: 40px;">
            <button class="start-activity-button back-button" onclick="completeSubActivity(3, 1); showScreen('session3PracticeScreen');">Continuar a Pr√°ctica Progresiva ‚Üí</button>
        </div>
    </div>
</div>

<!-- PR√ÅCTICA PROGRESIVA SESI√ìN 3: 15 EJERCICIOS MEJORADOS -->
<div class="screen" id="session3PracticeScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session3Screen')"> ‚Üê Volver a Sesi√≥n 3 </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 30px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">‚úçÔ∏è</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üéØ</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üí™</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üß†</span>
            </div>
            <h2 style="position: relative; z-index: 1;">‚úçÔ∏è Pr√°ctica Progresiva: 15 Ejercicios Secuenciales</h2>
        </div>

        <!-- HEADER INFORMATIVO -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 30px; border-radius: 20px; margin-bottom: 40px; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4); color: white;">
            <h3 style="font-size: 1.8em; margin-bottom: 15px; text-align: center; text-shadow: 0 2px 5px rgba(0,0,0,0.3);">üéØ ¬°Demuestra tu dominio!</h3>
            <p style="font-size: 1.2em; line-height: 1.8; text-align: center; margin-bottom: 20px;">
                Resuelve los 15 ejercicios en orden de dificultad creciente.<br>
                Necesitas <strong style="background: rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 10px;">al menos 10 correctos</strong> para avanzar al Escape Room.
            </p>
            <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px; margin-top: 25px;">
                <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">‚è±Ô∏è</div>
                    <div style="font-size: 1.1em; font-weight: 600;">T√≥mate tu tiempo</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üìù</div>
                    <div style="font-size: 1.1em; font-weight: 600;">Usa papel y l√°piz</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üéØ</div>
                    <div style="font-size: 1.1em; font-weight: 600;">Precisi√≥n > Velocidad</div>
                </div>
            </div>
        </div>

        <!-- BARRA DE PROGRESO -->
        <div style="background: linear-gradient(135deg, #f5f5f5, #e0e0e0); padding: 20px; border-radius: 20px; margin-bottom: 40px; border: 3px solid #9e9e9e; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <p style="font-size: 1.2em; font-weight: 700; color: #424242; margin-bottom: 15px; text-align: center;">üìä Progreso de Resoluci√≥n</p>
            <div id="session3ProgressBar" style="background: #bdbdbd; height: 30px; border-radius: 15px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.2) inset; position: relative;">
                <div id="session3ProgressFill" style="background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.4, 0.0, 0.2, 1); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.1em; box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);"></div>
            </div>
        </div>

        <div class="quiz-container" style="background: linear-gradient(135deg, #fafafa, #f5f5f5); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            
            <!-- NIVEL 1: B√ÅSICO (Ejercicios 1-5) -->
            <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 20px; border-radius: 15px; margin-bottom: 25px; border-left: 8px solid #4caf50;">
                <h3 style="color: #2e7d32; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="background: #4caf50; color: white; padding: 8px 18px; border-radius: 10px; margin-right: 15px;">NIVEL 1</span>
                    B√°sico - Calentamiento
                </h3>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q1">1. 10 + (5 √ó 2) ‚àí 8 =</label>
                <input type="text" id="s3q1" class="quiz-input" data-correct="12" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q2">2. 24 √∑ [12 ‚àí (3 + 3)] =</label>
                <input type="text" id="s3q2" class="quiz-input" data-correct="4" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q3">3. {20 ‚àí [15 ‚àí (2 √ó 3)]} =</label>
                <input type="text" id="s3q3" class="quiz-input" data-correct="11" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q4">4. 7 √ó (10 ‚àí 6) + 5 =</label>
                <input type="text" id="s3q4" class="quiz-input" data-correct="33" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q5">5. [18 √∑ (2 + 1)] √ó 4 =</label>
                <input type="text" id="s3q5" class="quiz-input" data-correct="24" placeholder="Respuesta" />
            </div>

            <!-- NIVEL 2: INTERMEDIO (Ejercicios 6-10) -->
            <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 15px; margin: 30px 0 25px 0; border-left: 8px solid #2196f3;">
                <h3 style="color: #0d47a1; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="background: #2196f3; color: white; padding: 8px 18px; border-radius: 10px; margin-right: 15px;">NIVEL 2</span>
                    Intermedio - Aumenta el Desaf√≠o
                </h3>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q6">6. {30 ‚àí [12 + (4 √ó 2)]} + 5 =</label>
                <input type="text" id="s3q6" class="quiz-input" data-correct="15" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q7">7. 50 √∑ {10 ‚àí [8 ‚àí (3 + 2)]} =</label>
                <input type="text" id="s3q7" class="quiz-input" data-correct="10" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q8">8. [(15 + 5) √∑ 4] √ó (6 ‚àí 2) =</label>
                <input type="text" id="s3q8" class="quiz-input" data-correct="20" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q9">9. {[(24 ‚àí 8) √∑ 4] + 3} √ó 2 =</label>
                <input type="text" id="s3q9" class="quiz-input" data-correct="18" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q10">10. 40 ‚àí {15 + [10 ‚àí (3 + 2)]} =</label>
                <input type="text" id="s3q10" class="quiz-input" data-correct="20" placeholder="Respuesta" />
            </div>

            <!-- NIVEL 3: AVANZADO/EXPERTO (Ejercicios 11-15) -->
            <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 20px; border-radius: 15px; margin: 30px 0 25px 0; border-left: 8px solid #9c27b0;">
                <h3 style="color: #6a1b9a; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="background: #9c27b0; color: white; padding: 8px 18px; border-radius: 10px; margin-right: 15px;">NIVEL 3</span>
                    Avanzado - ¬°Demuestra tu Maestr√≠a!
                </h3>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f3e5f5); border-left: 5px solid #ab47bc;">
                <label for="s3q11">11. (‚àí5) √ó [10 ‚àí (3 + 4)] + 8 =</label>
                <input type="text" id="s3q11" class="quiz-input" data-correct="-7" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f3e5f5); border-left: 5px solid #ab47bc;">
                <label for="s3q12">12. 60 ‚àí {[(‚àí8) √ó (‚àí3)] + 15} =</label>
                <input type="text" id="s3q12" class="quiz-input" data-correct="21" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f3e5f5); border-left: 5px solid #ab47bc;">
                <label for="s3q13">13. [(‚àí20) √∑ (‚àí4)] √ó {10 ‚àí [8 ‚àí 3]} =</label>
                <input type="text" id="s3q13" class="quiz-input" data-correct="25" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff3e0); border-left: 5px solid #ff9800; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);">
                <label for="s3q14" style="color: #e65100; font-weight: 700;">14. 100 ‚àí {50 + [20 ‚àí (8 √∑ 2) √ó 3]} =</label>
                <input type="text" id="s3q14" class="quiz-input" data-correct="62" placeholder="Respuesta" style="border-color: #ff9800;" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #f44336; box-shadow: 0 5px 15px rgba(244, 67, 54, 0.2);">
                <label for="s3q15" style="color: #c62828; font-weight: 700;">15. üî• DESAF√çO FINAL: 150 ‚àí {[(‚àí60) √∑ (‚àí12)] √ó [18 ‚àí (4 + 5)]} ‚àí 10 =</label>
                <input type="text" id="s3q15" class="quiz-input" data-correct="95" placeholder="Respuesta" style="border-color: #f44336; border-width: 3px;" />
            </div>
        </div>

        <button class="submit-quiz-button back-button" onclick="submitSession3Practice()" style="background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); font-size: 1.4em; padding: 25px 50px; margin-top: 40px; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);">
            üîç Verificar Todas las Respuestas
        </button>
        
        <div id="session3PracticeResults" class="quiz-results" style="display: none; background: linear-gradient(135deg, #f5f5f5, #ffffff); border: 4px solid #667eea; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3); margin-top: 40px;">
            <h3 style="color: #667eea; font-size: 2em; border-bottom: 3px solid #667eea; padding-bottom: 15px; margin-bottom: 25px;">üìä Resultados de la Pr√°ctica</h3>
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; text-align: center; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
                <p style="font-size: 1.5em; margin-bottom: 10px;">Tu Puntuaci√≥n:</p>
                <p style="font-size: 3em; font-weight: 900; margin: 0;"><span id="session3PracticeScore">0/15</span></p>
            </div>
            <ul class="result-list" id="session3PracticeResultList" style="list-style: none; padding: 0;"></ul>
        </div>
        
        <div id="session3CompleteButton" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
            <div style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(103, 58, 183, 0.2)); padding: 40px; border-radius: 30px; border: 4px solid #9c27b0; box-shadow: 0 20px 60px rgba(156, 39, 176, 0.5); position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; font-size: 15em; opacity: 0.1;">üéâ</div>
                <h3 style="color: #6a1b9a; font-size: 2.5em; margin-bottom: 25px; position: relative; z-index: 1;">üéâ ¬°PR√ÅCTICA SUPERADA!</h3>
                <p style="font-size: 1.3em; color: #4a148c; margin-bottom: 30px; line-height: 1.8; position: relative; z-index: 1;">
                    Has demostrado dominio de la jerarqu√≠a completa.<br>
                    <strong style="font-size: 1.2em;">¬°Est√°s listo para el Escape Room!</strong>
                </p>
                <button class="back-button" onclick="openEscapeRoom()" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2, #6a1b9a); font-size: 1.6em; padding: 30px 70px; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.6); position: relative; z-index: 1;">
                    üîê ¬°Acceder al Escape Room! ‚Üí
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ESCAPE ROOM SESI√ìN 3: PANTALLA INFORMATIVA -->
<div class="screen" id="session3EscapeRoomScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session3Screen')"> ‚Üê Volver a Sesi√≥n 3 </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 40px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üîê</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üêâ</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">‚öîÔ∏è</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üèÜ</span>
            </div>
            <h2 style="position: relative; z-index: 1; font-size: 3em; background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üîê Escape Room: La Batalla del Drag√≥n</h2>
        </div>

        <!-- INTRODUCCI√ìN √âPICA -->
        <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 30px; margin: 30px 0; border: 5px solid #f093fb; box-shadow: 0 20px 60px rgba(240, 147, 251, 0.5); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; font-size: 15em; opacity: 0.05; transform: rotate(-15deg);">üêâ</div>
            
            <div style="text-align: center; margin-bottom: 30px; position: relative; z-index: 1;">
                <div style="font-size: 6em; animation: pulse 2s infinite;">üêâ</div>
                <h3 style="color: #f093fb; font-size: 2.5em; margin-top: 20px; text-shadow: 0 0 20px rgba(240, 147, 251, 0.8);">¬°El Drag√≥n Matem√°tico te Desaf√≠a!</h3>
            </div>
            
            <p style="color: #ffffff; font-size: 1.3em; line-height: 2; text-align: center; margin-bottom: 30px; position: relative; z-index: 1;">
                Un poderoso drag√≥n ha encerrado los conocimientos matem√°ticos en una torre oscura. 
                Solo los valientes que dominen las operaciones con n√∫meros enteros podr√°n liberarlos.
                <br><br>
                <strong style="color: #ffeb3b; font-size: 1.2em;">¬øAceptas el desaf√≠o?</strong>
            </p>
        </div>

        <!-- ESTRUCTURA DEL DESAF√çO -->
        <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 40px; border-radius: 25px; margin: 40px 0; border: 4px solid #9c27b0; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.4);">
            <h3 style="color: #6a1b9a; font-size: 2.2em; text-align: center; margin-bottom: 35px; display: flex; align-items: center; justify-content: center; gap: 15px;">
                <span style="font-size: 1.5em;">‚öîÔ∏è</span>
                Estructura del Escape Room
                <span style="font-size: 1.5em;">üó°Ô∏è</span>
            </h3>

            <div style="display: grid; gap: 25px;">
                <!-- NIVELES 1 y 2 -->
                <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 30px; border-radius: 20px; border-left: 10px solid #4caf50; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                        <span style="background: #4caf50; color: white; font-size: 1.5em; font-weight: 900; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5);">1-2</span>
                        <h4 style="color: #2e7d32; font-size: 1.8em; margin: 0;">Niveles 1 y 2: Las Puertas del Castillo</h4>
                    </div>
                    <p style="color: #1b5e20; font-size: 1.2em; line-height: 1.8; padding-left: 80px;">
                        <strong>üìö Contenido:</strong> Operaciones b√°sicas con n√∫meros enteros<br>
                        <strong>üéØ Temas:</strong> Suma, resta, multiplicaci√≥n, divisi√≥n y ley de signos<br>
                        <strong>‚ö° Dificultad:</strong> B√°sico - Intermedio<br>
                        <strong>üìñ Basado en:</strong> Sesi√≥n 1 y parte de Sesi√≥n 2
                    </p>
                </div>

                <!-- NIVELES 3 y 4 -->
                <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 30px; border-radius: 20px; border-left: 10px solid #ff9800; box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                        <span style="background: #ff9800; color: white; font-size: 1.5em; font-weight: 900; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.5);">3-4</span>
                        <h4 style="color: #e65100; font-size: 1.8em; margin: 0;">Niveles 3 y 4: La Guarida del Drag√≥n</h4>
                    </div>
                    <p style="color: #bf360c; font-size: 1.2em; line-height: 1.8; padding-left: 80px;">
                        <strong>üìö Contenido:</strong> Jerarqu√≠a completa de operaciones<br>
                        <strong>üéØ Temas:</strong> Par√©ntesis, corchetes, llaves y operaciones combinadas<br>
                        <strong>‚ö° Dificultad:</strong> Avanzado - Experto<br>
                        <strong>üìñ Basado en:</strong> Sesi√≥n 2 (jerarqu√≠a) y Sesi√≥n 3 completa
                    </p>
                </div>
            </div>
        </div>

        <!-- RECOMPENSAS -->
        <div style="background: linear-gradient(135deg, #fff9c4, #fff59d); padding: 35px; border-radius: 25px; margin: 40px 0; border: 5px solid #fbc02d; box-shadow: 0 20px 50px rgba(251, 192, 45, 0.4); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; right: -30px; font-size: 12em; opacity: 0.1;">üèÜ</div>
            <h3 style="color: #f57f17; font-size: 2em; text-align: center; margin-bottom: 25px; position: relative; z-index: 1;">üéÅ Recompensas por Completar el Escape Room</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; position: relative; z-index: 1;">
                <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 3em; margin-bottom: 10px;">‚úÖ</div>
                    <p style="color: #6d4c41; font-size: 1.2em; font-weight: 600;">Dominio de<br>N√∫meros Enteros</p>
                </div>
                <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 3em; margin-bottom: 10px;">üîì</div>
                    <p style="color: #6d4c41; font-size: 1.2em; font-weight: 600;">Desbloqueo de<br>Sesi√≥n 4: Fracciones</p>
                </div>
                <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 3em; margin-bottom: 10px;">üèÖ</div>
                    <p style="color: #6d4c41; font-size: 1.2em; font-weight: 600;">Certificado de<br>Conquistador</p>
                </div>
            </div>
        </div>

        <!-- CONSEJOS ANTES DE EMPEZAR -->
        <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 35px; border-radius: 25px; margin: 40px 0; border: 4px solid #2196f3; box-shadow: 0 15px 40px rgba(33, 150, 243, 0.3);">
            <h3 style="color: #0d47a1; font-size: 2em; text-align: center; margin-bottom: 25px;">üí° Consejos Antes de Comenzar</h3>
            <div style="display: grid; gap: 15px;">
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">üìù</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">Ten papel y l√°piz a mano para resolver las operaciones</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">‚è∞</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">No hay l√≠mite de tiempo, trabaja con calma y precisi√≥n</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">üéØ</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">Lee bien cada pregunta antes de responder</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">üîÑ</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">Si te equivocas, puedes reintentar desde el nivel donde quedaste</p>
                </div>
            </div>
        </div>

        <!-- BOT√ìN √âPICO DE INICIO -->
        <div style="text-align: center; margin: 60px 0;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 50px; border-radius: 30px; display: inline-block; box-shadow: 0 25px 70px rgba(102, 126, 234, 0.6); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent); animation: shimmer 2s infinite;"></div>
                
                <p style="color: white; font-size: 1.5em; margin-bottom: 25px; font-weight: 600; text-shadow: 0 2px 10px rgba(0,0,0,0.3); position: relative; z-index: 1;">
                    ‚öîÔ∏è ¬øEst√°s listo para enfrentar al Drag√≥n Matem√°tico? ‚öîÔ∏è
                </p>
                
                <button onclick="launchEscapeRoom()" class="back-button" style="background: linear-gradient(135deg, #f093fb, #f5576c); font-size: 2em; padding: 30px 80px; border: 4px solid white; box-shadow: 0 15px 40px rgba(245, 87, 108, 0.6), 0 0 30px rgba(255,255,255,0.5) inset; position: relative; z-index: 1; transition: all 0.3s;">
                    üêâ ¬°INICIAR ESCAPE ROOM! üó°Ô∏è
                </button>
                
                <p style="color: rgba(255,255,255,0.9); font-size: 1.1em; margin-top: 20px; font-style: italic; position: relative; z-index: 1;">
                    Se abrir√° en una nueva pesta√±a
                </p>
            </div>
        </div>

        <style>
            @keyframes shimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }
        </style>
    </div>
</div>

<!-- ============================================== -->
    <!-- ========== SESI√ìN 4: FRACCIONES (I) ========== -->
    <!-- ============================================== -->
    
    <div class="screen" id="session4Screen">
        <div class="content-screen" style="position: relative; background: linear-gradient(180deg, rgba(255,215,0,0.05) 0%, rgba(255,140,0,0.08) 100%);">
            <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
            
            <!-- Decoraci√≥n flotante tem√°tica de pizza/fracciones -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; z-index: 0;">
                <span style="position: absolute; left: 5%; top: 15%; font-size: 3em; animation: floatMath 8s ease-in-out infinite; opacity: 0.25;">üçï</span>
                <span style="position: absolute; right: 8%; top: 20%; font-size: 2.5em; animation: floatMath 7s ease-in-out infinite; animation-delay: 1s; opacity: 0.25;">ü•ß</span>
                <span style="position: absolute; left: 10%; bottom: 30%; font-size: 2.8em; animation: floatMath 9s ease-in-out infinite; animation-delay: 2s; opacity: 0.25;">üç∞</span>
                <span style="position: absolute; right: 12%; bottom: 25%; font-size: 2.2em; animation: floatMath 6s ease-in-out infinite; animation-delay: 0.5s; opacity: 0.25;">üéÇ</span>
            </div>
            
            <div style="text-align: center; margin-top: 30px; position: relative; z-index: 1;">
                <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">üçï</div>
                <h2 class="session-title-gradient" style="background: linear-gradient(135deg, #FF6B35, #F7931E, #FFD700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 2.8em;">Sesi√≥n 4: Fracciones (I)</h2>
                <p style="font-size: 1.4em; color: #D35400; font-weight: 600; text-shadow: 0 2px 10px rgba(211, 84, 0, 0.3);">üéØ Simplificaci√≥n, Amplificaci√≥n y las 4 Operaciones</p>
            </div>

            <div class="content-grid-session1" style="position: relative; z-index: 1;">
                <div class="card-session objective-card" style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); border-left: 8px solid #FF9800;">
                    <h3 style="color: #E65100;">üéØ Objetivo de Sesi√≥n</h3>
                    <p style="color: #BF360C;">Dominar la simplificaci√≥n y amplificaci√≥n de fracciones usando el MCD, y realizar las cuatro operaciones fundamentales (suma, resta, multiplicaci√≥n y divisi√≥n) con fracciones, aplicando reglas de signos.</p>
                </div>
                <div class="card-session learning-card" style="background: linear-gradient(135deg, #FFF8E1, #FFECB3); border-left: 8px solid #FFC107;">
                    <h3 style="color: #FF8F00;">üó∫Ô∏è Ruta de Aprendizaje</h3>
                    <ul class="learning-list">
                        <li class="learning-list-item" onclick="showScreen('session4Theory1Screen')" style="background: linear-gradient(135deg, #FFCCBC, #FFAB91);"><span>üìö</span> Teor√≠a 1: Simplificaci√≥n y Amplificaci√≥n</li>
                        <li class="learning-list-item" onclick="showScreen('session4Theory2Screen')" style="background: linear-gradient(135deg, #FFE0B2, #FFCC80);"><span>üîÑ</span> Teor√≠a 2: Las 4 Operaciones con Fracciones</li>
                        <li class="learning-list-item" onclick="showScreen('session4GameClassScreen')" style="background: linear-gradient(135deg, #C8E6C9, #A5D6A7);"><span>üé≤</span> Juego en el Aula: Domin√≥ Fraccionario</li>
                        <li class="learning-list-item" onclick="showScreen('session4ActivityScreen')" style="background: linear-gradient(135deg, #B3E5FC, #81D4FA);"><span>üèÜ</span> Actividad Gamificada: Reto de las 4 Operaciones</li>
                        <li class="learning-list-item" onclick="showScreen('session4ArcadeScreen')" style="background: linear-gradient(135deg, #E1BEE7, #CE93D8);"><span>üêç</span> Juego Arcade: Culebrita Fraccionaria</li>
                    </ul>
                </div>
            </div>

<div class="session1-nav-grid" style="position: relative; z-index: 1;">
                <div class="session-nav-card session4-card" onclick="showScreen('session4Theory1Screen')" style="background: linear-gradient(135deg, #FF8A65, #FF7043); box-shadow: 0 10px 30px rgba(255, 112, 67, 0.4);">
                    <div class="session-nav-card-icon">üìö</div>
                    <h4>1. Simplificaci√≥n</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4Theory2Screen')" style="background: linear-gradient(135deg, #FFB74D, #FFA726); box-shadow: 0 10px 30px rgba(255, 167, 38, 0.4);">
                    <div class="session-nav-card-icon">üîÑ</div>
                    <h4>2. Las 4 Operaciones</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4GameClassScreen')" style="background: linear-gradient(135deg, #81C784, #66BB6A); box-shadow: 0 10px 30px rgba(102, 187, 106, 0.4);">
                    <div class="session-nav-card-icon">üé≤</div>
                    <h4>3. Torneo</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4ActivityScreen')" style="background: linear-gradient(135deg, #4FC3F7, #29B6F6); box-shadow: 0 10px 30px rgba(41, 182, 246, 0.4);">
                    <div class="session-nav-card-icon">üèÜ</div>
                    <h4>4. Actividad</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4ArcadeScreen')" style="background: linear-gradient(135deg, #BA68C8, #AB47BC); box-shadow: 0 10px 30px rgba(171, 71, 188, 0.4);">
                    <div class="session-nav-card-icon">üéÆ</div>
                    <h4>5. Culebrita üêç</h4>
                </div>
            </div>
        </div>
    </div>
    
<!-- ========== TEOR√çA 1: SIMPLIFICACI√ìN Y AMPLIFICACI√ìN ========== -->
<div class="screen" id="session4Theory1Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(255,152,0,0.05) 0%, rgba(255,87,34,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">üîç</div>
            <h2 style="color: #E65100; font-size: 2.2em; font-weight: 800;">Simplificaci√≥n y Amplificaci√≥n</h2>
            <p style="color: #BF360C; font-size: 1.15em;">Dos herramientas fundamentales para trabajar con fracciones</p>
        </div>

        <!-- SIMPLIFICACI√ìN -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.6em;">üìâ Simplificaci√≥n de Fracciones</h3>
            <p style="color: #4E342E; font-size: 1.05em; line-height: 1.8; margin: 15px 0;"><strong>Simplificar</strong> es dividir el numerador y el denominador por su <strong>M√°ximo Com√∫n Divisor (MCD)</strong> para obtener una fracci√≥n equivalente m√°s sencilla.</p>
            
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #FF9800; text-align: center;">
                <p style="font-size: 1.4em; color: #E65100; font-weight: 700;">Regla:</p>
                <p style="font-size: 1.8em; color: #1565C0; font-weight: 800; margin: 10px 0;">a/b √∑ MCD = a√∑MCD / b√∑MCD</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                <div style="background: rgba(255,255,255,0.8); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #E65100; font-weight: 700;">Ejemplo 1</p>
                    <p style="font-size: 1.5em; color: #1565C0; font-weight: 800;">12/18</p>
                    <p style="color: #4E342E;">MCD(12, 18) = <strong>6</strong></p>
                    <p style="color: #4E342E;">12√∑6 = 2 &nbsp;|&nbsp; 18√∑6 = 3</p>
                    <p style="font-size: 1.4em; color: #2E7D32; font-weight: 800;">= 2/3 ‚úÖ</p>
                </div>
                <div style="background: rgba(255,255,255,0.8); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #E65100; font-weight: 700;">Ejemplo 2</p>
                    <p style="font-size: 1.5em; color: #1565C0; font-weight: 800;">‚àí24/36</p>
                    <p style="color: #4E342E;">MCD(24, 36) = <strong>12</strong></p>
                    <p style="color: #4E342E;">‚àí24√∑12 = ‚àí2 &nbsp;|&nbsp; 36√∑12 = 3</p>
                    <p style="font-size: 1.4em; color: #2E7D32; font-weight: 800;">= ‚àí2/3 ‚úÖ</p>
                </div>
                <div style="background: rgba(255,255,255,0.8); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #E65100; font-weight: 700;">Ejemplo 3</p>
                    <p style="font-size: 1.5em; color: #1565C0; font-weight: 800;">45/60</p>
                    <p style="color: #4E342E;">MCD(45, 60) = <strong>15</strong></p>
                    <p style="color: #4E342E;">45√∑15 = 3 &nbsp;|&nbsp; 60√∑15 = 4</p>
                    <p style="font-size: 1.4em; color: #2E7D32; font-weight: 800;">= 3/4 ‚úÖ</p>
                </div>
            </div>

            <div style="background: rgba(233,30,99,0.1); padding: 15px; border-radius: 12px; margin-top: 20px; border-left: 4px solid #E91E63;">
                <p style="color: #880E4F; font-size: 1em;">‚ö†Ô∏è <strong>Importante:</strong> Una fracci√≥n est√° totalmente simplificada cuando el MCD del numerador y denominador es 1. El signo negativo se coloca siempre en el numerador.</p>
            </div>
        </div>

        <!-- AMPLIFICACI√ìN -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.6em;">üìà Amplificaci√≥n de Fracciones</h3>
            <p style="color: #263238; font-size: 1.05em; line-height: 1.8; margin: 15px 0;"><strong>Amplificar</strong> es multiplicar el numerador y el denominador por el <strong>mismo n√∫mero</strong> (distinto de cero). La fracci√≥n resultante es equivalente a la original.</p>
            
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #2196F3; text-align: center;">
                <p style="font-size: 1.4em; color: #1565C0; font-weight: 700;">Regla:</p>
                <p style="font-size: 1.8em; color: #E65100; font-weight: 800; margin: 10px 0;">a/b √ó k = (a√ók) / (b√ók)</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                <div style="background: rgba(255,255,255,0.8); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #1565C0; font-weight: 700;">Ejemplo 1</p>
                    <p style="color: #4E342E;">Amplificar <strong>2/3</strong> por <strong>5</strong></p>
                    <p style="color: #4E342E;">(2√ó5) / (3√ó5)</p>
                    <p style="font-size: 1.4em; color: #E65100; font-weight: 800;">= 10/15 ‚úÖ</p>
                </div>
                <div style="background: rgba(255,255,255,0.8); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #1565C0; font-weight: 700;">Ejemplo 2</p>
                    <p style="color: #4E342E;">Amplificar <strong>‚àí3/4</strong> por <strong>3</strong></p>
                    <p style="color: #4E342E;">(‚àí3√ó3) / (4√ó3)</p>
                    <p style="font-size: 1.4em; color: #E65100; font-weight: 800;">= ‚àí9/12 ‚úÖ</p>
                </div>
                <div style="background: rgba(255,255,255,0.8); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #1565C0; font-weight: 700;">¬øPara qu√© sirve?</p>
                    <p style="color: #4E342E; line-height: 1.7;">Se usa para encontrar <strong>denominadores comunes</strong> al sumar o restar fracciones con denominador diferente.</p>
                </div>
            </div>
        </div>

        <!-- MCD Y C√ìMO ENCONTRARLO -->
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #9C27B0;">
            <h3 style="color: #6A1B9A; font-size: 1.6em;">üî¢ ¬øC√≥mo encontrar el MCD?</h3>
            <p style="color: #4A148C; font-size: 1.05em; line-height: 1.8; margin: 15px 0;">El <strong>M√°ximo Com√∫n Divisor</strong> es el mayor n√∫mero que divide exactamente a ambos n√∫meros.</p>
            
            <div style="background: rgba(255,255,255,0.8); padding: 25px; border-radius: 15px; margin: 20px 0;">
                <p style="color: #6A1B9A; font-weight: 700; font-size: 1.2em; margin-bottom: 15px;">M√©todo: Descomposici√≥n en factores primos</p>
                <p style="color: #4A148C; line-height: 2; font-size: 1.05em;">
                    <strong>Ejemplo:</strong> MCD(24, 36)<br>
                    24 = 2¬≥ √ó 3¬π<br>
                    36 = 2¬≤ √ó 3¬≤<br>
                    MCD = 2¬≤ √ó 3¬π = 4 √ó 3 = <strong style="color: #E65100; font-size: 1.2em;">12</strong><br><br>
                    <strong>Ejemplo:</strong> MCD(15, 20)<br>
                    15 = 3 √ó 5<br>
                    20 = 2¬≤ √ó 5<br>
                    MCD = 5 (el √∫nico factor com√∫n es 5) ‚Üí <strong style="color: #E65100; font-size: 1.2em;">5</strong>
                </p>
            </div>

            <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #4CAF50;">
                <p style="color: #1B5E20; font-size: 1em;">üí° <strong>Atajo:</strong> Si un n√∫mero es divisible por el otro, el menor ES el MCD. Ejemplo: MCD(6, 18) = 6.</p>
            </div>
        </div>

        <!-- EJERCICIOS R√ÅPIDOS -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.5em;">‚úèÔ∏è Practica en tu Cuaderno</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700; font-size: 1.2em;">Simplifica: 16/24</p>
                    <p style="color: #888; font-size: 0.85em;">MCD(16,24) = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700; font-size: 1.2em;">Simplifica: ‚àí30/45</p>
                    <p style="color: #888; font-size: 0.85em;">¬°Cuidado con el signo!</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700; font-size: 1.2em;">Amplifica: 3/7 por 4</p>
                    <p style="color: #888; font-size: 0.85em;">(3√ó4)/(7√ó4) = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700; font-size: 1.2em;">Simplifica: 42/56</p>
                    <p style="color: #888; font-size: 0.85em;">MCD(42,56) = ?</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeSubActivity(4, 1); showScreen('session4Theory2Screen');" style="background: linear-gradient(135deg, #FF9800, #F57C00); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(255, 152, 0, 0.5);">
                Siguiente: Las 4 Operaciones ‚Üí
            </button>
        </div>
    </div>
</div>

<div class="screen" id="session4Theory2Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(255,193,7,0.05) 0%, rgba(255,152,0,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">‚ûï‚ûñ‚úñÔ∏è‚ûó</div>
            <h2 style="color: #E65100; font-size: 2.2em; font-weight: 800;">Las 4 Operaciones con Fracciones</h2>
            <p style="color: #BF360C; font-size: 1.15em;">Suma, Resta, Multiplicaci√≥n y Divisi√≥n</p>
        </div>

        <!-- SUMA Y RESTA -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.6em;">‚ûï‚ûñ Suma y Resta de Fracciones</h3>
            
            <!-- Mismo denominador -->
            <div style="background: white; padding: 22px; border-radius: 15px; margin: 18px 0; border: 2px solid #66BB6A;">
                <h4 style="color: #2E7D32; font-size: 1.2em;">üìó Mismo Denominador: Se suman/restan los numeradores</h4>
                <p style="font-size: 1.5em; color: #1565C0; font-weight: 800; text-align: center; margin: 12px 0;">a/c ¬± b/c = (a ¬± b) / c</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
                    <div style="background: #F1F8E9; padding: 12px; border-radius: 10px; text-align: center;">
                        <p style="color: #333;">3/7 + 2/7 = <strong style="color: #2E7D32;">5/7</strong></p>
                    </div>
                    <div style="background: #F1F8E9; padding: 12px; border-radius: 10px; text-align: center;">
                        <p style="color: #333;">5/8 ‚àí 3/8 = <strong style="color: #2E7D32;">2/8 = 1/4</strong></p>
                    </div>
                </div>
            </div>

            <!-- Distinto denominador -->
            <div style="background: white; padding: 22px; border-radius: 15px; margin: 18px 0; border: 2px solid #FF9800;">
                <h4 style="color: #E65100; font-size: 1.2em;">üìô Distinto Denominador: Buscar denominador com√∫n (MCM)</h4>
                <p style="font-size: 1.05em; color: #4E342E; line-height: 1.8; margin: 10px 0;">1) Encontrar el MCM de los denominadores. 2) Amplificar cada fracci√≥n. 3) Sumar/restar numeradores.</p>
                
                <div style="background: #FFF3E0; padding: 18px; border-radius: 12px; margin-top: 12px;">
                    <p style="color: #E65100; font-weight: 700; font-size: 1.1em;">Ejemplo: 2/3 + 1/4</p>
                    <p style="color: #4E342E; line-height: 2;">
                        MCM(3, 4) = 12<br>
                        2/3 = 8/12 &nbsp;(√ó4) &nbsp;&nbsp;|&nbsp;&nbsp; 1/4 = 3/12 &nbsp;(√ó3)<br>
                        8/12 + 3/12 = <strong style="color: #2E7D32; font-size: 1.2em;">11/12</strong>
                    </p>
                </div>

                <div style="background: #FFF3E0; padding: 18px; border-radius: 12px; margin-top: 12px;">
                    <p style="color: #E65100; font-weight: 700; font-size: 1.1em;">Ejemplo: 5/6 ‚àí 1/4</p>
                    <p style="color: #4E342E; line-height: 2;">
                        MCM(6, 4) = 12<br>
                        5/6 = 10/12 &nbsp;(√ó2) &nbsp;&nbsp;|&nbsp;&nbsp; 1/4 = 3/12 &nbsp;(√ó3)<br>
                        10/12 ‚àí 3/12 = <strong style="color: #2E7D32; font-size: 1.2em;">7/12</strong>
                    </p>
                </div>
            </div>

            <div style="background: rgba(244,67,54,0.08); padding: 15px; border-radius: 12px; border-left: 4px solid #F44336; margin-top: 15px;">
                <p style="color: #B71C1C;">‚ö†Ô∏è <strong>Con signos negativos:</strong> ‚àí2/5 + 3/5 = (‚àí2+3)/5 = 1/5 &nbsp;&nbsp;|&nbsp;&nbsp; ‚àí1/3 ‚àí 2/3 = (‚àí1‚àí2)/3 = ‚àí3/3 = ‚àí1</p>
            </div>
        </div>

        <!-- MULTIPLICACI√ìN -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.6em;">‚úñÔ∏è Multiplicaci√≥n de Fracciones</h3>
            
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 3px solid #2196F3; text-align: center;">
                <p style="font-size: 1.3em; color: #1565C0; font-weight: 700;">Se multiplica numerador √ó numerador y denominador √ó denominador</p>
                <p style="font-size: 1.8em; color: #E65100; font-weight: 800; margin: 12px 0;">a/b √ó c/d = (a√óc) / (b√ód)</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px;">
                <div style="background: rgba(255,255,255,0.85); padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #1565C0; font-weight: 700;">Ejemplo 1</p>
                    <p style="color: #333;">2/3 √ó 4/5 = 8/15</p>
                </div>
                <div style="background: rgba(255,255,255,0.85); padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #1565C0; font-weight: 700;">Ejemplo 2</p>
                    <p style="color: #333;">(‚àí3/4) √ó (2/7) = ‚àí6/28 = ‚àí3/14</p>
                </div>
                <div style="background: rgba(255,255,255,0.85); padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #1565C0; font-weight: 700;">Ejemplo 3</p>
                    <p style="color: #333;">(‚àí1/2) √ó (‚àí3/5) = 3/10</p>
                    <p style="color: #888; font-size: 0.85em;">(‚àí)(‚àí) = (+)</p>
                </div>
            </div>

            <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #4CAF50; margin-top: 15px;">
                <p style="color: #1B5E20;">üí° <strong>Tip:</strong> Antes de multiplicar, puedes simplificar cruzado (numerador de una con denominador de la otra) para hacer m√°s f√°cil el c√°lculo.</p>
            </div>
        </div>

        <!-- DIVISI√ìN -->
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #9C27B0;">
            <h3 style="color: #6A1B9A; font-size: 1.6em;">‚ûó Divisi√≥n de Fracciones</h3>
            
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 3px solid #9C27B0; text-align: center;">
                <p style="font-size: 1.3em; color: #6A1B9A; font-weight: 700;">Se multiplica por el rec√≠proco (invertir la segunda fracci√≥n)</p>
                <p style="font-size: 1.8em; color: #E65100; font-weight: 800; margin: 12px 0;">a/b √∑ c/d = a/b √ó d/c</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                <div style="background: rgba(255,255,255,0.85); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #6A1B9A; font-weight: 700;">Ejemplo 1</p>
                    <p style="color: #333; line-height: 1.8;">3/4 √∑ 2/5<br>= 3/4 √ó 5/2<br>= <strong style="color: #2E7D32;">15/8</strong></p>
                </div>
                <div style="background: rgba(255,255,255,0.85); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #6A1B9A; font-weight: 700;">Ejemplo 2</p>
                    <p style="color: #333; line-height: 1.8;">(‚àí5/6) √∑ (1/3)<br>= (‚àí5/6) √ó (3/1)<br>= <strong style="color: #2E7D32;">‚àí15/6 = ‚àí5/2</strong></p>
                </div>
                <div style="background: rgba(255,255,255,0.85); padding: 18px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 1.1em; color: #6A1B9A; font-weight: 700;">Ejemplo 3</p>
                    <p style="color: #333; line-height: 1.8;">(‚àí2/3) √∑ (‚àí4/9)<br>= (‚àí2/3) √ó (‚àí9/4)<br>= <strong style="color: #2E7D32;">18/12 = 3/2</strong></p>
                </div>
            </div>
        </div>

        <!-- RESUMEN DE SIGNOS -->
        <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 25px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #F44336;">
            <h3 style="color: #C62828; font-size: 1.4em;">üî¥üü¢ Regla de Signos (Multiplicaci√≥n y Divisi√≥n)</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
                <div style="background: rgba(76,175,80,0.15); padding: 12px; border-radius: 10px; text-align: center;">
                    <p style="color: #2E7D32; font-weight: 700; font-size: 1.1em;">(+) √ó (+) = <strong>+</strong></p>
                    <p style="color: #2E7D32; font-weight: 700; font-size: 1.1em;">(‚àí) √ó (‚àí) = <strong>+</strong></p>
                </div>
                <div style="background: rgba(244,67,54,0.15); padding: 12px; border-radius: 10px; text-align: center;">
                    <p style="color: #C62828; font-weight: 700; font-size: 1.1em;">(+) √ó (‚àí) = <strong>‚àí</strong></p>
                    <p style="color: #C62828; font-weight: 700; font-size: 1.1em;">(‚àí) √ó (+) = <strong>‚àí</strong></p>
                </div>
            </div>
            <p style="color: #880E4F; margin-top: 10px; text-align: center; font-weight: 600;">Signos iguales ‚Üí Positivo &nbsp;&nbsp;|&nbsp;&nbsp; Signos diferentes ‚Üí Negativo</p>
        </div>

        <!-- PRACTICA -->
        <div style="background: linear-gradient(135deg, #FFF8E1, #FFECB3); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FFC107;">
            <h3 style="color: #FF8F00; font-size: 1.5em;">‚úèÔ∏è Practica en tu Cuaderno</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">1) 2/5 + 3/10 = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">2) 7/8 ‚àí 1/3 = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">3) (‚àí3/4) √ó (8/9) = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">4) (5/6) √∑ (‚àí2/3) = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">5) ‚àí1/2 + 3/4 ‚àí 1/8 = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">6) (‚àí2/5) √∑ (‚àí4/15) = ?</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeSubActivity(4, 2); showScreen('session4GameClassScreen');" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(156, 39, 176, 0.5);">
                Siguiente: Juego en el Aula ‚Üí
            </button>
        </div>
    </div>
</div>

<div class="screen" id="session4GameClassScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(76,175,80,0.05) 0%, rgba(129,199,132,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">üé≤</div>
            <h2 style="color: #2E7D32; font-size: 2.2em; font-weight: 800;">Domin√≥ Fraccionario</h2>
            <p style="color: #1B5E20; font-size: 1.15em;">Juego grupal para practicar las 4 operaciones</p>
        </div>

        <!-- TAREA PREVIA -->
        <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #F44336;">
            <h3 style="color: #C62828; font-size: 1.5em;">üì¢ TAREA PARA LA CLASE ANTERIOR</h3>
            <p style="color: #B71C1C; font-size: 1.05em; line-height: 1.8; margin: 12px 0;">Cada grupo debe traer sus fichas ya hechas. El profesor asigna los grupos y cada integrante construye sus fichas en casa.</p>
            <div style="background: white; padding: 20px; border-radius: 15px; margin-top: 15px;">
                <p style="color: #333; line-height: 1.8;"><strong style="color: #C62828;">üìã Materiales por persona:</strong> 5 rect√°ngulos de cartulina (10cm √ó 5cm), marcador negro, regla y l√°piz. Cada rect√°ngulo se divide con una l√≠nea por la mitad.</p>
            </div>
        </div>

        <!-- ORGANIZACI√ìN POR GRUPO -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.5em;">üë• Organizaci√≥n: Grupos de 4 ‚Äî Total 20 fichas por grupo</h3>
            <p style="color: #1B5E20; font-size: 1.05em; margin: 12px 0;">Cada integrante fabrica <strong>5 fichas</strong>. Las fichas forman una cadena donde cada resultado conecta con una operaci√≥n.</p>
            
            <!-- ESTUDIANTE 1 -->
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 15px 0; border-left: 5px solid #2196F3;">
                <p style="font-size: 1.15em; color: #1565C0; font-weight: 800;">üë§ Estudiante 1 ‚Äî Fichas de SIMPLIFICACI√ìN (5 fichas)</p>
                <p style="color: #555; margin: 8px 0 12px;">Tema: Simplificaci√≥n y amplificaci√≥n de fracciones</p>
                <div style="display: grid; gap: 8px;">
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #2196F3; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #2196F3; background: #E3F2FD;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>Simplifica 12/18</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">3/4</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #2196F3; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #2196F3; background: #E3F2FD;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>Simplifica 20/30</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">5/6</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #2196F3; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #2196F3; background: #E3F2FD;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>Simplifica ‚àí24/36</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">1/2</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #2196F3; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #2196F3; background: #E3F2FD;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>Simplifica 45/60</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">‚àí2/3</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #2196F3; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #2196F3; background: #E3F2FD;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>Amplifica 2/3 por 4</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">11/12</strong></div>
                    </div>
                </div>
            </div>

            <!-- ESTUDIANTE 2 -->
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 15px 0; border-left: 5px solid #4CAF50;">
                <p style="font-size: 1.15em; color: #2E7D32; font-weight: 800;">üë§ Estudiante 2 ‚Äî Fichas de SUMA Y RESTA (5 fichas)</p>
                <p style="color: #555; margin: 8px 0 12px;">Tema: Sumas y restas con mismo y distinto denominador</p>
                <div style="display: grid; gap: 8px;">
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #4CAF50; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #4CAF50; background: #E8F5E9;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>3/4 + 1/6</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">2/3</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #4CAF50; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #4CAF50; background: #E8F5E9;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>5/8 ‚àí 1/4</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">8/12</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #4CAF50; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #4CAF50; background: #E8F5E9;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>‚àí2/3 + 5/6</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">3/8</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #4CAF50; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #4CAF50; background: #E8F5E9;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>1/2 + 1/3</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">1/6</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #4CAF50; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #4CAF50; background: #E8F5E9;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>‚àí1/2 ‚àí 1/3</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">‚àí3/8</strong></div>
                    </div>
                </div>
            </div>

            <!-- ESTUDIANTE 3 -->
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 15px 0; border-left: 5px solid #FF9800;">
                <p style="font-size: 1.15em; color: #E65100; font-weight: 800;">üë§ Estudiante 3 ‚Äî Fichas de MULTIPLICACI√ìN (5 fichas)</p>
                <p style="color: #555; margin: 8px 0 12px;">Tema: Multiplicaci√≥n de fracciones con regla de signos</p>
                <div style="display: grid; gap: 8px;">
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #FF9800; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #FF9800; background: #FFF3E0;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>2/3 √ó 3/4</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">‚àí5/6</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #FF9800; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #FF9800; background: #FFF3E0;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>(‚àí3/5) √ó (5/9)</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">6/5</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #FF9800; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #FF9800; background: #FFF3E0;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>(‚àí2/7) √ó (‚àí7/4)</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">‚àí1/3</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #FF9800; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #FF9800; background: #FFF3E0;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>4/5 √ó (‚àí5/8)</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">7/10</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #FF9800; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #FF9800; background: #FFF3E0;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>1/3 √ó 3/5</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">1/5</strong></div>
                    </div>
                </div>
            </div>

            <!-- ESTUDIANTE 4 -->
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 15px 0; border-left: 5px solid #9C27B0;">
                <p style="font-size: 1.15em; color: #6A1B9A; font-weight: 800;">üë§ Estudiante 4 ‚Äî Fichas de DIVISI√ìN (5 fichas)</p>
                <p style="color: #555; margin: 8px 0 12px;">Tema: Divisi√≥n de fracciones (multiplicar por rec√≠proco)</p>
                <div style="display: grid; gap: 8px;">
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #9C27B0; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #9C27B0; background: #F3E5F5;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>4/5 √∑ 2/3</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">1/2</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #9C27B0; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #9C27B0; background: #F3E5F5;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>3/4 √∑ 1/2</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">‚àí1/2</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #9C27B0; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #9C27B0; background: #F3E5F5;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>(‚àí5/6) √∑ (1/3)</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">3/2</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #9C27B0; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #9C27B0; background: #F3E5F5;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>(‚àí2/3) √∑ (‚àí4/9)</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">‚àí5/2</strong></div>
                    </div>
                    <div style="display: flex; background: #F5F5F5; border-radius: 10px; border: 2px solid #9C27B0; overflow: hidden;">
                        <div style="flex:1; padding: 10px; text-align: center; border-right: 2px dashed #9C27B0; background: #F3E5F5;"><span style="color: #888; font-size: 0.75em;">OPERACI√ìN</span><br><strong>5/8 √∑ 5/4</strong></div>
                        <div style="flex:1; padding: 10px; text-align: center;"><span style="color: #888; font-size: 0.75em;">RESULTADO</span><br><strong style="color: #2E7D32;">3/4</strong></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- C√ìMO CONECTAN LAS FICHAS -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.5em;">üîó ¬øC√≥mo Conectan las Fichas?</h3>
            <div style="background: white; padding: 22px; border-radius: 15px; margin-top: 15px;">
                <p style="color: #333; line-height: 2; font-size: 1.05em;">Cada ficha tiene un <strong>RESULTADO</strong> en un lado que es la respuesta a una <strong>OPERACI√ìN</strong> de otra ficha. Al jugar, se forma una cadena:</p>
                <div style="background: #F5F5F5; padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center; overflow-x: auto;">
                    <p style="font-size: 0.95em; color: #1565C0; font-weight: 600; white-space: nowrap;">
                        [Simplifica 12/18 | <span style="color:#2E7D32">3/4</span>] ‚Üî [4/5 √∑ 2/3 | <span style="color:#2E7D32">1/2</span>] ‚Üî [2/3 √ó 3/4 | <span style="color:#2E7D32">‚àí5/6</span>] ‚Üî [‚àí1/2 ‚àí 1/3 | <span style="color:#2E7D32">...</span>]
                    </p>
                </div>
                <p style="color: #333; line-height: 2;">El resultado <strong style="color:#2E7D32;">3/4</strong> de la ficha 1 conecta con la operaci√≥n <strong>"4/5 √∑ 2/3"</strong> (cuya respuesta es... ¬°no! se busca que el resultado coincida). Es decir: el lado RESULTADO de tu ficha debe coincidir resolviendo la OPERACI√ìN de la ficha vecina.</p>
            </div>
        </div>

        <!-- REGLAS DEL JUEGO -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.5em;">üéØ Reglas del Juego</h3>
            <div style="background: white; padding: 22px; border-radius: 15px; margin-top: 15px;">
                <div style="line-height: 2.2; color: #333; font-size: 1.05em;">
                    <p><strong style="color: #1565C0;">1.</strong> Se mezclan TODAS las 20 fichas del grupo y se reparten 5 a cada integrante.</p>
                    <p><strong style="color: #1565C0;">2.</strong> El que tenga la ficha "Simplifica 12/18 | 3/4" inicia coloc√°ndola en la mesa.</p>
                    <p><strong style="color: #1565C0;">3.</strong> El siguiente busca en sus fichas: una cuyo RESULTADO coincida con resolver "Simplifica 12/18" (= 2/3), O una cuya OPERACI√ìN d√© como resultado 3/4.</p>
                    <p><strong style="color: #1565C0;">4.</strong> Antes de colocarla, debe <strong>explicar en voz alta</strong> la operaci√≥n y demostrar que coincide.</p>
                    <p><strong style="color: #1565C0;">5.</strong> Si alguien del grupo detecta un error ‚Üí se retira la ficha y pierde turno.</p>
                    <p><strong style="color: #1565C0;">6.</strong> Si no tiene ficha que conecte ‚Üí pasa turno.</p>
                    <p><strong style="color: #E65100;">üèÜ Gana</strong> el primero que se quede sin fichas. Si nadie puede jugar, gana el que tenga menos fichas.</p>
                </div>
            </div>
        </div>

        <!-- R√öBRICA -->
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #9C27B0;">
            <h3 style="color: #6A1B9A; font-size: 1.5em;">üìä Evaluaci√≥n</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 2em;">‚≠ê‚≠ê‚≠ê</p>
                    <p style="color: #6A1B9A; font-weight: 700;">Experto</p>
                    <p style="color: #333; font-size: 0.9em;">Trajo fichas correctas, coloca todas y explica cada paso.</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 2em;">‚≠ê‚≠ê</p>
                    <p style="color: #FF8F00; font-weight: 700;">Avanzado</p>
                    <p style="color: #333; font-size: 0.9em;">Trajo fichas, coloca la mayor√≠a con errores menores.</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 2em;">‚≠ê</p>
                    <p style="color: #F44336; font-weight: 700;">En Proceso</p>
                    <p style="color: #333; font-size: 0.9em;">No trajo fichas o necesita ayuda constante.</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeSubActivity(4, 3); showScreen('session4ActivityScreen');" style="background: linear-gradient(135deg, #4CAF50, #388E3C); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);">
                Siguiente: Actividad Gamificada ‚Üí
            </button>
        </div>
    </div>
</div>

<div class="screen" id="session4ActivityScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(33,150,243,0.05) 0%, rgba(3,169,244,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">üèÜ</div>
            <h2 style="color: #1565C0; font-size: 2.2em; font-weight: 800;">Reto de las 4 Operaciones</h2>
            <p style="color: #1976D2; font-size: 1.15em;">28 ejercicios ‚Äî 7 por nivel. ¬°Demuestra tu dominio!</p>
        </div>
        <div style="background: rgba(33,150,243,0.1); padding: 20px; border-radius: 20px; margin: 20px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span style="color: #1565C0; font-weight: 700;">üìä Progreso</span>
                <span style="color: #1976D2; font-weight: 600;" id="s4ProgressText">0/28</span>
            </div>
            <div style="height: 16px; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden;">
                <div id="session4ProgressFill" style="background: linear-gradient(90deg, #4CAF50, #8BC34A); height: 100%; width: 0%; transition: width 0.8s; border-radius: 10px;"></div>
            </div>
        </div>
        <div style="background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">

            <!-- NIVEL 1: SIMPLIFICACI√ìN Y AMPLIFICACI√ìN -->
            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 18px; border-radius: 15px; margin-bottom: 20px; border-left: 6px solid #4CAF50;">
                <h3 style="color: #2E7D32;">üü¢ Nivel 1: Simplificaci√≥n y Amplificaci√≥n</h3>
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">1. Simplifica 18/24:</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/4" placeholder="ej: 3/4" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">2. Simplifica ‚àí30/45:</p>
                <input type="text" class="quiz-input session4-input" data-correct="-2/3" placeholder="ej: -2/3" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">3. Simplifica 42/56:</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/4" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">4. Simplifica 36/48:</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/4" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">5. Amplifica 2/5 por 4:</p>
                <input type="text" class="quiz-input session4-input" data-correct="8/20" placeholder="ej: 8/20" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">6. Amplifica ‚àí3/7 por 3:</p>
                <input type="text" class="quiz-input session4-input" data-correct="-9/21" placeholder="Fracci√≥n amplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #4CAF50;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">7. Simplifica 14/21:</p>
                <input type="text" class="quiz-input session4-input" data-correct="2/3" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #4CAF50;border-radius:10px;" />
            </div>

            <!-- NIVEL 2: SUMA Y RESTA -->
            <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 18px; border-radius: 15px; margin: 20px 0; border-left: 6px solid #2196F3;">
                <h3 style="color: #1565C0;">üîµ Nivel 2: Suma y Resta</h3>
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">8. 3/4 + 1/6 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="11/12" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">9. 5/8 ‚àí 1/4 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/8" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">10. ‚àí2/3 + 5/6 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="1/6" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">11. 1/2 + 1/3 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="5/6" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">12. ‚àí1/2 ‚àí 1/3 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="-5/6" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">13. 7/10 ‚àí 2/5 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/10" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #2196F3;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">14. 2/9 + 1/3 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="5/9" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #2196F3;border-radius:10px;" />
            </div>

            <!-- NIVEL 3: MULTIPLICACI√ìN Y DIVISI√ìN -->
            <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 18px; border-radius: 15px; margin: 20px 0; border-left: 6px solid #9C27B0;">
                <h3 style="color: #6A1B9A;">üü£ Nivel 3: Multiplicaci√≥n y Divisi√≥n</h3>
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">15. 2/3 √ó 3/4 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="1/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">16. (‚àí3/5) √ó (5/9) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="-1/3" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">17. 4/5 √∑ 2/3 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="6/5" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">18. (‚àí2/7) √ó (‚àí7/4) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="1/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">19. 3/4 √∑ 1/2 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">20. (‚àí5/6) √∑ (1/3) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="-5/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #9C27B0;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">21. 1/3 √ó (‚àí6/5) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="-2/5" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #9C27B0;border-radius:10px;" />
            </div>

            <!-- NIVEL 4: DESAF√çO MIXTO -->
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 18px; border-radius: 15px; margin: 20px 0; border-left: 6px solid #F44336;">
                <h3 style="color: #C62828;">üî¥ Nivel 4: Desaf√≠o Mixto</h3>
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">22. (‚àí7/8) √∑ (‚àí1/4) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="7/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">23. Simplifica 48/64:</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/4" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">24. 1/2 + 1/3 ‚àí 1/6 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="2/3" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">25. (‚àí2/3) √∑ (‚àí4/9) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="3/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">26. 3/4 √ó (‚àí2/3) =</p>
                <input type="text" class="quiz-input session4-input" data-correct="-1/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">27. ‚àí3/5 + 7/10 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="1/10" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>
            <div class="quiz-question" style="padding:12px;margin-bottom:12px;background:#FAFAFA;border-radius:12px;border-left:4px solid #F44336;">
                <p style="font-weight:600;color:#333;margin-bottom:8px;">28. 5/8 √∑ 5/4 =</p>
                <input type="text" class="quiz-input session4-input" data-correct="1/2" placeholder="Fracci√≥n simplificada" style="width:100%;max-width:280px;padding:10px;font-size:1.05em;border:2px solid #F44336;border-radius:10px;" />
            </div>

            <div style="text-align: center; margin-top: 25px;">
                <button onclick="checkSession4Quiz()" style="background: linear-gradient(135deg, #4CAF50, #388E3C); color: white; border: none; padding: 18px 50px; font-size: 1.3em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 8px 25px rgba(76,175,80,0.4);">‚úÖ Verificar Respuestas</button>
            </div>
            <div id="s4QuizResult" style="display: none; margin-top: 20px; padding: 25px; border-radius: 15px; text-align: center;"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeSubActivity(4, 4); showScreen('session4ArcadeScreen');" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(156,39,176,0.5);">
                Siguiente: Arcade Culebrita üêç ‚Üí
            </button>
        </div>
    </div>
</div>

<div class="screen" id="session6PracticeScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(156,39,176,0.08) 0%, rgba(123,31,162,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session6Screen')"> ‚Üê Volver a Sesi√≥n 6 </button>
        
        <div style="text-align: center; margin-bottom: 40px;">
            <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">‚úèÔ∏è</div>
            <h2 style="color: #4A148C; font-size: 2.5em;">Pr√°ctica Mixta de Fracciones</h2>
            <p style="font-size: 1.3em; color: #6A1B9A; font-weight: 500;">¬°Demuestra todo lo que has aprendido!</p>
        </div>

        <p style="font-size: 1.2em; line-height: 1.8; margin-bottom: 30px; color: #555;">
            Resuelve los siguientes <strong>7 ejercicios</strong>: 3 de multiplicaci√≥n/divisi√≥n y 4 de jerarqu√≠a de operaciones. 
            Recuerda simplificar tus respuestas y aplicar correctamente el orden PEMDSR.
        </p>

        <!-- SECCI√ìN 1: MULTIPLICACI√ìN Y DIVISI√ìN (3 EJERCICIOS) -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 20px; margin: 25px 0; border: 4px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.8em; text-align: center; margin-bottom: 25px;">‚úñÔ∏è‚ûó Parte 1: Multiplicaci√≥n y Divisi√≥n (3 ejercicios)</h3>
            
            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="s6p1">1. <sup>2</sup>/<sub>5</sub> √ó <sup>5</sup>/<sub>8</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p1" class="quiz-input" data-correct="1/4" placeholder="Ejemplo: 3/4" />
                </div>
                <div class="quiz-item">
                    <label for="s6p2">2. <sup>7</sup>/<sub>9</sub> √∑ <sup>14</sup>/<sub>3</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p2" class="quiz-input" data-correct="1/6" placeholder="Ejemplo: 2/3" />
                </div>
                <div class="quiz-item">
                    <label for="s6p3">3. <sup>‚àí3</sup>/<sub>4</sub> √ó <sup>2</sup>/<sub>9</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p3" class="quiz-input" data-correct="-1/6" placeholder="Ejemplo: -1/2" />
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 2: JERARQU√çA DE OPERACIONES (4 EJERCICIOS) -->
        <div style="background: linear-gradient(135deg, #FCE4EC, #F8BBD0); padding: 30px; border-radius: 20px; margin: 25px 0; border: 4px solid #E91E63;">
            <h3 style="color: #880E4F; font-size: 1.8em; text-align: center; margin-bottom: 25px;">üß† Parte 2: Jerarqu√≠a de Operaciones (4 ejercicios)</h3>
            
            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="s6p4">4. <sup>1</sup>/<sub>3</sub> + <sup>1</sup>/<sub>2</sub> √ó <sup>2</sup>/<sub>5</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p4" class="quiz-input" data-correct="8/15" placeholder="Ejemplo: 5/6" />
                </div>
                <div class="quiz-item">
                    <label for="s6p5">5. (<sup>2</sup>/<sub>3</sub> ‚àí <sup>1</sup>/<sub>6</sub>) √ó <sup>3</sup>/<sub>4</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p5" class="quiz-input" data-correct="3/8" placeholder="Ejemplo: 1/4" />
                </div>
                <div class="quiz-item">
                    <label for="s6p6">6. <sup>5</sup>/<sub>6</sub> √∑ <sup>1</sup>/<sub>3</sub> + <sup>1</sup>/<sub>2</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p6" class="quiz-input" data-correct="3" placeholder="Ejemplo: 2" />
                </div>
                <div class="quiz-item">
                    <label for="s6p7">7. <sup>1</sup>/<sub>2</sub> + (<sup>1</sup>/<sub>4</sub> √ó <sup>2</sup>/<sub>3</sub>) ‚àí <sup>1</sup>/<sub>6</sub> = ? (Simplifica)</label>
                    <input type="text" id="s6p7" class="quiz-input" data-correct="1/2" placeholder="Ejemplo: 7/12" />
                </div>
            </div>
        </div>

        <button class="submit-quiz-button back-button" onclick="submitS6Practice()" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); margin-top: 30px;">
            Comprobar Resultados
        </button>
        
        <div id="s6PracticeResults" class="quiz-results" style="display: none; border-color: #9C27B0; box-shadow: 0 10px 30px rgba(156, 39, 176, 0.4);">
            <h3>Resultados de la Pr√°ctica:</h3>
            <p>Puntuaci√≥n: <span id="s6PracticeScore">0/7</span></p>
            <ul class="result-list" id="s6PracticeResultList"></ul>
        </div>
        
        <div id="completeS6PracticeButton" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
            <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(102, 187, 106, 0.2)); padding: 30px; border-radius: 25px; border: 3px solid #4CAF50; box-shadow: 0 0 30px rgba(76, 175, 80, 0.5);">
                <h3 style="color: #1B5E20; font-size: 2em; margin-bottom: 20px;">üéâ ¬°Pr√°ctica Completada!</h3>
                <p style="font-size: 1.2em; color: #2E7D32; margin-bottom: 25px;">
                    Excelente trabajo. Ahora est√°s listo para el desaf√≠o final.
                </p>
                <button onclick="completeS6Practice()" style="padding: 25px 60px; font-size: 1.5em; background: linear-gradient(135deg, #F44336, #D32F2F); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 700; box-shadow: 0 15px 40px rgba(244, 67, 54, 0.4);">
                    ‚öîÔ∏è Ir a la Batalla Final
                </button>
            </div>
        </div>
    </div>
</div>
<!-- ========== JUEGO FINAL: REINO DE NUMERUS ========== -->
<div class="screen" id="session6GameScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(244,67,54,0.08) 0%, rgba(211,47,47,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session6Screen')"> ‚Üê Volver a Sesi√≥n 6 </button>
        
        <div style="text-align: center; margin-bottom: 40px;">
            <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">‚öîÔ∏è</div>
            <h2 style="color: #B71C1C; font-size: 2.5em;">La Batalla Final: Reino de Numerus</h2>
            <p style="font-size: 1.3em; color: #D32F2F; font-weight: 500;">¬°El desaf√≠o m√°s grande te espera!</p>
        </div>

        <!-- HISTORIA √âPICA -->
        <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 40px; border-radius: 25px; margin: 25px 0; border: 4px solid #F44336; box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 4em; margin-bottom: 15px;">üè∞</div>
                <h3 style="color: #B71C1C; font-size: 2em; margin-bottom: 20px;">La Leyenda del Rey Numerus</h3>
            </div>
            
            <p style="font-size: 1.2em; color: #C62828; line-height: 2; margin-bottom: 20px;">
                Hace mucho tiempo, en un reino lejano llamado <strong style="color: #D32F2F;">Mathem√°tica</strong>, viv√≠a un poderoso rey llamado 
                <strong style="color: #B71C1C;">Numerus el Calculador</strong>. Este rey ten√≠a un don √∫nico: pod√≠a manipular los n√∫meros a su antojo, 
                creando desaf√≠os matem√°ticos imposibles que nadie pod√≠a resolver.
            </p>
            
            <p style="font-size: 1.2em; color: #C62828; line-height: 2; margin-bottom: 20px;">
                Con el tiempo, Numerus se volvi√≥ arrogante y comenz√≥ a <strong>robar el conocimiento matem√°tico</strong> de todos los estudiantes 
                del reino, encerr√°ndolo en su <strong style="color: #D32F2F;">Torre de las Fracciones Imposibles</strong>. 
                Los habitantes del reino perdieron su habilidad para resolver problemas, y la oscuridad matem√°tica se apoder√≥ de la tierra.
            </p>
            
            <p style="font-size: 1.2em; color: #C62828; line-height: 2; margin-bottom: 20px;">
                Pero una antigua profec√≠a dec√≠a: <em style="color: #880E4F; font-size: 1.1em;">"Solo aquel que domine las cuatro operaciones con fracciones 
                y comprenda la jerarqu√≠a completa podr√° derrotar a Numerus y devolver el conocimiento al reino."</em>
            </p>
            
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 25px 0; border-left: 6px solid #F44336;">
                <p style="font-size: 1.3em; color: #B71C1C; line-height: 2; font-weight: 600; text-align: center;">
                    üéì Has completado tu entrenamiento.<br>
                    ‚öîÔ∏è Has dominado las fracciones.<br>
                    üß† Has conquistado la jerarqu√≠a de operaciones.<br><br>
                    <strong style="font-size: 1.2em; color: #D32F2F;">¬°ERES EL ELEGIDO PARA SALVAR EL REINO!</strong>
                </p>
            </div>
        </div>

        <!-- LO QUE ENCONTRAR√ÅS -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 35px; border-radius: 25px; margin: 25px 0; border: 4px solid #2196F3;">
            <h3 style="color: #0D47A1; font-size: 1.8em; text-align: center; margin-bottom: 25px;">üéÆ ¬øQu√© encontrar√°s en el juego?</h3>
            
            <div style="display: grid; gap: 15px;">
                <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #1976D2;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2.5em;">üó∫Ô∏è</div>
                        <div>
                            <h4 style="color: #1565C0; font-size: 1.3em; margin-bottom: 8px;">Niveles Progresivos</h4>
                            <p style="color: #1976D2; font-size: 1.05em;">Avanza por diferentes reinos, cada uno m√°s desafiante que el anterior. Desde el Valle de las Sumas hasta la Fortaleza de Numerus.</p>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #9C27B0;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2.5em;">üß©</div>
                        <div>
                            <h4 style="color: #6A1B9A; font-size: 1.3em; margin-bottom: 8px;">Desaf√≠os de Fracciones</h4>
                            <p style="color: #7B1FA2; font-size: 1.05em;">Resuelve problemas de multiplicaci√≥n, divisi√≥n, jerarqu√≠a y operaciones combinadas para avanzar y desbloquear nuevas √°reas.</p>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #FF9800;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2.5em;">üëë</div>
                        <div>
                            <h4 style="color: #E65100; font-size: 1.3em; margin-bottom: 8px;">Batalla contra Numerus</h4>
                            <p style="color: #F57C00; font-size: 1.05em;">En el nivel final, enfr√©ntate cara a cara con el Rey Numerus. Solo los m√°s h√°biles lograr√°n derrotarlo y restaurar el conocimiento.</p>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #4CAF50;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2.5em;">üèÜ</div>
                        <div>
                            <h4 style="color: #2E7D32; font-size: 1.3em; margin-bottom: 8px;">Recompensas y Logros</h4>
                            <p style="color: #388E3C; font-size: 1.05em;">Gana medallas, desbloquea t√≠tulos especiales y convi√©rtete en el Gran Maestro de las Fracciones al completar todos los desaf√≠os.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONSEJOS PARA LA BATALLA -->
        <div style="background: linear-gradient(135deg, #FFF9C4, #FFF59D); padding: 30px; border-radius: 20px; margin: 25px 0; border: 4px solid #FDD835;">
            <h3 style="color: #F57F17; font-size: 1.6em; text-align: center; margin-bottom: 20px;">üí° Consejos del Sabio Matem√°tico</h3>
            <div style="background: white; padding: 25px; border-radius: 15px;">
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="padding: 12px 0; font-size: 1.15em; color: #F57F17; border-bottom: 1px solid #FFF9C4;">
                        ‚úÖ <strong>Simplifica siempre:</strong> Las fracciones simplificadas son m√°s f√°ciles de trabajar
                    </li>
                    <li style="padding: 12px 0; font-size: 1.15em; color: #F57F17; border-bottom: 1px solid #FFF9C4;">
                        ‚úÖ <strong>Recuerda PEMDSR:</strong> Par√©ntesis, Exponentes, Multiplicaci√≥n/Divisi√≥n, Suma/Resta
                    </li>
                    <li style="padding: 12px 0; font-size: 1.15em; color: #F57F17; border-bottom: 1px solid #FFF9C4;">
                        ‚úÖ <strong>Divisi√≥n = Multiplicar por el rec√≠proco:</strong> Voltea la segunda fracci√≥n y multiplica
                    </li>
                    <li style="padding: 12px 0; font-size: 1.15em; color: #F57F17; border-bottom: 1px solid #FFF9C4;">
                        ‚úÖ <strong>No te apresures:</strong> Lee cada problema con cuidado antes de resolver
                    </li>
                    <li style="padding: 12px 0; font-size: 1.15em; color: #F57F17;">
                        ‚úÖ <strong>Verifica tus respuestas:</strong> Un peque√±o error puede cambiar todo el resultado
                    </li>
                </ul>
            </div>
        </div>

        <!-- ENLACE AL JUEGO -->
        <div style="background: linear-gradient(135deg, #1A237E, #311B92); padding: 50px; border-radius: 30px; margin: 35px 0; border: 5px solid #FFD700; box-shadow: 0 15px 50px rgba(26, 35, 126, 0.5); text-align: center;">
            <div style="font-size: 5em; margin-bottom: 20px; animation: bounce 2s infinite;">‚öîÔ∏è</div>
            <h3 style="color: #FFD700; font-size: 2.2em; margin-bottom: 20px; text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);">
                ¬°Es Hora de la Batalla Final!
            </h3>
            <p style="color: white; font-size: 1.3em; margin-bottom: 30px; line-height: 1.8;">
                El destino del Reino de Mathem√°tica est√° en tus manos.<br>
                ¬øEst√°s listo para enfrentar al Rey Numerus y demostrar que eres el verdadero maestro de las fracciones?
            </p>
            
            <!-- AQU√ç ANDR√âS PEGAR√Å SU ENLACE DEL JUEGO -->
         <button onclick="abrirJuegoNumerus()" style="display: inline-block; padding: 30px 70px; font-size: 1.8em; background: linear-gradient(135deg, #FF6B6B, #FF8E53); color: white; border: none; cursor: pointer; border-radius: 25px; font-weight: 700; box-shadow: 0 15px 40px rgba(255, 107, 107, 0.5); transition: all 0.3s; border: 4px solid #FFD700;">
    üéÆ ¬°COMENZAR LA AVENTURA!
</button>

            <p style="color: #FFD700; font-size: 1em; margin-top: 25px; font-style: italic;">
                ‚ö†Ô∏è Una vez que inicies, no podr√°s volver atr√°s. ¬°Prep√°rate bien!
            </p>
        </div>

        <!-- NOTA PARA DESPU√âS DE COMPLETAR -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 20px; margin: 25px 0; border: 4px solid #4CAF50;">
            <h4 style="color: #1B5E20; font-size: 1.5em; margin-bottom: 15px; text-align: center;">üéì Despu√©s de completar el juego...</h4>
            <p style="font-size: 1.15em; color: #2E7D32; text-align: center; line-height: 1.8;">
                Habr√°s demostrado que dominas completamente las fracciones y la jerarqu√≠a de operaciones.<br>
                ¬°Ser√°s reconocido como un <strong>Maestro de las Matem√°ticas</strong> y habr√°s completado con √©xito toda la Unidad Did√°ctica!
            </p>
        </div>

        <!-- BOT√ìN PARA COMPLETAR SESI√ìN 6 -->
        <div style="text-align: center; margin-top: 40px;">
            <button onclick="completeSession6()" style="padding: 25px 60px; font-size: 1.5em; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 700; box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4);">
                üèÜ ¬°Completar Sesi√≥n 6 y Unidad Did√°ctica!
            </button>
        </div>
    </div>
</div>

<style>
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}
</style>

<!-- ========== JUEGO ARCADE: CULEBRITA FRACCIONARIA ========== -->
<div class="screen" id="session4ArcadeScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, #0a0020 0%, #1a0040 50%, #2d1060 100%); min-height: 100vh; padding: 15px; max-width: 100%; border-radius: 0;">
        <button class="back-button" onclick="exitSnakeGame(); showScreen('session4Screen')" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <!-- INICIO -->
        <div id="snakeStartScreen" style="text-align: center; padding: 30px 15px;">
            <div style="margin-bottom: 15px;">
                <span style="font-size: 4.5em; display: inline-block; animation: snkFloat 2s ease-in-out infinite;">üêç</span>
            </div>
            <h2 style="font-family: 'Segoe UI', sans-serif; font-size: 2.2em; font-weight: 900; color: #fff; margin-bottom: 5px; text-shadow: 0 0 30px rgba(156,39,176,0.6);">
                CULEBRITA FRACCIONARIA
            </h2>
            <p style="font-size: 1em; color: #CE93D8; margin-bottom: 25px; letter-spacing: 2px;">FRACCIONES: CONCEPTO, EQUIVALENCIA Y SIMPLIFICACI√ìN</p>
            
            <div style="background: linear-gradient(145deg, rgba(156,39,176,0.15), rgba(156,39,176,0.05)); padding: 25px; border-radius: 20px; max-width: 500px; margin: 0 auto 25px auto; border: 2px solid rgba(156,39,176,0.4);">
                <h4 style="color: #CE93D8; margin-bottom: 15px; font-size: 1.1em;">üìã ¬øC√≥mo Jugar?</h4>
                <div style="text-align: left; font-size: 0.95em; color: #E1BEE7; line-height: 2;">
                    <p style="margin-bottom: 8px;">üêç Controla la culebrita con <strong style="color: #fff;">flechas ‚Üë‚Üì‚Üê‚Üí</strong></p>
                    <p style="margin-bottom: 8px;">üçé Come las <strong style="color: #69F0AE;">manzanas</strong> para crecer y ganar puntos</p>
                    <p style="margin-bottom: 8px;">ü™® Esquiva los <strong style="color: #CE93D8;">obst√°culos</strong> que aparecen al avanzar</p>
                    <p style="margin-bottom: 8px;">‚ö° La velocidad <strong style="color: #40C4FF;">aumenta progresivamente</strong></p>
                    <p style="margin-bottom: 8px;">üí• Si chocas ‚Üí <strong style="color: #FFD740;">pregunta de fracciones</strong></p>
                    <p style="margin-bottom: 8px;">‚úÖ Correcta ‚Üí <strong style="color: #69F0AE;">No pierdes vida</strong></p>
                    <p style="margin-bottom: 8px;">‚ùå Incorrecta ‚Üí <strong style="color: #FF5252;">Pierdes una vida</strong></p>
                    <p>‚ù§Ô∏è Tienes <strong style="color: #FF5252;">4 vidas</strong> y 3 intentos</p>
                </div>
            </div>
            
            <div id="snkAttemptsInfo" style="display: none; background: rgba(255,152,0,0.15); padding: 12px 20px; border-radius: 12px; max-width: 400px; margin: 0 auto 20px auto; border: 2px solid rgba(255,152,0,0.4);">
                <p style="color: #FFB74D; font-size: 1em; font-weight: 600;" id="snkAttemptsText"></p>
            </div>
            
            <button onclick="startSnakeGame()" style="background: linear-gradient(135deg, #9C27B0, #E040FB); color: white; border: none; padding: 20px 60px; font-size: 1.4em; font-weight: 800; border-radius: 30px; cursor: pointer; box-shadow: 0 8px 25px rgba(156,39,176,0.5); animation: snkPulse 2s infinite;">
                üêç ¬°JUGAR!
            </button>
            
            <div style="margin-top: 15px;">
                <label style="color: #CE93D8; font-size: 0.9em; cursor: pointer;">
                    <input type="checkbox" id="snkMusicToggle" checked style="margin-right: 8px;"> üîä M√∫sica y sonidos
                </label>
            </div>
        </div>
        
        <!-- JUEGO -->
        <div id="snakeGameScreen" style="display: none; text-align: center; padding: 10px;">
            <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 6px; max-width: 600px; margin: 0 auto 8px auto; padding: 10px 12px; background: linear-gradient(135deg, rgba(74,20,140,0.9), rgba(106,27,154,0.9)); border-radius: 15px; border: 2px solid rgba(186,104,200,0.5);">
                <div style="text-align: center;">
                    <div style="font-size: 0.65em; color: #CE93D8;">PUNTOS</div>
                    <div style="color: #FFD700; font-weight: 800; font-size: 1.2em;" id="snkScore">0</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.65em; color: #CE93D8;">VELOCIDAD</div>
                    <div style="color: #40C4FF; font-weight: 800; font-size: 1.2em;" id="snkSpeed">1x</div>
                </div>
                <div id="snkLives" style="display: flex; gap: 4px; font-size: 1.1em;">
                    <span class="snkHeart">‚ù§Ô∏è</span><span class="snkHeart">‚ù§Ô∏è</span><span class="snkHeart">‚ù§Ô∏è</span><span class="snkHeart">‚ù§Ô∏è</span>
                </div>
                <button onclick="toggleSnkMusic()" id="snkMuteBtn" style="background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 8px; border-radius: 10px; cursor: pointer; font-size: 0.9em;">üîä</button>
            </div>
            
            <div style="position: relative; display: inline-block; width: 100%; max-width: 600px;">
                <canvas id="snakeCanvas" style="border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.5), 0 0 50px rgba(156,39,176,0.2); border: 3px solid rgba(156,39,176,0.5); width: 100%; display: block; touch-action: none;"></canvas>
            </div>
            
            <div style="margin-top: 10px; color: #CE93D8; font-size: 0.85em;">
                ‚Üë‚Üì‚Üê‚Üí Flechas &nbsp;|&nbsp; üì± Desliza sobre el canvas
            </div>
        </div>
        
        <!-- MODAL PREGUNTA -->
        <div id="snkQuestionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10,0,37,0.95); z-index: 9999; justify-content: center; align-items: center; backdrop-filter: blur(8px); overflow-y: auto;">
            <div style="background: linear-gradient(145deg, #4A148C, #6A1B9A); padding: 30px; border-radius: 25px; border: 4px solid #BA68C8; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); text-align: center; margin: auto;">
                <div style="font-size: 2.5em; margin-bottom: 8px;">üß†</div>
                <h3 style="color: #FFD740; font-size: 1.3em; margin-bottom: 5px;">¬°Chocaste! Responde correctamente</h3>
                <p style="color: #CE93D8; font-size: 0.9em; margin-bottom: 15px;" id="snkLivesRemaining"></p>
                <div style="background: rgba(255,255,255,0.1); padding: 18px; border-radius: 15px; margin-bottom: 18px; border: 2px solid rgba(186,104,200,0.5);">
                    <p style="font-size: 1.4em; color: #fff; font-weight: 700;" id="snkQuestionContent"></p>
                </div>
                <div id="snkAnswerOptions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;"></div>
                <div id="snkQuestionFeedback" style="display: none; padding: 15px; border-radius: 12px; margin-top: 12px;">
                    <p id="snkFeedbackText" style="font-size: 1.1em; font-weight: 700;"></p>
                    <p id="snkFeedbackExp" style="font-size: 0.9em; margin-top: 6px;"></p>
                </div>
                <button id="snkContinueBtn" onclick="snkContinueAfterQuestion()" style="display: none; margin-top: 15px; background: linear-gradient(135deg, #9C27B0, #E040FB); color: white; border: none; padding: 15px 40px; font-size: 1.15em; font-weight: 800; border-radius: 25px; cursor: pointer; animation: snkPulse 1.5s infinite;">
                    ‚ñ∂ Continuar Jugando
                </button>
            </div>
        </div>
        
        <!-- GAME OVER -->
        <div id="snakeGameOverScreen" style="display: none; text-align: center; padding: 40px 20px;">
            <div style="font-size: 5em; margin-bottom: 20px;">üíî</div>
            <h2 style="font-size: 2.3em; color: #F44336; margin-bottom: 15px;">¬°SIGUE INTENTANDO!</h2>
            <p style="font-size: 1.1em; color: #FFCDD2; margin-bottom: 10px;">Puntuaci√≥n: <span id="snkGameOverScore" style="font-weight: 800; color: #FFD700;">0</span></p>
            <p style="font-size: 1em; color: #CE93D8; margin-bottom: 10px;">Preguntas correctas: <span id="snkGameOverCorrect" style="font-weight: 700;">0</span></p>
            <p style="font-size: 1em; color: #FFB74D; margin-bottom: 25px;" id="snkGameOverAttempts"></p>
            <div id="snkGameOverButtons" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;"></div>
        </div>
        
        <!-- VICTORIA (tras 3 intentos) -->
        <div id="snakeWinScreen" style="display: none; text-align: center; padding: 40px 20px;">
            <div style="font-size: 5em; margin-bottom: 20px; animation: snkFloat 0.6s infinite;">üèÜ</div>
            <h2 style="font-size: 2.5em; color: #FFD700; text-shadow: 0 0 30px rgba(255,215,0,0.5); margin-bottom: 15px;">¬°GRAN TRABAJO!</h2>
            <p style="font-size: 1.2em; color: #69F0AE; margin-bottom: 10px;">Mejor puntuaci√≥n: <span id="snkFinalScore" style="font-weight: 800; color: #FFD700;">0</span></p>
            <p style="font-size: 1.1em; color: #E1BEE7; margin-bottom: 10px;">Preguntas correctas: <span id="snkFinalQuestions" style="font-weight: 800; color: #69F0AE;">0</span></p>
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 25px;">
                <button onclick="resetSnakeGame()" style="background: linear-gradient(135deg, #9C27B0, #E040FB); color: white; border: none; padding: 15px 35px; font-size: 1.1em; font-weight: 700; border-radius: 30px; cursor: pointer;">üîÑ Jugar de Nuevo</button>
                <button onclick="exitSnakeGame(); finalizeSnakeArcade()" style="background: linear-gradient(135deg, #4CAF50, #43A047); color: white; border: none; padding: 15px 35px; font-size: 1.1em; font-weight: 700; border-radius: 30px; cursor: pointer;">‚úÖ Continuar ‚Üí</button>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes snkFloat { 0%,100%{transform:translateY(0) rotate(-3deg);} 50%{transform:translateY(-15px) rotate(3deg);} }
        @keyframes snkPulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }
    </style>
</div>


</div>

  


 <div class="screen" id="session5Screen">
        <div class="content-screen" style="background: linear-gradient(180deg, rgba(0,150,136,0.1) 0%, rgba(38,166,154,0.1) 50%, rgba(77,182,172,0.08) 100%);">
            <button class="back-button" onclick="showScreen('sectionsScreen')">&#8592; Volver al mapa</button>
            
            <!-- Decoraci√≥n flotante tem√°tica -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; z-index: 0;">
                <span style="position: absolute; left: 5%; top: 15%; font-size: 3em; animation: floatMath 8s ease-in-out infinite; opacity: 0.2;">&#10133;</span>
                <span style="position: absolute; right: 8%; top: 20%; font-size: 2.5em; animation: floatMath 7s ease-in-out infinite; animation-delay: 1s; opacity: 0.2;">&#10134;</span>
                <span style="position: absolute; left: 10%; bottom: 30%; font-size: 2.8em; animation: floatMath 9s ease-in-out infinite; animation-delay: 2s; opacity: 0.2;">&#128290;</span>
                <span style="position: absolute; right: 12%; bottom: 25%; font-size: 2.2em; animation: floatMath 6s ease-in-out infinite; animation-delay: 0.5s; opacity: 0.2;">&#128202;</span>
            </div>
            
            <div style="text-align: center; margin-top: 30px; position: relative; z-index: 1;">
                <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">&#129518;</div>
                <h2 class="session-title-gradient" style="background: linear-gradient(135deg, #009688, #26A69A, #4DB6AC); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 2.8em;">Sesi√≥n 5: Fracciones (II)</h2>
                <p style="font-size: 1.4em; color: #00796B; font-weight: 600; text-shadow: 0 2px 10px rgba(0, 121, 107, 0.3);">üéØ Operaciones Avanzadas: MCM y 3+ T√©rminos</p>
            </div>

            <div class="content-grid-session1" style="position: relative; z-index: 1;">
                <div class="card-session objective-card" style="background: linear-gradient(135deg, #E0F2F1, #B2DFDB); border-left: 8px solid #009688;">
                    <h3 style="color: #00695C;">&#127919; Objetivo de Sesi√≥n</h3>
                    <p style="color: #004D40;">Dominar la suma y resta de fracciones con igual y distinto denominador, aplicando correctamente las reglas de signos para obtener resultados exactos y simplificados.</p>
                </div>
                <div class="card-session learning-card" style="background: linear-gradient(135deg, #E0F7FA, #B2EBF2); border-left: 8px solid #00BCD4;">
                    <h3 style="color: #00838F;">&#128506;&#65039; Ruta de Aprendizaje</h3>
                    <ul class="learning-list">
                        <li class="learning-list-item" id="s5-theory1-btn" onclick="goToSession5Screen('session5Theory1Screen', 1)" style="background: linear-gradient(135deg, #80CBC4, #4DB6AC);"><span>&#128218;</span> Teor√≠a 1: MCM y Suma/Resta de 3+ Fracciones</li>
                        <li class="learning-list-item" id="s5-theory2-btn" onclick="goToSession5Screen('session5Theory2Screen', 2)" style="background: linear-gradient(135deg, #4DD0E1, #26C6DA);"><span>&#128208;</span> Teor√≠a 2: Multiplicaci√≥n y Divisi√≥n de 3+ Fracciones</li>
                        <li class="learning-list-item" id="s5-game-btn" onclick="goToSession5Screen('session5GameClassScreen', 3)" style="background: linear-gradient(135deg, #81C784, #66BB6A);"><span>&#127922;</span> Juego en Aula: Torneo de Fracciones</li>
<li class="learning-list-item" id="s5-arcade-btn" onclick="goToSession5Screen('session5ArcadeScreen', 4)" style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ff88;"><span>üèéÔ∏è</span> Arcade: Turbo Fracciones</li>
                        <li class="learning-list-item" id="s5-quiz-btn" onclick="goToSession5Screen('session5QuizScreen', 4)" style="background: linear-gradient(135deg, #FFB74D, #FFA726);"><span>&#128221;</span> Actividad Nearpod</li>
                    </ul>
                </div>
            </div>

            <div class="session1-nav-grid" style="position: relative; z-index: 1;">
                <div class="session-nav-card session5-card" id="s5-nav-theory1" onclick="goToSession5Screen('session5Theory1Screen', 1)" style="background: linear-gradient(135deg, #26A69A, #009688); box-shadow: 0 10px 30px rgba(0, 150, 136, 0.4);">
                    <div class="session-nav-card-icon">&#128218;</div>
                    <h4>1. MCM y Suma</h4>
                </div>
                <div class="session-nav-card session5-card" id="s5-nav-theory2" onclick="goToSession5Screen('session5Theory2Screen', 2)" style="background: linear-gradient(135deg, #4DD0E1, #00BCD4); box-shadow: 0 10px 30px rgba(0, 188, 212, 0.4);">
                    <div class="session-nav-card-icon">&#128208;</div>
                    <h4>2. √ó √∑ Avanzada</h4>
                </div>
                <div class="session-nav-card session5-card" id="s5-nav-game" onclick="goToSession5Screen('session5GameClassScreen', 3)" style="background: linear-gradient(135deg, #81C784, #4CAF50); box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);">
                    <div class="session-nav-card-icon">&#127922;</div>
                    <h4>3. Torneo</h4>
                </div>
<div class="session-nav-card session5-card" id="s5-nav-arcade" onclick="goToSession5Screen('session5ArcadeScreen', 4)" style="background: linear-gradient(135deg, #1a1a2e, #16213e); box-shadow: 0 10px 30px rgba(0, 255, 136, 0.4); border: 2px solid #00ff88;">
    <div class="session-nav-card-icon">üèéÔ∏è</div>
    <h4>4. Turbo Fracciones</h4>
</div>
                <div class="session-nav-card session5-card" id="s5-nav-quiz" onclick="goToSession5Screen('session5QuizScreen', 5)" style="background: linear-gradient(135deg, #FFB74D, #FF9800); box-shadow: 0 10px 30px rgba(255, 152, 0, 0.4);">
                    <div class="session-nav-card-icon">&#128221;</div>
                    <h4>5. Nearpod &#128274;</h4>
                </div>
            </div>
        </div>
    </div>
<!-- ========== TEOR√çA 1: SUMA Y RESTA CON IGUAL DENOMINADOR ========== -->
<div class="screen" id="session5Theory1Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(0,150,136,0.05) 0%, rgba(0,121,107,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session5Screen')"> ‚Üê Volver a Sesi√≥n 5 </button>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">üî¢</div>
            <h2 style="color: #00695C; font-size: 2.2em; font-weight: 800;">MCM y Suma/Resta de 3+ Fracciones</h2>
            <p style="color: #00796B; font-size: 1.15em;">Operaciones con m√∫ltiples t√©rminos</p>
        </div>

        <!-- MCM -->
        <div style="background: linear-gradient(135deg, #E0F2F1, #B2DFDB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #009688;">
            <h3 style="color: #00695C; font-size: 1.6em;">üî¢ M√≠nimo Com√∫n M√∫ltiplo (MCM)</h3>
            <p style="color: #004D40; font-size: 1.05em; line-height: 1.8; margin: 15px 0;">El <strong>MCM</strong> es el menor n√∫mero que es m√∫ltiplo de todos los denominadores. Se usa para encontrar el denominador com√∫n al sumar o restar fracciones.</p>
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 3px solid #009688;">
                <p style="color: #00695C; font-weight: 700; font-size: 1.2em; margin-bottom: 10px;">M√©todo: Descomposici√≥n en factores primos</p>
                <p style="color: #333; line-height: 2;">
                    <strong>Ejemplo:</strong> MCM(4, 6, 3)<br>
                    4 = 2¬≤ &nbsp;|&nbsp; 6 = 2 √ó 3 &nbsp;|&nbsp; 3 = 3<br>
                    MCM = 2¬≤ √ó 3 = <strong style="color: #E65100; font-size: 1.2em;">12</strong><br><br>
                    <strong>Ejemplo:</strong> MCM(8, 12, 6)<br>
                    8 = 2¬≥ &nbsp;|&nbsp; 12 = 2¬≤ √ó 3 &nbsp;|&nbsp; 6 = 2 √ó 3<br>
                    MCM = 2¬≥ √ó 3 = <strong style="color: #E65100; font-size: 1.2em;">24</strong>
                </p>
            </div>
            <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #4CAF50;">
                <p style="color: #1B5E20;">üí° <strong>Recuerda:</strong> El MCM toma la mayor potencia de cada factor primo que aparezca en cualquiera de los n√∫meros.</p>
            </div>
        </div>

        <!-- SUMA/RESTA 3+ T√âRMINOS -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.6em;">‚ûï‚ûñ Suma y Resta con 3 o m√°s Fracciones</h3>
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 2px solid #2196F3;">
                <p style="color: #1565C0; font-weight: 700; font-size: 1.1em;">Pasos:</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    <strong>1.</strong> Encontrar el MCM de TODOS los denominadores.<br>
                    <strong>2.</strong> Amplificar cada fracci√≥n al denominador com√∫n.<br>
                    <strong>3.</strong> Sumar o restar los numeradores respetando signos.<br>
                    <strong>4.</strong> Simplificar el resultado si es posible.
                </p>
            </div>

            <div style="background: #FFF3E0; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.15em;">Ejemplo 1: 1/2 + 1/3 + 1/4</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    MCM(2, 3, 4) = 12<br>
                    1/2 = 6/12 &nbsp;|&nbsp; 1/3 = 4/12 &nbsp;|&nbsp; 1/4 = 3/12<br>
                    6/12 + 4/12 + 3/12 = <strong style="color: #2E7D32; font-size: 1.2em;">13/12</strong>
                </p>
            </div>

            <div style="background: #FFF3E0; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.15em;">Ejemplo 2: 2/3 ‚àí 1/4 + 5/6</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    MCM(3, 4, 6) = 12<br>
                    2/3 = 8/12 &nbsp;|&nbsp; 1/4 = 3/12 &nbsp;|&nbsp; 5/6 = 10/12<br>
                    8/12 ‚àí 3/12 + 10/12 = <strong style="color: #2E7D32; font-size: 1.2em;">15/12 = 5/4</strong>
                </p>
            </div>

            <div style="background: #FFEBEE; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #F44336;">
                <p style="color: #C62828; font-weight: 700; font-size: 1.15em;">Ejemplo 3: ‚àí3/4 + 1/6 ‚àí 2/3</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    MCM(4, 6, 3) = 12<br>
                    ‚àí3/4 = ‚àí9/12 &nbsp;|&nbsp; 1/6 = 2/12 &nbsp;|&nbsp; ‚àí2/3 = ‚àí8/12<br>
                    ‚àí9/12 + 2/12 ‚àí 8/12 = <strong style="color: #C62828; font-size: 1.2em;">‚àí15/12 = ‚àí5/4</strong>
                </p>
            </div>
        </div>

        <!-- PRACTICA -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.5em;">‚úèÔ∏è Practica en tu Cuaderno</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">1) 1/3 + 1/5 + 1/15 = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">2) 3/4 ‚àí 1/2 + 2/8 = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">3) ‚àí2/5 + 3/10 ‚àí 1/2 = ?</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">4) 5/6 ‚àí 1/3 + 1/2 ‚àí 1/4 = ?</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeS5Theory1();" style="background: linear-gradient(135deg, #009688, #00796B); font-size: 1.4em; padding: 20px 50px;">
                Siguiente: Multiplicaci√≥n/Divisi√≥n Avanzada ‚Üí
            </button>
        </div>
    </div>
</div>

<div class="screen" id="session5Theory2Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(0,188,212,0.05) 0%, rgba(0,150,136,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session5Screen')"> ‚Üê Volver a Sesi√≥n 5 </button>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">‚úñÔ∏è‚ûó</div>
            <h2 style="color: #00695C; font-size: 2.2em; font-weight: 800;">Multiplicaci√≥n y Divisi√≥n de 3+ T√©rminos</h2>
            <p style="color: #00796B; font-size: 1.15em;">Cadenas de operaciones con fracciones</p>
        </div>

        <!-- MULTIPLICACI√ìN 3+ T√âRMINOS -->
        <div style="background: linear-gradient(135deg, #E0F7FA, #B2EBF2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #00BCD4;">
            <h3 style="color: #006064; font-size: 1.6em;">‚úñÔ∏è Multiplicaci√≥n de 3 o m√°s Fracciones</h3>
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 3px solid #00BCD4; text-align: center;">
                <p style="font-size: 1.3em; color: #006064; font-weight: 700;">Se multiplican todos los numeradores entre s√≠ y todos los denominadores entre s√≠</p>
                <p style="font-size: 1.6em; color: #E65100; font-weight: 800; margin: 12px 0;">a/b √ó c/d √ó e/f = (a√óc√óe) / (b√ód√óf)</p>
            </div>

            <div style="background: #FFF3E0; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.15em;">Ejemplo: 2/3 √ó 3/4 √ó 4/5</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    Numeradores: 2 √ó 3 √ó 4 = 24<br>
                    Denominadores: 3 √ó 4 √ó 5 = 60<br>
                    = 24/60 = <strong style="color: #2E7D32; font-size: 1.2em;">2/5</strong><br>
                    <span style="color: #888;">üí° Truco: puedes simplificar cruzado antes ‚Üí (2√ó<s>3</s>√ó<s>4</s>) / (<s>3</s>√ó<s>4</s>√ó5) = 2/5</span>
                </p>
            </div>

            <div style="background: #FFEBEE; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #F44336;">
                <p style="color: #C62828; font-weight: 700; font-size: 1.15em;">Ejemplo con signos: (‚àí1/2) √ó (3/5) √ó (‚àí2/3)</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    Signos: (‚àí)(+)(‚àí) = (+) &nbsp; <span style="color: #888;">(cantidad par de negativos = positivo)</span><br>
                    Numeradores: 1 √ó 3 √ó 2 = 6<br>
                    Denominadores: 2 √ó 5 √ó 3 = 30<br>
                    = +6/30 = <strong style="color: #2E7D32; font-size: 1.2em;">1/5</strong>
                </p>
            </div>

            <div style="background: rgba(76,175,80,0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #4CAF50; margin-top: 15px;">
                <p style="color: #1B5E20;">üí° <strong>Regla de signos:</strong> Cantidad <strong>par</strong> de signos negativos = resultado <strong>positivo</strong>. Cantidad <strong>impar</strong> de negativos = resultado <strong>negativo</strong>.</p>
            </div>
        </div>

        <!-- DIVISI√ìN 3+ T√âRMINOS -->
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #9C27B0;">
            <h3 style="color: #6A1B9A; font-size: 1.6em;">‚ûó Divisi√≥n Sucesiva de Fracciones</h3>
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 3px solid #9C27B0; text-align: center;">
                <p style="font-size: 1.2em; color: #6A1B9A; font-weight: 700;">Se resuelve de izquierda a derecha: primero la 1¬™ √∑ 2¬™, y luego ese resultado √∑ 3¬™</p>
                <p style="font-size: 1.1em; color: #E65100; font-weight: 700; margin: 10px 0;">O se convierte todo a multiplicaci√≥n invirtiendo desde la 2¬™ fracci√≥n en adelante</p>
            </div>

            <div style="background: #FFF3E0; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.15em;">Ejemplo: 3/4 √∑ 1/2 √∑ 3/8</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    Paso 1: 3/4 √∑ 1/2 = 3/4 √ó 2/1 = 6/4 = 3/2<br>
                    Paso 2: 3/2 √∑ 3/8 = 3/2 √ó 8/3 = 24/6 = <strong style="color: #2E7D32; font-size: 1.2em;">4</strong>
                </p>
            </div>

            <div style="background: #FFEBEE; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #F44336;">
                <p style="color: #C62828; font-weight: 700; font-size: 1.15em;">Ejemplo mixto: (‚àí2/3) √ó (1/4) √∑ (‚àí1/6)</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    Paso 1: (‚àí2/3) √ó (1/4) = ‚àí2/12 = ‚àí1/6<br>
                    Paso 2: (‚àí1/6) √∑ (‚àí1/6) = (‚àí1/6) √ó (‚àí6/1) = 6/6 = <strong style="color: #2E7D32; font-size: 1.2em;">1</strong><br>
                    <span style="color: #888;">(‚àí)(‚àí) = (+)</span>
                </p>
            </div>
        </div>

        <!-- OPERACIONES COMBINADAS -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.6em;">üîÄ Operaciones Combinadas (√ó, √∑ y +, ‚àí)</h3>
            <p style="color: #4E342E; font-size: 1.05em; line-height: 1.8; margin: 15px 0;">Cuando se mezclan las cuatro operaciones, recuerda la <strong>jerarqu√≠a</strong>: primero multiplicaciones y divisiones (de izquierda a derecha), luego sumas y restas.</p>

            <div style="background: white; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.15em;">Ejemplo: 1/2 + 2/3 √ó 3/4</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    Primero √ó : 2/3 √ó 3/4 = 6/12 = 1/2<br>
                    Luego + : 1/2 + 1/2 = <strong style="color: #2E7D32; font-size: 1.2em;">1</strong>
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.15em;">Ejemplo: 3/4 ‚àí 1/2 √∑ 2/3 + 1/6</p>
                <p style="color: #333; line-height: 2; margin-top: 8px;">
                    Primero √∑ : 1/2 √∑ 2/3 = 1/2 √ó 3/2 = 3/4<br>
                    Queda: 3/4 ‚àí 3/4 + 1/6<br>
                    = 0 + 1/6 = <strong style="color: #2E7D32; font-size: 1.2em;">1/6</strong>
                </p>
            </div>
        </div>

        <!-- PRACTICA -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.5em;">‚úèÔ∏è Practica en tu Cuaderno</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">1) (‚àí1/3) √ó (2/5) √ó (‚àí3/4)</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">2) 5/6 √∑ 1/3 √∑ 5/2</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">3) 1/4 + 2/3 √ó 3/8</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                    <p style="color: #1565C0; font-weight: 700;">4) 1/2 ‚àí 1/3 √∑ 2/9 + 1/4</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeS5Theory2();" style="background: linear-gradient(135deg, #00BCD4, #0097A7); font-size: 1.4em; padding: 20px 50px;">
                Siguiente: Juego en el Aula ‚Üí
            </button>
        </div>
    </div>
</div>

<div class="screen" id="session5GameClassScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(76,175,80,0.05) 0%, rgba(129,199,132,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session5Screen')"> ‚Üê Volver a Sesi√≥n 5 </button>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">‚öîÔ∏è</div>
            <h2 style="color: #2E7D32; font-size: 2.2em; font-weight: 800;">Torneo de Fracciones</h2>
            <p style="color: #1B5E20; font-size: 1.15em;">Competencia por equipos de operaciones combinadas</p>
        </div>

        <!-- PREPARACI√ìN -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.5em;">üì¶ Materiales</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                <div style="background: white; padding: 20px; border-radius: 15px;">
                    <p style="font-size: 1.1em; color: #2E7D32; font-weight: 700;">üìã Se necesita</p>
                    <p style="color: #333; line-height: 1.8; margin-top: 8px;">Tablero (cartulina grande), dado, fichas de colores (una por equipo), tarjetas con operaciones de fracciones clasificadas por dificultad (verde, azul, rojo).</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px;">
                    <p style="font-size: 1.1em; color: #2E7D32; font-weight: 700;">üë• Organizaci√≥n</p>
                    <p style="color: #333; line-height: 1.8; margin-top: 8px;">4-6 equipos de 3-4 estudiantes. El tablero tiene 20 casillas con operaciones de dificultad creciente. Cada equipo tiene 1 ficha y compite por llegar al final.</p>
                </div>
            </div>
        </div>

        <!-- REGLAS -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.5em;">üéØ Reglas del Torneo</h3>
            <div style="background: white; padding: 25px; border-radius: 15px; margin-top: 15px;">
                <div style="color: #333; font-size: 1.05em; line-height: 2.2;">
                    <p><strong style="color: #1565C0;">1.</strong> Cada equipo lanza el dado y avanza las casillas correspondientes.</p>
                    <p><strong style="color: #1565C0;">2.</strong> En la casilla que caigan, toman una tarjeta del color indicado (üü¢ f√°cil, üîµ medio, üî¥ dif√≠cil).</p>
                    <p><strong style="color: #1565C0;">3.</strong> El equipo tiene <strong>90 segundos</strong> para resolver la operaci√≥n en grupo. TODOS deben mostrar el proceso en el cuaderno.</p>
                    <p><strong style="color: #1565C0;">4.</strong> Si responden correctamente, se quedan en la casilla. Si fallan, retroceden 2 casillas.</p>
                    <p><strong style="color: #E65100;">‚ö° Casillas especiales:</strong> Casilla ‚≠ê = doble avance si acierta. Casilla ‚ö° = duelo contra otro equipo (ambos resuelven, el m√°s r√°pido gana).</p>
                    <p><strong style="color: #2E7D32;">üèÜ</strong> Primer equipo en llegar a la meta gana puntos extra.</p>
                </div>
            </div>
        </div>

        <!-- TARJETAS EJEMPLO -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.5em;">üÉè Ejemplo de Tarjetas</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                <div style="background: #E8F5E9; padding: 18px; border-radius: 12px; text-align: center; border: 3px solid #4CAF50;">
                    <p style="color: #2E7D32; font-weight: 800;">üü¢ F√ÅCIL</p>
                    <p style="color: #333; font-size: 1.2em; font-weight: 700; margin: 8px 0;">1/3 + 1/4 + 1/6</p>
                    <p style="color: #888; font-size: 0.85em;">MCM y suma 3 fracciones</p>
                </div>
                <div style="background: #E3F2FD; padding: 18px; border-radius: 12px; text-align: center; border: 3px solid #2196F3;">
                    <p style="color: #1565C0; font-weight: 800;">üîµ MEDIO</p>
                    <p style="color: #333; font-size: 1.2em; font-weight: 700; margin: 8px 0;">(‚àí2/3) √ó (3/5) √ó (‚àí1/4)</p>
                    <p style="color: #888; font-size: 0.85em;">Multiplicaci√≥n con signos</p>
                </div>
                <div style="background: #FFEBEE; padding: 18px; border-radius: 12px; text-align: center; border: 3px solid #F44336;">
                    <p style="color: #C62828; font-weight: 800;">üî¥ DIF√çCIL</p>
                    <p style="color: #333; font-size: 1.2em; font-weight: 700; margin: 8px 0;">1/2 + 3/4 √ó 2/3 ‚àí 1/6</p>
                    <p style="color: #888; font-size: 0.85em;">Operaciones combinadas</p>
                </div>
            </div>
        </div>

        <!-- R√öBRICA -->
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #9C27B0;">
            <h3 style="color: #6A1B9A; font-size: 1.5em;">üìä Evaluaci√≥n</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 2em;">‚≠ê‚≠ê‚≠ê</p>
                    <p style="color: #6A1B9A; font-weight: 700;">Experto</p>
                    <p style="color: #333; font-size: 0.9em;">Resuelve correctamente, muestra proceso y ayuda a compa√±eros.</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 2em;">‚≠ê‚≠ê</p>
                    <p style="color: #FF8F00; font-weight: 700;">Avanzado</p>
                    <p style="color: #333; font-size: 0.9em;">Resuelve la mayor√≠a con proceso completo.</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center;">
                    <p style="font-size: 2em;">‚≠ê</p>
                    <p style="color: #F44336; font-weight: 700;">En Proceso</p>
                    <p style="color: #333; font-size: 0.9em;">Participa pero necesita apoyo para resolver.</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeS5GameClass();" style="background: linear-gradient(135deg, #4CAF50, #388E3C); font-size: 1.4em; padding: 20px 50px;">
                Siguiente: Turbo Fracciones üèéÔ∏è ‚Üí
            </button>
        </div>
    </div>
</div>

<!-- ========== JUEGO ARCADE: TURBO FRACCIONES ========== -->
<div class="screen" id="session5ArcadeScreen">
    <div style="background: #0a0a0f; min-height: 100vh; padding: 0; user-select: none; -webkit-user-select: none; overflow: hidden; position: relative;">
        <button class="back-button" onclick="tfExit()" style="color: #555; border-color: #333; position: absolute; top: 8px; left: 8px; z-index: 100; font-size: 0.85em;"> &larr; Salir </button>
        <div id="tfScrStart" style="text-align: center; padding: 30px 15px;">
            <div style="font-size: 4em; margin-bottom: 5px; filter: drop-shadow(0 0 20px #00ff88);">&#127951;</div>
            <h2 style="color: #00ff88; font-size: 2.2em; margin: 0; font-family: 'Courier New', monospace; letter-spacing: 4px; text-shadow: 0 0 20px #00ff88, 0 0 40px #00ff8844;">TURBO<br>FRACCIONES</h2>
            <p style="color: #fdd835; font-size: 0.9em; font-family: 'Courier New', monospace; margin: 8px 0 20px;">&mdash; Carrera de Fracciones Avanzadas &mdash;</p>
            <div style="background: rgba(0,255,136,0.05); padding: 14px; border-radius: 10px; margin: 8px auto; max-width: 340px; border: 2px solid #00ff8844;">
                <p style="color: #00ff88; font-weight: 700; font-size: 0.85em; margin-bottom: 8px; font-family: 'Courier New', monospace;">&#127918; CONTROLES</p>
                <p style="color: #aaa; font-size: 0.8em; line-height: 1.6; font-family: 'Courier New', monospace;">&#128241; Toca &#11013;&#65039; &#10145;&#65039; para cambiar carril<br>&#128187; Flechas &larr; &rarr; del teclado</p>
            </div>
            <div style="background: rgba(0,255,136,0.05); padding: 14px; border-radius: 10px; margin: 8px auto; max-width: 340px; border: 2px solid #00ff8844;">
                <p style="color: #aaa; font-size: 0.8em; line-height: 1.7; font-family: 'Courier New', monospace;">&#127937; Esquiva autos en 3 carriles<br>&#9889; La velocidad sube con el puntaje<br>&#128165; Choque &rarr; <span style="color: #fdd835;">Pregunta de fracciones</span><br>&#9989; Correcta = sigues | &#10060; = &minus;1 vida<br>&#10084;&#65039; 4 vidas &middot; 3 intentos</p>
            </div>
            <p id="tfTxtAtt" style="color: #555; font-size: 0.85em; font-family: 'Courier New', monospace; margin: 12px 0 5px;">Intento 1 de 3</p>
            <button onclick="tfStart()" style="padding: 16px 60px; font-size: 1.3em; background: linear-gradient(180deg, #00ff88, #00aa55); color: #000; border: 3px solid #fdd835; border-radius: 12px; cursor: pointer; font-weight: 900; font-family: 'Courier New', monospace; letter-spacing: 3px; box-shadow: 0 0 30px #00ff8844;">&#9654; START</button>
        </div>
        <div id="tfScrGame" style="display: none; touch-action: none;">
            <div style="display: flex; justify-content: center;"><canvas id="tfCvs" style="border: 3px solid #00ff8833; border-radius: 6px;"></canvas></div>
            <div style="display: flex; justify-content: center; gap: 50px; margin-top: 10px;">
                <button onclick="tfMv(-1)" ontouchstart="event.preventDefault();tfMv(-1)" style="width: 80px; height: 80px; font-size: 2.2em; background: linear-gradient(180deg,#1a2a1a,#0a150a); color: #00ff88; border: 3px solid #00ff8844; border-radius: 50%; cursor: pointer; touch-action: manipulation;">&#11013;&#65039;</button>
                <button onclick="tfMv(1)" ontouchstart="event.preventDefault();tfMv(1)" style="width: 80px; height: 80px; font-size: 2.2em; background: linear-gradient(180deg,#1a2a1a,#0a150a); color: #00ff88; border: 3px solid #00ff8844; border-radius: 50%; cursor: pointer; touch-action: manipulation;">&#10145;&#65039;</button>
            </div>
        </div>
        <div id="tfScrQ" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.93); z-index: 1000; align-items: center; justify-content: center; padding: 15px;">
            <div style="background: #111; padding: 22px; border-radius: 16px; max-width: 420px; width: 100%; border: 3px solid #00ff88;">
                <div style="text-align: center; margin-bottom: 10px;"><span style="font-size: 1.8em;">&#128165;</span><h3 style="color: #00ff88; font-size: 1.05em; margin-top: 4px; font-family: 'Courier New', monospace;">&#161;CHOQUE! Responde para continuar</h3><p id="tfQLiv" style="color: #ff8a65; font-size: 0.85em; font-family: 'Courier New', monospace;"></p></div>
                <div style="background: #1a1a2e; padding: 14px; border-radius: 10px; margin-bottom: 14px; border: 1px solid #333;"><p id="tfQTxt" style="color: #fdd835; font-size: 1.15em; font-weight: 700; text-align: center; font-family: 'Courier New', monospace;"></p></div>
                <div id="tfQOpts" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;"></div>
                <div id="tfQFb" style="display: none; margin-top: 10px; padding: 10px; border-radius: 8px; text-align: center;"></div>
            </div>
        </div>
        <div id="tfScrGO" style="display: none; text-align: center; padding: 30px 15px;">
            <div style="font-size: 3em;">&#128128;</div><h2 style="color: #ff5252; font-family: 'Courier New', monospace; font-size: 1.6em;">GAME OVER</h2>
            <p style="color: #aaa; font-family: 'Courier New', monospace;">Puntuaci&oacute;n: <span id="tfGOSc" style="color: #fdd835; font-weight: 700;">0</span></p>
            <p style="color: #aaa; font-family: 'Courier New', monospace;">Nivel: <span id="tfGOLv" style="color: #00ff88; font-weight: 700;">1</span></p>
            <p style="color: #aaa; font-family: 'Courier New', monospace;">Preguntas: <span id="tfGOQ" style="color: #00ff88; font-weight: 700;">0/0</span></p>
            <p id="tfGOMsg" style="color: #ff8a65; font-family: 'Courier New', monospace; font-size: 0.9em; margin: 12px 0; line-height: 1.6;"></p>
            <p id="tfGOAtt" style="color: #888; font-family: 'Courier New', monospace; font-size: 0.85em; margin-bottom: 15px;"></p>
            <button id="tfGOBtn" onclick="tfRetry()" style="padding: 14px 50px; font-size: 1.1em; background: linear-gradient(180deg,#00ff88,#00aa55); color: #000; border: 3px solid #fdd835; border-radius: 10px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace;">&#128260; REINTENTAR</button>
        </div>
        <div id="tfScrFin" style="display: none; text-align: center; padding: 30px 15px;">
            <div style="font-size: 3em;">&#127942;</div><h2 style="color: #fdd835; font-family: 'Courier New', monospace; font-size: 1.8em; text-shadow: 0 0 20px #fdd83555;">&#161;GRAN CARRERA!</h2>
            <p style="color: #00ff88; font-family: 'Courier New', monospace;">Mejor Puntuaci&oacute;n: <span id="tfFinSc" style="font-size: 1.3em; font-weight: 900; color: #fdd835;">0</span></p>
            <p style="color: #aaa; font-family: 'Courier New', monospace;">Preguntas: <span id="tfFinQ" style="color: #00ff88;">0/0</span></p>
            <button onclick="tfFinish()" style="padding: 14px 50px; margin-top: 15px; font-size: 1.1em; background: linear-gradient(180deg,#fdd835,#f9a825); color: #000; border: 3px solid #00ff88; border-radius: 10px; cursor: pointer; font-weight: 700; font-family: 'Courier New', monospace;">&#9654; CONTINUAR</button>
        </div>
    </div>
</div>


<div class="screen" id="session5QuizScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(255,152,0,0.08) 0%, rgba(255,183,77,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session5Screen')"> ‚Üê Volver a Sesi√≥n 5 </button>
        
        <div style="text-align: center; margin-bottom: 40px;">
            <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">üìù</div>
            <h2 style="color: #E65100; font-size: 2.5em;">Actividad en Nearpod</h2>
            <p style="font-size: 1.3em; color: #FF8F00; font-weight: 500;">¬°Demuestra todo lo que aprendiste!</p>
        </div>

        <!-- CONTENEDOR DE NEARPOD -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 50px; border-radius: 30px; margin: 30px 0; border: 5px solid #FF9800; text-align: center;">
            <div style="font-size: 4em; margin-bottom: 20px;">üéÆ</div>
            <h3 style="color: #E65100; font-size: 1.8em; margin-bottom: 20px;">¬°Es hora de la evaluaci√≥n!</h3>
            <p style="color: #BF360C; font-size: 1.2em; line-height: 1.8; margin-bottom: 30px;">
                El profesor compartir√° el c√≥digo de la actividad en Nearpod.<br>
                Prep√°rate para demostrar tus conocimientos sobre suma y resta de fracciones.
            </p>
            
            <!-- BOT√ìN NEARPOD -->
            <a id="nearpodLinkS5" href="https://nearpod.com/student/" target="_blank" style="display: inline-block; padding: 25px 60px; font-size: 1.5em; background: linear-gradient(135deg, #00BCD4, #0097A7); color: white; text-decoration: none; border-radius: 20px; font-weight: 700; box-shadow: 0 10px 30px rgba(0, 188, 212, 0.4); margin-bottom: 20px;">
                üöÄ Ir a Nearpod
            </a>
            
            <p style="color: #F57F17; font-size: 1em; font-style: italic; margin-top: 20px;">
                Ingresa el c√≥digo que el profesor te dar√° en clase
            </p>
        </div>

        <!-- INSTRUCCIONES -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 35px; border-radius: 25px; margin: 25px 0; border: 4px solid #2196F3;">
            <h3 style="color: #0D47A1; font-size: 1.5em; margin-bottom: 20px; text-align: center;">üìã Instrucciones</h3>
            <div style="display: grid; gap: 15px;">
                <div style="background: white; padding: 15px 20px; border-radius: 10px; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.5em;">1Ô∏è‚É£</span>
                    <p style="color: #1565C0; margin: 0; font-size: 1.1em;">Haz clic en "Ir a Nearpod"</p>
                </div>
                <div style="background: white; padding: 15px 20px; border-radius: 10px; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.5em;">2Ô∏è‚É£</span>
                    <p style="color: #1565C0; margin: 0; font-size: 1.1em;">Ingresa el c√≥digo que el profesor te dar√°</p>
                </div>
                <div style="background: white; padding: 15px 20px; border-radius: 10px; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.5em;">3Ô∏è‚É£</span>
                    <p style="color: #1565C0; margin: 0; font-size: 1.1em;">Escribe tu nombre real para identificarte</p>
                </div>
                <div style="background: white; padding: 15px 20px; border-radius: 10px; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.5em;">4Ô∏è‚É£</span>
                    <p style="color: #1565C0; margin: 0; font-size: 1.1em;">¬°Responde las preguntas y divi√©rtete!</p>
                </div>
            </div>
        </div>

        <!-- BOT√ìN COMPLETAR SESI√ìN -->
        <div style="text-align: center; margin-top: 40px;">
            <button onclick="completeSession5()" style="padding: 25px 60px; font-size: 1.5em; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 700; box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4);">
                üèÜ ¬°Completar Sesi√≥n 5!
            </button>
        </div>
    </div>
</div>


    <!-- ============================================== -->
<!-- SESI√ìN 6: FRACCIONES (III) - MULTIPLICACI√ìN, DIVISI√ìN Y JERARQU√çA -->
<!-- ============================================== -->

<div class="screen" id="session6Screen">
    <div class="content-screen" style="position: relative;">
        <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
        
        <!-- DECORACI√ìN DE FONDO -->
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden;">
            <span style="position: absolute; left: 8%; top: 15%; font-size: 3em; animation: floatMath 7s ease-in-out infinite; opacity: 0.15;">‚úñÔ∏è</span>
            <span style="position: absolute; right: 10%; top: 20%; font-size: 2.5em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s; opacity: 0.15;">‚ûó</span>
            <span style="position: absolute; left: 12%; bottom: 30%; font-size: 2.8em; animation: floatMath 9s ease-in-out infinite; animation-delay: 2s; opacity: 0.15;">üî¢</span>
            <span style="position: absolute; right: 12%; bottom: 25%; font-size: 2.2em; animation: floatMath 6s ease-in-out infinite; animation-delay: 0.5s; opacity: 0.15;">‚ö°</span>
        </div>
        
        <div style="text-align: center; margin-top: 30px; position: relative; z-index: 1;">
            <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">üèÜ</div>
            <h2 class="session-title-gradient" style="background: linear-gradient(135deg, #FF6B6B, #FF8E53, #FFA726); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 2.8em;">Sesi√≥n 6: Fracciones (III)</h2>
            <p style="font-size: 1.4em; color: #E64A19; font-weight: 600; text-shadow: 0 2px 10px rgba(230, 74, 25, 0.3);">üî• ¬°El Desaf√≠o Final de las Fracciones!</p>
        </div>

        <div class="content-grid-session1" style="position: relative; z-index: 1;">
            <div class="card-session objective-card" style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); border-left: 8px solid #FF6F00;">
                <h3 style="color: #E65100;">üéØ Objetivo de Sesi√≥n</h3>
                <p style="color: #BF360C;">Dominar la multiplicaci√≥n, divisi√≥n y jerarqu√≠a de operaciones combinadas con fracciones, aplicando correctamente las reglas y simplificando resultados para resolver expresiones complejas.</p>
            </div>
            <div class="card-session learning-card" style="background: linear-gradient(135deg, #FCE4EC, #F8BBD0); border-left: 8px solid #E91E63;">
                <h3 style="color: #880E4F;">üöÄ Ruta de Aprendizaje</h3>
                <ul class="learning-list">
                    <li class="learning-list-item" id="s6-theory1-btn" onclick="goToSession6Screen('session6Theory1Screen', 0)" style="background: linear-gradient(135deg, #FF9800, #F57C00);"><span>üìñ</span> Teor√≠a 1: Jerarqu√≠a con Fracciones y Enteros</li>
                    <li class="learning-list-item" id="s6-theory2-btn" onclick="goToSession6Screen('session6Theory2Screen', 1)" style="background: linear-gradient(135deg, #FF5722, #E64A19);"><span>üß†</span> Teor√≠a 2: Repaso Integral y Problemas Mixtos</li>
                    <li class="learning-list-item" id="s6-practice-btn" onclick="goToSession6Screen('session6PracticeScreen', 2)" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2);"><span>‚úèÔ∏è</span> Pr√°ctica: Ejercicios Mixtos</li>
                    <li class="learning-list-item" id="s6-game-btn" onclick="goToSession6Screen('session6GameScreen', 3)" style="background: linear-gradient(135deg, #F44336, #D32F2F);"><span>‚öîÔ∏è</span> Batalla Final: Reino de Numerus</li>
                </ul>
            </div>
        </div>

        <div class="session1-nav-grid" style="position: relative; z-index: 1;">
            <div class="session-nav-card session6-card" id="s6-nav-theory1" onclick="goToSession6Screen('session6Theory1Screen', 0)" style="background: linear-gradient(135deg, #FF9800, #F57C00); box-shadow: 0 10px 30px rgba(255, 152, 0, 0.4);">
                <div class="session-nav-card-icon">üìñ</div>
                <h4>1. Multiplicaci√≥n y Divisi√≥n</h4>
                <p style="font-size: 0.9em; margin-top: 8px;">Aprende a multiplicar y dividir fracciones</p>
            </div>
            <div class="session-nav-card session6-card" id="s6-nav-theory2" onclick="goToSession6Screen('session6Theory2Screen', 1)" style="background: linear-gradient(135deg, #FF5722, #E64A19); box-shadow: 0 10px 30px rgba(255, 87, 34, 0.4);">
                <div class="session-nav-card-icon">üß†</div>
                <h4>2. Jerarqu√≠a Completa</h4>
                <p style="font-size: 0.9em; margin-top: 8px;">Operaciones combinadas con fracciones</p>
            </div>
            <div class="session-nav-card session6-card" id="s6-nav-practice" onclick="goToSession6Screen('session6PracticeScreen', 2)" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); box-shadow: 0 10px 30px rgba(156, 39, 176, 0.4);">
                <div class="session-nav-card-icon">‚úèÔ∏è</div>
                <h4>3. Pr√°ctica Mixta</h4>
                <p style="font-size: 0.9em; margin-top: 8px;">7 ejercicios para dominar</p>
            </div>
            <div class="session-nav-card session6-card" id="s6-nav-game" onclick="goToSession6Screen('session6GameScreen', 3)" style="background: linear-gradient(135deg, #F44336, #D32F2F); box-shadow: 0 10px 30px rgba(244, 67, 54, 0.4);">
                <div class="session-nav-card-icon">‚öîÔ∏è</div>
                <h4>4. Batalla Final</h4>
                <p style="font-size: 0.9em; margin-top: 8px;">Derrota al Rey Numerus</p>
            </div>
        </div>
    </div>
</div>

<!-- ========== TEOR√çA 1: MULTIPLICACI√ìN Y DIVISI√ìN DE FRACCIONES ========== -->
<div class="screen" id="session6Theory1Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(255,87,34,0.05) 0%, rgba(244,67,54,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session6Screen')"> ‚Üê Volver a Sesi√≥n 6 </button>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">üèóÔ∏è</div>
            <h2 style="color: #BF360C; font-size: 2.2em; font-weight: 800;">Jerarqu√≠a de Operaciones con Fracciones</h2>
            <p style="color: #D84315; font-size: 1.15em;">El orden correcto para resolver expresiones complejas</p>
        </div>

        <!-- REGLAS DE JERARQU√çA -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.6em;">üìã Orden de las Operaciones</h3>
            <div style="background: white; padding: 25px; border-radius: 15px; margin: 18px 0; border: 3px solid #FF9800;">
                <div style="display: grid; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: #FFEBEE; border-radius: 12px; border-left: 5px solid #F44336;">
                        <span style="font-size: 2em; font-weight: 900; color: #C62828;">1¬∞</span>
                        <div><p style="color: #C62828; font-weight: 700; font-size: 1.1em;">Par√©ntesis y corchetes</p><p style="color: #666; font-size: 0.9em;">( ), [ ], { } ‚Üí de adentro hacia afuera</p></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: #F3E5F5; border-radius: 12px; border-left: 5px solid #9C27B0;">
                        <span style="font-size: 2em; font-weight: 900; color: #6A1B9A;">2¬∞</span>
                        <div><p style="color: #6A1B9A; font-weight: 700; font-size: 1.1em;">Potencias y ra√≠ces</p><p style="color: #666; font-size: 0.9em;">(1/2)¬≤, ‚àö(1/4), etc.</p></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: #E3F2FD; border-radius: 12px; border-left: 5px solid #2196F3;">
                        <span style="font-size: 2em; font-weight: 900; color: #1565C0;">3¬∞</span>
                        <div><p style="color: #1565C0; font-weight: 700; font-size: 1.1em;">Multiplicaci√≥n y Divisi√≥n</p><p style="color: #666; font-size: 0.9em;">De izquierda a derecha</p></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: #E8F5E9; border-radius: 12px; border-left: 5px solid #4CAF50;">
                        <span style="font-size: 2em; font-weight: 900; color: #2E7D32;">4¬∞</span>
                        <div><p style="color: #2E7D32; font-weight: 700; font-size: 1.1em;">Suma y Resta</p><p style="color: #666; font-size: 0.9em;">De izquierda a derecha</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- EJEMPLOS COMPLETOS -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.6em;">üìù Ejemplos Paso a Paso</h3>

            <div style="background: white; padding: 22px; border-radius: 15px; margin: 15px 0; border: 2px solid #2196F3;">
                <p style="color: #1565C0; font-weight: 700; font-size: 1.2em;">Ejemplo 1: (1/2 + 1/3) √ó 3/5</p>
                <p style="color: #333; line-height: 2.2; margin-top: 8px;">
                    <strong>1¬∞</strong> Par√©ntesis: 1/2 + 1/3 = 3/6 + 2/6 = 5/6<br>
                    <strong>2¬∞</strong> Multiplicar: 5/6 √ó 3/5 = 15/30 = <strong style="color: #2E7D32; font-size: 1.2em;">1/2</strong>
                </p>
            </div>

            <div style="background: white; padding: 22px; border-radius: 15px; margin: 15px 0; border: 2px solid #FF9800;">
                <p style="color: #E65100; font-weight: 700; font-size: 1.2em;">Ejemplo 2: 2/3 + (3/4 ‚àí 1/2) √ó 4/3</p>
                <p style="color: #333; line-height: 2.2; margin-top: 8px;">
                    <strong>1¬∞</strong> Par√©ntesis: 3/4 ‚àí 1/2 = 3/4 ‚àí 2/4 = 1/4<br>
                    <strong>2¬∞</strong> Multiplicar: 1/4 √ó 4/3 = 4/12 = 1/3<br>
                    <strong>3¬∞</strong> Sumar: 2/3 + 1/3 = <strong style="color: #2E7D32; font-size: 1.2em;">1</strong>
                </p>
            </div>

            <div style="background: white; padding: 22px; border-radius: 15px; margin: 15px 0; border: 2px solid #F44336;">
                <p style="color: #C62828; font-weight: 700; font-size: 1.2em;">Ejemplo 3: [1/2 ‚àí (1/3 + 1/6)] √∑ 1/4 + 2</p>
                <p style="color: #333; line-height: 2.2; margin-top: 8px;">
                    <strong>1¬∞</strong> Par√©ntesis interno: 1/3 + 1/6 = 2/6 + 1/6 = 3/6 = 1/2<br>
                    <strong>2¬∞</strong> Corchete: 1/2 ‚àí 1/2 = 0<br>
                    <strong>3¬∞</strong> Divisi√≥n: 0 √∑ 1/4 = 0<br>
                    <strong>4¬∞</strong> Sumar: 0 + 2 = <strong style="color: #2E7D32; font-size: 1.2em;">2</strong>
                </p>
            </div>

            <div style="background: white; padding: 22px; border-radius: 15px; margin: 15px 0; border: 2px solid #9C27B0;">
                <p style="color: #6A1B9A; font-weight: 700; font-size: 1.2em;">Ejemplo 4 (con enteros): 3 ‚àí (‚àí2/3) √ó 9/4 + 1/2</p>
                <p style="color: #333; line-height: 2.2; margin-top: 8px;">
                    <strong>1¬∞</strong> Multiplicar: (‚àí2/3) √ó 9/4 = ‚àí18/12 = ‚àí3/2<br>
                    <strong>2¬∞</strong> Reemplazar: 3 ‚àí (‚àí3/2) + 1/2 = 3 + 3/2 + 1/2<br>
                    <strong>3¬∞</strong> Sumar: 6/2 + 3/2 + 1/2 = <strong style="color: #2E7D32; font-size: 1.2em;">10/2 = 5</strong>
                </p>
            </div>
        </div>

        <!-- ERRORES COMUNES -->
        <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 25px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #F44336;">
            <h3 style="color: #C62828; font-size: 1.4em;">‚ö†Ô∏è Errores Comunes</h3>
            <div style="display: grid; gap: 12px; margin-top: 12px;">
                <div style="background: white; padding: 15px; border-radius: 12px;">
                    <p style="color: #C62828; font-weight: 700;">‚ùå Sumar antes de multiplicar</p>
                    <p style="color: #333;">En 1/2 + 1/3 √ó 3 ‚Üí NO hacer (1/2+1/3)√ó3. Se hace: 1/2 + (1/3√ó3) = 1/2 + 1 = 3/2</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px;">
                    <p style="color: #C62828; font-weight: 700;">‚ùå Olvidar signos al distribuir</p>
                    <p style="color: #333;">‚àí(1/2 ‚àí 1/3) = ‚àí1/2 + 1/3 (el signo negativo cambia los signos internos)</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px;">
                    <p style="color: #C62828; font-weight: 700;">‚ùå Mezclar enteros y fracciones sin convertir</p>
                    <p style="color: #333;">3 + 1/2 ‚Üí Convertir: 3 = 6/2, entonces 6/2 + 1/2 = 7/2</p>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeS6Theory1();" style="background: linear-gradient(135deg, #FF9800, #F57C00); font-size: 1.4em; padding: 20px 50px;">
                Siguiente: Repaso Integral ‚Üí
            </button>
        </div>
    </div>
</div>

<!-- ========== TEOR√çA 2: JERARQU√çA DE OPERACIONES CON FRACCIONES ========== -->
<div class="screen" id="session6Theory2Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(244,67,54,0.05) 0%, rgba(211,47,47,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session6Screen')"> ‚Üê Volver a Sesi√≥n 6 </button>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 4em;">üìñ</div>
            <h2 style="color: #C62828; font-size: 2.2em; font-weight: 800;">Repaso Integral</h2>
            <p style="color: #D32F2F; font-size: 1.15em;">Todo lo aprendido sobre enteros y fracciones</p>
        </div>

        <!-- MAPA MENTAL -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #FF9800;">
            <h3 style="color: #E65100; font-size: 1.6em;">üó∫Ô∏è Mapa de Contenidos</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 18px;">
                <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 20px; border-radius: 15px; border: 2px solid #2196F3;">
                    <h4 style="color: #1565C0; margin-bottom: 8px;">üìò N√∫meros Enteros</h4>
                    <p style="color: #333; line-height: 1.8; font-size: 0.95em;">Suma y resta (recta num√©rica), multiplicaci√≥n y divisi√≥n (regla de signos), jerarqu√≠a de operaciones con enteros.</p>
                </div>
                <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 20px; border-radius: 15px; border: 2px solid #4CAF50;">
                    <h4 style="color: #2E7D32; margin-bottom: 8px;">üìó Fracciones B√°sicas</h4>
                    <p style="color: #333; line-height: 1.8; font-size: 0.95em;">Simplificaci√≥n (MCD), amplificaci√≥n, suma y resta (mismo y distinto denominador), multiplicaci√≥n y divisi√≥n.</p>
                </div>
                <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 20px; border-radius: 15px; border: 2px solid #9C27B0;">
                    <h4 style="color: #6A1B9A; margin-bottom: 8px;">üìï Fracciones Avanzadas</h4>
                    <p style="color: #333; line-height: 1.8; font-size: 0.95em;">Operaciones con 3+ t√©rminos, MCM, operaciones combinadas, jerarqu√≠a completa con par√©ntesis.</p>
                </div>
            </div>
        </div>

        <!-- RESUMEN F√ìRMULAS -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #2196F3;">
            <h3 style="color: #1565C0; font-size: 1.6em;">üìê F√≥rmulas Clave</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #4CAF50;">
                    <p style="color: #2E7D32; font-weight: 700;">Suma/Resta</p>
                    <p style="color: #333; font-size: 1.15em; font-weight: 700;">a/c ¬± b/c = (a¬±b)/c</p>
                    <p style="color: #888; font-size: 0.85em;">Mismo denominador</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #FF9800;">
                    <p style="color: #E65100; font-weight: 700;">Distinto denominador</p>
                    <p style="color: #333; font-size: 1.05em; font-weight: 700;">Buscar MCM ‚Üí amplificar ‚Üí operar</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #2196F3;">
                    <p style="color: #1565C0; font-weight: 700;">Multiplicaci√≥n</p>
                    <p style="color: #333; font-size: 1.15em; font-weight: 700;">a/b √ó c/d = ac/bd</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #9C27B0;">
                    <p style="color: #6A1B9A; font-weight: 700;">Divisi√≥n</p>
                    <p style="color: #333; font-size: 1.15em; font-weight: 700;">a/b √∑ c/d = a/b √ó d/c</p>
                </div>
            </div>
        </div>

        <!-- PROBLEMAS DE REPASO -->
        <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 30px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #F44336;">
            <h3 style="color: #C62828; font-size: 1.6em;">üî• Problemas de Repaso Final</h3>
            <p style="color: #880E4F; margin-bottom: 15px;">Resuelve estos problemas que combinan TODO lo aprendido:</p>
            <div style="display: grid; gap: 15px;">
                <div style="background: white; padding: 18px; border-radius: 12px; border-left: 4px solid #F44336;">
                    <p style="color: #333; font-weight: 700; font-size: 1.1em;">1. (‚àí3) √ó (1/2 ‚àí 2/3) + 5/6</p>
                    <p style="color: #888; font-size: 0.85em;">Combina enteros, fracciones y jerarqu√≠a</p>
                </div>
                <div style="background: white; padding: 18px; border-radius: 12px; border-left: 4px solid #F44336;">
                    <p style="color: #333; font-weight: 700; font-size: 1.1em;">2. [2/3 + (‚àí1/4)] √ó 8 ‚àí 1/3</p>
                    <p style="color: #888; font-size: 0.85em;">Corchetes, multiplicaci√≥n por entero, suma</p>
                </div>
                <div style="background: white; padding: 18px; border-radius: 12px; border-left: 4px solid #F44336;">
                    <p style="color: #333; font-weight: 700; font-size: 1.1em;">3. 1/2 √∑ (1/3 ‚àí 1/6) √ó 2/5 + 1</p>
                    <p style="color: #888; font-size: 0.85em;">Par√©ntesis, divisi√≥n, multiplicaci√≥n, suma</p>
                </div>
                <div style="background: white; padding: 18px; border-radius: 12px; border-left: 4px solid #F44336;">
                    <p style="color: #333; font-weight: 700; font-size: 1.1em;">4. ‚àí2 + [(3/4 √ó 8/3) ‚àí (1/2 √∑ 1/4)] + 5/2</p>
                    <p style="color: #888; font-size: 0.85em;">Corchetes con operaciones mixtas + enteros</p>
                </div>
                <div style="background: white; padding: 18px; border-radius: 12px; border-left: 4px solid #F44336;">
                    <p style="color: #333; font-weight: 700; font-size: 1.1em;">5. {1/2 √ó [3/4 + (1/3 ‚àí 1/12)]} √∑ 1/2</p>
                    <p style="color: #888; font-size: 0.85em;">Llaves, corchetes y par√©ntesis anidados</p>
                </div>
            </div>
        </div>

        <!-- TIPS PARA EL EXAMEN -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 25px; border-radius: 25px; margin: 25px 0; border-left: 8px solid #4CAF50;">
            <h3 style="color: #2E7D32; font-size: 1.4em;">üí° Tips para la Batalla Final (Numerus)</h3>
            <div style="display: grid; gap: 10px; margin-top: 12px;">
                <p style="color: #333; line-height: 1.7;">‚úÖ Siempre resuelve par√©ntesis de adentro hacia afuera.</p>
                <p style="color: #333; line-height: 1.7;">‚úÖ Cuida los signos: anota el signo de cada t√©rmino.</p>
                <p style="color: #333; line-height: 1.7;">‚úÖ Simplifica al final (o durante, con simplificaci√≥n cruzada).</p>
                <p style="color: #333; line-height: 1.7;">‚úÖ Convierte enteros a fracci√≥n cuando los mezcles con fracciones (ej: 3 = 3/1).</p>
                <p style="color: #333; line-height: 1.7;">‚úÖ Revisa tu respuesta sustituyendo valores si es posible.</p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="back-button" onclick="completeS6Theory2();" style="background: linear-gradient(135deg, #FF5722, #E64A19); font-size: 1.4em; padding: 20px 50px;">
                Siguiente: Pr√°ctica ‚Üí
            </button>
        </div>
    </div>
</div>

<script>
        // === DATOS DE JUEGO ===
        let completedSections = JSON.parse(localStorage.getItem('completedSections')) || [];
        const TOTAL_SECTIONS = 6;
// === NUEVO: Progreso interno de sub-retos (activityProgress) ===
// Estructura: { sesion1: 5, sesion2: 2, ... }
let activityProgress = JSON.parse(localStorage.getItem('activityProgress')) || {
    sesion1: 0, 
    sesion2: 0,
    sesion3: 0,
    sesion4: 0,
    sesion5: 0,
    sesion6: 0
};


       // N√∫meros para el juego de Drag & Drop
    const DRAG_NUMBERS = ['+5', '-12', '0', '+25', '-8', '-1', '+1', '-50', '+100', '-3', '+4', '-9', '6', '-7', '15',
                            '‚àö9', '-6/3', '4.0', '7.00', '8/4', '-3/1', // Enteros
                            '‚àö2', '1/2', '-3/4', '0.5', '4.75', '-2.5','-5.485784']; // No Enteros
    const CORRECT_DRAG_COUNT = DRAG_NUMBERS.length;
        let correctDrops = 0;
        
        // =================================================
        // === EFECTOS VISUALES Y ANIMACIONES ===
        // =================================================

        // === CREAR ESTRELLAS QUE CAEN (Aumentado a 40) ===
        function createStars() {
            const starsContainer = document.getElementById('stars-container');
            const starEmojis = ['‚≠ê', '‚ú®', 'üåü', '‚òÑÔ∏è'];
            const isMobile = window.innerWidth <= 768;
            const starCount = isMobile ? 20 : 40;

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = starEmojis[Math.floor(Math.random() * starEmojis.length)];
                
                // Posici√≥n inicial aleatoria
                star.style.left = Math.random() * 100 + '%';
                star.style.top = -100 + 'px'; // Inicia fuera de la vista
                
                // Propiedades de la animaci√≥n
                star.style.animationDuration = (5 + Math.random() * 5) + 's';
                star.style.animationDelay = (Math.random() * 10) + 's';
                star.style.fontSize = (15 + Math.random() * 15) + 'px';
                starsContainer.appendChild(star);
                
                // Remover despu√©s de la duraci√≥n de la animaci√≥n
                setTimeout(() => star.remove(), 10000); 
            }
        }

        // === CREAR PART√çCULAS FLOTANTES (Aumentado a 60) ===
        function createParticles() {
            const particles = document.getElementById('particles');
            const isMobile = window.innerWidth <= 768;
            const particleCount = isMobile ? 30 : 60;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 15) + 's';
                particles.appendChild(particle);
            }
        }

        // === REGLA 2: GENERAR S√çMBOLOS MATEM√ÅTICOS FLOTANTES ===
        function createMathSymbols() {
            const wrapper = document.getElementById('mathSymbolsWrapper');
            if (!wrapper) return; // Asegurar que el contenedor existe
            
            const symbols = ['‚àë', '‚àö', 'œÄ', '‚àû', 'Œî', 'Œ∏', '√ó', '√∑', '‚à´', '‚â†'];
            const numSymbols = symbols.length;

            for (let i = 0; i < numSymbols; i++) {
                const symbol = document.createElement('span');
                symbol.className = 'math-symbol';
                symbol.textContent = symbols[i];
                
                // Posicionamiento alrededor del control (relativo al logo-container)
                const angle = (i / numSymbols) * 2 * Math.PI;
                const radius = 120; // Distancia desde el centro del logo
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                
                symbol.style.left = `calc(50% + ${x}px)`;
                symbol.style.top = `calc(50% + ${y}px)`;
                
                // Animaci√≥n personalizada
                symbol.style.animationDelay = (i * 0.8) + 's';
                symbol.style.animationDuration = (7 + Math.random() * 3) + 's'; // Variaci√≥n de 7s a 10s
                symbol.style.transform = `translate(-50%, -50%)`;
                symbol.style.fontSize = (1.5 + Math.random() * 1) + 'em'; // Tama√±os variados (1.5em a 2.5em)
                
                wrapper.appendChild(symbol);
            }
        }

        // === CREAR CONFETI AL COMPLETAR SESI√ìN ===
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#00f2fe', '#FFD700', '#FF69B4'];
            const isMobile = window.innerWidth <= 768;
            const confettiCount = isMobile ? 30 : 50;

            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }


        // =================================================
        // === L√ìGICA DE NAVEGACI√ìN Y PROGRESO ===
        // =================================================

       // === CAMBIAR DE PANTALLA ===
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');

    // Scroll al inicio
    window.scrollTo({ top: 0, behavior: 'smooth' });

    // Mostrar badge de progreso solo en pantalla de secciones
    if (screenId === 'sectionsScreen') {
        document.getElementById('progressBadge').style.display = 'block';
        updateProgress();
    } else {
        document.getElementById('progressBadge').style.display = 'none';
    }

   // Inicializar el juego de Drag & Drop si se entra a esa pantalla
    if (screenId === 'session1DragScreen') {
        initDragGame();
    }

    // === NUEVO: Actualizar estado de los sub-retos al entrar a una sesi√≥n ===
    if (screenId.includes('session1')) {
        updateSession1Nav();
    }
    if (screenId.includes('session2')) {
        updateSession2Nav();
    }
    if (screenId.includes('session3')) {
        updateSession3Nav();
    }
    if (screenId === 'session4Screen') {
        updateSession4LockState();
    }
    // =====================================================================
}
// === NUEVO: L√ìGICA DE BLOQUEO INTERNO PARA SESI√ìN 1 ===
// [nombre de la pantalla de sub-reto] : [√≠ndice del sub-reto]
const session1Map = {
    'session1TheoryScreen': 1,
    'session1DragScreen': 2,
    'session1ChallengeScreen': 3,
    'session1OperationsScreen': 4,
    'session1QuizScreen': 5 
};

function updateSession1Nav() {
    const currentProgress = activityProgress.sesion1;
    
    // Tarjetas de navegaci√≥n del fondo (session1-nav-grid)
    document.querySelectorAll('#session1Screen .session-nav-card').forEach(card => {
        const targetScreen = card.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session1Map[targetScreen]; // El n√∫mero de reto (1, 2, 3...)
        
        // Bloqueo: El reto debe ser igual o menor que el progreso actual + 1
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        card.classList.remove('locked', 'unlocked');
        card.onclick = null; // Quitar el onclick original para reasignar la l√≥gica

        if (isCompleted) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
         let h4 = card.querySelector('h4');
            h4.textContent = h4.textContent.replace(' ‚úÖ', ''); // ‚¨ÖÔ∏è LIMPIA (QUITA) el chulo existente
            h4.textContent += ' ‚úÖ';                               // ‚¨ÖÔ∏è AGREGA (PONE) un √∫nico chulo
            // ==================================================

        } else if (isAvailable) {
            card.classList.add('unlocked'); // Usamos 'unlocked' para que no tenga el efecto de bloqueo visual
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
    
    // Actualizar tambi√©n la lista de la ruta de aprendizaje
    document.querySelectorAll('#session1Screen .learning-list-item').forEach(item => {
        const targetScreen = item.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session1Map[targetScreen];
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
}

// === L√ìGICA DE BLOQUEO INTERNO PARA SESI√ìN 2 ===
const session2Map = {
    'session2TheoryScreen': 1,
    'session2HierarchyScreen': 2,
    'session2GameClassScreen': 3,
    'session2ArcadeScreen': 4,
    'session2PracticeScreen': 5 
};

function updateSession2Nav() {
    const currentProgress = activityProgress.sesion2;
    
    // Tarjetas de navegaci√≥n del fondo (session1-nav-grid)
    document.querySelectorAll('#session2Screen .session-nav-card').forEach(card => {
        const targetScreen = card.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session2Map[targetScreen];
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        card.classList.remove('locked', 'unlocked');
        card.onclick = null; // Quitar el onclick original para reasignar la l√≥gica

        if (isCompleted) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
            
// üõë C√ìDIGO CORREGIDO PARA EVITAR CHULOS DUPLICADOS üõë
            let h4 = card.querySelector('h4');
            h4.textContent = h4.textContent.replace(' ‚úÖ', ''); // ‚¨ÖÔ∏è LIMPIA (QUITA) el chulo existente
            h4.textContent += ' ‚úÖ';                               // ‚¨ÖÔ∏è AGREGA (PONE) un √∫nico chulo
            // ==================================================
        


        } else if (isAvailable) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
    
    // Actualizar tambi√©n la lista de la ruta de aprendizaje
    document.querySelectorAll('#session2Screen .learning-list-item').forEach(item => {
        const targetScreen = item.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session2Map[targetScreen];
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
}

// === NUEVO: MARCADOR GENERAL DE SUB-RETO COMPLETADO ===
function completeSubActivity(sessionNum, activityIndex) {
    const sessionKey = `sesion${sessionNum}`;
    
    // Solo actualiza si el √≠ndice que se intenta completar es mayor al progreso actual
    if (activityProgress[sessionKey] < activityIndex) {
        activityProgress[sessionKey] = activityIndex;
        localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
        console.log(`‚úÖ Actividad ${activityIndex} de Sesi√≥n ${sessionNum} marcada como completada.`);
        
        // Recarga el estado de navegaci√≥n para reflejar el desbloqueo
        if (sessionNum === 1) updateSession1Nav();
        if (sessionNum === 2) updateSession2Nav();
        if (sessionNum === 3) updateSession3LockState();
        if (sessionNum === 4) updateSession4LockState();
    }
}
        // === ACTUALIZAR PROGRESO ===
        function updateProgress() {
            const total = TOTAL_SECTIONS;
            const completed = completedSections.length;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('progressText').textContent = `${completed}/${total} Completadas (${percentage}%)`;
            document.getElementById('progressBarFill').style.width = `${percentage}%`;

            // === BLOQUE DE C√ìDIGO ACTUALIZADO PARA updateProgress() ===

            // Actualizar estado visual de las tarjetas de sesi√≥n
            document.querySelectorAll('.section-card').forEach(card => {
                const sectionNum = parseInt(card.dataset.section);
                const isCompleted = completedSections.includes(sectionNum);
                const isAvailable = sectionNum === 1 || completedSections.includes(sectionNum - 1);
                const statusDiv = card.querySelector('.section-status'); // Contenedor del estado completo
                const titleDiv = card.querySelector('.section-title');
                const lockIcon = card.querySelector('.lock-icon');

                card.classList.remove('locked', 'unlocked');
                card.onclick = null;
                titleDiv.style.opacity = 1;

                if (isCompleted) {
                    card.classList.add('unlocked');
                    // Reemplazamos el HTML del status para que diga COMPLETADA
                    statusDiv.innerHTML = '<span style="color: #2ecc71;">‚úÖ</span> Completada';
                    statusDiv.style.color = '#2ecc71'; 
                    lockIcon && lockIcon.remove();
                    card.onclick = () => enterSection(sectionNum);
                } else if (isAvailable) {
                    // Reemplazamos el HTML del status para que diga DISPONIBLE
                    statusDiv.innerHTML = '<span style="color: #FFD700;">‚óè</span> Disponible - ¬°Comienza ahora!';
                    statusDiv.style.color = '#FFD700';
                    lockIcon && lockIcon.remove();
                    card.onclick = () => enterSection(sectionNum);
                } else {
                    card.classList.add('locked');
                    // Reemplazamos el HTML del status para que diga BLOQUEADA
                    statusDiv.innerHTML = '<span style="color: #e74c3c;">üîí</span> Bloqueada - Completa la sesi√≥n anterior.';
                    statusDiv.style.color = '#e74c3c';
                    if (!lockIcon) { 
                        const newLock = document.createElement('div');
                        newLock.className = 'lock-icon';
                        newLock.textContent = 'üîí';
                        card.appendChild(newLock);
                    }
                }
            });


// üëá AGREGA ESTO AQU√ç üëá



// Actualizar estado del Postest
            const postestCard = document.getElementById('postestCard');
            if (postestCard) {
                if (completedSections.length === TOTAL_SECTIONS) {
                    postestCard.classList.remove('postest-locked');
                    postestCard.querySelector('.card-description').textContent = '‚úÖ ¬°Todas las sesiones completadas! Realiza tu evaluaci√≥n final.';
                } else {
                    postestCard.classList.add('postest-locked');
                    const remaining = TOTAL_SECTIONS - completedSections.length;
                    if (remaining === TOTAL_SECTIONS) {
                        // Si no ha completado ninguna sesi√≥n
                        postestCard.querySelector('.card-description').textContent = `üîí Bloqueado - Completa las ${TOTAL_SECTIONS} sesiones para desbloquear.`;
                    } else if (remaining === 1) {
                        // Si falta solo 1 sesi√≥n
                        postestCard.querySelector('.card-description').textContent = 'üîí Bloqueado - Completa la √∫ltima sesi√≥n para desbloquear.';
                    } else {
                        // Si faltan 2 o m√°s sesiones
                        postestCard.querySelector('.card-description').textContent = `üîí Bloqueado - Completa las ${remaining} sesiones restantes.`;
                    }
                }
            }  }

      // === ENTRAR A SESI√ìN (Corregido) ===
function enterSection(sectionNum) {
    // Sesi√≥n 1
    if (sectionNum === 1) {
        showScreen('session1Screen');
        return;
    }
    
    // Sesi√≥n 2
    if (sectionNum === 2) {
        showScreen('session2Screen');
        return;
    }
    
    // Sesi√≥n 3
    if (sectionNum === 3) {
        showScreen('session3Screen');
        return;
    }
    
    // Sesi√≥n 4
    if (sectionNum === 4) {
        showScreen('session4Screen');
        return;
    }
    
    // Si la sesi√≥n est√° completada, permitir entrar
    if (completedSections.includes(sectionNum)) {
        showScreen(`session${sectionNum}Screen`); 
        return;
    }

    // Comportamiento por defecto para sesiones 5 y 6 (a√∫n no implementadas)
// Sesi√≥n 5
    if (sectionNum === 5) {
        showScreen('session5Screen');
        return;
    }
    alert(`¬°Entrando a la Sesi√≥n ${sectionNum}! ‚ú®\n\n(Esta sesi√≥n estar√° disponible pr√≥ximamente.)`);

    // Simulaci√≥n de completado para testear
    if (confirm('¬øMarcar esta sesi√≥n como completada? üéâ')) {
        if (!completedSections.includes(sectionNum)) {
            completedSections.push(sectionNum);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            createConfetti();
            updateProgress();
        }
    }
}


        // =================================================
        // === L√ìGICA DEL DRAG & DROP ===
        // =================================================

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initDragGame() {
            const pool = document.getElementById('dragPool');
            pool.innerHTML = '';
            correctDrops = 0;
            document.getElementById('completionMessage').style.display = 'none';

            // Mezclar y crear tokens
            const shuffledNumbers = shuffleArray([...DRAG_NUMBERS]);
            shuffledNumbers.forEach(num => {
                const token = document.createElement('div');
                token.className = 'token';
                token.textContent = num;
                token.id = 'token-' + num;
                token.draggable = true;
                token.setAttribute('data-value', num);
                token.addEventListener('dragstart', dragStart);
                pool.appendChild(token);
            });

            // Restablecer dropzones
            document.getElementById('dropPositivos').innerHTML = '<h3>Enteros Positivos (‚Ñ§‚Å∫)</h3><p style="color: #27ae60; font-weight: 700;">(N√∫meros mayores que 0)</p>';
            document.getElementById('dropNegativos').innerHTML = '<h3>Enteros Negativos (‚Ñ§‚Åª)</h3><p style="color: #e74c3c; font-weight: 700;">(N√∫meros menores que 0)</p>';
            document.getElementById('dropPositivos').classList.remove('drag-over', 'correct-zone');
            document.getElementById('dropNegativos').classList.remove('drag-over', 'correct-zone');
        }

        function dragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.id);
            setTimeout(() => {
                event.target.classList.add('dragging');
            }, 0);
        }

        function dragOver(event) {
            event.preventDefault();
            const dropzone = event.target.closest('.dropzone');
            if (dropzone) {
                dropzone.classList.add('drag-over');
            }
        }

        function dragLeave(event) {
            const dropzone = event.target.closest('.dropzone');
            if (dropzone) {
                dropzone.classList.remove('drag-over');
            }
        }
// === CONSTANTES PARA CLASIFICACI√ìN DE N√öMEROS ===
const PI_SYMBOL = 'œÄ';
// Identifica cualquier patr√≥n que termine en '...' como peri√≥dico/no peri√≥dico
const RE_PERIODIC_DECIMAL = /^\-?\d+(\.\d+\.\.\.)$/; 
const RE_PI = /œÄ/;
// =================================================

// Helper para evaluar si un token (expresi√≥n) resulta en un n√∫mero entero
function isTokenInteger(tokenText) {
    const text = tokenText.replace(/\s/g, '');

    // 1. **NUEVO BLOQUE DE RECHAZO:** Si es Pi, Decimal Peri√≥dico, o la ra√≠z de 2, NO es entero.
    if (RE_PI.test(text) || RE_PERIODIC_DECIMAL.test(text) || text === '‚àö2') {
        return false;
    }

    // 2. Ra√≠z Cuadrada (e.g., ‚àö9, ‚àö2)
    const sqrtMatch = text.match(/‚àö(\-?\d+(\.\d+)?)/);
    if (sqrtMatch) {
        const number = parseFloat(sqrtMatch[1]);
        if (number < 0) return false;
        const sqrtResult = Math.sqrt(number);
        return Number.isInteger(sqrtResult);
    }

    // 3. Fracci√≥n (e.g., -6/3, 1/2)
    const fractionMatch = text.match(/^(-?\d+)\/(-?\d+)$/);
    if (fractionMatch) {
        const numerator = parseInt(fractionMatch[1]);
        const denominator = parseInt(fractionMatch[2]);
        if (denominator === 0) return false;
        const divisionResult = numerator / denominator;
        return Number.isInteger(divisionResult);
    }

    // 4. Decimal/Entero Simple
    const numberValue = parseFloat(text);
    // Maneja NaN (ej: texto no num√©rico) y verifica si es un entero exacto
    return !isNaN(numberValue) && Number.isInteger(numberValue);
}

// Helper para calcular el valor num√©rico para la verificaci√≥n de signo
function getTokenValue(tokenText) {
    const text = tokenText.replace(/\s/g, '');
    const sqrtMatch = text.match(/‚àö(\-?\d+(\.\d+)?)/);
    const fractionMatch = text.match(/^(-?\d+)\/(-?\d+)$/);

    // [NUEVO] Si es Pi
    if (RE_PI.test(text)) return Math.PI; 
    
    if (sqrtMatch) return Math.sqrt(parseFloat(sqrtMatch[1]));
    if (fractionMatch) return parseInt(fractionMatch[1]) / parseInt(fractionMatch[2]);
    
    // [NUEVO] Para decimales que terminan en '...'
    const periodicMatch = text.match(RE_PERIODIC_DECIMAL);
    if (periodicMatch) {
        return parseFloat(text.replace('...', '')); 
    }
    
    return parseFloat(text);
}

function drop(event) {
    event.preventDefault();
    const data = event.dataTransfer.getData('text/plain');
    const token = document.getElementById(data);
    const dropzone = event.target.closest('.dropzone');

    if (!dropzone) return;

    dropzone.classList.remove('drag-over');

    const tokenValueText = token.getAttribute('data-value');
    
    // Paso 1: Usar los helpers para evaluar el valor real y el tipo
    const tokenValue = getTokenValue(tokenValueText);
    const isInteger = isTokenInteger(tokenValueText);

    let isCorrect = false;
    const targetId = dropzone.id;

    // L√≥gica de Clasificaci√≥n ESTRICTA
    if (targetId === 'dropPositivos') {
        // Correcto si: Es Entero Y Positivo
        if (isInteger && tokenValue > 0) {
            isCorrect = true;
        }
    } else if (targetId === 'dropNegativos') {
        // Correcto si: Es Entero Y Negativo
        if (isInteger && tokenValue < 0) {
            isCorrect = true;
        }
    } else if (targetId === 'dropNoEnteros') {
        // Correcto si: NO es Entero
        if (!isInteger) {
            isCorrect = true;
        }
    } else {
        // Bloquear drop en zonas que no son dropzone
        return;
    }

    // L√≥gica de movimiento y puntuaci√≥n
    if (isCorrect) {
        if (token.parentNode !== dropzone) { // Solo contar si se mueve a una nueva zona
            if (token.parentNode.id !== 'dragPool') {
                // Si viene de otra dropzone, lo devolvemos al pool para evitar errores
                document.getElementById('dragPool').appendChild(token);
                // El contador de correctas se ajustar√° al devolverlo al pool y luego contarlo.
            }
            
            // Proceso de movimiento final
            dropzone.appendChild(token);
            token.classList.add('correct');
            token.setAttribute('draggable', 'false');
            
            // Conteo de aciertos
            correctDrops++;
            
            // Animaci√≥n y mensaje
            showCorrectFeedback(dropzone);
            
            if (correctDrops === totalTokens) {
                showCompletionMessage();
            }
        }
    } else {
        // Si es incorrecto, lo devuelve al dragPool
        showErrorFeedback(dropzone);
        document.getElementById('dragPool').appendChild(token);
        token.classList.remove('correct');
        token.setAttribute('draggable', 'true');
    }
    
    token.classList.remove('dragging');
}

        function checkDragCompletion() {
            const message = document.getElementById('completionMessage');

            if (correctDrops >= CORRECT_DRAG_COUNT) {
                // Mensaje de finalizaci√≥n con 150 puntos
                message.innerHTML = 'üéâ <strong>¬°Clasificaci√≥n completada!</strong> Puntos obtenidos: 150. Tus puntos se acumulan en la Misi√≥n Z.';
                message.style.display = 'block';
                createConfetti();
            }
        }

        // CSS Keyframe para la vibraci√≥n (A√±adido din√°micamente)
        const style = document.createElement('style');
        style.type = 'text/css';
        style.innerHTML += '@keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }';
        document.getElementsByTagName('head')[0].appendChild(style);

        // =================================================
        // === L√ìGICA DEL QUIZ ===
        // =================================================
        function submitQuiz(sectionNum) {
            const inputs = document.querySelectorAll('#session1QuizScreen .quiz-input');
            const resultList = document.getElementById('resultList');
            const resultsDiv = document.getElementById('quizResults');
            let correctCount = 0;
            let totalQuestions = 0;

            resultList.innerHTML = '';
            
            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim();
                // Normaliza la respuesta correcta (ej: elimina el '+' de '+10')
                const correctAnswer = input.getAttribute('data-correct').trim();
                const questionNumber = index + 1;
                
                // Normaliza la respuesta del usuario para coincidir con la data-correct
                const normalizedUserAnswer = userAnswer.startsWith('+') ? userAnswer.substring(1) : userAnswer;
                
                const isCorrect = normalizedUserAnswer === correctAnswer;

                if (isCorrect) {
                    correctCount++;
                    resultList.innerHTML += `<li class="correct-text">Pregunta ${questionNumber}: Correcto (Respuesta: ${correctAnswer})</li>`;
                    input.style.border = '2px solid #2ecc71';
                } else {
                    resultList.innerHTML += `<li class="incorrect-text">Pregunta ${questionNumber}: Incorrecto (Tu: ${userAnswer} | Corr: ${correctAnswer})</li>`;
                    input.style.border = '2px solid #e74c3c';
                }
                totalQuestions++;
            });

            document.getElementById('quizScore').textContent = `${correctCount}/${totalQuestions}`;
            resultsDiv.style.display = 'block';

            // Marcar Sesi√≥n 1 como completada si se obtiene un 75% o m√°s (6/8)
             if (correctCount >= 6) {
		// === AGREGAR: MARCAR RETO 5 DE SESI√ìN 1 ===
 							   completeSubActivity(1, 5);
    					// ==========================================
                if (!completedSections.includes(1)) {
                    completedSections.push(1);
                    localStorage.setItem('completedSections', JSON.stringify(completedSections));
                    updateProgress();
                    createConfetti();
                    alert('‚ú® ¬°Sesi√≥n 1 Completada con Honores! Has desbloqueado la Sesi√≥n 2.');
                }
                // Mostrar el bot√≥n siempre que tenga 6 o m√°s correctas
                document.getElementById('nextSessionButton').style.display = 'block';
            } else {
                alert('Sigue practicando. Necesitas al menos 6/8 correctas para desbloquear la siguiente sesi√≥n.');
            }
            }
        


        // === INICIALIZAR TODO ===
    document.addEventListener('DOMContentLoaded', function() {
        createStars();
        createParticles();
        createMathSymbols();
        updateProgress();
        showScreen('homeScreen');

showScreen('homeScreen');
        
        // üëá AGREGA ESTO AQU√ç üëá
        // Inicializar estado del Postest al cargar
        const postestCard = document.getElementById('postestCard');
        if (postestCard) {
            if (completedSections.length === TOTAL_SECTIONS) {
                postestCard.classList.remove('postest-locked');
            } else {
                postestCard.classList.add('postest-locked');
            }
        }
        
        // Inicializar juego arcade cuando se active la pantalla
        
        // Inicializar juego arcade cuando se active la pantalla
        const arcadeScreen = document.getElementById('session2ArcadeScreen');
        if (arcadeScreen) {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.target.classList.contains('active')) {
                        setTimeout(() => initArcadeGame(), 100);
                    }
                });
            });
            observer.observe(arcadeScreen, { attributes: true, attributeFilter: ['class'] });
        }
    });

        // === FUNCI√ìN PARA REINICIAR PROGRESO (SOLO PARA PRUEBAS) ===
        function resetProgress() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres reiniciar todo el progreso?')) {
                localStorage.removeItem('completedSections');
                completedSections = [];
                alert('‚úÖ Progreso reiniciado. Recarga la p√°gina.');
                location.reload();
            }
        }

        // === OPTIMIZACI√ìN M√ìVIL: Reducir animaciones si es necesario ===
        if (window.innerWidth <= 768) {
            console.log('Modo m√≥vil activado - Efectos optimizados');
        }
// === FUNCI√ìN PARA ABRIR EL POSTEST ===
        function openPostest() {
            if (completedSections.length === TOTAL_SECTIONS) {
                window.open('https://andres5050-sudo.github.io/Pretest-Octavo2/', '_blank');
            } else {
                const remaining = TOTAL_SECTIONS - completedSections.length;
                alert(`üîí El Postest estar√° disponible cuando completes todas las sesiones.\n\nüìä Progreso actual: ${completedSections.length}/${TOTAL_SECTIONS} sesiones completadas.\n\‚ö†Ô∏è Te faltan ${remaining} sesi√≥n${remaining > 1 ? 'es' : ''}.`);
            }
        }
// ==========================================
// NAVE MULTIPLICADORA - JUEGO ARCADE SESI√ìN 2
// Combustible + 4 vidas + velocidad infinita + 3 intentos
// ==========================================

let a2Canvas, a2Ctx, a2GameLoop = null, a2Frame = 0;

// === AUDIO ===
let a2AudioCtx = null, a2MusicEnabled = true, a2MusicInterval = null, a2MusicStep = 0;

function initA2Audio() { try { a2AudioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {} }
function a2PlayNote(f, d, t, v) {
    if (!a2AudioCtx || !a2MusicEnabled) return;
    try { if (a2AudioCtx.state==='suspended') a2AudioCtx.resume();
        const o=a2AudioCtx.createOscillator(),g=a2AudioCtx.createGain();
        o.type=t||'square';o.frequency.value=f;g.gain.setValueAtTime(v||0.06,a2AudioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001,a2AudioCtx.currentTime+d);
        o.connect(g);g.connect(a2AudioCtx.destination);o.start();o.stop(a2AudioCtx.currentTime+d);
    } catch(e) {}
}
function a2SoundHit() { a2PlayNote(120,0.3,'sawtooth',0.12); setTimeout(()=>a2PlayNote(80,0.4,'sawtooth',0.08),100); }
function a2SoundCorrect() { a2PlayNote(523,0.1,'square',0.08); setTimeout(()=>a2PlayNote(659,0.1,'square',0.08),100); setTimeout(()=>a2PlayNote(784,0.15,'square',0.08),200); }
function a2SoundWrong() { a2PlayNote(250,0.2,'sawtooth',0.08); setTimeout(()=>a2PlayNote(180,0.3,'sawtooth',0.08),120); }
function a2SoundStar() { a2PlayNote(880,0.08,'sine',0.06); setTimeout(()=>a2PlayNote(1100,0.1,'sine',0.06),60); }
function a2SoundMilestone() { [523,659,784,1047].forEach((n,i)=>setTimeout(()=>a2PlayNote(n,0.12,'square',0.06),i*70)); }
function a2SoundGameOver() { [350,300,250,180,120].forEach((n,i)=>setTimeout(()=>a2PlayNote(n,0.25,'sawtooth',0.08),i*140)); }
function a2SoundFuelLow() { a2PlayNote(200,0.15,'square',0.06); setTimeout(()=>a2PlayNote(150,0.15,'square',0.06),150); }

const a2Melody = [330,370,415,440,494,523,494,440,415,370,330,294,262,294,330,370,440,494,523,587,659,587,523,494,440,415,370,330,294,330,370,294];
function startA2Music() { if(!a2AudioCtx||!a2MusicEnabled) return; stopA2Music(); a2MusicStep=0;
    a2MusicInterval=setInterval(()=>{ if(!a2MusicEnabled||!a2.isRunning||a2.isPaused) return;
        const n=a2Melody[a2MusicStep%a2Melody.length]; a2PlayNote(n,0.16,'triangle',0.03); a2PlayNote(n/2,0.18,'sine',0.02); a2MusicStep++; },200); }
function stopA2Music() { if(a2MusicInterval){clearInterval(a2MusicInterval);a2MusicInterval=null;} }
function toggleArcade2Music() { a2MusicEnabled=!a2MusicEnabled; document.getElementById('arcade2MuteBtn').textContent=a2MusicEnabled?'üîä':'üîá';
    if(!a2MusicEnabled) stopA2Music(); else if(a2.isRunning&&!a2.isPaused) startA2Music(); }

// === ESTADO ===
const a2 = {
    ship: { x: 0, y: 0, width: 36, height: 44 },
    lives: 4, score: 0,
    highScore: parseInt(localStorage.getItem('arcade2High')) || 0,
    
    // Velocidad: empieza en 3, sube sin l√≠mite real (tope alt√≠simo)
    speed: 3, baseSpeed: 3, maxSpeed: 50,
    shipSpeed: 6, baseShipSpeed: 6,
    isRunning: false, isPaused: false,
    questionsAnswered: 0, questionsCorrect: 0,
    canvasWidth: 700, canvasHeight: 400,
    
    // Combustible: 100 max, baja constantemente, estrellas lo recargan
    fuel: 100, maxFuel: 100,
    fuelDecay: 0.08, // Porcentaje por frame que baja
    fuelPerStar: 25, // Cu√°nto recarga cada estrella
    fuelWarned: false,
    
    asteroids: [], stars: [], particles: [], bgStars: [],
    spawnTimer: 0, spawnInterval: 55, minSpawnInterval: 15,
    starSpawnTimer: 0, starSpawnInterval: 80,
    
    invincible: false, invincibleTimer: 0, invincibleDuration: 90,
    
    attempts: 0, maxAttempts: 3,
    totalQCorrect: 0, totalQAnswered: 0, bestScore: 0,
    usedQuestions: [], lastMilestone: 0,
    keys: { left: false, right: false }, touchSide: null
};

// === PREGUNTAS ===
const a2Questions = [
    // --- 2 T√âRMINOS: √ó y √∑ con signos (8) ---
    { q: "(‚àí7) √ó (+8) = ?", opts: ["‚àí56","+56","‚àí15","+15"], c:0, exp: "Neg √ó Pos = Neg. 7√ó8=56 ‚Üí ‚àí56" },
    { q: "(‚àí9) √ó (‚àí6) = ?", opts: ["+54","‚àí54","+15","‚àí15"], c:0, exp: "Neg √ó Neg = Pos. 9√ó6=54 ‚Üí +54" },
    { q: "(+48) √∑ (‚àí8) = ?", opts: ["‚àí6","+6","‚àí40","+40"], c:0, exp: "Pos √∑ Neg = Neg. 48√∑8=6 ‚Üí ‚àí6" },
    { q: "(‚àí72) √∑ (‚àí9) = ?", opts: ["+8","‚àí8","+63","‚àí63"], c:0, exp: "Neg √∑ Neg = Pos. 72√∑9=8 ‚Üí +8" },
    { q: "(+11) √ó (‚àí4) = ?", opts: ["‚àí44","+44","‚àí15","+15"], c:0, exp: "Pos √ó Neg = Neg. 11√ó4=44 ‚Üí ‚àí44" },
    { q: "(‚àí56) √∑ (+7) = ?", opts: ["‚àí8","+8","‚àí49","+49"], c:0, exp: "Neg √∑ Pos = Neg. 56√∑7=8 ‚Üí ‚àí8" },
    { q: "(‚àí12) √ó (‚àí5) = ?", opts: ["+60","‚àí60","+17","‚àí17"], c:0, exp: "Neg √ó Neg = Pos. 12√ó5=60 ‚Üí +60" },
    { q: "(+90) √∑ (‚àí10) = ?", opts: ["‚àí9","+9","‚àí80","+80"], c:0, exp: "Pos √∑ Neg = Neg. 90√∑10=9 ‚Üí ‚àí9" },
    // --- 3 T√âRMINOS: √ó y √∑ encadenados (8) ---
    { q: "(‚àí2)√ó(+3)√ó(‚àí4) = ?", opts: ["+24","‚àí24","+9","‚àí9"], c:0, exp: "(‚àí2)√ó3=‚àí6, (‚àí6)√ó(‚àí4)=+24" },
    { q: "(+10)√ó(‚àí5)√∑(+2) = ?", opts: ["‚àí25","+25","‚àí3","+3"], c:0, exp: "10√ó(‚àí5)=‚àí50, ‚àí50√∑2=‚àí25" },
    { q: "(‚àí8)√∑(+2)√ó(‚àí3) = ?", opts: ["+12","‚àí12","‚àí2","+2"], c:0, exp: "Izq‚ÜíDer: ‚àí8√∑2=‚àí4, (‚àí4)√ó(‚àí3)=+12" },
    { q: "(‚àí36)√∑(‚àí6)√∑(‚àí2) = ?", opts: ["‚àí3","+3","‚àí12","+12"], c:0, exp: "Izq‚ÜíDer: 36√∑6=+6, 6√∑(‚àí2)=‚àí3" },
    { q: "(‚àí3)√ó(+5)+(‚àí10) = ?", opts: ["‚àí25","+25","‚àí5","+5"], c:0, exp: "√ó primero: (‚àí3)√ó5=‚àí15, ‚àí15+(‚àí10)=‚àí25" },
    { q: "20√∑(‚àí4)√ó(+3) = ?", opts: ["‚àí15","+15","‚àí60","+60"], c:0, exp: "Izq‚ÜíDer: 20√∑(‚àí4)=‚àí5, (‚àí5)√ó3=‚àí15" },
    { q: "(‚àí8)√ó(‚àí2)‚àí(+10) = ?", opts: ["+6","‚àí6","+26","‚àí26"], c:0, exp: "√ó primero: 16‚àí10=+6" },
    { q: "(+7)√ó(‚àí2)√∑(‚àí1) = ?", opts: ["+14","‚àí14","‚àí9","+5"], c:0, exp: "7√ó(‚àí2)=‚àí14, ‚àí14√∑(‚àí1)=+14" },
    // --- 4 T√âRMINOS: jerarqu√≠a + signos (8) ---
    { q: "15‚àí(‚àí3)√ó4+(‚àí6) = ?", opts: ["+21","‚àí21","+3","‚àí3"], c:0, exp: "√ó primero: (‚àí3)√ó4=‚àí12, 15‚àí(‚àí12)+(‚àí6)=21" },
    { q: "(‚àí2)√ó5+30√∑(‚àí6)‚àí3 = ?", opts: ["‚àí18","+18","‚àí8","+8"], c:0, exp: "√ó y √∑: ‚àí10+(‚àí5)‚àí3=‚àí18" },
    { q: "(8‚àí12)√ó(‚àí3)+7 = ?", opts: ["+19","‚àí19","+5","‚àí5"], c:0, exp: "( )‚Üí‚àí4, (‚àí4)√ó(‚àí3)=12, 12+7=19" },
    { q: "(‚àí24)√∑4+(‚àí3)√ó(‚àí5)‚àí2 = ?", opts: ["+7","‚àí7","+19","‚àí19"], c:0, exp: "‚àí24√∑4=‚àí6, (‚àí3)√ó(‚àí5)=15, ‚àí6+15‚àí2=7" },
    { q: "(‚àí10)√∑5+3√ó(‚àí4) = ?", opts: ["‚àí14","+14","‚àí10","+10"], c:0, exp: "√∑ y √ó primero: ‚àí2+(‚àí12)=‚àí14" },
    { q: "8√ó(‚àí3)+(‚àí12)√∑(‚àí4) = ?", opts: ["‚àí21","+21","‚àí27","+27"], c:0, exp: "8√ó(‚àí3)=‚àí24, (‚àí12)√∑(‚àí4)=3, ‚àí24+3=‚àí21" },
    { q: "(‚àí6)√ó(‚àí2)‚àí15√∑(‚àí3) = ?", opts: ["+17","‚àí17","+7","‚àí7"], c:0, exp: "(‚àí6)√ó(‚àí2)=12, 15√∑(‚àí3)=‚àí5, 12‚àí(‚àí5)=17" },
    { q: "7+(‚àí3)√ó5‚àí(‚àí1) = ?", opts: ["‚àí7","+7","‚àí8","+8"], c:0, exp: "(‚àí3)√ó5=‚àí15, 7‚àí15+1=‚àí7" },
    // --- 5 T√âRMINOS: jerarqu√≠a + par√©ntesis (8) ---
    { q: "(‚àí2)√ó(3‚àí7)+10√∑(‚àí5) = ?", opts: ["+6","‚àí6","+10","‚àí10"], c:0, exp: "( )‚Üí‚àí4, (‚àí2)√ó(‚àí4)=8, 10√∑(‚àí5)=‚àí2, 8+(‚àí2)=+6" },
    { q: "12√∑(‚àí3)+(‚àí2)√ó(5‚àí8)‚àí1 = ?", opts: ["+1","‚àí1","+5","‚àí5"], c:0, exp: "( )‚Üí‚àí3, ‚àí4+6‚àí1=+1" },
    { q: "(4‚àí10)√ó(‚àí3)+6√∑(‚àí2) = ?", opts: ["+15","‚àí15","+21","‚àí21"], c:0, exp: "( )‚Üí‚àí6, 18+(‚àí3)=+15" },
    { q: "(‚àí8)√∑2+(1‚àí5)√ó(‚àí3) = ?", opts: ["+8","‚àí8","+16","‚àí16"], c:0, exp: "‚àí4+12=+8" },
    { q: "5√ó(‚àí2)+3√ó(7‚àí10)+1 = ?", opts: ["‚àí18","+18","‚àí8","+8"], c:0, exp: "‚àí10+(‚àí9)+1=‚àí18" },
    { q: "(‚àí15)√∑(‚àí5)‚àí2√ó(3‚àí6) = ?", opts: ["+9","‚àí9","+3","‚àí3"], c:0, exp: "3‚àí(‚àí6)=+9" },
    // --- √ó y √∑ SEGUIDAS: izquierda a derecha (4) ---
    { q: "(‚àí24)√∑4√ó(‚àí3)+5 = ?", opts: ["+23","+7","‚àí13","+2"], c:0, exp: "Izq‚ÜíDer: ‚àí24√∑4=‚àí6, (‚àí6)√ó(‚àí3)=18, 18+5=23" },
    { q: "36√∑(‚àí6)√∑(‚àí2)√ó5‚àí10 = ?", opts: ["+5","‚àí5","+25","‚àí25"], c:0, exp: "Izq‚ÜíDer: ‚àí6√∑(‚àí2)=3, 3√ó5=15, 15‚àí10=5" },
];

// === CANVAS ===
function initA2Canvas() {
    a2Canvas = document.getElementById('arcade2Canvas');
    a2Ctx = a2Canvas.getContext('2d');
    const w = Math.min(700, window.innerWidth - 40);
    a2.canvasWidth = w; a2.canvasHeight = 400;
    const dpr = window.devicePixelRatio || 1;
    a2Canvas.width = w*dpr; a2Canvas.height = 400*dpr;
    a2Canvas.style.width = w+'px'; a2Canvas.style.height = '400px';
    a2Ctx.scale(dpr, dpr);
    a2.ship.x = w/2 - a2.ship.width/2; a2.ship.y = a2.canvasHeight - 70;
    a2.bgStars = [];
    for (let i=0; i<80; i++) a2.bgStars.push({x:Math.random()*w, y:Math.random()*400, size:Math.random()*2+0.5, speed:0.3+Math.random()*1.5, b:Math.random()});
}

function startArcade2Game() {
    if (!a2AudioCtx) initA2Audio();
    a2MusicEnabled = document.getElementById('arcade2MusicToggle').checked;
    initA2Canvas(); resetA2State(); a2.attempts++;
    
    document.getElementById('arcade2StartScreen').style.display='none';
    document.getElementById('arcade2GameScreen').style.display='block';
    document.getElementById('arcade2WinScreen').style.display='none';
    document.getElementById('arcade2GameOverScreen').style.display='none';
    
    document.addEventListener('keydown', a2KeyDown);
    document.addEventListener('keyup', a2KeyUp);
    a2Canvas.addEventListener('touchstart', a2TouchStart, {passive:false});
    a2Canvas.addEventListener('touchend', a2TouchEnd, {passive:false});
    a2Canvas.addEventListener('mousedown', a2MouseDown);
    a2Canvas.addEventListener('mouseup', a2MouseUp);
    
    a2.isRunning = true;
    document.getElementById('arcade2MuteBtn').textContent = a2MusicEnabled ? 'üîä' : 'üîá';
    startA2Music(); a2MainLoop();
}

function resetA2State() {
    a2.ship.x = a2.canvasWidth/2 - a2.ship.width/2; a2.ship.y = a2.canvasHeight - 70;
    a2.lives=4; a2.score=0; a2.speed=a2.baseSpeed; a2.shipSpeed=a2.baseShipSpeed;
    a2.fuel=a2.maxFuel; a2.fuelDecay=0.12; a2.fuelWarned=false;
    a2.isRunning=false; a2.isPaused=false;
    a2.questionsAnswered=0; a2.questionsCorrect=0;
    a2.asteroids=[]; a2.stars=[]; a2.particles=[];
    a2.spawnTimer=0; a2.spawnInterval=55; a2.starSpawnTimer=0; a2.starSpawnInterval=80;
    a2.invincible=false; a2.invincibleTimer=0;
    a2.usedQuestions=[]; a2.lastMilestone=0;
    a2.keys={left:false,right:false}; a2.touchSide=null;
    a2Frame=0;
    updateA2HUD(); updateA2FuelBar();
}

// === CONTROLES ===
function a2KeyDown(e) { if(!a2.isRunning||a2.isPaused) return;
    if(e.code==='ArrowLeft'||e.code==='KeyA'){a2.keys.left=true;e.preventDefault();}
    if(e.code==='ArrowRight'||e.code==='KeyD'){a2.keys.right=true;e.preventDefault();} }
function a2KeyUp(e) { if(e.code==='ArrowLeft'||e.code==='KeyA') a2.keys.left=false;
    if(e.code==='ArrowRight'||e.code==='KeyD') a2.keys.right=false; }
function a2TouchStart(e) { e.preventDefault(); if(!a2.isRunning||a2.isPaused) return;
    const r=a2Canvas.getBoundingClientRect(); a2.touchSide=(e.touches[0].clientX-r.left)<r.width/2?'left':'right'; }
function a2TouchEnd(e) { e.preventDefault(); a2.touchSide=null; }
function a2MouseDown(e) { if(!a2.isRunning||a2.isPaused) return;
    const r=a2Canvas.getBoundingClientRect(); a2.touchSide=(e.clientX-r.left)<r.width/2?'left':'right'; }
function a2MouseUp() { a2.touchSide=null; }

// === LOOP ===
function a2MainLoop() {
    if (!a2.isRunning) return;
    if (a2.isPaused) { a2GameLoop=requestAnimationFrame(a2MainLoop); return; }
    a2Frame++;
    a2UpdateShip(); a2UpdateFuel(); a2UpdateAsteroids(); a2UpdateStars();
    a2SpawnObjects(); a2CheckCollisions(); a2UpdateParticles();
    a2UpdateSpeed(); a2UpdateScore(); a2Draw();
    a2GameLoop = requestAnimationFrame(a2MainLoop);
}

function a2UpdateShip() {
    const ml=a2.keys.left||a2.touchSide==='left', mr=a2.keys.right||a2.touchSide==='right';
    if(ml) a2.ship.x -= a2.shipSpeed;
    if(mr) a2.ship.x += a2.shipSpeed;
    a2.ship.x = Math.max(0, Math.min(a2.canvasWidth - a2.ship.width, a2.ship.x));
    if(a2.invincible) { a2.invincibleTimer--; if(a2.invincibleTimer<=0) a2.invincible=false; }
}

// === COMBUSTIBLE ===
function a2UpdateFuel() {
    // El combustible baja constantemente, m√°s r√°pido a mayor velocidad
    const speedMult = 1 + (a2.speed - a2.baseSpeed) * 0.05;
    a2.fuel -= a2.fuelDecay * speedMult;
    
    // Advertencia de combustible bajo
    if (a2.fuel <= 25 && !a2.fuelWarned && a2Frame % 60 === 0) {
        a2SoundFuelLow();
    }
    a2.fuelWarned = a2.fuel <= 25;
    
    if (a2.fuel <= 0) {
        a2.fuel = 0;
        // Sin combustible = choque (como quedarse sin gasolina)
        a2Hit();
    }
    
    updateA2FuelBar();
}

function updateA2FuelBar() {
    const pct = Math.max(0, Math.min(100, a2.fuel));
    const bar = document.getElementById('arcade2FuelBar');
    const txt = document.getElementById('arcade2FuelText');
    if (bar) {
        bar.style.width = pct + '%';
        if (pct > 50) bar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
        else if (pct > 25) bar.style.background = 'linear-gradient(90deg, #FF9800, #FFC107)';
        else bar.style.background = 'linear-gradient(90deg, #F44336, #FF5252)';
    }
    if (txt) txt.textContent = Math.round(pct) + '%';
}

// === VELOCIDAD PROGRESIVA SIN L√çMITE REAL ===
function a2UpdateSpeed() {
    // La velocidad sube continuamente: cada 80 puntos +0.5
    // No tiene tope real pr√°ctico (maxSpeed=50 pero nunca se alcanza f√°cilmente)
    a2.speed = a2.baseSpeed + (a2.score / 150) * 0.5;
    if (a2.speed > a2.maxSpeed) a2.speed = a2.maxSpeed;
    
    // La velocidad de la nave tambi√©n sube para compensar
    a2.shipSpeed = a2.baseShipSpeed + (a2.speed - a2.baseSpeed) * 0.3;
    
    // Spawn m√°s frecuente conforme sube velocidad
    a2.minSpawnInterval = Math.max(12, 40 - Math.floor(a2.score / 100) * 2);
    a2.starSpawnInterval = Math.max(50, 80 - Math.floor(a2.score / 200) * 3);
    
    // Decay de combustible sube ligeramente
    a2.fuelDecay = 0.08 + (a2.score / 1000) * 0.02;
    
    const mult = (a2.speed / a2.baseSpeed).toFixed(1);
    document.getElementById('arcade2SpeedDisplay').textContent = mult + 'x';
}

function a2UpdateScore() {
    if (a2Frame % 6 === 0) a2.score++;
    document.getElementById('arcade2Score').textContent = a2.score;
    const m = Math.floor(a2.score / 100);
    if (m > a2.lastMilestone) { a2.lastMilestone = m; a2SoundMilestone(); }
}

// === OBJETOS ===
function a2SpawnObjects() {
    a2.spawnTimer++;
    if (a2.spawnTimer >= a2.spawnInterval) {
        a2.spawnTimer=0;
        a2.spawnInterval = a2.minSpawnInterval + Math.floor(Math.random() * 35);
        const sz = 18 + Math.random() * 28;
        a2.asteroids.push({ x:Math.random()*(a2.canvasWidth-sz), y:-sz, width:sz, height:sz,
            rot:Math.random()*Math.PI*2, rotS:(Math.random()-0.5)*0.1, type:Math.random()<0.5?'rock':'crystal' });
    }
    a2.starSpawnTimer++;
    if (a2.starSpawnTimer >= a2.starSpawnInterval) {
        a2.starSpawnTimer=0;
        a2.stars.push({ x:Math.random()*(a2.canvasWidth-24), y:-24, width:24, height:24, pulse:0 });
    }
}

function a2UpdateAsteroids() {
    for(let i=a2.asteroids.length-1;i>=0;i--) {
        a2.asteroids[i].y += a2.speed; a2.asteroids[i].rot += a2.asteroids[i].rotS;
        if(a2.asteroids[i].y > a2.canvasHeight+30) a2.asteroids.splice(i,1);
    }
}
function a2UpdateStars() {
    for(let i=a2.stars.length-1;i>=0;i--) {
        a2.stars[i].y += a2.speed*0.6; a2.stars[i].pulse += 0.1;
        if(a2.stars[i].y > a2.canvasHeight+20) a2.stars.splice(i,1);
    }
}

function a2CheckCollisions() {
    if(a2.invincible) return;
    const s=a2.ship, sb={x:s.x+4,y:s.y+4,w:s.width-8,h:s.height-8};
    
    for(let i=0;i<a2.asteroids.length;i++) {
        const a=a2.asteroids[i];
        if(sb.x<a.x+a.width-4&&sb.x+sb.w>a.x+4&&sb.y<a.y+a.height-4&&sb.y+sb.h>a.y+4) {
            for(let j=0;j<12;j++) a2.particles.push({x:a.x+a.width/2,y:a.y+a.height/2,vx:(Math.random()-0.5)*6,vy:(Math.random()-0.5)*6,life:30,color:a.type==='rock'?'#FF5252':'#E040FB',size:2+Math.random()*4});
            a2.asteroids.splice(i,1);
            a2Hit(); return;
        }
    }
    
    for(let i=a2.stars.length-1;i>=0;i--) {
        const st=a2.stars[i];
        if(sb.x<st.x+st.width&&sb.x+sb.w>st.x&&sb.y<st.y+st.height&&sb.y+sb.h>st.y) {
            a2SoundStar();
            a2.fuel = Math.min(a2.maxFuel, a2.fuel + a2.fuelPerStar);
            a2.score += 30;
            for(let j=0;j<8;j++) a2.particles.push({x:st.x+12,y:st.y+12,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,life:20,color:'#FFD740',size:2+Math.random()*3});
            a2.stars.splice(i,1);
        }
    }
}

function a2Hit() {
    a2.isPaused=true; stopA2Music(); a2SoundHit(); showA2Question();
}

function a2UpdateParticles() { a2.particles=a2.particles.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.life--;return p.life>0;}); }

function updateA2HUD() {
    document.getElementById('arcade2Score').textContent = a2.score;
    const hearts = document.querySelectorAll('.a2Heart');
    hearts.forEach((h,i)=>{h.style.opacity=i<a2.lives?'1':'0.2';h.style.filter=i<a2.lives?'none':'grayscale(100%)';h.style.transform=i<a2.lives?'scale(1)':'scale(0.7)';});
}

// === DIBUJAR ===
function a2Draw() {
    const c=a2Ctx, W=a2.canvasWidth, H=a2.canvasHeight;
    
    const bg=c.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'#0a0025');bg.addColorStop(0.5,'#150040');bg.addColorStop(1,'#1a0050');
    c.fillStyle=bg;c.fillRect(0,0,W,H);
    
    // Estrellas fondo
    a2.bgStars.forEach(s=>{s.y+=s.speed+(a2.speed-a2.baseSpeed)*0.3;if(s.y>H){s.y=0;s.x=Math.random()*W;}
        c.fillStyle=`rgba(255,255,255,${0.3+0.7*(0.5+0.5*Math.sin(a2Frame*0.02+s.b*10))})`;
        c.beginPath();c.arc(s.x,s.y,s.size,0,Math.PI*2);c.fill();});
    
    // Nebulosa
    c.fillStyle='rgba(156,39,176,0.03)';c.beginPath();c.ellipse(W*0.3,H*0.4,150,80,0.5,0,Math.PI*2);c.fill();
    c.fillStyle='rgba(33,150,243,0.02)';c.beginPath();c.ellipse(W*0.7,H*0.6,120,100,-0.3,0,Math.PI*2);c.fill();
    
    // Part√≠culas
    a2.particles.forEach(p=>{c.globalAlpha=p.life/30;c.fillStyle=p.color;c.beginPath();c.arc(p.x,p.y,p.size,0,Math.PI*2);c.fill();});
    c.globalAlpha=1;
    
    // Estrellas/combustible
    a2.stars.forEach(st=>{
        const pulse=1+0.25*Math.sin(st.pulse);
        c.save();c.translate(st.x+12,st.y+12);c.scale(pulse,pulse);
        // Bid√≥n de gasolina estilizado como estrella dorada
        c.fillStyle='#FFD740';c.strokeStyle='#FFC107';c.lineWidth=1.5;
        c.beginPath();
        for(let i=0;i<5;i++){const a=(Math.PI*2*i)/5-Math.PI/2;c.lineTo(Math.cos(a)*12,Math.sin(a)*12);
            const a2a=(Math.PI*2*(i+0.5))/5-Math.PI/2;c.lineTo(Math.cos(a2a)*5,Math.sin(a2a)*5);}
        c.closePath();c.fill();c.stroke();
        // Icono de gasolina
        c.fillStyle='#FF9800';c.font='bold 8px Arial';c.textAlign='center';c.fillText('‚õΩ',0,3);
        c.restore();
    });
    
    // Asteroides
    a2.asteroids.forEach(a=>{
        c.save();c.translate(a.x+a.width/2,a.y+a.height/2);c.rotate(a.rot);
        const r=a.width/2;
        if(a.type==='rock'){
            c.fillStyle='#795548';c.strokeStyle='#5D4037';c.lineWidth=2;
            c.beginPath();for(let i=0;i<7;i++){const ang=(Math.PI*2*i)/7,d=r*(0.7+((i*37)%10)/30);
                if(i===0)c.moveTo(Math.cos(ang)*d,Math.sin(ang)*d);else c.lineTo(Math.cos(ang)*d,Math.sin(ang)*d);}
            c.closePath();c.fill();c.stroke();
            c.fillStyle='#6D4C41';c.beginPath();c.arc(-r*0.2,-r*0.1,r*0.2,0,Math.PI*2);c.fill();
        } else {
            c.fillStyle='#CE93D8';c.strokeStyle='#AB47BC';c.lineWidth=2;
            c.beginPath();for(let i=0;i<6;i++){const ang=(Math.PI*2*i)/6;
                if(i===0)c.moveTo(Math.cos(ang)*r,Math.sin(ang)*r);else c.lineTo(Math.cos(ang)*r,Math.sin(ang)*r);}
            c.closePath();c.fill();c.stroke();
            c.fillStyle='rgba(255,255,255,0.3)';c.beginPath();c.arc(0,-r*0.2,r*0.25,0,Math.PI*2);c.fill();
        }
        c.restore();
    });
    
    // Nave
    if(!(a2.invincible&&a2Frame%6<3)){
        const sx=a2.ship.x,sy=a2.ship.y,sw=a2.ship.width,sh=a2.ship.height;
        c.save();
        c.fillStyle='#42A5F5';c.beginPath();c.moveTo(sx+sw/2,sy);c.lineTo(sx+sw,sy+sh);c.lineTo(sx,sy+sh);c.closePath();c.fill();
        c.fillStyle='#90CAF9';c.beginPath();c.moveTo(sx+sw/2,sy+10);c.lineTo(sx+sw-8,sy+sh-8);c.lineTo(sx+8,sy+sh-8);c.closePath();c.fill();
        c.fillStyle='#E3F2FD';c.beginPath();c.arc(sx+sw/2,sy+sh*0.4,5,0,Math.PI*2);c.fill();
        const fl=5+Math.random()*8;
        c.fillStyle='#FF9800';c.beginPath();c.moveTo(sx+sw*0.3,sy+sh);c.lineTo(sx+sw/2,sy+sh+fl);c.lineTo(sx+sw*0.7,sy+sh);c.closePath();c.fill();
        c.fillStyle='#FFEB3B';c.beginPath();c.moveTo(sx+sw*0.4,sy+sh);c.lineTo(sx+sw/2,sy+sh+fl*0.6);c.lineTo(sx+sw*0.6,sy+sh);c.closePath();c.fill();
        if(a2.invincible){c.strokeStyle='rgba(156,39,176,0.5)';c.lineWidth=2;c.beginPath();c.arc(sx+sw/2,sy+sh/2,30,0,Math.PI*2);c.stroke();}
        c.restore();
    }
    
    // Barra de combustible en canvas tambi√©n
    const fuelPct = a2.fuel / a2.maxFuel;
    c.fillStyle='rgba(0,0,0,0.4)';c.fillRect(W-160,10,150,12);
    c.fillStyle=fuelPct>0.5?'#4CAF50':fuelPct>0.25?'#FF9800':'#F44336';
    c.fillRect(W-160,10,150*fuelPct,12);
    c.strokeStyle='rgba(255,255,255,0.3)';c.lineWidth=1;c.strokeRect(W-160,10,150,12);
    c.fillStyle='#fff';c.font='bold 8px Arial';c.textAlign='center';
    c.fillText('‚õΩ '+Math.round(a2.fuel)+'%',W-85,19);
    
    // Score
    c.fillStyle='#fff';c.font='bold 14px monospace';c.textAlign='left';
    c.fillText('SCORE: '+String(a2.score).padStart(5,'0'),10,20);
    const spd=(a2.speed/a2.baseSpeed).toFixed(1);
    c.fillStyle=a2.speed>10?'#FF5252':a2.speed>6?'#FFB74D':'#CE93D8';
    c.font='bold 11px Arial';c.fillText('VEL: '+spd+'x',10,36);
    
    // Advertencia de combustible bajo
    if(a2.fuel<=20){c.fillStyle='rgba(244,67,54,'+(0.1+0.1*Math.sin(a2Frame*0.2))+')';c.fillRect(0,0,W,H);
        c.fillStyle='#FF5252';c.font='bold 16px Arial';c.textAlign='center';c.fillText('‚ö†Ô∏è ¬°COMBUSTIBLE BAJO! ‚õΩ ¬°Recoge estrellas!',W/2,H/2-80);c.textAlign='left';}
}

// === PREGUNTAS ===
function getA2Question() {
    if(a2.usedQuestions.length>=a2Questions.length) a2.usedQuestions=[];
    let i; do{i=Math.floor(Math.random()*a2Questions.length);}while(a2.usedQuestions.includes(i));
    a2.usedQuestions.push(i); return{...a2Questions[i]};
}

function showA2Question() {
    const q=getA2Question();
    document.getElementById('arcade2QuestionContent').textContent=q.q;
    document.getElementById('arcade2LivesRemaining').textContent='Vidas restantes: '+a2.lives;
    const opts=document.getElementById('arcade2AnswerOptions');opts.innerHTML='';
    const idx=[0,1,2,3];for(let i=3;i>0;i--){const j=Math.floor(Math.random()*(i+1));[idx[i],idx[j]]=[idx[j],idx[i]];}
    idx.forEach(oi=>{
        const btn=document.createElement('button');btn.textContent=q.opts[oi];
        btn.style.cssText='background:linear-gradient(135deg,rgba(186,104,200,0.3),rgba(186,104,200,0.1));color:white;border:2px solid rgba(186,104,200,0.5);padding:15px;font-size:1.2em;font-weight:700;border-radius:15px;cursor:pointer;transition:all 0.2s;';
        btn.onmouseover=()=>{btn.style.background='linear-gradient(135deg,#AB47BC,#7B1FA2)';btn.style.transform='scale(1.05)';};
        btn.onmouseout=()=>{btn.style.background='linear-gradient(135deg,rgba(186,104,200,0.3),rgba(186,104,200,0.1))';btn.style.transform='scale(1)';};
        btn.onclick=()=>handleA2Answer(oi===q.c,q,opts);opts.appendChild(btn);});
    document.getElementById('arcade2QuestionFeedback').style.display='none';
    document.getElementById('arcade2ContinueBtn').style.display='none';
    document.getElementById('arcade2QuestionModal').style.display='flex';
}

function handleA2Answer(correct, question, container) {
    a2.questionsAnswered++;a2.totalQAnswered++;
    container.querySelectorAll('button').forEach(b=>{b.onclick=null;b.style.cursor='default';b.style.opacity='0.5';});
    const fb=document.getElementById('arcade2QuestionFeedback'),ft=document.getElementById('arcade2FeedbackText'),
          fe=document.getElementById('arcade2FeedbackExplanation'),cb=document.getElementById('arcade2ContinueBtn');
    if(correct){a2.questionsCorrect++;a2.totalQCorrect++;a2SoundCorrect();
        fb.style.background='rgba(76,175,80,0.2)';fb.style.border='2px solid #4CAF50';
        ft.style.color='#69F0AE';ft.textContent='‚úÖ ¬°CORRECTO! No pierdes vida. +30 combustible';
        fe.style.color='#A5D6A7';
        a2.fuel=Math.min(a2.maxFuel,a2.fuel+30); // Bonus de combustible por responder bien
    } else {
        a2.lives--;a2SoundWrong();updateA2HUD();
        fb.style.background='rgba(244,67,54,0.2)';fb.style.border='2px solid #F44336';
        ft.style.color='#FF5252';ft.textContent='‚ùå Incorrecto. Pierdes vida. ('+a2.lives+' restantes)';
        fe.style.color='#FFCDD2';
    }
    fe.textContent=question.exp;fb.style.display='block';
    cb.style.display='inline-block';cb.textContent=a2.lives>0?'‚ñ∂ Continuar Jugando':'üíî Ver Resultado';
}

function arcade2ContinueAfterQuestion() {
    document.getElementById('arcade2QuestionModal').style.display='none';
    document.getElementById('arcade2ContinueBtn').style.display='none';
    if(a2.lives<=0){a2GameOver();}
    else{a2.invincible=true;a2.invincibleTimer=a2.invincibleDuration;a2.isPaused=false;
        a2.fuel=Math.min(a2.maxFuel,a2.fuel+15); // Un poco de fuel al continuar
        a2.asteroids=a2.asteroids.filter(o=>o.y<a2.ship.y-60);startA2Music();}
}

// === GAME OVER ===
function a2GameOver() {
    a2.isRunning=false;cancelAnimationFrame(a2GameLoop);stopA2Music();a2SoundGameOver();
    if(a2.score>a2.highScore){a2.highScore=a2.score;localStorage.setItem('arcade2High',a2.highScore);}
    if(a2.score>a2.bestScore) a2.bestScore=a2.score;
    document.getElementById('arcade2GameOverScore').textContent=a2.score;
    document.getElementById('arcade2GameOverCorrect').textContent=a2.questionsCorrect+'/'+a2.questionsAnswered;
    document.getElementById('arcade2GameOverAttempts').textContent='Intento '+a2.attempts+' de '+a2.maxAttempts;
    const btns=document.getElementById('arcade2GameOverButtons');btns.innerHTML='';
    const msg=document.getElementById('arcade2GameOverMessage');
    if(a2.attempts<a2.maxAttempts){
        msg.innerHTML='üí™ ¬°No te rindas!<br>Repasa signos en √ó y √∑.<br>Quedan <strong>'+(a2.maxAttempts-a2.attempts)+' intento(s)</strong>.';
        const rb=document.createElement('button');rb.textContent='üîÑ Intentar ('+(a2.attempts+1)+'/'+a2.maxAttempts+')';
        rb.style.cssText='background:linear-gradient(135deg,#9C27B0,#E040FB);color:white;border:none;padding:15px 35px;font-size:1.1em;font-weight:700;border-radius:30px;cursor:pointer;';
        rb.onclick=showA2StartForRetry;btns.appendChild(rb);
        const bb=document.createElement('button');bb.textContent='‚Üê Volver';
        bb.style.cssText='background:rgba(255,255,255,0.1);color:white;border:2px solid rgba(255,255,255,0.2);padding:15px 35px;font-size:1.1em;font-weight:700;border-radius:30px;cursor:pointer;';
        bb.onclick=()=>{exitArcade2();showScreen('session2Screen');};btns.appendChild(bb);
    } else {
        document.getElementById('arcade2FinalScore').textContent=a2.bestScore;
        document.getElementById('arcade2FinalQuestions').textContent=a2.totalQCorrect+'/'+a2.totalQAnswered;
        document.getElementById('arcade2StartScreen').style.display='none';
        document.getElementById('arcade2GameScreen').style.display='none';
        document.getElementById('arcade2GameOverScreen').style.display='none';
        document.getElementById('arcade2WinScreen').style.display='block';
        if(typeof completeSubActivity==='function') completeSubActivity(2,3);
        return;
    }
    document.getElementById('arcade2StartScreen').style.display='none';
    document.getElementById('arcade2GameScreen').style.display='none';
    document.getElementById('arcade2WinScreen').style.display='none';
    document.getElementById('arcade2GameOverScreen').style.display='block';
}

function showA2StartForRetry() {
    document.getElementById('arcade2GameOverScreen').style.display='none';
    document.getElementById('arcade2StartScreen').style.display='block';
    document.getElementById('arcade2AttemptsInfo').style.display='block';
    document.getElementById('arcade2AttemptsText').textContent='Intento '+(a2.attempts+1)+' de '+a2.maxAttempts;
}

function finalizeSession2Arcade() {
    if(typeof completeSubActivity==='function') completeSubActivity(2,3);
    if(typeof finalizeSession2==='function') finalizeSession2();
    else showScreen('session2HierarchyScreen');
}

function resetArcade2Game() {
    cancelAnimationFrame(a2GameLoop);stopA2Music();a2.isRunning=false;a2.attempts=0;
    a2.totalQCorrect=0;a2.totalQAnswered=0;a2.bestScore=0;
    document.getElementById('arcade2StartScreen').style.display='block';
    document.getElementById('arcade2GameScreen').style.display='none';
    document.getElementById('arcade2WinScreen').style.display='none';
    document.getElementById('arcade2GameOverScreen').style.display='none';
    document.getElementById('arcade2QuestionModal').style.display='none';
    document.getElementById('arcade2AttemptsInfo').style.display='none';
}

function exitArcade2() {
    cancelAnimationFrame(a2GameLoop);stopA2Music();a2.isRunning=false;a2.isPaused=false;
    a2.attempts=0;a2.totalQCorrect=0;a2.totalQAnswered=0;a2.bestScore=0;
    document.removeEventListener('keydown',a2KeyDown);document.removeEventListener('keyup',a2KeyUp);
    if(a2Canvas){a2Canvas.removeEventListener('touchstart',a2TouchStart);a2Canvas.removeEventListener('touchend',a2TouchEnd);
        a2Canvas.removeEventListener('mousedown',a2MouseDown);a2Canvas.removeEventListener('mouseup',a2MouseUp);}
    document.getElementById('arcade2StartScreen').style.display='block';
    document.getElementById('arcade2GameScreen').style.display='none';
    document.getElementById('arcade2WinScreen').style.display='none';
    document.getElementById('arcade2GameOverScreen').style.display='none';
    document.getElementById('arcade2QuestionModal').style.display='none';
    document.getElementById('arcade2AttemptsInfo').style.display='none';
}

function initArcadeGame() { /* reemplazado */ }

if (typeof shuffleArray === 'undefined') {
    function shuffleArray(array) {
        for (let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}
        return array;
    }
}


// Funci√≥n original de finalizaci√≥n de sesi√≥n 2
function finalizeSession2() {
    if (!completedSections.includes(2)) {
        completedSections.push(2);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
        updateProgress();
        if (typeof createConfetti === 'function') createConfetti();
    }
    updateProgress();
    showScreen('session2HierarchyScreen');
}

// Mantener shuffleArray disponible globalmente
if (typeof shuffleArray === 'undefined') {
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
}


// === NUEVA L√ìGICA DEL QUIZ DE PR√ÅCTICA (Jerarqu√≠a) ===
// Check Hierarchy interactive practice (8 questions)
function checkS2Hierarchy() {
    const inputs = document.querySelectorAll('.s2h-input');
    let correct = 0, total = inputs.length;
    const results = document.getElementById('s2hResults');
    let html = '';
    inputs.forEach((inp, i) => {
        const ua = inp.value.trim();
        const ca = inp.getAttribute('data-correct');
        const ok = ua === ca;
        if(ok) { correct++; inp.style.border='2px solid #2ecc71'; }
        else { inp.style.border='2px solid #e74c3c'; }
        html += '<p style="margin:6px 0;color:'+(ok?'#2ecc71':'#e74c3c')+';font-size:0.95em;">'+(ok?'‚úÖ':'‚ùå')+' Pregunta '+(i+1)+': '+(ok?'Correcto':'Tu: '+ua+' ‚Üí Correcta: '+ca)+'</p>';
    });
    results.innerHTML = '<h4 style="color:#5C6BC0;margin-bottom:10px;">Resultado: '+correct+'/'+total+'</h4>' + html;
    results.style.display = 'block';
    if(correct >= 6) {
        results.innerHTML += '<p style="color:#27ae60;font-weight:700;font-size:1.1em;margin-top:10px;">üéâ ¬°Bien hecho! Puedes continuar.</p>';
    } else {
        results.innerHTML += '<p style="color:#e74c3c;font-weight:700;margin-top:10px;">Necesitas al menos 6/8. ¬°Revisa e intenta de nuevo!</p>';
    }
}

function submitPracticeQuiz(sectionNum) {
    const inputs = document.querySelectorAll('#session2PracticeScreen .quiz-input');
    const resultList = document.getElementById('practiceResultList');
    const resultsDiv = document.getElementById('practiceResults');
    let correctCount = 0;
    let totalQuestions = 0;

    resultList.innerHTML = '';
    
    inputs.forEach((input, index) => {
        const userAnswer = input.value.trim();
        // Nota: Aseg√∫rate de que las respuestas correctas en el data-correct del HTML son strings (ej: "24", "-6")
        const correctAnswer = input.getAttribute('data-correct').trim();
        const questionNumber = index + 1;
        
        // La comparaci√≥n debe ser estricta, incluyendo el signo negativo si aplica
        const isCorrect = userAnswer === correctAnswer; 

        let listItem = document.createElement('li');
        listItem.style.padding = '10px 0';
        listItem.style.borderBottom = '1px dashed #ccc';

        if (isCorrect) {
            correctCount++;
            listItem.className = 'correct-text';
            listItem.style.color = '#2ecc71';
            listItem.innerHTML = `‚úÖ Pregunta ${questionNumber}: Correcto (Respuesta: ${correctAnswer})`;
            input.style.border = '2px solid #2ecc71';
        } else {
            listItem.className = 'incorrect-text';
            listItem.style.color = '#e74c3c';
            listItem.innerHTML = `‚ùå Pregunta ${questionNumber}: Incorrecto (Tu respuesta: ${userAnswer} | Respuesta Correcta: ${correctAnswer})`;
            input.style.border = '2px solid #e74c3c';
        }
        resultList.appendChild(listItem);
        totalQuestions++;
    });

    document.getElementById('practiceScore').textContent = `${correctCount}/${totalQuestions}`;
    resultsDiv.style.display = 'block';

// Se requiere un m√≠nimo de 16/20 (80%) para aprobar
    if (correctCount >= 16) { 
        document.getElementById('completeSession2Button').style.display = 'block';

// === AGREGAR: MARCAR RETO 5 DE SESI√ìN 2 ===
        completeSubActivity(2, 5);
        // ==========================================
        // Marcar la sesi√≥n como completada DEBE hacerse al final
        if (!completedSections.includes(sectionNum)) {
             completedSections.push(sectionNum);
             localStorage.setItem('completedSections', JSON.stringify(completedSections));
             // Esto actualiza el mapa para desbloquear la Sesi√≥n 3 y asegurar el reingreso a la Sesi√≥n 2
             updateProgress(); 
             createConfetti();
        }
    } else {
        document.getElementById('completeSession2Button').style.display = 'none';
        alert('Necesitas al menos 16/20 correctas para superar el Quiz Final. ¬°Revisa tus respuestas!');
    }
}
// =================================================
// === L√ìGICA DE SESI√ìN 3: JERARQU√çA COMPLETA ===
// =================================================

// Mapa de bloqueo interno para Sesi√≥n 3
const session3Map = {
    'session3TheoryScreen': 1,
    'session3PracticeScreen': 2,
    'session3EscapeRoomScreen': 3  // ‚Üê CAMBIO AQU√ç
};

function updateSession3Nav() {
    const currentProgress = activityProgress.sesion3;
    
    // Tarjetas de navegaci√≥n
    document.querySelectorAll('#session3Screen .session-nav-card').forEach(card => {
        const onclickAttr = card.getAttribute('onclick');
        if (!onclickAttr) return;
        
        // Manejar el caso especial del Escape Room
        if (onclickAttr.includes('openEscapeRoom')) {
            const requiredIndex = 3;
            const isAvailable = requiredIndex <= currentProgress + 1;
            const isCompleted = requiredIndex <= currentProgress;
            
            card.classList.remove('locked', 'unlocked');
            
            if (isCompleted) {
                card.classList.add('unlocked');
                let h4 = card.querySelector('h4');
                h4.textContent = h4.textContent.replace(' ‚úÖ', '');
                h4.textContent += ' ‚úÖ';
            } else if (isAvailable) {
                card.classList.add('unlocked');
            } else {
                card.classList.add('locked');
                card.onclick = () => alert(`üîí Debes completar la Pr√°ctica Progresiva (paso 2) antes de acceder al Escape Room.`);
            }
            return;
        }
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session3Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        card.classList.remove('locked', 'unlocked');
        card.onclick = null;

        if (isCompleted) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
            let h4 = card.querySelector('h4');
            h4.textContent = h4.textContent.replace(' ‚úÖ', '');
            h4.textContent += ' ‚úÖ';
        } else if (isAvailable) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
    
    // Actualizar lista de ruta de aprendizaje
    document.querySelectorAll('#session3Screen .learning-list-item').forEach(item => {
        const onclickAttr = item.getAttribute('onclick');
        if (!onclickAttr) return;
        
        // Escape Room case
        if (onclickAttr.includes('openEscapeRoom')) {
            const requiredIndex = 3;
            const isAvailable = requiredIndex <= currentProgress + 1;
            
            item.classList.remove('locked-item');
            if (!isAvailable) {
                item.classList.add('locked-item');
                item.onclick = () => alert(`üîí Debes completar la Pr√°ctica Progresiva antes de acceder al Escape Room.`);
            }
            return;
        }
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session3Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
}

// Funci√≥n para verificar las 15 respuestas de la pr√°ctica
function submitSession3Practice() {
    const inputs = document.querySelectorAll('#session3PracticeScreen .quiz-input');
    const resultList = document.getElementById('session3PracticeResultList');
    const resultsDiv = document.getElementById('session3PracticeResults');
    const progressFill = document.getElementById('session3ProgressFill');
    
    let correctCount = 0;
    let totalQuestions = 15; // CAMBIO: 15 ejercicios

    resultList.innerHTML = '';
    
    inputs.forEach((input, index) => {
        const userAnswer = input.value.trim();
        const correctAnswer = input.getAttribute('data-correct').trim();
        const questionNumber = index + 1;
        
        // Comparaci√≥n flexible para decimales
        const userNum = parseFloat(userAnswer);
        const correctNum = parseFloat(correctAnswer);
        const isCorrect = Math.abs(userNum - correctNum) < 0.01 || userAnswer === correctAnswer;

        let listItem = document.createElement('li');
        listItem.style.padding = '15px 20px';
        listItem.style.marginBottom = '12px';
        listItem.style.borderRadius = '12px';
        listItem.style.fontSize = '1.15em';
        listItem.style.borderLeft = '8px solid';
        listItem.style.boxShadow = '0 3px 10px rgba(0,0,0,0.15)';
        listItem.style.transition = 'transform 0.3s';

        if (isCorrect) {
            correctCount++;
            listItem.style.borderColor = '#2ecc71';
            listItem.style.background = 'linear-gradient(135deg, #d4edda, #f3fff5)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">‚úÖ</span>
                    <div style="flex: 1;">
                        <span style="font-size: 1.3em; font-weight: 700; color: #27ae60;">Pregunta ${questionNumber}:</span> 
                        <span style="font-weight: 600; color: #1e8449;">¬°Correcto!</span><br>
                        <span style="color: #27ae60;">Respuesta: <strong>${correctAnswer}</strong></span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #2ecc71';
            input.style.background = '#d4edda';
        } else {
            listItem.style.borderColor = '#e74c3c';
            listItem.style.background = 'linear-gradient(135deg, #f8d7da, #fff7f7)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">‚ùå</span>
                    <div style="flex: 1;">
                        <span style="font-size: 1.3em; font-weight: 700; color: #c0392b;">Pregunta ${questionNumber}:</span> 
                        <span style="font-weight: 600; color: #a93226;">Incorrecto</span><br>
                        <span style="color: #c0392b;">Tu respuesta: <strong>${userAnswer || '(vac√≠o)'}</strong></span><br>
                        <span style="color: #27ae60;">Respuesta correcta: <strong>${correctAnswer}</strong></span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #e74c3c';
            input.style.background = '#f8d7da';
        }
        
        listItem.onmouseover = () => { listItem.style.transform = 'translateX(5px)'; };
        listItem.onmouseout = () => { listItem.style.transform = 'translateX(0)'; };
        
        resultList.appendChild(listItem);
    });

    // Actualizar barra de progreso
    const percentage = (correctCount / totalQuestions) * 100;
    progressFill.style.width = `${percentage}%`;
    progressFill.textContent = `${correctCount}/${totalQuestions} (${Math.round(percentage)}%)`;

    // Mostrar resultados
    document.getElementById('session3PracticeScore').textContent = `${correctCount}/${totalQuestions}`;
    resultsDiv.style.display = 'block';

    // Scroll hacia resultados
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

    // Verificar si aprob√≥ (necesita 10/15 = 67%)
    if (correctCount >= 10) {
        // Marcar actividad 2 de sesi√≥n 3 como completada
        completeSubActivity(3, 2);
        
        // Mostrar bot√≥n de avance
        document.getElementById('session3CompleteButton').style.display = 'block';
        
        // Marcar sesi√≥n como completada
        if (!completedSections.includes(3)) {
            completedSections.push(3);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            updateProgress();
            createConfetti();
            
            setTimeout(() => {
                alert(`üéâ ¬°FELICIDADES! Has completado la Sesi√≥n 3 con ${correctCount}/15 correctas.\n\n‚úÖ Sesi√≥n 4 desbloqueada\nüîê Escape Room disponible`);
            }, 500);
        }
    } else {
        document.getElementById('session3CompleteButton').style.display = 'none';
        alert(`üìö Necesitas al menos 10/15 correctas para avanzar.\n\nüìä Tu puntuaci√≥n: ${correctCount}/15\nüí™ Revisa los ejercicios incorrectos y vuelve a intentarlo.`);
    }
}


// Funci√≥n para abrir la pantalla informativa del Escape Room
function openEscapeRoom() {
    // Verificar que haya completado la pr√°ctica
    if (activityProgress.sesion3 < 2) {
        alert('üîí Debes completar la Pr√°ctica Progresiva antes de acceder al Escape Room.');
        return;
    }
    
    // Mostrar la pantalla del Escape Room
    showScreen('session3EscapeRoomScreen');
}

// Funci√≥n para lanzar el Escape Room (link de Genially)
// Funci√≥n para lanzar el Escape Room (link de Genially)
function launchEscapeRoom() {
    const escapeRoomLink = 'https://view.genially.com/68cc2448564a4e8d8e2f9308/interactive-content-numeros-enteros';
    
    // Marcar el escape room como completado (actividad 3 de sesi√≥n 3)
    completeSubActivity(3, 3);
    
    // Detectar si es m√≥vil para mejor compatibilidad
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    
    if (isMobile) {
        // En m√≥vil, redirigir directamente es m√°s confiable
        location.href = escapeRoomLink;
    } else {
        // En PC, abrir en nueva pesta√±a
        window.open(escapeRoomLink, '_blank');
        setTimeout(() => {
            if (confirm('üéâ ¬°El Escape Room se ha abierto en una nueva pesta√±a!\n\n‚úÖ Una vez que completes los 4 niveles del Escape Room, la Sesi√≥n 4 se desbloquear√° autom√°ticamente.\n\n¬øDeseas volver al mapa de sesiones ahora?')) {
                showScreen('sectionsScreen');
            }
        }, 1000);
    }
}





// ========== FUNCIONES PARA SESI√ìN 4 ==========

// Funci√≥n para verificar mini-retos interactivos
function checkMiniAnswer(button, isCorrect) {
    const allButtons = button.parentElement.querySelectorAll('button');
    allButtons.forEach(btn => {
        btn.disabled = true;
        btn.style.opacity = '0.6';
    });
    
    if (isCorrect) {
        button.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
        button.style.color = 'white';
        button.style.transform = 'scale(1.1)';
        button.style.border = '3px solid #2E7D32';
    } else {
        button.style.background = 'linear-gradient(135deg, #F44336, #E53935)';
        button.style.color = 'white';
        button.style.border = '3px solid #C62828';
        // Mostrar la correcta
        allButtons.forEach(btn => {
            if (btn.onclick.toString().includes('true')) {
                btn.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
                btn.style.color = 'white';
                btn.style.border = '3px solid #2E7D32';
                btn.style.opacity = '1';
            }
        });
    }
}

// Funci√≥n para verificar el quiz de Sesi√≥n 4
function submitSession4Quiz() {
    const inputs = document.querySelectorAll('.session4-input');
    const resultList = document.getElementById('session4ResultList');
    const resultsDiv = document.getElementById('session4QuizResults');
    const progressFill = document.getElementById('session4ProgressFill');
    
    let correctCount = 0;
    const totalQuestions = 15;

    resultList.innerHTML = '';
    
    inputs.forEach((input, index) => {
        const userAnswer = input.value.trim().toLowerCase().replace(/\s/g, '');
        const correctAnswer = input.getAttribute('data-correct').toLowerCase().replace(/\s/g, '');
        const questionNumber = index + 1;
        
        // Comparaci√≥n flexible
        let isCorrect = userAnswer === correctAnswer;
        
        // Comparaci√≥n alternativa para fracciones (ej: 3/4 vs 3/4)
        if (!isCorrect && userAnswer.includes('/') && correctAnswer.includes('/')) {
            const userParts = userAnswer.split('/').map(Number);
            const correctParts = correctAnswer.split('/').map(Number);
            if (userParts.length === 2 && correctParts.length === 2) {
                isCorrect = (userParts[0] / userParts[1]) === (correctParts[0] / correctParts[1]);
            }
        }
        
        // Aceptar "s√≠" con tilde tambi√©n
        if (!isCorrect && (correctAnswer === 'si' && (userAnswer === 's√≠' || userAnswer === 'si'))) {
            isCorrect = true;
        }

        let listItem = document.createElement('li');
        listItem.style.padding = '15px 20px';
        listItem.style.marginBottom = '12px';
        listItem.style.borderRadius = '12px';
        listItem.style.fontSize = '1.1em';
        listItem.style.borderLeft = '8px solid';
        listItem.style.boxShadow = '0 3px 10px rgba(0,0,0,0.1)';

        if (isCorrect) {
            correctCount++;
            listItem.style.borderColor = '#4CAF50';
            listItem.style.background = 'linear-gradient(135deg, #E8F5E9, #C8E6C9)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.8em;">‚úÖ</span>
                    <div>
                        <span style="font-weight: 700; color: #2E7D32;">Pregunta ${questionNumber}:</span> 
                        <span style="color: #388E3C;">¬°Correcto!</span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #4CAF50';
            input.style.background = '#E8F5E9';
        } else {
            listItem.style.borderColor = '#F44336';
            listItem.style.background = 'linear-gradient(135deg, #FFEBEE, #FFCDD2)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.8em;">‚ùå</span>
                    <div>
                        <span style="font-weight: 700; color: #C62828;">Pregunta ${questionNumber}:</span> 
                        <span style="color: #D32F2F;">Tu respuesta: ${input.value || '(vac√≠o)'}</span><br>
                        <span style="color: #388E3C;">Respuesta correcta: <strong>${input.getAttribute('data-correct')}</strong></span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #F44336';
            input.style.background = '#FFEBEE';
        }
        
        resultList.appendChild(listItem);
    });

    // Actualizar barra de progreso
    const percentage = (correctCount / totalQuestions) * 100;
    progressFill.style.width = `${percentage}%`;
    progressFill.textContent = `${correctCount}/${totalQuestions} (${Math.round(percentage)}%)`;
    
    // Cambiar color seg√∫n puntaje
    if (percentage >= 67) {
        progressFill.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
    } else if (percentage >= 40) {
        progressFill.style.background = 'linear-gradient(90deg, #FF9800, #FFC107)';
    } else {
        progressFill.style.background = 'linear-gradient(90deg, #F44336, #E57373)';
    }

    // Mostrar resultados
    document.getElementById('session4QuizScore').textContent = `${correctCount}/${totalQuestions}`;
    resultsDiv.style.display = 'block';

    // Scroll hacia resultados
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

    // Verificar si aprob√≥ (10/15 = 67%)
    if (correctCount >= 10) {
        completeSubActivity(4, 4);
        document.getElementById('session4CompleteButton').style.display = 'block';
        
        if (!completedSections.includes(4)) {
            completedSections.push(4);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            updateProgress();
            createConfetti();
            
            setTimeout(() => {
                alert(`üéâ ¬°FELICIDADES! Has completado la Sesi√≥n 4 con ${correctCount}/15 correctas.\n\n‚úÖ ¬°Eres un Maestro de las Fracciones!\nüîì Sesi√≥n 5 desbloqueada`);
            }, 500);
        }
    } else {
        document.getElementById('session4CompleteButton').style.display = 'none';
        alert(`üìö Necesitas al menos 10/15 correctas para completar.\n\nüìä Tu puntuaci√≥n: ${correctCount}/15\nüí™ ¬°Revisa los conceptos y vuelve a intentarlo!`);
    }
}

// Funci√≥n para completar la sesi√≥n 4
function completeSession4() {
    if (!completedSections.includes(4)) {
        completedSections.push(4);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
        updateProgress();
    }
}
// ========== SISTEMA DE BLOQUEO SESI√ìN 4 ==========

// Mapa de pantallas de Sesi√≥n 4 y su orden
const session4Map = {
    'session4Theory1Screen': 1,
    'session4Theory2Screen': 2,
    'session4GameClassScreen': 3,
    'session4ActivityScreen': 4,
    'session4ArcadeScreen': 5
};

// Funci√≥n para actualizar el estado de bloqueo en Sesi√≥n 4
function updateSession4LockState() {
    const currentProgress = activityProgress.sesion4 || 0;
    
    // Actualizar tarjetas de navegaci√≥n
    document.querySelectorAll('#session4Screen .session4-card').forEach(card => {
        const onclickAttr = card.getAttribute('onclick');
        if (!onclickAttr) return;
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session4Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        // Resetear estilos
        card.classList.remove('locked', 'unlocked');
        card.style.opacity = '';
        card.style.cursor = '';
        card.onclick = null;
        
        // Obtener el h4 dentro de la tarjeta
        let h4 = card.querySelector('h4');
        if (h4) {
            h4.textContent = h4.textContent.replace(' ‚úÖ', '').replace(' üîí', '');
        }

        if (isCompleted) {
            card.classList.add('unlocked');
            card.style.opacity = '1';
            card.style.cursor = 'pointer';
            card.onclick = () => showScreen(targetScreen);
            if (h4) h4.textContent += ' ‚úÖ';
        } else if (isAvailable) {
            card.classList.add('unlocked');
            card.style.opacity = '1';
            card.style.cursor = 'pointer';
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.style.opacity = '0.5';
            card.style.cursor = 'not-allowed';
          card.onclick = () => alert(`üîí Debes completar el paso ${requiredIndex - 1} antes de acceder a este contenido.`);
            if (h4) h4.textContent += ' üîí';
        }
    });
    
    // Actualizar lista de ruta de aprendizaje
    document.querySelectorAll('#session4Screen .learning-list-item').forEach(item => {
        const onclickAttr = item.getAttribute('onclick');
        if (!onclickAttr) return;
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session4Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        item.style.opacity = '';
        item.style.cursor = '';
        
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.style.opacity = '0.5';
            item.style.cursor = 'not-allowed';
            item.onclick = (e) => {
                e.preventDefault();
                alert(`üîí Debes completar el paso ${requiredIndex - 1} antes de acceder a este contenido.`);
            };
        } else {
            item.onclick = () => showScreen(targetScreen);
        }
    });
}

// ==========================================
// ==========================================
// QUIZ SESI√ìN 4: RETO DE LAS 4 OPERACIONES
// ==========================================
function checkSession4Quiz() {
    const inputs = document.querySelectorAll('.session4-input');
    let correct = 0;
    const total = inputs.length;
    inputs.forEach(inp => {
        const userAns = inp.value.trim().replace(/\s/g, '');
        const correctAns = inp.dataset.correct;
        const normalize = s => s.replace(/‚àí/g, '-').replace(/\s/g, '');
        if (normalize(userAns) === normalize(correctAns)) {
            correct++;
            inp.style.borderColor = '#4CAF50';
            inp.style.background = 'rgba(76,175,80,0.1)';
        } else {
            inp.style.borderColor = '#F44336';
            inp.style.background = 'rgba(244,67,54,0.1)';
        }
    });
    const pct = Math.round(correct / total * 100);
    const fill = document.getElementById('session4ProgressFill');
    if (fill) fill.style.width = pct + '%';
    const txt = document.getElementById('s4ProgressText');
    if (txt) txt.textContent = correct + '/' + total;
    const res = document.getElementById('s4QuizResult');
    if (res) {
        res.style.display = 'block';
        if (pct >= 80) {
            res.style.background = 'rgba(76,175,80,0.15)';
            res.innerHTML = '<p style="color:#2E7D32;font-size:1.4em;font-weight:700;">üèÜ ¬°Excelente! ' + correct + '/' + total + ' (' + pct + '%)</p><p style="color:#388E3C;">¬°Dominas las 4 operaciones!</p>';
        } else if (pct >= 50) {
            res.style.background = 'rgba(255,152,0,0.15)';
            res.innerHTML = '<p style="color:#E65100;font-size:1.4em;font-weight:700;">‚≠ê Buen intento: ' + correct + '/' + total + ' (' + pct + '%)</p><p style="color:#F57C00;">Revisa los errores.</p>';
        } else {
            res.style.background = 'rgba(244,67,54,0.15)';
            res.innerHTML = '<p style="color:#C62828;font-size:1.4em;font-weight:700;">üí™ Sigue practicando: ' + correct + '/' + total + ' (' + pct + '%)</p><p style="color:#D32F2F;">Repasa la teor√≠a.</p>';
        }
    }
    if (typeof completeSubActivity === 'function' && pct >= 50) completeSubActivity(4, 4);
}

// CULEBRITA FRACCIONARIA - NUEVA VERSI√ìN
// Comida normal, 4 vidas, velocidad progresiva,
// preguntas al chocar, m√∫sica chip-tune, 3 intentos
// ==========================================

let snakeCanvas, snakeCtx;
let snakeGameLoop = null;
let snkFrame = 0;

// === AUDIO ===
let snkAudioCtx = null, snkMusicEnabled = true, snkMusicInterval = null, snkMusicStep = 0;
function initSnkAudio() { try { snkAudioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {} }
function snkNote(f, d, t, v) {
    if (!snkAudioCtx || !snkMusicEnabled) return;
    try { if (snkAudioCtx.state==='suspended') snkAudioCtx.resume();
        const o=snkAudioCtx.createOscillator(), g=snkAudioCtx.createGain();
        o.type=t||'square'; o.frequency.value=f; g.gain.setValueAtTime(v||0.05, snkAudioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, snkAudioCtx.currentTime+d);
        o.connect(g); g.connect(snkAudioCtx.destination); o.start(); o.stop(snkAudioCtx.currentTime+d);
    } catch(e) {}
}
function snkSoundEat() { snkNote(600,0.06,'sine',0.06); setTimeout(()=>snkNote(800,0.08,'sine',0.06),50); }
function snkSoundHit() { snkNote(120,0.3,'sawtooth',0.1); setTimeout(()=>snkNote(80,0.4,'sawtooth',0.07),80); }
function snkSoundCorrect() { snkNote(523,0.1,'square',0.07); setTimeout(()=>snkNote(659,0.1,'square',0.07),80); setTimeout(()=>snkNote(784,0.15,'square',0.07),160); }
function snkSoundWrong() { snkNote(250,0.2,'sawtooth',0.07); setTimeout(()=>snkNote(180,0.3,'sawtooth',0.06),100); }
function snkSoundMilestone() { [523,659,784,1047].forEach((n,i)=>setTimeout(()=>snkNote(n,0.12,'square',0.05),i*70)); }
function snkSoundGameOver() { [350,300,250,180,120].forEach((n,i)=>setTimeout(()=>snkNote(n,0.25,'sawtooth',0.07),i*130)); }

const snkMelody = [262,294,330,349,392,440,392,349,330,294,262,247,220,247,262,294,330,349,392,440,494,523,494,440,392,349,330,294,262,247,220,262];
function startSnkMusic() { if(!snkAudioCtx||!snkMusicEnabled) return; stopSnkMusic(); snkMusicStep=0;
    snkMusicInterval=setInterval(()=>{ if(!snkMusicEnabled||!snk.isRunning||snk.isPaused) return;
        const n=snkMelody[snkMusicStep%snkMelody.length]; snkNote(n,0.14,'triangle',0.025); snkNote(n/2,0.16,'sine',0.015); snkMusicStep++; },220); }
function stopSnkMusic() { if(snkMusicInterval){clearInterval(snkMusicInterval);snkMusicInterval=null;} }
function toggleSnkMusic() { snkMusicEnabled=!snkMusicEnabled; document.getElementById('snkMuteBtn').textContent=snkMusicEnabled?'üîä':'üîá';
    if(!snkMusicEnabled) stopSnkMusic(); else if(snk.isRunning&&!snk.isPaused) startSnkMusic(); }

// === ESTADO ===
const snk = {
    snake: [], dir: 'right', nextDir: 'right',
    food: null, obstacles: [], gridSize: 20,
    canvasW: 600, canvasH: 400,
    score: 0, lives: 4,
    baseSpeed: 140, speed: 140, maxSpeed: 50,
    isRunning: false, isPaused: false,
    invincible: false, invincibleTimer: 0,
    questionsAnswered: 0, questionsCorrect: 0,
    attempts: 0, maxAttempts: 3,
    totalQCorrect: 0, totalQAnswered: 0, bestScore: 0,
    highScore: parseInt(localStorage.getItem('snakeHigh')) || 0,
    usedQuestions: [], lastMilestone: 0,
    bgStars: [], particles: [],
    obstacleTimer: 0, nextObstacleAt: 3 // cada cu√°ntas comidas aparece un obst√°culo nuevo
};

// === PREGUNTAS ===
const snkQuestions = [
    { q: "Simplifica 12/18", opts: ["2/3","4/6","3/4","6/9"], c:0, exp: "MCD(12,18)=6. 12√∑6=2, 18√∑6=3 ‚Üí 2/3." },
    { q: "Simplifica ‚àí24/36", opts: ["-2/3","2/3","-4/6","4/6"], c:0, exp: "MCD(24,36)=12. ‚àí24√∑12=‚àí2, 36√∑12=3 ‚Üí ‚àí2/3." },
    { q: "Simplifica 45/60", opts: ["3/4","9/12","15/20","5/6"], c:0, exp: "MCD(45,60)=15. 45√∑15=3, 60√∑15=4 ‚Üí 3/4." },
    { q: "Amplifica 2/3 por 5", opts: ["10/15","7/8","2/15","10/3"], c:0, exp: "(2√ó5)/(3√ó5) = 10/15." },
    { q: "Amplifica ‚àí3/4 por 3", opts: ["-9/12","9/12","-3/12","9/4"], c:0, exp: "(‚àí3√ó3)/(4√ó3) = ‚àí9/12." },
    { q: "MCD de 16 y 24", opts: ["8","4","16","6"], c:0, exp: "16=2‚Å¥, 24=2¬≥√ó3. MCD=2¬≥=8." },
    { q: "MCD de 15 y 20", opts: ["5","10","15","4"], c:0, exp: "15=3√ó5, 20=2¬≤√ó5. MCD=5." },
    { q: "3/5 + 1/5 = ?", opts: ["4/5","4/10","2/5","3/10"], c:0, exp: "Mismo denominador: (3+1)/5 = 4/5." },
    { q: "7/8 ‚àí 3/8 = ?", opts: ["1/2","4/8","4/16","2/8"], c:0, exp: "(7‚àí3)/8 = 4/8 = 1/2." },
    { q: "2/3 + 1/4 = ?", opts: ["11/12","3/7","3/12","8/12"], c:0, exp: "MCM(3,4)=12. 8/12+3/12=11/12." },
    { q: "5/6 ‚àí 1/4 = ?", opts: ["7/12","4/2","1/2","6/10"], c:0, exp: "MCM(6,4)=12. 10/12‚àí3/12=7/12." },
    { q: "‚àí2/3 + 5/6 = ?", opts: ["1/6","-1/6","3/6","1/2"], c:0, exp: "MCM(3,6)=6. ‚àí4/6+5/6=1/6." },
    { q: "‚àí1/2 ‚àí 1/3 = ?", opts: ["-5/6","5/6","-2/5","1/6"], c:0, exp: "MCM(2,3)=6. ‚àí3/6‚àí2/6=‚àí5/6." },
    { q: "2/3 √ó 3/4 = ?", opts: ["1/2","6/12","5/7","2/4"], c:0, exp: "(2√ó3)/(3√ó4)=6/12=1/2." },
    { q: "(‚àí3/5) √ó (5/9) = ?", opts: ["-1/3","1/3","-15/45","3/5"], c:0, exp: "(‚àí3√ó5)/(5√ó9)=‚àí15/45=‚àí1/3." },
    { q: "(‚àí2/7) √ó (‚àí7/4) = ?", opts: ["1/2","-1/2","14/28","2/4"], c:0, exp: "(‚àí)(‚àí)=(+). (2√ó7)/(7√ó4)=14/28=1/2." },
    { q: "4/5 √∑ 2/3 = ?", opts: ["6/5","8/15","2/5","12/10"], c:0, exp: "4/5 √ó 3/2 = 12/10 = 6/5." },
    { q: "3/4 √∑ 1/2 = ?", opts: ["3/2","3/8","6/4","1/2"], c:0, exp: "3/4 √ó 2/1 = 6/4 = 3/2." },
    { q: "(‚àí5/6) √∑ (1/3) = ?", opts: ["-5/2","5/2","-5/18","5/18"], c:0, exp: "‚àí5/6 √ó 3/1 = ‚àí15/6 = ‚àí5/2." },
    { q: "(‚àí2/3) √∑ (‚àí4/9) = ?", opts: ["3/2","-3/2","8/27","2/3"], c:0, exp: "‚àí2/3 √ó ‚àí9/4 = 18/12 = 3/2. (‚àí)(‚àí)=(+)" },
    { q: "Simplifica 8/20", opts: ["2/5","4/10","1/5","8/10"], c:0, exp: "MCD(8,20)=4. 8√∑4=2, 20√∑4=5 ‚Üí 2/5." },
    { q: "Simplifica 14/21", opts: ["2/3","7/21","14/7","1/3"], c:0, exp: "MCD(14,21)=7. 14√∑7=2, 21√∑7=3 ‚Üí 2/3." },
    { q: "1/2 + 1/3 = ?", opts: ["5/6","2/5","3/6","1/5"], c:0, exp: "MCM(2,3)=6. 3/6+2/6=5/6." },
    { q: "3/4 √ó (‚àí2/3) = ?", opts: ["-1/2","1/2","-6/12","6/7"], c:0, exp: "(3√ó‚àí2)/(4√ó3)=‚àí6/12=‚àí1/2." },
    { q: "5/8 √∑ 5/4 = ?", opts: ["1/2","25/32","5/2","4/8"], c:0, exp: "5/8 √ó 4/5 = 20/40 = 1/2." },
    { q: "(+) √ó (‚àí) = ?", opts: ["Negativo","Positivo","Cero","No se puede"], c:0, exp: "Signos diferentes ‚Üí resultado Negativo." },
    { q: "(‚àí) √∑ (‚àí) = ?", opts: ["Positivo","Negativo","Cero","No se puede"], c:0, exp: "Signos iguales ‚Üí resultado Positivo." },
    { q: "Simplifica 36/48", opts: ["3/4","6/8","9/12","12/16"], c:0, exp: "MCD(36,48)=12. 36√∑12=3, 48√∑12=4 ‚Üí 3/4." },
    { q: "Amplifica 1/3 por 7", opts: ["7/21","1/21","7/3","3/21"], c:0, exp: "(1√ó7)/(3√ó7) = 7/21." },
    { q: "3/10 + 2/5 = ?", opts: ["7/10","5/15","1/2","5/10"], c:0, exp: "MCM(10,5)=10. 3/10+4/10=7/10." },
];

// === CANVAS ===
function initSnkCanvas() {
    snakeCanvas = document.getElementById('snakeCanvas');
    snakeCtx = snakeCanvas.getContext('2d');
    const w = Math.min(600, window.innerWidth - 40);
    const h = Math.min(400, w * 0.67);
    snk.canvasW = Math.floor(w / snk.gridSize) * snk.gridSize;
    snk.canvasH = Math.floor(h / snk.gridSize) * snk.gridSize;
    const dpr = window.devicePixelRatio || 1;
    snakeCanvas.width = snk.canvasW * dpr; snakeCanvas.height = snk.canvasH * dpr;
    snakeCanvas.style.width = snk.canvasW + 'px'; snakeCanvas.style.height = snk.canvasH + 'px';
    snakeCtx.scale(dpr, dpr);
    snk.bgStars = [];
    for (let i = 0; i < 50; i++) snk.bgStars.push({x:Math.random()*snk.canvasW,y:Math.random()*snk.canvasH,s:Math.random()*1.5+0.5,b:Math.random()});
}

function startSnakeGame() {
    if (!snkAudioCtx) initSnkAudio();
    snkMusicEnabled = document.getElementById('snkMusicToggle').checked;
    initSnkCanvas(); resetSnkState(); snk.attempts++;
    document.getElementById('snakeStartScreen').style.display='none';
    document.getElementById('snakeGameScreen').style.display='block';
    document.getElementById('snakeWinScreen').style.display='none';
    document.getElementById('snakeGameOverScreen').style.display='none';
    document.addEventListener('keydown', snkKeyDown);
    snakeCanvas.addEventListener('touchstart', snkTouchStart, {passive:false});
    snakeCanvas.addEventListener('touchend', snkTouchEnd, {passive:false});
    snk.isRunning = true;
    document.getElementById('snkMuteBtn').textContent = snkMusicEnabled ? 'üîä' : 'üîá';
    startSnkMusic(); snkMainLoop();
}

function resetSnkState() {
    const sx = Math.floor(snk.canvasW / snk.gridSize / 4) * snk.gridSize;
    const sy = Math.floor(snk.canvasH / snk.gridSize / 2) * snk.gridSize;
    snk.snake = [{x:sx,y:sy},{x:sx-snk.gridSize,y:sy},{x:sx-snk.gridSize*2,y:sy}];
    snk.dir = 'right'; snk.nextDir = 'right';
    snk.score = 0; snk.lives = 4; snk.speed = snk.baseSpeed;
    snk.isRunning = false; snk.isPaused = false;
    snk.invincible = false; snk.invincibleTimer = 0;
    snk.questionsAnswered = 0; snk.questionsCorrect = 0;
    snk.usedQuestions = []; snk.lastMilestone = 0;
    snk.food = null; snk.obstacles = []; snk.particles = [];
    snk.obstacleTimer = 0; snk.nextObstacleAt = 3;
    snkFrame = 0;
    spawnSnkFood();
    updateSnkHUD();
}

// === OBST√ÅCULOS ===
function spawnSnkObstacle() {
    let pos, tries = 0;
    do {
        pos = { x: Math.floor(Math.random() * (snk.canvasW / snk.gridSize)) * snk.gridSize,
                y: Math.floor(Math.random() * (snk.canvasH / snk.gridSize)) * snk.gridSize };
        tries++;
        // No colocar sobre la serpiente, comida u otros obst√°culos
        const onSnake = snk.snake.some(s => Math.abs(s.x - pos.x) < snk.gridSize*2 && Math.abs(s.y - pos.y) < snk.gridSize*2);
        const onFood = snk.food && pos.x === snk.food.x && pos.y === snk.food.y;
        const onObs = snk.obstacles.some(o => o.x === pos.x && o.y === pos.y);
        if (!onSnake && !onFood && !onObs) break;
    } while (tries < 80);
    if (tries < 80) {
        snk.obstacles.push({ x: pos.x, y: pos.y, type: Math.random() < 0.5 ? 'rock' : 'crystal', rot: Math.random()*Math.PI*2 });
    }
}

// === CONTROLES ===
function snkKeyDown(e) {
    if (!snk.isRunning || snk.isPaused) return;
    if ((e.key==='ArrowUp'||e.key==='w') && snk.dir!=='down') { snk.nextDir='up'; e.preventDefault(); }
    if ((e.key==='ArrowDown'||e.key==='s') && snk.dir!=='up') { snk.nextDir='down'; e.preventDefault(); }
    if ((e.key==='ArrowLeft'||e.key==='a') && snk.dir!=='right') { snk.nextDir='left'; e.preventDefault(); }
    if ((e.key==='ArrowRight'||e.key==='d') && snk.dir!=='left') { snk.nextDir='right'; e.preventDefault(); }
}
let snkTouchX=0, snkTouchY=0;
function snkTouchStart(e) { e.preventDefault(); snkTouchX=e.touches[0].clientX; snkTouchY=e.touches[0].clientY; }
function snkTouchEnd(e) { e.preventDefault(); if(!snk.isRunning||snk.isPaused) return;
    const dx=e.changedTouches[0].clientX-snkTouchX, dy=e.changedTouches[0].clientY-snkTouchY;
    if(Math.abs(dx)>Math.abs(dy)){if(dx>20&&snk.dir!=='left')snk.nextDir='right';else if(dx<-20&&snk.dir!=='right')snk.nextDir='left';}
    else{if(dy>20&&snk.dir!=='up')snk.nextDir='down';else if(dy<-20&&snk.dir!=='down')snk.nextDir='up';} }

// === COMIDA ===
function spawnSnkFood() {
    let pos, tries = 0;
    do {
        pos = { x: Math.floor(Math.random() * (snk.canvasW / snk.gridSize)) * snk.gridSize,
                y: Math.floor(Math.random() * (snk.canvasH / snk.gridSize)) * snk.gridSize };
        tries++;
        const onSnake = snk.snake.some(s => s.x === pos.x && s.y === pos.y);
        const onObs = snk.obstacles.some(o => o.x === pos.x && o.y === pos.y);
        if (!onSnake && !onObs) break;
    } while (tries < 100);
    snk.food = pos;
}

// === LOOP ===
function snkMainLoop() {
    if (!snk.isRunning) return;
    if (snk.isPaused) { snakeGameLoop = setTimeout(snkMainLoop, snk.speed); return; }
    snkFrame++;
    snk.dir = snk.nextDir;
    
    // Mover
    const head = { ...snk.snake[0] };
    if (snk.dir==='up') head.y -= snk.gridSize;
    if (snk.dir==='down') head.y += snk.gridSize;
    if (snk.dir==='left') head.x -= snk.gridSize;
    if (snk.dir==='right') head.x += snk.gridSize;
    
    // Colisi√≥n paredes
    if (head.x < 0 || head.x >= snk.canvasW || head.y < 0 || head.y >= snk.canvasH) {
        snkHit(); return;
    }
    // Colisi√≥n cuerpo
    if (!snk.invincible && snk.snake.some((s, i) => i > 0 && s.x === head.x && s.y === head.y)) {
        snkHit(); return;
    }
    // Colisi√≥n obst√°culos
    if (!snk.invincible && snk.obstacles.some(o => o.x === head.x && o.y === head.y)) {
        // Part√≠culas de choque
        for(let i=0;i<10;i++) snk.particles.push({x:head.x+10,y:head.y+10,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5,life:25,color:Math.random()<0.5?'#FF5252':'#E040FB',size:2+Math.random()*4});
        snkHit(); return;
    }
    
    snk.snake.unshift(head);
    
    // Comer comida
    if (snk.food && head.x === snk.food.x && head.y === snk.food.y) {
        snkSoundEat();
        snk.score += 10;
        for (let i=0;i<6;i++) snk.particles.push({x:snk.food.x+10,y:snk.food.y+10,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,life:20,color:'#FF5252',size:2+Math.random()*3});
        spawnSnkFood();
        // Velocidad aumenta con cada comida
        snk.speed = Math.max(snk.maxSpeed, snk.speed - 2);
        // Cada N comidas aparece un obst√°culo nuevo
        snk.obstacleTimer++;
        if (snk.obstacleTimer >= snk.nextObstacleAt) {
            snk.obstacleTimer = 0;
            spawnSnkObstacle();
            // Obst√°culos m√°s frecuentes conforme avanza
            if (snk.nextObstacleAt > 2) snk.nextObstacleAt = Math.max(2, snk.nextObstacleAt - 0.2);
        }
        const m = Math.floor(snk.score / 50);
        if (m > snk.lastMilestone) { snk.lastMilestone = m; snkSoundMilestone(); }
    } else {
        snk.snake.pop();
    }
    
    if (snk.invincible) { snk.invincibleTimer--; if (snk.invincibleTimer <= 0) snk.invincible = false; }
    snk.particles = snk.particles.filter(p => { p.x+=p.vx; p.y+=p.vy; p.life--; return p.life > 0; });
    
    updateSnkHUD();
    drawSnkGame();
    snakeGameLoop = setTimeout(snkMainLoop, snk.speed);
}

function snkHit() {
    snk.isPaused = true; stopSnkMusic(); snkSoundHit();
    showSnkQuestion();
}

// === HUD ===
function updateSnkHUD() {
    document.getElementById('snkScore').textContent = snk.score;
    const spd = ((snk.baseSpeed - snk.speed) / (snk.baseSpeed - snk.maxSpeed) * 9 + 1).toFixed(1);
    document.getElementById('snkSpeed').textContent = spd + 'x';
    const hearts = document.querySelectorAll('.snkHeart');
    hearts.forEach((h,i) => { h.style.opacity=i<snk.lives?'1':'0.2'; h.style.filter=i<snk.lives?'none':'grayscale(100%)'; h.style.transform=i<snk.lives?'scale(1)':'scale(0.7)'; });
}

// === DIBUJAR ===
function drawSnkGame() {
    const c=snakeCtx, W=snk.canvasW, H=snk.canvasH, G=snk.gridSize;
    const bg=c.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'#0a0020');bg.addColorStop(0.4,'#120030');bg.addColorStop(1,'#1a0045');
    c.fillStyle=bg;c.fillRect(0,0,W,H);
    
    // Estrellas fondo
    snk.bgStars.forEach(s=>{const br=0.3+0.4*(0.5+0.5*Math.sin(snkFrame*0.015+s.b*10));
        c.fillStyle=`rgba(200,180,255,${br})`;c.beginPath();c.arc(s.x,s.y,s.s,0,Math.PI*2);c.fill();});
    
    // Grid sutil
    c.strokeStyle='rgba(156,39,176,0.05)';c.lineWidth=0.5;
    for(let i=0;i<=W;i+=G){c.beginPath();c.moveTo(i,0);c.lineTo(i,H);c.stroke();}
    for(let i=0;i<=H;i+=G){c.beginPath();c.moveTo(0,i);c.lineTo(W,i);c.stroke();}
    
    // Part√≠culas
    snk.particles.forEach(p=>{c.globalAlpha=p.life/20;c.fillStyle=p.color;c.beginPath();c.arc(p.x,p.y,p.size,0,Math.PI*2);c.fill();});
    c.globalAlpha=1;
    
    // Comida (manzana 3D)
    if(snk.food){const fx=snk.food.x+G/2,fy=snk.food.y+G/2,t=Date.now()*0.004;
        const pulse=1+0.12*Math.sin(t);
        c.save();c.translate(fx,fy);c.scale(pulse,pulse);
        // Sombra
        c.shadowColor='#FF1744';c.shadowBlur=15;
        // Manzana
        const gr=c.createRadialGradient(-3,-3,2,0,0,G*0.5);
        gr.addColorStop(0,'#FF6B6B');gr.addColorStop(0.6,'#F44336');gr.addColorStop(1,'#B71C1C');
        c.fillStyle=gr;c.beginPath();c.arc(0,0,G*0.45,0,Math.PI*2);c.fill();
        // Brillo
        c.shadowBlur=0;c.fillStyle='rgba(255,255,255,0.3)';
        c.beginPath();c.ellipse(-2,-3,G*0.18,G*0.12,-0.3,0,Math.PI*2);c.fill();
        // Tallo
        c.strokeStyle='#4CAF50';c.lineWidth=2;c.beginPath();c.moveTo(0,-G*0.4);c.quadraticCurveTo(3,-G*0.6,5,-G*0.55);c.stroke();
        // Hoja
        c.fillStyle='#66BB6A';c.beginPath();c.ellipse(4,-G*0.52,5,3,0.5,0,Math.PI*2);c.fill();
        c.restore();}
    
    // Obst√°culos (rocas y cristales 3D)
    snk.obstacles.forEach(ob => {
        const ox = ob.x + snk.gridSize/2, oy = ob.y + snk.gridSize/2, r = snk.gridSize * 0.45;
        c.save(); c.translate(ox, oy); c.rotate(ob.rot);
        if (ob.type === 'rock') {
            // Roca irregular marr√≥n
            c.shadowColor = 'rgba(121,85,72,0.5)'; c.shadowBlur = 8;
            c.fillStyle = '#795548'; c.strokeStyle = '#5D4037'; c.lineWidth = 1.5;
            c.beginPath();
            for(let i=0;i<7;i++){const ang=(Math.PI*2*i)/7, d=r*(0.7+((i*37)%10)/30);
                if(i===0) c.moveTo(Math.cos(ang)*d, Math.sin(ang)*d); else c.lineTo(Math.cos(ang)*d, Math.sin(ang)*d);}
            c.closePath(); c.fill(); c.stroke();
            c.shadowBlur = 0;
            // Detalle de textura
            c.fillStyle = 'rgba(93,64,55,0.6)'; c.beginPath(); c.arc(-r*0.2, -r*0.1, r*0.22, 0, Math.PI*2); c.fill();
            c.fillStyle = 'rgba(255,255,255,0.1)'; c.beginPath(); c.arc(r*0.15, -r*0.2, r*0.15, 0, Math.PI*2); c.fill();
        } else {
            // Cristal p√∫rpura hexagonal
            c.shadowColor = 'rgba(224,64,251,0.5)'; c.shadowBlur = 12;
            c.fillStyle = '#CE93D8'; c.strokeStyle = '#AB47BC'; c.lineWidth = 1.5;
            c.beginPath();
            for(let i=0;i<6;i++){const ang=(Math.PI*2*i)/6;
                if(i===0) c.moveTo(Math.cos(ang)*r, Math.sin(ang)*r); else c.lineTo(Math.cos(ang)*r, Math.sin(ang)*r);}
            c.closePath(); c.fill(); c.stroke();
            c.shadowBlur = 0;
            // Brillo del cristal
            c.fillStyle = 'rgba(255,255,255,0.35)'; c.beginPath(); c.arc(0, -r*0.2, r*0.25, 0, Math.PI*2); c.fill();
            // Destellos
            c.fillStyle = 'rgba(255,255,255,0.15)'; c.beginPath(); c.arc(-r*0.3, r*0.1, r*0.12, 0, Math.PI*2); c.fill();
        }
        c.restore();
    });
    
    // Serpiente 3D
    const len=snk.snake.length;
    snk.snake.forEach((seg,i)=>{
        if(snk.invincible&&snkFrame%4<2&&i===0) return;
        const isHead=i===0;const t=i/Math.max(1,len-1);
        const hue=300-t*40,sat=80-t*20,li=isHead?55:45-t*10;
        const px=seg.x+1,py=seg.y+1,pw=G-2,ph=G-2,cx=seg.x+G/2,cy=seg.y+G/2;
        // Sombra
        c.fillStyle='rgba(0,0,0,0.3)';c.beginPath();c.roundRect(px+2,py+2,pw,ph,isHead?7:5);c.fill();
        // Cuerpo
        const bg2=c.createLinearGradient(px,py,px+pw,py+ph);
        bg2.addColorStop(0,`hsl(${hue},${sat}%,${li+20}%)`);bg2.addColorStop(0.5,`hsl(${hue},${sat}%,${li}%)`);bg2.addColorStop(1,`hsl(${hue},${sat}%,${li-15}%)`);
        c.fillStyle=bg2;c.beginPath();c.roundRect(px,py,pw,ph,isHead?7:5);c.fill();
        // Borde luminoso
        c.strokeStyle=`hsla(${hue},90%,70%,0.3)`;c.lineWidth=1;c.beginPath();c.roundRect(px,py,pw,ph,isHead?7:5);c.stroke();
        // Brillo
        c.fillStyle='rgba(255,255,255,0.18)';c.beginPath();c.roundRect(px+2,py+1,pw-4,ph*0.35,3);c.fill();
        // Ojos
        if(isHead){let e1,e2;
            switch(snk.dir){case'right':e1={x:cx+3,y:cy-4};e2={x:cx+3,y:cy+4};break;case'left':e1={x:cx-3,y:cy-4};e2={x:cx-3,y:cy+4};break;
                case'up':e1={x:cx-4,y:cy-3};e2={x:cx+4,y:cy-3};break;case'down':e1={x:cx-4,y:cy+3};e2={x:cx+4,y:cy+3};break;}
            [e1,e2].forEach(eye=>{c.fillStyle='#fff';c.beginPath();c.arc(eye.x,eye.y,3.5,0,Math.PI*2);c.fill();
                c.fillStyle='#1a0030';c.beginPath();c.arc(eye.x+0.5,eye.y+0.5,2,0,Math.PI*2);c.fill();
                c.fillStyle='rgba(255,255,255,0.9)';c.beginPath();c.arc(eye.x-0.8,eye.y-0.8,0.8,0,Math.PI*2);c.fill();});}
        if(!isHead&&i%2===0){c.fillStyle='rgba(255,255,255,0.05)';c.beginPath();c.arc(cx,cy,3,0,Math.PI*2);c.fill();}
    });
    
    // Score en canvas
    c.fillStyle='#fff';c.font='bold 12px monospace';c.textAlign='left';c.fillText('SCORE: '+String(snk.score).padStart(4,'0'),8,16);
    const spd=((snk.baseSpeed-snk.speed)/(snk.baseSpeed-snk.maxSpeed)*9+1).toFixed(1);
    c.fillStyle=parseFloat(spd)>5?'#FF5252':parseFloat(spd)>3?'#FFB74D':'#CE93D8';
    c.font='bold 10px Arial';c.fillText('VEL: '+spd+'x',8,30);
    
    // Invincible indicator
    if(snk.invincible){c.strokeStyle='rgba(156,39,176,0.4)';c.lineWidth=2;
        c.beginPath();c.arc(snk.snake[0].x+G/2,snk.snake[0].y+G/2,G,0,Math.PI*2);c.stroke();}
}

// === PREGUNTAS ===
function getSnkQuestion() {
    if(snk.usedQuestions.length>=snkQuestions.length) snk.usedQuestions=[];
    let i;do{i=Math.floor(Math.random()*snkQuestions.length);}while(snk.usedQuestions.includes(i));
    snk.usedQuestions.push(i);return{...snkQuestions[i]};
}

function showSnkQuestion() {
    const q=getSnkQuestion();
    document.getElementById('snkQuestionContent').textContent=q.q;
    document.getElementById('snkLivesRemaining').textContent='Vidas restantes: '+snk.lives;
    const opts=document.getElementById('snkAnswerOptions');opts.innerHTML='';
    const idx=[0,1,2,3];for(let i=3;i>0;i--){const j=Math.floor(Math.random()*(i+1));[idx[i],idx[j]]=[idx[j],idx[i]];}
    idx.forEach(oi=>{
        const btn=document.createElement('button');btn.textContent=q.opts[oi];
        btn.style.cssText='background:linear-gradient(135deg,rgba(186,104,200,0.3),rgba(186,104,200,0.1));color:white;border:2px solid rgba(186,104,200,0.5);padding:15px;font-size:1.2em;font-weight:700;border-radius:15px;cursor:pointer;transition:all 0.2s;';
        btn.onmouseover=()=>{btn.style.background='linear-gradient(135deg,#AB47BC,#7B1FA2)';btn.style.transform='scale(1.05)';};
        btn.onmouseout=()=>{btn.style.background='linear-gradient(135deg,rgba(186,104,200,0.3),rgba(186,104,200,0.1))';btn.style.transform='scale(1)';};
        btn.onclick=()=>handleSnkAnswer(oi===q.c,q,opts);opts.appendChild(btn);});
    document.getElementById('snkQuestionFeedback').style.display='none';
    document.getElementById('snkContinueBtn').style.display='none';
    document.getElementById('snkQuestionModal').style.display='flex';
}

function handleSnkAnswer(correct,question,container) {
    snk.questionsAnswered++;snk.totalQAnswered++;
    container.querySelectorAll('button').forEach(b=>{b.onclick=null;b.style.cursor='default';b.style.opacity='0.5';});
    const fb=document.getElementById('snkQuestionFeedback'),ft=document.getElementById('snkFeedbackText'),fe=document.getElementById('snkFeedbackExp'),cb=document.getElementById('snkContinueBtn');
    if(correct){snk.questionsCorrect++;snk.totalQCorrect++;snkSoundCorrect();
        fb.style.background='rgba(76,175,80,0.2)';fb.style.border='2px solid #4CAF50';
        ft.style.color='#69F0AE';ft.textContent='‚úÖ ¬°CORRECTO! No pierdes vida.';fe.style.color='#A5D6A7';
    } else {snk.lives--;snkSoundWrong();updateSnkHUD();
        fb.style.background='rgba(244,67,54,0.2)';fb.style.border='2px solid #F44336';
        ft.style.color='#FF5252';ft.textContent='‚ùå Incorrecto. Pierdes vida. ('+snk.lives+' restantes)';fe.style.color='#FFCDD2';}
    fe.textContent=question.exp;fb.style.display='block';
    cb.style.display='inline-block';cb.textContent=snk.lives>0?'‚ñ∂ Continuar Jugando':'üíî Ver Resultado';
}

function snkContinueAfterQuestion() {
    document.getElementById('snkQuestionModal').style.display='none';
    if(snk.lives<=0){snkGameOver();return;}
    // Reiniciar posici√≥n
    const sx=Math.floor(snk.canvasW/snk.gridSize/4)*snk.gridSize,sy=Math.floor(snk.canvasH/snk.gridSize/2)*snk.gridSize;
    snk.snake=[{x:sx,y:sy},{x:sx-snk.gridSize,y:sy},{x:sx-snk.gridSize*2,y:sy}];
    snk.dir='right';snk.nextDir='right';
    snk.invincible=true;snk.invincibleTimer=15;
    snk.isPaused=false;spawnSnkFood();startSnkMusic();
    drawSnkGame();snkMainLoop();
}

// === GAME OVER ===
function snkGameOver() {
    snk.isRunning=false;clearTimeout(snakeGameLoop);stopSnkMusic();snkSoundGameOver();
    if(snk.score>snk.highScore){snk.highScore=snk.score;localStorage.setItem('snakeHigh',snk.highScore);}
    if(snk.score>snk.bestScore) snk.bestScore=snk.score;
    document.getElementById('snkGameOverScore').textContent=snk.score;
    document.getElementById('snkGameOverCorrect').textContent=snk.questionsCorrect+'/'+snk.questionsAnswered;
    document.getElementById('snkGameOverAttempts').textContent='Intento '+snk.attempts+' de '+snk.maxAttempts;
    const btns=document.getElementById('snkGameOverButtons');btns.innerHTML='';
    if(snk.attempts<snk.maxAttempts){
        const rb=document.createElement('button');rb.textContent='üîÑ Intentar ('+(snk.attempts+1)+'/'+snk.maxAttempts+')';
        rb.style.cssText='background:linear-gradient(135deg,#9C27B0,#E040FB);color:white;border:none;padding:15px 35px;font-size:1.1em;font-weight:700;border-radius:30px;cursor:pointer;';
        rb.onclick=showSnkRetry;btns.appendChild(rb);
        const bb=document.createElement('button');bb.textContent='‚Üê Volver';
        bb.style.cssText='background:rgba(255,255,255,0.1);color:white;border:2px solid rgba(255,255,255,0.2);padding:15px 35px;font-size:1.1em;font-weight:700;border-radius:30px;cursor:pointer;';
        bb.onclick=()=>{exitSnakeGame();showScreen('session4Screen');};btns.appendChild(bb);
    } else {
        document.getElementById('snkFinalScore').textContent=snk.bestScore;
        document.getElementById('snkFinalQuestions').textContent=snk.totalQCorrect+'/'+snk.totalQAnswered;
        document.getElementById('snakeGameOverScreen').style.display='none';
        document.getElementById('snakeWinScreen').style.display='block';
        if(typeof completeSubActivity==='function') completeSubActivity(4,5);
        return;
    }
    document.getElementById('snakeStartScreen').style.display='none';
    document.getElementById('snakeGameScreen').style.display='none';
    document.getElementById('snakeWinScreen').style.display='none';
    document.getElementById('snakeGameOverScreen').style.display='block';
}

function showSnkRetry() {
    document.getElementById('snakeGameOverScreen').style.display='none';
    document.getElementById('snakeStartScreen').style.display='block';
    document.getElementById('snkAttemptsInfo').style.display='block';
    document.getElementById('snkAttemptsText').textContent='Intento '+(snk.attempts+1)+' de '+snk.maxAttempts;
}

function finalizeSnakeArcade() {
    if(typeof completeSubActivity==='function') completeSubActivity(4,5);
    showScreen('session4Screen');
}

function resetSnakeGame() {
    clearTimeout(snakeGameLoop);stopSnkMusic();snk.isRunning=false;snk.attempts=0;
    snk.totalQCorrect=0;snk.totalQAnswered=0;snk.bestScore=0;
    document.getElementById('snakeStartScreen').style.display='block';
    document.getElementById('snakeGameScreen').style.display='none';
    document.getElementById('snakeWinScreen').style.display='none';
    document.getElementById('snakeGameOverScreen').style.display='none';
    document.getElementById('snkQuestionModal').style.display='none';
    document.getElementById('snkAttemptsInfo').style.display='none';
}

function exitSnakeGame() {
    clearTimeout(snakeGameLoop);stopSnkMusic();snk.isRunning=false;snk.isPaused=false;
    snk.attempts=0;snk.totalQCorrect=0;snk.totalQAnswered=0;snk.bestScore=0;
    document.removeEventListener('keydown',snkKeyDown);
    if(snakeCanvas){snakeCanvas.removeEventListener('touchstart',snkTouchStart);snakeCanvas.removeEventListener('touchend',snkTouchEnd);}
    document.getElementById('snakeStartScreen').style.display='block';
    document.getElementById('snakeGameScreen').style.display='none';
    document.getElementById('snakeWinScreen').style.display='none';
    document.getElementById('snakeGameOverScreen').style.display='none';
    document.getElementById('snkQuestionModal').style.display='none';
    document.getElementById('snkAttemptsInfo').style.display='none';
}


// ==========================================
// ENTERO RUNNER - JUEGO TIPO DINO PARA 8¬∞ GRADO
// 4 vidas, velocidad progresiva, 3 intentos, con m√∫sica
// ==========================================

let dinoCanvas, dinoCtx;
let dinoGameLoop = null;
let dinoAnimFrame = 0;

// === SISTEMA DE AUDIO ===
let dinoAudioCtx = null;
let dinoMusicEnabled = true;
let dinoMusicInterval = null;
let dinoMusicStep = 0;

function initDinoAudio() {
    try {
        dinoAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } catch(e) { dinoAudioCtx = null; }
}

function playDinoNote(freq, duration, type, vol) {
    if (!dinoAudioCtx || !dinoMusicEnabled) return;
    try {
        if (dinoAudioCtx.state === 'suspended') dinoAudioCtx.resume();
        const osc = dinoAudioCtx.createOscillator();
        const gain = dinoAudioCtx.createGain();
        osc.type = type || 'square';
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(vol || 0.08, dinoAudioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, dinoAudioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(dinoAudioCtx.destination);
        osc.start();
        osc.stop(dinoAudioCtx.currentTime + duration);
    } catch(e) {}
}

function playDinoJumpSound() {
    playDinoNote(400, 0.1, 'square', 0.1);
    setTimeout(() => playDinoNote(600, 0.1, 'square', 0.08), 50);
}

function playDinoHitSound() {
    playDinoNote(150, 0.3, 'sawtooth', 0.15);
    setTimeout(() => playDinoNote(100, 0.4, 'sawtooth', 0.1), 100);
}

function playDinoCorrectSound() {
    playDinoNote(523, 0.12, 'square', 0.1);
    setTimeout(() => playDinoNote(659, 0.12, 'square', 0.1), 120);
    setTimeout(() => playDinoNote(784, 0.2, 'square', 0.1), 240);
}

function playDinoWrongSound() {
    playDinoNote(300, 0.2, 'sawtooth', 0.1);
    setTimeout(() => playDinoNote(200, 0.3, 'sawtooth', 0.1), 150);
}

function playDinoScoreMilestone() {
    const notes = [523, 587, 659, 784];
    notes.forEach((n, i) => setTimeout(() => playDinoNote(n, 0.15, 'square', 0.07), i * 80));
}

function playDinoGameOverSound() {
    const notes = [400, 350, 300, 200, 150];
    notes.forEach((n, i) => setTimeout(() => playDinoNote(n, 0.25, 'sawtooth', 0.1), i * 150));
}

// M√∫sica de fondo - melod√≠a retro tipo chip-tune
const dinoMelody = [
    392, 440, 494, 523, 494, 440, 392, 330,
    294, 330, 392, 440, 392, 330, 294, 262,
    330, 392, 440, 523, 587, 523, 440, 392,
    494, 440, 392, 330, 294, 330, 392, 262
];

function startDinoMusic() {
    if (!dinoAudioCtx || !dinoMusicEnabled) return;
    stopDinoMusic();
    dinoMusicStep = 0;
    dinoMusicInterval = setInterval(() => {
        if (!dinoMusicEnabled || !dino.isRunning || dino.isPaused) return;
        const note = dinoMelody[dinoMusicStep % dinoMelody.length];
        playDinoNote(note, 0.18, 'triangle', 0.04);
        // Bass line
        playDinoNote(note / 2, 0.2, 'sine', 0.03);
        dinoMusicStep++;
    }, 220);
}

function stopDinoMusic() {
    if (dinoMusicInterval) { clearInterval(dinoMusicInterval); dinoMusicInterval = null; }
}

function toggleDinoMusic() {
    dinoMusicEnabled = !dinoMusicEnabled;
    const btn = document.getElementById('dinoMuteBtn');
    btn.textContent = dinoMusicEnabled ? 'üîä' : 'üîá';
    if (!dinoMusicEnabled) stopDinoMusic();
    else if (dino.isRunning && !dino.isPaused) startDinoMusic();
}

// === ESTADO DEL JUEGO ===
const dino = {
    x: 60, y: 0, width: 40, height: 50,
    vy: 0, isJumping: false, isDucking: false,
    duckHeight: 30, gravity: 0.7, jumpForce: -14,
    
    lives: 4, score: 0,
    highScore: parseInt(localStorage.getItem('dinoRunnerHigh')) || 0,
    speed: 4.5, baseSpeed: 4.5, maxSpeed: 16,
    isRunning: false, isPaused: false,
    questionsAnswered: 0, questionsCorrect: 0,
    
    canvasWidth: 700, canvasHeight: 250, groundY: 0,
    
    obstacles: [], spawnTimer: 0,
    spawnInterval: 110, minSpawnInterval: 35,
    
    clouds: [], legFrame: 0, legTimer: 0,
    dustParticles: [],
    
    invincible: false, invincibleTimer: 0, invincibleDuration: 90,
    
    attempts: 0, maxAttempts: 3,
    totalQuestionsCorrect: 0, totalQuestionsAnswered: 0,
    bestScore: 0,
    usedQuestions: [],
    lastMilestone: 0
};

// === PREGUNTAS ===
const dinoQuestions = [
    // --- 2 T√âRMINOS (10 preguntas) ---
    { q: "(+8) + (+13) =", opts: ["+21", "+5", "-21", "-5"], c: 0, exp: "Signos iguales: 8+13=21, positivos ‚Üí +21" },
    { q: "(‚àí7) + (‚àí9) =", opts: ["-16", "+16", "-2", "+2"], c: 0, exp: "Signos iguales: 7+9=16, negativos ‚Üí ‚àí16" },
    { q: "(+15) + (‚àí8) =", opts: ["+7", "-7", "+23", "-23"], c: 0, exp: "Diferentes: 15‚àí8=7, gana + ‚Üí +7" },
    { q: "(‚àí20) + (+12) =", opts: ["-8", "+8", "-32", "+32"], c: 0, exp: "Diferentes: 20‚àí12=8, gana ‚àí ‚Üí ‚àí8" },
    { q: "(+10) ‚àí (+4) =", opts: ["+6", "-6", "+14", "-14"], c: 0, exp: "10+(‚àí4) = +6" },
    { q: "(‚àí7) ‚àí (+3) =", opts: ["-10", "+10", "-4", "+4"], c: 0, exp: "(‚àí7)+(‚àí3) = ‚àí10" },
    { q: "(+5) ‚àí (‚àí3) =", opts: ["+8", "-8", "+2", "-2"], c: 0, exp: "5+(+3) = +8" },
    { q: "(‚àí14) ‚àí (‚àí6) =", opts: ["-8", "+8", "-20", "+20"], c: 0, exp: "(‚àí14)+(+6) = ‚àí8" },
    { q: "(+25) + (‚àí30) =", opts: ["-5", "+5", "-55", "+55"], c: 0, exp: "Diferentes: 30‚àí25=5, gana ‚àí ‚Üí ‚àí5" },
    { q: "(‚àí18) ‚àí (+7) =", opts: ["-25", "+25", "-11", "+11"], c: 0, exp: "(‚àí18)+(‚àí7) = ‚àí25" },
    // --- 3 T√âRMINOS (10 preguntas) ---
    { q: "(+4) + (‚àí7) + (+3) =", opts: ["0", "+14", "-14", "+4"], c: 0, exp: "4+(‚àí7)=‚àí3, ‚àí3+3=0" },
    { q: "(‚àí5) + (+8) + (‚àí3) =", opts: ["0", "+6", "-16", "+16"], c: 0, exp: "‚àí5+8=+3, 3+(‚àí3)=0" },
    { q: "(‚àí3) + (‚àí4) + (+10) =", opts: ["+3", "-3", "+17", "-17"], c: 0, exp: "‚àí3+(‚àí4)=‚àí7, ‚àí7+10=+3" },
    { q: "(+6) ‚àí (+9) + (‚àí2) =", opts: ["-5", "+5", "-17", "+17"], c: 0, exp: "6+(‚àí9)=‚àí3, ‚àí3+(‚àí2)=‚àí5" },
    { q: "(‚àí15) + (+20) ‚àí (+8) =", opts: ["-3", "+3", "-43", "+43"], c: 0, exp: "‚àí15+20=+5, 5+(‚àí8)=‚àí3" },
    { q: "(+12) ‚àí (‚àí3) + (‚àí10) =", opts: ["+5", "-5", "+25", "-1"], c: 0, exp: "12+3=15, 15+(‚àí10)=+5" },
    { q: "(‚àí8) + (+12) ‚àí (+5) =", opts: ["-1", "+1", "-25", "+25"], c: 0, exp: "‚àí8+12=+4, 4+(‚àí5)=‚àí1" },
    { q: "(+18) ‚àí (+25) + (‚àí3) =", opts: ["-10", "+10", "-46", "+46"], c: 0, exp: "18+(‚àí25)=‚àí7, ‚àí7+(‚àí3)=‚àí10" },
    { q: "(‚àí20) + (+7) ‚àí (‚àí4) =", opts: ["-9", "+9", "-31", "+31"], c: 0, exp: "‚àí20+7=‚àí13, ‚àí13+4=‚àí9" },
    { q: "(‚àí12) ‚àí (‚àí8) + (+15) =", opts: ["+11", "-11", "+35", "-35"], c: 0, exp: "‚àí12+8=‚àí4, ‚àí4+15=+11" },
    // --- 4 T√âRMINOS (8 preguntas) ---
    { q: "(+6) ‚àí (+14) + (+3) ‚àí (‚àí5) =", opts: ["0", "+28", "-10", "+10"], c: 0, exp: "6‚àí14=‚àí8, ‚àí8+3=‚àí5, ‚àí5+5=0" },
    { q: "(‚àí9) + (+15) ‚àí (‚àí7) + (‚àí20) =", opts: ["-7", "+7", "-51", "+51"], c: 0, exp: "‚àí9+15=6, 6+7=13, 13‚àí20=‚àí7" },
    { q: "(+8) + (‚àí5) + (‚àí7) + (+2) =", opts: ["-2", "+2", "-22", "+22"], c: 0, exp: "8‚àí5=3, 3‚àí7=‚àí4, ‚àí4+2=‚àí2" },
    { q: "(‚àí10) ‚àí (+4) ‚àí (‚àí8) + (+3) =", opts: ["-3", "+3", "-25", "+25"], c: 0, exp: "‚àí10‚àí4=‚àí14, ‚àí14+8=‚àí6, ‚àí6+3=‚àí3" },
    { q: "(+30) ‚àí (+12) + (‚àí18) ‚àí (‚àí5) =", opts: ["+5", "-5", "+65", "-65"], c: 0, exp: "30‚àí12=18, 18‚àí18=0, 0+5=+5" },
    { q: "(‚àí11) ‚àí (+6) + (+22) ‚àí (‚àí3) =", opts: ["+8", "-8", "+42", "-42"], c: 0, exp: "‚àí11‚àí6=‚àí17, ‚àí17+22=5, 5+3=+8" },
    { q: "(+15) + (‚àí22) ‚àí (‚àí10) + (‚àí8) =", opts: ["-5", "+5", "-55", "+55"], c: 0, exp: "15‚àí22=‚àí7, ‚àí7+10=3, 3‚àí8=‚àí5" },
    { q: "(‚àí7) ‚àí (‚àí12) + (+4) ‚àí (+15) =", opts: ["-6", "+6", "-38", "+38"], c: 0, exp: "‚àí7+12=5, 5+4=9, 9‚àí15=‚àí6" },
    // --- 5 T√âRMINOS (5 preguntas) ---
    { q: "(‚àí3)+(‚àí7)‚àí(‚àí15)+(+2)‚àí(+8)=", opts: ["-1", "+1", "-33", "+33"], c: 0, exp: "‚àí3‚àí7=‚àí10, ‚àí10+15=5, 5+2=7, 7‚àí8=‚àí1" },
    { q: "(+10)‚àí(+18)+(‚àí5)‚àí(‚àí12)+(+6)=", opts: ["+5", "-5", "+51", "-51"], c: 0, exp: "10‚àí18=‚àí8, ‚àí8‚àí5=‚àí13, ‚àí13+12=‚àí1, ‚àí1+6=+5" },
    { q: "(‚àí6)+(+11)‚àí(+3)+(‚àí9)‚àí(‚àí2)=", opts: ["-5", "+5", "-31", "+31"], c: 0, exp: "‚àí6+11=5, 5‚àí3=2, 2‚àí9=‚àí7, ‚àí7+2=‚àí5" },
    { q: "(+20)‚àí(+8)+(‚àí15)‚àí(‚àí3)+(‚àí5)=", opts: ["-5", "+5", "-51", "+51"], c: 0, exp: "20‚àí8=12, 12‚àí15=‚àí3, ‚àí3+3=0, 0‚àí5=‚àí5" },
    { q: "(‚àí4)‚àí(+6)+(+13)‚àí(‚àí7)‚àí(+10)=", opts: ["0", "+40", "-40", "+10"], c: 0, exp: "‚àí4‚àí6=‚àí10, ‚àí10+13=3, 3+7=10, 10‚àí10=0" },
];

// === CANVAS ===
function initDinoCanvas() {
    dinoCanvas = document.getElementById('dinoCanvas');
    dinoCtx = dinoCanvas.getContext('2d');
    
    const w = Math.min(700, window.innerWidth - 40);
    dino.canvasWidth = w;
    dino.canvasHeight = 250;
    
    const dpr = window.devicePixelRatio || 1;
    dinoCanvas.width = w * dpr;
    dinoCanvas.height = 250 * dpr;
    dinoCanvas.style.width = w + 'px';
    dinoCanvas.style.height = '250px';
    dinoCtx.scale(dpr, dpr);
    
    dino.groundY = dino.canvasHeight - 50;
    dino.y = dino.groundY - dino.height;
    
    dino.clouds = [];
    for (let i = 0; i < 4; i++) {
        dino.clouds.push({ x: Math.random() * w, y: 20 + Math.random() * 60, w: 40 + Math.random() * 50, speed: 0.3 + Math.random() * 0.5 });
    }
}

// === INICIO ===
function startDinoGame() {
    if (!dinoAudioCtx) initDinoAudio();
    dinoMusicEnabled = document.getElementById('dinoMusicToggle').checked;
    
    initDinoCanvas();
    resetDinoState();
    dino.attempts++;
    
    document.getElementById('dinoStartScreen').style.display = 'none';
    document.getElementById('dinoGameScreen').style.display = 'block';
    document.getElementById('dinoWinScreen').style.display = 'none';
    document.getElementById('dinoGameOverScreen').style.display = 'none';
    
    document.addEventListener('keydown', handleDinoKeyDown);
    document.addEventListener('keyup', handleDinoKeyUp);
    dinoCanvas.addEventListener('touchstart', handleDinoTouch, { passive: false });
    dinoCanvas.addEventListener('mousedown', handleDinoClick);
    
    dino.isRunning = true;
    document.getElementById('dinoMuteBtn').textContent = dinoMusicEnabled ? 'üîä' : 'üîá';
    startDinoMusic();
    dinoMainLoop();
}

function resetDinoState() {
    dino.y = dino.groundY - dino.height;
    dino.vy = 0; dino.isJumping = false; dino.isDucking = false;
    dino.lives = 4; dino.score = 0; dino.speed = dino.baseSpeed;
    dino.isRunning = false; dino.isPaused = false;
    dino.questionsAnswered = 0; dino.questionsCorrect = 0;
    dino.obstacles = []; dino.spawnTimer = 0; dino.spawnInterval = 110;
    dino.dustParticles = []; dino.invincible = false; dino.invincibleTimer = 0;
    dino.usedQuestions = []; dino.legFrame = 0; dino.legTimer = 0;
    dino.lastMilestone = 0;
    dinoAnimFrame = 0;
    updateDinoHUD();
}

// === CONTROLES ===
function handleDinoKeyDown(e) {
    if (!dino.isRunning || dino.isPaused) return;
    if ((e.code === 'Space' || e.code === 'ArrowUp') && !dino.isJumping) { dinoJump(); e.preventDefault(); }
    if (e.code === 'ArrowDown') { dino.isDucking = true; e.preventDefault(); }
}
function handleDinoKeyUp(e) { if (e.code === 'ArrowDown') dino.isDucking = false; }

function handleDinoTouch(e) {
    e.preventDefault();
    if (!dino.isRunning || dino.isPaused) return;
    const rect = dinoCanvas.getBoundingClientRect();
    const ty = e.touches[0].clientY - rect.top;
    if (ty > rect.height * 0.7) { dino.isDucking = true; setTimeout(() => dino.isDucking = false, 500); }
    else if (!dino.isJumping) dinoJump();
}
function handleDinoClick(e) { if (!dino.isRunning || dino.isPaused) return; if (!dino.isJumping) dinoJump(); }

function dinoJump() {
    if (dino.isJumping) return;
    dino.isJumping = true; dino.isDucking = false; dino.vy = dino.jumpForce;
    playDinoJumpSound();
    for (let i = 0; i < 5; i++) {
        dino.dustParticles.push({ x: dino.x + 20 + (Math.random()-0.5)*20, y: dino.groundY, vx: (Math.random()-0.5)*3, vy: -Math.random()*3, life: 20, size: 2+Math.random()*3 });
    }
}

// === LOOP ===
function dinoMainLoop() {
    if (!dino.isRunning) return;
    if (dino.isPaused) { dinoGameLoop = requestAnimationFrame(dinoMainLoop); return; }
    
    dinoAnimFrame++;
    updateDinoPlayer();
    updateDinoObstacles();
    spawnDinoObstacles();
    checkDinoCollisions();
    updateDinoDust();
    updateDinoClouds();
    updateDinoSpeed();
    updateDinoScore();
    drawDinoGame();
    
    dinoGameLoop = requestAnimationFrame(dinoMainLoop);
}

function updateDinoPlayer() {
    dino.vy += dino.gravity; dino.y += dino.vy;
    const h = dino.isDucking ? dino.duckHeight : dino.height;
    const g = dino.groundY - h;
    if (dino.y >= g) { dino.y = g; dino.vy = 0; dino.isJumping = false; }
    
    dino.legTimer++; if (dino.legTimer > 5) { dino.legTimer = 0; dino.legFrame = (dino.legFrame+1)%2; }
    if (!dino.isJumping && dinoAnimFrame%8===0) {
        dino.dustParticles.push({ x: dino.x+5, y: dino.groundY, vx: -1-Math.random()*2, vy: -Math.random()*1.5, life: 15, size: 1.5+Math.random()*2 });
    }
    if (dino.invincible) { dino.invincibleTimer--; if (dino.invincibleTimer<=0) dino.invincible = false; }
}

// === VELOCIDAD PROGRESIVA (estilo Chrome Dino) ===
function updateDinoSpeed() {
    // Aumenta cada 100 puntos de score
    dino.speed = dino.baseSpeed + (dino.score / 100) * 0.5;
    if (dino.speed > dino.maxSpeed) dino.speed = dino.maxSpeed;
    
    // Spawn m√°s frecuente
    dino.minSpawnInterval = Math.max(30, 55 - Math.floor(dino.score / 150) * 3);
    
    // Mostrar velocidad
    const mult = (dino.speed / dino.baseSpeed).toFixed(1);
    document.getElementById('dinoSpeedDisplay').textContent = mult + 'x';
}

function updateDinoScore() {
    if (dinoAnimFrame % 5 === 0) dino.score++;
    document.getElementById('dinoScore').textContent = dino.score;
    
    // Milestone cada 100 puntos
    const milestone = Math.floor(dino.score / 100);
    if (milestone > dino.lastMilestone) {
        dino.lastMilestone = milestone;
        playDinoScoreMilestone();
    }
}

// === OBST√ÅCULOS ===
function spawnDinoObstacles() {
    dino.spawnTimer++;
    if (dino.spawnTimer >= dino.spawnInterval) {
        dino.spawnTimer = 0;
        dino.spawnInterval = dino.minSpawnInterval + Math.floor(Math.random() * 50);
        
        const t = Math.random();
        let obs;
        if (t < 0.3) obs = { x: dino.canvasWidth+10, y: dino.groundY-35, width: 20, height: 35, type: 'cactus_small' };
        else if (t < 0.55) obs = { x: dino.canvasWidth+10, y: dino.groundY-50, width: 25, height: 50, type: 'cactus_big' };
        else if (t < 0.78) obs = { x: dino.canvasWidth+10, y: dino.groundY-40, width: 45, height: 40, type: 'cactus_double' };
        else obs = { x: dino.canvasWidth+10, y: dino.groundY-55-Math.random()*20, width: 35, height: 25, type: 'bird', wingFrame: 0, wingTimer: 0 };
        dino.obstacles.push(obs);
    }
}

function updateDinoObstacles() {
    for (let i = dino.obstacles.length-1; i >= 0; i--) {
        const o = dino.obstacles[i];
        o.x -= dino.speed;
        if (o.type==='bird') { o.wingTimer++; if (o.wingTimer>10) { o.wingTimer=0; o.wingFrame=(o.wingFrame+1)%2; } }
        if (o.x + o.width < -20) dino.obstacles.splice(i, 1);
    }
}

function checkDinoCollisions() {
    if (dino.invincible) return;
    const pH = dino.isDucking ? dino.duckHeight : dino.height;
    const pY = dino.isDucking ? dino.groundY-dino.duckHeight : dino.y;
    const p = { x: dino.x+5, y: pY+5, w: dino.width-10, h: pH-10 };
    
    for (let i = 0; i < dino.obstacles.length; i++) {
        const o = dino.obstacles[i];
        const ob = { x: o.x+3, y: o.y+3, w: o.width-6, h: o.height-6 };
        if (p.x < ob.x+ob.w && p.x+p.w > ob.x && p.y < ob.y+ob.h && p.y+p.h > ob.y) {
            dinoHit(); break;
        }
    }
}

// === IMPACTO ===
function dinoHit() {
    dino.isPaused = true;
    stopDinoMusic();
    playDinoHitSound();
    showDinoQuestion();
}

function getRandomQuestion() {
    if (dino.usedQuestions.length >= dinoQuestions.length) dino.usedQuestions = [];
    let idx;
    do { idx = Math.floor(Math.random() * dinoQuestions.length); } while (dino.usedQuestions.includes(idx));
    dino.usedQuestions.push(idx);
    return { ...dinoQuestions[idx] };
}

function showDinoQuestion() {
    const q = getRandomQuestion();
    document.getElementById('dinoQuestionContent').textContent = q.q;
    document.getElementById('dinoLivesRemaining').textContent = 'Vidas restantes: ' + dino.lives;
    
    const opts = document.getElementById('dinoAnswerOptions');
    opts.innerHTML = '';
    
    const idx = [0,1,2,3];
    for (let i = 3; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [idx[i],idx[j]]=[idx[j],idx[i]]; }
    
    idx.forEach(oi => {
        const btn = document.createElement('button');
        btn.textContent = q.opts[oi];
        btn.style.cssText = 'background:linear-gradient(135deg,rgba(92,107,192,0.3),rgba(92,107,192,0.1));color:white;border:2px solid rgba(92,107,192,0.5);padding:15px;font-size:1.2em;font-weight:700;border-radius:15px;cursor:pointer;transition:all 0.2s;';
        btn.onmouseover = () => { btn.style.background='linear-gradient(135deg,#5C6BC0,#3949AB)'; btn.style.transform='scale(1.05)'; };
        btn.onmouseout = () => { btn.style.background='linear-gradient(135deg,rgba(92,107,192,0.3),rgba(92,107,192,0.1))'; btn.style.transform='scale(1)'; };
        btn.onclick = () => handleDinoAnswer(oi === q.c, q, opts);
        opts.appendChild(btn);
    });
    
    document.getElementById('dinoQuestionFeedback').style.display = 'none';
    document.getElementById('dinoContinueBtn').style.display = 'none';
    document.getElementById('dinoQuestionModal').style.display = 'flex';
}

function handleDinoAnswer(correct, question, container) {
    dino.questionsAnswered++; dino.totalQuestionsAnswered++;
    
    container.querySelectorAll('button').forEach(b => { b.onclick=null; b.style.cursor='default'; b.style.opacity='0.5'; });
    
    const fb = document.getElementById('dinoQuestionFeedback');
    const ft = document.getElementById('dinoFeedbackText');
    const fe = document.getElementById('dinoFeedbackExplanation');
    const cb = document.getElementById('dinoContinueBtn');
    
    if (correct) {
        dino.questionsCorrect++; dino.totalQuestionsCorrect++;
        playDinoCorrectSound();
        fb.style.background='rgba(76,175,80,0.2)'; fb.style.border='2px solid #4CAF50';
        ft.style.color='#69F0AE'; ft.textContent='‚úÖ ¬°CORRECTO! No pierdes vida.';
        fe.style.color='#A5D6A7';
    } else {
        dino.lives--;
        playDinoWrongSound();
        updateDinoHUD();
        fb.style.background='rgba(244,67,54,0.2)'; fb.style.border='2px solid #F44336';
        ft.style.color='#FF5252'; ft.textContent='‚ùå Incorrecto. Pierdes una vida. (' + dino.lives + ' restantes)';
        fe.style.color='#FFCDD2';
    }
    
    fe.textContent = question.exp;
    fb.style.display = 'block';
    
    cb.style.display = 'inline-block';
    cb.textContent = dino.lives > 0 ? '‚ñ∂ Continuar Jugando' : 'üíî Ver Resultado';
}

function dinoContinueAfterQuestion() {
    document.getElementById('dinoQuestionModal').style.display = 'none';
    document.getElementById('dinoContinueBtn').style.display = 'none';
    
    if (dino.lives <= 0) {
        dinoGameOver();
    } else {
        dino.invincible = true;
        dino.invincibleTimer = dino.invincibleDuration;
        dino.isPaused = false;
        dino.obstacles = dino.obstacles.filter(o => o.x > dino.x + dino.width + 80);
        startDinoMusic();
    }
}

function updateDinoDust() { dino.dustParticles = dino.dustParticles.filter(p => { p.x+=p.vx; p.y+=p.vy; p.life--; return p.life>0; }); }
function updateDinoClouds() { dino.clouds.forEach(c => { c.x -= c.speed; if (c.x+c.w<0) { c.x=dino.canvasWidth+20; c.y=20+Math.random()*60; } }); }

function updateDinoHUD() {
    document.getElementById('dinoScore').textContent = dino.score;
    document.getElementById('dinoHighScore').textContent = dino.highScore;
    const hearts = document.querySelectorAll('.dinoHeart');
    hearts.forEach((h, i) => {
        h.style.opacity = i < dino.lives ? '1' : '0.2';
        h.style.filter = i < dino.lives ? 'none' : 'grayscale(100%)';
        h.style.transform = i < dino.lives ? 'scale(1)' : 'scale(0.7)';
    });
}

// === DIBUJAR ===
function drawDinoGame() {
    const c = dinoCtx, W = dino.canvasWidth, H = dino.canvasHeight;
    
    const sky = c.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,'#87CEEB'); sky.addColorStop(0.6,'#E0F7FA'); sky.addColorStop(1,'#FFF8E1');
    c.fillStyle=sky; c.fillRect(0,0,W,H);
    
    c.fillStyle='rgba(255,255,255,0.8)';
    dino.clouds.forEach(cl => {
        c.beginPath(); c.ellipse(cl.x,cl.y,cl.w/2,12,0,0,Math.PI*2); c.fill();
        c.beginPath(); c.ellipse(cl.x-cl.w*0.2,cl.y-5,cl.w*0.3,10,0,0,Math.PI*2); c.fill();
        c.beginPath(); c.ellipse(cl.x+cl.w*0.2,cl.y-3,cl.w*0.25,8,0,0,Math.PI*2); c.fill();
    });
    
    c.fillStyle='rgba(149,165,166,0.3)'; c.beginPath(); c.moveTo(0,dino.groundY);
    for (let x=0;x<W;x+=80){ c.lineTo(x+40,dino.groundY-30-Math.sin(x*0.01)*20); c.lineTo(x+80,dino.groundY); }
    c.fill();
    
    c.fillStyle='#8D6E63'; c.fillRect(0,dino.groundY,W,H-dino.groundY);
    c.strokeStyle='#6D4C41'; c.lineWidth=2; c.beginPath(); c.moveTo(0,dino.groundY); c.lineTo(W,dino.groundY); c.stroke();
    
    c.fillStyle='#795548';
    for (let i=0;i<W;i+=15){ const off=(i+dinoAnimFrame*dino.speed)%(W+30)-15; c.fillRect(W-off,dino.groundY+5,8,2); c.fillRect(W-off+5,dino.groundY+15,5,2); }
    
    c.fillStyle='rgba(139,119,101,0.6)';
    dino.dustParticles.forEach(p => { c.globalAlpha=p.life/20; c.beginPath(); c.arc(p.x,p.y,p.size,0,Math.PI*2); c.fill(); });
    c.globalAlpha=1;
    
    dino.obstacles.forEach(o => { if (o.type==='bird') drawBird(c,o); else drawCactus(c,o); });
    drawDinoPlayer(c);
    
    c.fillStyle='#333'; c.font='bold 14px monospace'; c.textAlign='left';
    c.fillText('SCORE: '+String(dino.score).padStart(5,'0'), 10, 20);
    
    const mult = (dino.speed / dino.baseSpeed).toFixed(1);
    c.fillStyle = dino.speed > 10 ? '#e74c3c' : dino.speed > 7 ? '#e67e22' : '#333';
    c.font='bold 11px Arial';
    c.fillText('VEL: '+mult+'x', 10, 36);
}

function drawDinoPlayer(c) {
    const h = dino.isDucking ? dino.duckHeight : dino.height;
    const py = dino.isDucking ? dino.groundY-dino.duckHeight : dino.y;
    const px = dino.x;
    if (dino.invincible && dinoAnimFrame%6<3) return;
    c.save();
    if (dino.isDucking) {
        c.fillStyle='#4CAF50'; c.fillRect(px,py+5,45,20);
        c.fillStyle='#388E3C'; c.fillRect(px+35,py,15,18);
        c.fillStyle='#fff'; c.fillRect(px+43,py+4,5,5);
        c.fillStyle='#000'; c.fillRect(px+45,py+5,3,3);
        c.fillStyle='#2E7D32';
        if(dino.legFrame===0){c.fillRect(px+8,py+25,6,5);c.fillRect(px+25,py+25,6,5);}
        else{c.fillRect(px+5,py+25,6,5);c.fillRect(px+28,py+25,6,5);}
    } else {
        c.fillStyle='#4CAF50'; c.beginPath(); c.roundRect(px+5,py+5,30,30,5); c.fill();
        c.fillStyle='#388E3C'; c.beginPath(); c.roundRect(px+15,py-8,25,20,4); c.fill();
        c.fillStyle='#fff'; c.fillRect(px+30,py-3,6,6);
        c.fillStyle='#000'; c.fillRect(px+32,py-1,3,4);
        c.fillStyle='#2E7D32'; c.fillRect(px+28,py+7,12,3);
        c.fillStyle='#388E3C'; c.fillRect(px+28,py+15,8,4);
        c.fillStyle='#4CAF50';
        c.beginPath();c.moveTo(px+5,py+10);c.lineTo(px-8,py+5);c.lineTo(px+5,py+20);c.fill();
        c.fillStyle='#2E7D32';
        if(dino.isJumping){c.fillRect(px+8,py+35,7,12);c.fillRect(px+22,py+35,7,12);}
        else if(dino.legFrame===0){c.fillRect(px+8,py+35,7,15);c.fillRect(px+22,py+33,7,12);}
        else{c.fillRect(px+8,py+33,7,12);c.fillRect(px+22,py+35,7,15);}
        c.fillStyle='rgba(56,142,60,0.6)';
        c.beginPath();c.arc(px+15,py+15,3,0,Math.PI*2);c.fill();
        c.beginPath();c.arc(px+25,py+22,2.5,0,Math.PI*2);c.fill();
    }
    if(dino.invincible){c.strokeStyle='rgba(33,150,243,0.5)';c.lineWidth=2;c.beginPath();c.arc(px+20,py+20,30,0,Math.PI*2);c.stroke();}
    c.restore();
}

function drawCactus(c, o) {
    c.fillStyle='#2E7D32';
    if(o.type==='cactus_small'){
        c.fillRect(o.x+6,o.y,8,o.height);c.fillRect(o.x,o.y+8,6,5);c.fillRect(o.x,o.y+5,3,8);
        c.fillRect(o.x+14,o.y+12,6,5);c.fillRect(o.x+17,o.y+8,3,9);
        c.fillStyle='#1B5E20';c.fillRect(o.x+4,o.y,2,3);c.fillRect(o.x+14,o.y+3,2,3);
    } else if(o.type==='cactus_big'){
        c.fillRect(o.x+7,o.y,11,o.height);c.fillRect(o.x,o.y+10,7,6);c.fillRect(o.x,o.y+5,4,11);
        c.fillRect(o.x+18,o.y+15,7,6);c.fillRect(o.x+21,o.y+10,4,11);
        c.fillStyle='#1B5E20';c.fillRect(o.x+5,o.y-2,2,4);c.fillRect(o.x+18,o.y+2,2,4);
    } else {
        c.fillRect(o.x+5,o.y,8,o.height);c.fillRect(o.x+30,o.y+5,8,o.height-5);
        c.fillRect(o.x,o.y+10,5,5);c.fillRect(o.x+13,o.y+8,5,5);
        c.fillRect(o.x+25,o.y+15,5,5);c.fillRect(o.x+38,o.y+12,5,5);
    }
}

function drawBird(c, o) {
    c.fillStyle='#5D4037';c.fillRect(o.x+8,o.y+8,20,10);c.fillRect(o.x+25,o.y+5,10,10);
    c.fillStyle='#FF9800';c.fillRect(o.x+32,o.y+8,6,4);
    c.fillStyle='#fff';c.fillRect(o.x+29,o.y+6,3,3);c.fillStyle='#000';c.fillRect(o.x+30,o.y+7,2,2);
    c.fillStyle='#4E342E';
    if(o.wingFrame===0)c.fillRect(o.x+10,o.y,15,8);else c.fillRect(o.x+10,o.y+15,15,8);
    c.fillStyle='#5D4037';c.beginPath();c.moveTo(o.x+8,o.y+8);c.lineTo(o.x,o.y+5);c.lineTo(o.x+8,o.y+18);c.fill();
}

// === GAME OVER ===
function dinoGameOver() {
    dino.isRunning = false;
    cancelAnimationFrame(dinoGameLoop);
    stopDinoMusic();
    playDinoGameOverSound();
    
    if (dino.score > dino.highScore) { dino.highScore = dino.score; localStorage.setItem('dinoRunnerHigh', dino.highScore); }
    if (dino.score > dino.bestScore) dino.bestScore = dino.score;
    
    document.getElementById('dinoGameOverScore').textContent = dino.score;
    document.getElementById('dinoGameOverCorrect').textContent = dino.questionsCorrect + '/' + dino.questionsAnswered;
    document.getElementById('dinoGameOverAttempts').textContent = 'Intento ' + dino.attempts + ' de ' + dino.maxAttempts;
    
    const btns = document.getElementById('dinoGameOverButtons');
    btns.innerHTML = '';
    const msg = document.getElementById('dinoGameOverMessage');
    
    if (dino.attempts < dino.maxAttempts) {
        msg.innerHTML = 'üí™ ¬°No te rindas!<br>Repasa las reglas de suma y resta.<br>Te quedan <strong>' + (dino.maxAttempts - dino.attempts) + ' intento(s)</strong>.';
        const rb = document.createElement('button');
        rb.textContent = 'üîÑ Intentar de Nuevo (' + (dino.attempts+1) + '/' + dino.maxAttempts + ')';
        rb.style.cssText = 'background:linear-gradient(135deg,#4CAF50,#43A047);color:white;border:none;padding:15px 35px;font-size:1.1em;font-weight:700;border-radius:30px;cursor:pointer;box-shadow:0 8px 25px rgba(76,175,80,0.3);';
        rb.onclick = showDinoStartForRetry;
        btns.appendChild(rb);
        const bb = document.createElement('button');
        bb.textContent = '‚Üê Volver'; bb.style.cssText='background:rgba(255,255,255,0.1);color:white;border:2px solid rgba(255,255,255,0.2);padding:15px 35px;font-size:1.1em;font-weight:700;border-radius:30px;cursor:pointer;';
        bb.onclick = () => { exitDinoGame(); showScreen('session1OperationsScreen'); };
        btns.appendChild(bb);
    } else {
        msg.innerHTML = 'üìö Has usado tus 3 intentos.<br>¬°Lo importante es aprender!<br>Mejor puntuaci√≥n: <strong>' + dino.bestScore + '</strong><br>Preguntas correctas totales: <strong>' + dino.totalQuestionsCorrect + '/' + dino.totalQuestionsAnswered + '</strong>';
        
        // Mostrar pantalla de resumen tipo "victoria"
        document.getElementById('dinoFinalScore').textContent = dino.bestScore;
        document.getElementById('dinoQuestionsAnswered').textContent = dino.totalQuestionsCorrect + '/' + dino.totalQuestionsAnswered;
        
        document.getElementById('dinoStartScreen').style.display = 'none';
        document.getElementById('dinoGameScreen').style.display = 'none';
        document.getElementById('dinoGameOverScreen').style.display = 'none';
        document.getElementById('dinoWinScreen').style.display = 'block';
        
        if (typeof completeSubActivity === 'function') completeSubActivity(1, 4);
        return;
    }
    
    document.getElementById('dinoStartScreen').style.display = 'none';
    document.getElementById('dinoGameScreen').style.display = 'none';
    document.getElementById('dinoWinScreen').style.display = 'none';
    document.getElementById('dinoGameOverScreen').style.display = 'block';
}

function showDinoStartForRetry() {
    document.getElementById('dinoGameOverScreen').style.display = 'none';
    document.getElementById('dinoStartScreen').style.display = 'block';
    document.getElementById('dinoAttemptsInfo').style.display = 'block';
    document.getElementById('dinoAttemptsText').textContent = 'Intento ' + (dino.attempts+1) + ' de ' + dino.maxAttempts;
}

// === RESET Y SALIR ===
function resetDinoGame() {
    cancelAnimationFrame(dinoGameLoop); stopDinoMusic();
    dino.isRunning = false; dino.attempts = 0;
    dino.totalQuestionsCorrect = 0; dino.totalQuestionsAnswered = 0; dino.bestScore = 0;
    document.getElementById('dinoStartScreen').style.display = 'block';
    document.getElementById('dinoGameScreen').style.display = 'none';
    document.getElementById('dinoWinScreen').style.display = 'none';
    document.getElementById('dinoGameOverScreen').style.display = 'none';
    document.getElementById('dinoQuestionModal').style.display = 'none';
    document.getElementById('dinoAttemptsInfo').style.display = 'none';
}

function exitDinoGame() {
    cancelAnimationFrame(dinoGameLoop); stopDinoMusic();
    dino.isRunning = false; dino.isPaused = false;
    dino.attempts = 0; dino.totalQuestionsCorrect = 0; dino.totalQuestionsAnswered = 0; dino.bestScore = 0;
    document.removeEventListener('keydown', handleDinoKeyDown);
    document.removeEventListener('keyup', handleDinoKeyUp);
    if (dinoCanvas) { dinoCanvas.removeEventListener('touchstart', handleDinoTouch); dinoCanvas.removeEventListener('mousedown', handleDinoClick); }
    document.getElementById('dinoStartScreen').style.display = 'block';
    document.getElementById('dinoGameScreen').style.display = 'none';
    document.getElementById('dinoWinScreen').style.display = 'none';
    document.getElementById('dinoGameOverScreen').style.display = 'none';
    document.getElementById('dinoQuestionModal').style.display = 'none';
    document.getElementById('dinoAttemptsInfo').style.display = 'none';
}

function exitCatchGame() { exitDinoGame(); }
function resetCatchGame() { resetDinoGame(); }
function exitCatchGameFullscreen() { exitDinoGame(); }


// =====================================================
// === SESI√ìN 5: FRACCIONES II - SUMA Y RESTA ==========
// =====================================================

// === PROGRESO DE SESI√ìN 5 ===
let session5Progress = JSON.parse(localStorage.getItem('session5Progress')) || {
    theory1: false,
    theory2: false,
    gameClass: false,
    arcade: false,
    quiz: false
};

// === NAVEGACI√ìN CON BLOQUEO ===
function goToSession5Screen(screenId, requiredStep) {
    const steps = ['theory1', 'theory2', 'gameClass', 'arcade', 'quiz'];
    
    if (requiredStep > 1) {
        const previousStep = steps[requiredStep - 2];
        if (!session5Progress[previousStep]) {
            alert('üîí ¬°Debes completar el paso anterior primero!');
            return;
        }
    }
    
    showScreen(screenId);
}

// Actualizar UI de bloqueo de Sesi√≥n 5
function updateSession5UI() {
    const steps = [
    { id: 's5-theory1-btn', navId: 's5-nav-theory1', step: 'theory1', prev: null },
    { id: 's5-theory2-btn', navId: 's5-nav-theory2', step: 'theory2', prev: 'theory1' },
    { id: 's5-game-btn', navId: 's5-nav-game', step: 'gameClass', prev: 'theory2' },
    { id: 's5-arcade-btn', navId: 's5-nav-arcade', step: 'arcade', prev: 'gameClass' },
    { id: 's5-quiz-btn', navId: 's5-nav-quiz', step: 'quiz', prev: 'arcade' }
];
    
    steps.forEach(function(item, index) {
        const btn = document.getElementById(item.id);
        const navCard = document.getElementById(item.navId);
        
        if (item.prev && !session5Progress[item.prev]) {
            if (btn) {
                btn.classList.add('locked-item');
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            }
            if (navCard) {
                navCard.style.opacity = '0.5';
                navCard.style.cursor = 'not-allowed';
            }
        } else {
            if (btn) {
                btn.classList.remove('locked-item');
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            }
            if (navCard) {
                navCard.style.opacity = '1';
                navCard.style.cursor = 'pointer';
            }
        }
        
        if (session5Progress[item.step]) {
            if (btn) {
                btn.innerHTML = btn.innerHTML.replace(/<span>.*?<\/span>/, '<span>‚úÖ</span>');
            }
        }
    });
}

// === MINI-RETOS TEOR√çA 1 ===
let s5t1Correct = 0;
const s5t1Answers = { 1: '9/12', 2: '5/15', 3: '-5/8' };

function checkS5T1Answer(reto, answer, btn) {
    const feedback = document.getElementById('s5t1-feedback-' + reto);
    const buttons = btn.parentElement.querySelectorAll('button');
    
    if (answer === s5t1Answers[reto]) {
        btn.style.background = '#4CAF50';
        btn.style.color = 'white';
        btn.style.borderColor = '#4CAF50';
        feedback.textContent = '‚úÖ ¬°Correcto! Excelente trabajo.';
        feedback.style.color = '#4CAF50';
        
        buttons.forEach(function(b) { b.disabled = true; });
        s5t1Correct++;
        
        setTimeout(function() {
            if (reto < 3) {
                document.getElementById('s5t1-challenge-' + (reto + 1)).style.display = 'block';
                document.getElementById('s5t1-challenge-' + (reto + 1)).scrollIntoView({ behavior: 'smooth' });
            } else {
                document.getElementById('s5t1-completion').style.display = 'block';
                document.getElementById('s5t1-completion').scrollIntoView({ behavior: 'smooth' });
            }
        }, 1000);
    } else {
        btn.style.background = '#F44336';
        btn.style.color = 'white';
        btn.style.borderColor = '#F44336';
        feedback.textContent = '‚ùå Incorrecto. ¬°Intenta de nuevo!';
        feedback.style.color = '#F44336';
        
        setTimeout(function() {
            btn.style.background = 'white';
            btn.style.color = '#6A1B9A';
            btn.style.borderColor = '#9C27B0';
            feedback.textContent = '';
        }, 1500);
    }
}

function completeS5Theory1() {
    session5Progress.theory1 = true;
    localStorage.setItem('session5Progress', JSON.stringify(session5Progress));
    
    if (typeof activityProgress !== 'undefined') {
        activityProgress.sesion5 = Math.max(activityProgress.sesion5 || 0, 1);
        localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
    }
    
    updateSession5UI();
    showScreen('session5Theory2Screen');
}

// === MINI-RETOS TEOR√çA 2 (MEJORADOS) ===
let s5t2Correct = 0;
// RESPUESTAS ACTUALIZADAS:
// Reto 1: 1/4 + 1/2 = 1/4 + 2/4 = 3/4
// Reto 2: 2/5 + 7/20 + 1/7 = 56/140 + 49/140 + 20/140 = 125/140 = 25/28
// Reto 3: 4/5 - 7/20 - 1/7 = 112/140 - 49/140 - 20/140 = 43/140 
// Reto 4: 4/5 - 7/20 - 1/7 = 112/140 - 49/140 - 20/140 = 43/140 
const s5t2Answers = { 1: '3/4', 2: '25/28', 3: '43/140', 4: '43/140'};

function checkS5T2Answer(reto, answer, btn) {
    const feedback = document.getElementById('s5t2-feedback-' + reto);
    const buttons = btn.parentElement.querySelectorAll('button');
    
    if (answer === s5t2Answers[reto]) {
        btn.style.background = '#4CAF50';
        btn.style.color = 'white';
        btn.style.borderColor = '#4CAF50';
        feedback.textContent = '‚úÖ ¬°Excelente! Dominas el MCM.';
        feedback.style.color = '#4CAF50';
        
        buttons.forEach(function(b) { b.disabled = true; });
        s5t2Correct++;
        
        setTimeout(function() {
            if (reto < 3) {
                document.getElementById('s5t2-challenge-' + (reto + 1)).style.display = 'block';
                document.getElementById('s5t2-challenge-' + (reto + 1)).scrollIntoView({ behavior: 'smooth' });
            } else {
                document.getElementById('s5t2-completion').style.display = 'block';
                document.getElementById('s5t2-completion').scrollIntoView({ behavior: 'smooth' });
            }
        }, 1000);
    } else {
        btn.style.background = '#F44336';
        btn.style.color = 'white';
        btn.style.borderColor = '#F44336';
        feedback.textContent = '‚ùå Revisa el MCM e intenta de nuevo.';
        feedback.style.color = '#F44336';
        
        setTimeout(function() {
            btn.style.background = 'white';
            btn.style.color = '#6A1B9A';
            btn.style.borderColor = '#9C27B0';
            feedback.textContent = '';
        }, 1500);
    }
}

function completeS5Theory2() {
    session5Progress.theory2 = true;
    localStorage.setItem('session5Progress', JSON.stringify(session5Progress));
    
    if (typeof activityProgress !== 'undefined') {
        activityProgress.sesion5 = Math.max(activityProgress.sesion5 || 0, 2);
        localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
    }
    
    updateSession5UI();
    showScreen('session5GameClassScreen');
}

function completeS5GameClass() {
    session5Progress.gameClass = true;
    localStorage.setItem('session5Progress', JSON.stringify(session5Progress));
    
    if (typeof activityProgress !== 'undefined') {
        activityProgress.sesion5 = Math.max(activityProgress.sesion5 || 0, 3);
        localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
    }
    
    updateSession5UI();
    showScreen('session5ArcadeScreen');
}

function completeSession5() {
    session5Progress.quiz = true;
    localStorage.setItem('session5Progress', JSON.stringify(session5Progress));
    
    if (typeof activityProgress !== 'undefined') {
        activityProgress.sesion5 = 4;
        localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
    }
    
    if (typeof completedSections !== 'undefined' && !completedSections.includes(5)) {
        completedSections.push(5);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
    }
    
    if (typeof createConfetti === 'function') {
        createConfetti();
    }
    
    alert('üéâ ¬°FELICITACIONES!\n\n¬°Has completado la Sesi√≥n 5!\nYa dominas la suma y resta de fracciones.\n\n¬°Contin√∫a a la Sesi√≥n 6!');
    
    if (typeof updateProgress === 'function') {
        updateProgress();
    }
    
    showScreen('sectionsScreen');
}

// Inicializar UI
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateSession5UI);
} else {
    updateSession5UI();
}

// =====================================================
// =====================================================
// =====================================================
// =====================================================
// =====================================================
// =====================================================
// =====================================================
// =====================================================
// === TURBO FRACCIONES ‚Äî RACING GAME =====================
let tfAud,tfCvs,tfCtx,tfRAF;
const tfMel=[330,330,392,440,392,330,294,262,262,294,330,330,294,294,330,330,392,440,392,330,294,262,262,294,330,294,262,262];
const tfBN=[131,165,175,196,131,165,147,131,131,165,175,220,196,175,165,131];
let tfMI=0,tfBI=0,tfMT=0,tfBT=0;
function tfInitAud(){tfAud=new(window.AudioContext||window.webkitAudioContext)()}
function tfTone(f,d,t,v){if(!tfAud)return;try{const o=tfAud.createOscillator(),g=tfAud.createGain();o.type=t||'square';o.frequency.value=f;g.gain.setValueAtTime(v||0.06,tfAud.currentTime);g.gain.exponentialRampToValueAtTime(0.001,tfAud.currentTime+d);o.connect(g);g.connect(tfAud.destination);o.start();o.stop(tfAud.currentTime+d)}catch(e){}}
function tfMusic(ts){if(!tf.on||tf.paused||!tfAud)return;const tempo=130+tf.level*10;const mi=60000/tempo/2,bi=60000/tempo;if(ts-tfMT>mi){tfTone(tfMel[tfMI%tfMel.length],0.12,'square',0.04);tfMI++;tfMT=ts}if(ts-tfBT>bi){tfTone(tfBN[tfBI%tfBN.length],0.2,'triangle',0.05);tfBI++;tfBT=ts}}

const tf={
    W:0, H:0,
    lane:1,
    // === SAME SPEED SYSTEM AS DINO ===
    speed:4.5, baseSpeed:4.5, maxSpeed:16,
    score:0, lives:4, level:1,
    on:false, paused:false,
    obs:[], trees:[],
    att:0, maxAtt:3,
    qA:0, qC:0, totalQA:0, totalQC:0, bestScore:0,
    usedQ:[],
    colors:['#ff3333','#3388ff','#ffaa00','#ff66cc','#33ddff','#ff5533','#aa44ff','#44ff44'],
    laneX:[], carW:0, carH:0,
    spawnT:0, spawnInt:110, minSpawnInt:35,
};

const tfQs=[
    {q:"1/2 + 1/3 + 1/6 = ?",o:["1","5/6","2/3","7/6"],c:0,e:"MCM=6 \u2192 3+2+1=6/6=1"},
    {q:"2/3 \u2212 1/4 + 1/6 = ?",o:["7/12","1/2","5/12","3/4"],c:0,e:"MCM=12 \u2192 8\u22123+2=7/12"},
    {q:"\u22121/2 + 3/4 \u2212 1/8 = ?",o:["1/8","3/8","1/4","0"],c:0,e:"MCM=8 \u2192 \u22124+6\u22121=1/8"},
    {q:"1/3 + 1/5 + 1/15 = ?",o:["3/5","9/15","2/5","7/15"],c:0,e:"MCM=15 \u2192 5+3+1=9/15=3/5"},
    {q:"MCM(4, 6, 3) = ?",o:["12","24","6","36"],c:0,e:"2\u00b2\u00d73 = 12"},
    {q:"MCM(8, 12, 6) = ?",o:["24","48","12","36"],c:0,e:"2\u00b3\u00d73 = 24"},
    {q:"2/3 \u00d7 3/4 \u00d7 4/5 = ?",o:["2/5","24/60","1/2","3/5"],c:0,e:"Simplificando: 2/5"},
    {q:"(\u22121/2) \u00d7 (3/5) \u00d7 (\u22122/3) = ?",o:["1/5","\u22121/5","2/5","\u22122/5"],c:0,e:"(\u2212)(+)(\u2212)=+ \u2192 1/5"},
    {q:"(\u22121/3) \u00d7 (\u22122/5) \u00d7 (\u22123/4) = ?",o:["\u22121/10","1/10","\u22126/60","1/5"],c:0,e:"3 neg=neg \u2192 \u22121/10"},
    {q:"3/4 \u00f7 1/2 \u00f7 3/8 = ?",o:["4","3/2","2","8/3"],c:0,e:"3/4\u00d72=3/2, \u00d78/3=4"},
    {q:"5/6 \u00f7 1/3 \u00f7 5/2 = ?",o:["1","5/6","5/3","2/5"],c:0,e:"5/6\u00d73=5/2, \u00d72/5=1"},
    {q:"1/2 + 2/3 \u00d7 3/4 = ?",o:["1","7/8","5/6","3/4"],c:0,e:"\u00d7 primero: 1/2+1/2=1"},
    {q:"3/4 \u2212 1/2 \u00f7 2/3 = ?",o:["0","3/4","1/4","\u22121/12"],c:0,e:"\u00f7 primero: 3/4\u22123/4=0"},
    {q:"Par de signos (\u2212) = ?",o:["Positivo","Negativo","Cero","Depende"],c:0,e:"Par neg \u2192 Positivo"},
    {q:"Impar signos (\u2212) = ?",o:["Negativo","Positivo","Cero","Depende"],c:0,e:"Impar neg \u2192 Negativo"},
    {q:"\u22123/4 + 1/6 \u2212 2/3 = ?",o:["\u22125/4","\u221215/12","5/4","1/4"],c:0,e:"MCM=12 \u2192 \u221215/12=\u22125/4"},
    {q:"1/4 + 2/3 \u00d7 3/8 = ?",o:["1/2","7/24","5/8","1/4"],c:0,e:"\u00d7 primero: 1/4+1/4=1/2"},
    {q:"(\u22122/3) \u00d7 (1/4) \u00f7 (\u22121/6) = ?",o:["1","\u22121","1/6","\u22121/6"],c:0,e:"\u22121/6 \u00f7 \u22121/6 = 1"},
    {q:"5/8 \u2212 3/4 + 1/2 = ?",o:["3/8","1/8","1/4","5/8"],c:0,e:"MCM=8 \u2192 5\u22126+4=3/8"},
    {q:"1/3 \u00d7 3/5 \u00d7 5/7 = ?",o:["1/7","3/35","15/105","5/21"],c:0,e:"Simplificando: 1/7"},
];

function tfScr(id){['tfScrStart','tfScrGame','tfScrGO','tfScrFin'].forEach(function(s){var e=document.getElementById(s);if(e)e.style.display='none'});var q=document.getElementById('tfScrQ');if(q)q.style.display='none';var e=document.getElementById(id);if(e)e.style.display=(id==='tfScrQ')?'flex':'block'}
function tfMv(dir){if(!tf.on||tf.paused)return;var n=tf.lane+dir;if(n<0||n>2)return;tf.lane=n;tfTone(400+n*100,0.04,'sine',0.04)}

function tfInitCanvas(){
    tfCvs=document.getElementById('tfCvs');tfCtx=tfCvs.getContext('2d');
    var maxW=Math.min(440,window.innerWidth-20),maxH=Math.min(680,window.innerHeight-140);
    tf.W=maxW;tf.H=maxH;
    var dpr=window.devicePixelRatio||1;
    tfCvs.width=tf.W*dpr;tfCvs.height=tf.H*dpr;
    tfCvs.style.width=tf.W+'px';tfCvs.style.height=tf.H+'px';
    tfCtx.scale(dpr,dpr);
    var rL=45,rR=tf.W-45,lW=(rR-rL)/3;
    tf.laneX=[rL+lW/2,rL+lW*1.5,rL+lW*2.5];
    tf.carW=Math.min(48,lW*0.65);tf.carH=tf.carW*1.55;
}

function tfDrawCar(x,y,w,h,col,isP){
    var c=tfCtx;
    c.fillStyle='rgba(0,0,0,0.3)';c.beginPath();c.ellipse(x,y+h/2+3,w/2+2,6,0,0,Math.PI*2);c.fill();
    c.fillStyle=col;c.beginPath();c.roundRect(x-w/2,y-h/2,w,h,7);c.fill();
    c.fillStyle=isP?'rgba(0,255,136,0.25)':'rgba(200,220,255,0.2)';
    c.beginPath();c.roundRect(x-w/2+4,y-h/2+7,w-8,h*0.22,3);c.fill();
    if(isP){c.fillStyle='#00ff88';c.fillRect(x-w/2+3,y+h/2-8,6,4);c.fillRect(x+w/2-9,y+h/2-8,6,4)}
    else{c.fillStyle='#ff3333';c.fillRect(x-w/2+3,y+h/2-8,5,3);c.fillRect(x+w/2-8,y+h/2-8,5,3)}
    c.fillStyle=isP?'#00ff88':'rgba(255,255,255,0.15)';c.fillRect(x-1.5,y-h/2+2,3,h-4);
    c.fillStyle='#1a1a1a';
    [[-1,-.3],[-1,.3],[1,-.3],[1,.3]].forEach(function(p){c.fillRect(x+p[0]*(w/2)-1,y+p[1]*h-5,p[0]>0?5:-5,10)});
    if(isP){c.shadowColor='#00ff88';c.shadowBlur=20;c.fillStyle='rgba(0,255,136,0.08)';c.fillRect(x-w/2-5,y-h/2-5,w+10,h+10);c.shadowBlur=0}
}

var tfRoadOff=0;
function tfDrawRoad(){
    var W=tf.W,H=tf.H,c=tfCtx;
    c.fillStyle='#080810';c.fillRect(0,0,W,H);
    var g1=c.createLinearGradient(0,0,40,0);g1.addColorStop(0,'#061206');g1.addColorStop(1,'#0a2a0a');c.fillStyle=g1;c.fillRect(0,0,40,H);
    var g2=c.createLinearGradient(W-40,0,W,0);g2.addColorStop(0,'#0a2a0a');g2.addColorStop(1,'#061206');c.fillStyle=g2;c.fillRect(W-40,0,40,H);
    c.fillStyle='#14141e';c.fillRect(40,0,W-80,H);
    c.strokeStyle='#ffffff55';c.lineWidth=3;
    c.beginPath();c.moveTo(42,0);c.lineTo(42,H);c.stroke();
    c.beginPath();c.moveTo(W-42,0);c.lineTo(W-42,H);c.stroke();
    var cOff=(tfRoadOff*3)%30;
    for(var y=-30+cOff;y<H;y+=30){c.fillStyle=(Math.floor(y/15)%2)?'#cc2222':'#ffffff55';c.fillRect(38,y,5,15);c.fillRect(W-43,y,5,15)}
    var dOff=(tfRoadOff*3)%40;c.strokeStyle='#ffffff18';c.lineWidth=2;c.setLineDash([20,20]);c.lineDashOffset=-dOff;
    var rL=45,rR=W-45,lW=(rR-rL)/3;
    c.beginPath();c.moveTo(rL+lW,0);c.lineTo(rL+lW,H);c.stroke();
    c.beginPath();c.moveTo(rL+lW*2,0);c.lineTo(rL+lW*2,H);c.stroke();
    c.setLineDash([]);
    tf.trees.forEach(function(t){c.fillStyle='#0a3a0a';c.beginPath();c.arc(t.x,t.y,t.r,0,Math.PI*2);c.fill();c.fillStyle='#0a4a0a';c.beginPath();c.arc(t.x,t.y,t.r*0.6,0,Math.PI*2);c.fill()});
}

function tfDrawHUD(){
    var W=tf.W,H=tf.H,c=tfCtx;
    c.font='bold 13px Courier New';c.fillStyle='#00ff88';c.textAlign='left';c.fillText('PTS '+tf.score,48,16);
    c.fillStyle='#fdd835';c.textAlign='center';c.fillText('NIV '+tf.level,W/2,16);
    var sp=Math.min((tf.speed-tf.baseSpeed)/(tf.maxSpeed-tf.baseSpeed),1);
    c.fillStyle='#222';c.fillRect(W/2-25,20,50,4);
    c.fillStyle=sp<0.5?'#00ff88':sp<0.8?'#fdd835':'#ff5252';
    c.fillRect(W/2-25,20,50*sp,4);
    var spdTxt='x'+(tf.speed/tf.baseSpeed).toFixed(1);
    c.fillStyle='#aaa';c.font='9px Courier New';c.fillText(spdTxt,W/2,32);
    c.textAlign='right';c.font='bold 13px Courier New';
    var lt='';for(var i=0;i<4;i++)lt+=i<tf.lives?'\u2764\ufe0f':'\u{1f5a4}';c.fillText(lt,W-48,16);
}

function tfSpawn(){
    var lane=Math.floor(Math.random()*3);
    if(tf.obs.some(function(o){return o.y<120&&o.lane===lane}))return;
    tf.obs.push({lane:lane,x:tf.laneX[lane],y:-80,color:tf.colors[Math.floor(Math.random()*tf.colors.length)],w:34+Math.random()*10,h:52+Math.random()*14});
}

function tfHit(){
    var px=tf.laneX[tf.lane],py=tf.H-90;
    for(var i=0;i<tf.obs.length;i++){var o=tf.obs[i];if(Math.abs(o.x-px)<(tf.carW/2+o.w/2-10)&&Math.abs(o.y-py)<(tf.carH/2+o.h/2-10))return o}
    return null;
}

function tfGetQ(){if(tf.usedQ.length>=tfQs.length)tf.usedQ=[];var i;do{i=Math.floor(Math.random()*tfQs.length)}while(tf.usedQ.includes(i));tf.usedQ.push(i);return Object.assign({},tfQs[i])}

function tfShowQ(){
    tf.paused=true;cancelAnimationFrame(tfRAF);
    var q=tfGetQ();tf.curQ=q;
    document.getElementById('tfQLiv').textContent='\u2764\ufe0f'.repeat(tf.lives)+' Vidas: '+tf.lives;
    document.getElementById('tfQTxt').textContent=q.q;
    var od=document.getElementById('tfQOpts');od.innerHTML='';
    document.getElementById('tfQFb').style.display='none';
    q.o.forEach(function(opt,idx){
        var b=document.createElement('button');b.textContent=opt;
        b.style.cssText='padding:12px;font-size:1.05em;background:#1a2a1a;color:#00ff88;border:2px solid #00ff8866;border-radius:8px;cursor:pointer;font-family:Courier New,monospace;font-weight:700;';
        b.onclick=function(){tfAns(idx,q)};od.appendChild(b);
    });
    tfScr('tfScrQ');
}

function tfAns(idx,q){
    tf.qA++;tf.totalQA++;
    var fb=document.getElementById('tfQFb'),bs=document.getElementById('tfQOpts').children;
    for(var i=0;i<bs.length;i++){bs[i].onclick=null;bs[i].style.opacity='0.5'}
    bs[q.c].style.border='3px solid #00ff88';bs[q.c].style.background='#00ff8833';bs[q.c].style.opacity='1';
    if(idx===q.c){
        tf.qC++;tf.totalQC++;tf.score+=50;
        fb.style.background='#00ff8822';fb.style.border='2px solid #00ff88';
        fb.innerHTML='<p style="color:#00ff88;font-weight:700;font-family:Courier New,monospace">\u2705 \u00a1CORRECTO! +50 pts</p><p style="color:#aaa;font-size:0.85em">'+q.e+'</p>';
        tfTone(523,0.1,'square',0.06);setTimeout(function(){tfTone(659,0.15,'square',0.06)},100);
    } else {
        tf.lives--;
        bs[idx].style.border='3px solid #ff5252';bs[idx].style.background='#ff525233';
        fb.style.background='#ff525222';fb.style.border='2px solid #ff5252';
        fb.innerHTML='<p style="color:#ff5252;font-weight:700;font-family:Courier New,monospace">\u274c Incorrecto ('+tf.lives+' vidas)</p><p style="color:#aaa;font-size:0.85em">'+q.e+'</p>';
        tfTone(200,0.2,'sawtooth',0.06);
    }
    fb.style.display='block';
    setTimeout(function(){
        if(tf.lives<=0){tfGameOver()}
        else{
            tf.obs=tf.obs.filter(function(o){return!(Math.abs(o.x-tf.laneX[tf.lane])<60&&o.y>tf.H-160)});
            tf.paused=false;tfScr('tfScrGame');
            tfRAF=requestAnimationFrame(tfLoop);
        }
    },1800);
}

// === SPEED: IDENTICAL TO DINO GAME ===
// Base 4.5, increases +0.5 every 100 score points, max 16
// Spawn starts at 110, decreases gradually
function tfUpdateSpeed(){
    tf.speed = tf.baseSpeed + (tf.score / 100) * 0.5;
    if(tf.speed > tf.maxSpeed) tf.speed = tf.maxSpeed;
    tf.level = 1 + Math.floor(tf.score / 200);
    tf.minSpawnInt = Math.max(35, 55 - Math.floor(tf.score / 150) * 3);
}

var tfFrame=0;
function tfLoop(ts){
    if(!tf.on)return;
    tfMusic(ts);tfFrame++;
    if(!tf.paused){
        tfRoadOff+=tf.speed*0.3;
        tfUpdateSpeed();
        if(tfFrame%5===0)tf.score++;
        tf.spawnT++;
        if(tf.spawnT>=tf.spawnInt){
            tfSpawn();tf.spawnT=0;
            tf.spawnInt=tf.minSpawnInt+Math.floor(Math.random()*50);
        }
        for(var i=0;i<tf.obs.length;i++)tf.obs[i].y+=tf.speed;
        tf.obs=tf.obs.filter(function(o){return o.y<tf.H+80});
        for(var i=0;i<tf.trees.length;i++)tf.trees[i].y+=tf.speed*0.5;
        tf.trees=tf.trees.filter(function(t){return t.y<tf.H+30});
        if(Math.random()<0.03)tf.trees.push({x:Math.random()<0.5?Math.random()*35:tf.W-Math.random()*35,y:-20,r:8+Math.random()*12});
        if(tfHit()){
            tfTone(150,0.3,'sawtooth',0.08);
            cancelAnimationFrame(tfRAF);
            setTimeout(function(){tfShowQ()},200);
            return;
        }
    }
    tfDrawRoad();
    for(var i=0;i<tf.obs.length;i++){var o=tf.obs[i];tfDrawCar(o.x,o.y,o.w,o.h,o.color,false)}
    tfDrawCar(tf.laneX[tf.lane],tf.H-90,tf.carW,tf.carH,'#00ff88',true);
    tfDrawHUD();
    tfRAF=requestAnimationFrame(tfLoop);
}

function tfStart(){
    if(!tfAud)tfInitAud();tfInitCanvas();
    tf.lane=1;tf.score=0;tf.lives=4;tf.level=1;
    tf.speed=tf.baseSpeed;tf.spawnT=0;tf.spawnInt=110;
    tf.obs=[];tf.trees=[];tf.on=true;tf.paused=false;
    tf.qA=0;tf.qC=0;tf.att++;tfRoadOff=0;tfFrame=0;
    document.addEventListener('keydown',tfKD);
    tfScr('tfScrGame');tfMI=0;tfBI=0;
    tfRAF=requestAnimationFrame(tfLoop);
}
function tfKD(e){if(e.key==='ArrowLeft'){e.preventDefault();tfMv(-1)}if(e.key==='ArrowRight'){e.preventDefault();tfMv(1)}}

function tfGameOver(){
    tf.on=false;cancelAnimationFrame(tfRAF);document.removeEventListener('keydown',tfKD);
    if(tf.score>tf.bestScore)tf.bestScore=tf.score;
    document.getElementById('tfGOSc').textContent=tf.score;
    document.getElementById('tfGOLv').textContent=tf.level;
    document.getElementById('tfGOQ').textContent=tf.qC+'/'+tf.qA;
    var btn=document.getElementById('tfGOBtn');
    if(tf.att>=tf.maxAtt){
        document.getElementById('tfGOMsg').innerHTML='Intentos agotados. \u00a1Buen esfuerzo!';
        document.getElementById('tfGOAtt').textContent='';
        btn.textContent='\u25b6 FINALIZAR';btn.onclick=function(){
            if(typeof completeSubActivity==='function')completeSubActivity(5,4);
            tfScr('tfScrFin');document.getElementById('tfFinSc').textContent=tf.bestScore;
            document.getElementById('tfFinQ').textContent=tf.totalQC+'/'+tf.totalQA;
        };
    } else {
        document.getElementById('tfGOMsg').innerHTML='\u00a1No te rindas! Te quedan <strong>'+(tf.maxAtt-tf.att)+'</strong> intento(s).';
        document.getElementById('tfGOAtt').textContent='Intento '+tf.att+' de '+tf.maxAtt;
        btn.textContent='\u{1f504} REINTENTAR ('+(tf.att+1)+'/'+tf.maxAtt+')';btn.onclick=tfRetry;
    }
    tfScr('tfScrGO');
}
function tfRetry(){document.getElementById('tfTxtAtt').textContent='Intento '+(tf.att+1)+' de '+tf.maxAtt;tfScr('tfScrStart')}
function tfFinish(){tf.on=false;cancelAnimationFrame(tfRAF);document.removeEventListener('keydown',tfKD);if(typeof completeSubActivity==='function')completeSubActivity(5,4);showScreen('session5QuizScreen')}
function tfExit(){tf.on=false;cancelAnimationFrame(tfRAF);document.removeEventListener('keydown',tfKD);showScreen('session5Screen')}




// JAVASCRIPT COMPLETO PARA SESI√ìN 6
// ===================================================

// === PROGRESO DE SESI√ìN 6 ===
let session6Progress = JSON.parse(localStorage.getItem('session6Progress')) || {
    theory1: false,
    theory2: false,
    practice: false,
    game: false
};

// Guardar progreso
function saveSession6Progress() {
    localStorage.setItem('session6Progress', JSON.stringify(session6Progress));
}

// === NAVEGACI√ìN DE SESI√ìN 6 ===
function goToSession6Screen(screenId, step) {
    // Verificar si el m√≥dulo anterior est√° completado
    const steps = ['theory1', 'theory2', 'practice', 'game'];
    
    if (step > 0) {
        const previousStep = steps[step - 1];
        if (!session6Progress[previousStep]) {
            alert('‚ö†Ô∏è Debes completar el m√≥dulo anterior primero.');
            return;
        }
    }
    
    showScreen(screenId);
}

// Actualizar UI de bloqueo de Sesi√≥n 6
function updateSession6UI() {
    const steps = [
        { id: 's6-theory1-btn', navId: 's6-nav-theory1', step: 'theory1', prev: null },
        { id: 's6-theory2-btn', navId: 's6-nav-theory2', step: 'theory2', prev: 'theory1' },
        { id: 's6-practice-btn', navId: 's6-nav-practice', step: 'practice', prev: 'theory2' },
        { id: 's6-game-btn', navId: 's6-nav-game', step: 'game', prev: 'practice' }
    ];
    
    steps.forEach(function(item) {
        const btn = document.getElementById(item.id);
        const navCard = document.getElementById(item.navId);
        
        if (item.prev && !session6Progress[item.prev]) {
            if (btn) {
                btn.classList.add('locked-item');
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            }
            if (navCard) {
                navCard.style.opacity = '0.5';
                navCard.style.cursor = 'not-allowed';
            }
        } else {
            if (btn) {
                btn.classList.remove('locked-item');
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            }
            if (navCard) {
                navCard.style.opacity = '1';
                navCard.style.cursor = 'pointer';
            }
        }
        
        if (session6Progress[item.step]) {
            if (btn) {
                btn.innerHTML = btn.innerHTML.replace(/<span>.*?<\/span>/, '<span>‚úÖ</span>');
            }
        }
    });
}

// === MINI-RETOS TEOR√çA 1 (MULTIPLICACI√ìN Y DIVISI√ìN) ===
let s6t1Correct = 0;
const s6t1Answers = { 
    1: '1/2',      // 2/3 √ó 3/4 = 6/12 = 1/2
    2: '1/4',      // 5/6 √ó 3/10 = 15/60 = 1/4
    3: '21/10',    // 3/5 √∑ 2/7 = 3/5 √ó 7/2 = 21/10
    4: '1/6'       // 4/9 √∑ 8/3 = 4/9 √ó 3/8 = 12/72 = 1/6
};

function checkS6T1Answer(reto, answer, btn) {
    const feedback = document.getElementById('s6t1-feedback-' + reto);
    const buttons = btn.parentElement.querySelectorAll('button');
    
    if (answer === s6t1Answers[reto]) {
        btn.style.background = '#4CAF50';
        btn.style.color = 'white';
        btn.style.borderColor = '#4CAF50';
        feedback.textContent = '‚úÖ ¬°Correcto! Excelente trabajo.';
        feedback.style.color = '#4CAF50';
        
        buttons.forEach(function(b) { b.disabled = true; });
        
        s6t1Correct++;
        
        setTimeout(function() {
            document.getElementById('s6t1-challenge-' + reto).style.display = 'none';
            if (reto < 4) {
                document.getElementById('s6t1-challenge-' + (reto + 1)).style.display = 'block';
            } else {
                document.getElementById('s6t1-completion').style.display = 'block';
            }
        }, 1500);
    } else {
        btn.style.background = '#F44336';
        btn.style.color = 'white';
        btn.style.borderColor = '#F44336';
        feedback.textContent = '‚ùå Incorrecto. Revisa tu operaci√≥n.';
        feedback.style.color = '#F44336';
        
        setTimeout(function() {
            btn.style.background = 'white';
            btn.style.color = '#E65100';
            btn.style.borderColor = '#FF9800';
            feedback.textContent = '';
        }, 2000);
    }
}

function completeS6Theory1() {
    session6Progress.theory1 = true;
    saveSession6Progress();
    updateSession6UI();
    showScreen('session6Theory2Screen');
}

// === MINI-RETOS TEOR√çA 2 (JERARQU√çA) ===
let s6t2Correct = 0;
const s6t2Answers = { 
    1: '7/12',     // 1/4 + 1/2 √ó 2/3 = 1/4 + 1/3 = 3/12 + 4/12 = 7/12
    2: '1',        // (1/2 + 1/4) √ó 4/3 = 3/4 √ó 4/3 = 12/12 = 1
    3: '1'         // 3/4 √∑ 1/2 ‚àí 1/2 = 3/2 ‚àí 1/2 = 2/2 = 1
};

function checkS6T2Answer(reto, answer, btn) {
    const feedback = document.getElementById('s6t2-feedback-' + reto);
    const buttons = btn.parentElement.querySelectorAll('button');
    
    if (answer === s6t2Answers[reto]) {
        btn.style.background = '#4CAF50';
        btn.style.color = 'white';
        btn.style.borderColor = '#4CAF50';
        feedback.textContent = '‚úÖ ¬°Perfecto! Dominas la jerarqu√≠a.';
        feedback.style.color = '#4CAF50';
        
        buttons.forEach(function(b) { b.disabled = true; });
        
        s6t2Correct++;
        
        setTimeout(function() {
            document.getElementById('s6t2-challenge-' + reto).style.display = 'none';
            if (reto < 3) {
                document.getElementById('s6t2-challenge-' + (reto + 1)).style.display = 'block';
            } else {
                document.getElementById('s6t2-completion').style.display = 'block';
            }
        }, 1500);
    } else {
        btn.style.background = '#F44336';
        btn.style.color = 'white';
        btn.style.borderColor = '#F44336';
        feedback.textContent = '‚ùå Incorrecto. Recuerda el orden PEMDSR.';
        feedback.style.color = '#F44336';
        
        setTimeout(function() {
            btn.style.background = 'white';
            btn.style.color = '#BF360C';
            btn.style.borderColor = '#FF5722';
            feedback.textContent = '';
        }, 2000);
    }
}

function completeS6Theory2() {
    session6Progress.theory2 = true;
    saveSession6Progress();
    updateSession6UI();
    showScreen('session6PracticeScreen');
}

// === PR√ÅCTICA DE SESI√ìN 6 ===
function normalizeFraction(input) {
    if (!input) return '';
    
    // Normalizar el input
    let normalized = input.toString().trim();
    
    // Manejar fracciones negativas: -1/2, -1 / 2, - 1/2
    normalized = normalized.replace(/\s*-\s*/g, '-');
    normalized = normalized.replace(/\s+/g, '');
    
    // Si es un n√∫mero entero, agregamos /1
    if (!normalized.includes('/') && !isNaN(normalized)) {
        normalized = normalized + '/1';
    }
    
    return normalized.toLowerCase();
}

function submitS6Practice() {
    const answers = {
        's6p1': '1/4',      // 2/5 √ó 5/8 = 10/40 = 1/4
        's6p2': '1/6',      // 7/9 √∑ 14/3 = 7/9 √ó 3/14 = 21/126 = 1/6
        's6p3': '-1/6',     // -3/4 √ó 2/9 = -6/36 = -1/6
        's6p4': '8/15',     // 1/3 + 1/2 √ó 2/5 = 1/3 + 1/5 = 5/15 + 3/15 = 8/15
        's6p5': '3/8',      // (2/3 ‚àí 1/6) √ó 3/4 = 1/2 √ó 3/4 = 3/8
        's6p6': '3',        // 5/6 √∑ 1/3 + 1/2 = 5/2 + 1/2 = 6/2 = 3
        's6p7': '1/2'       // 1/2 + (1/4 √ó 2/3) ‚àí 1/6 = 1/2 + 1/6 ‚àí 1/6 = 1/2
    };
    
    let score = 0;
    const resultList = document.getElementById('s6PracticeResultList');
    resultList.innerHTML = '';
    
    for (let i = 1; i <= 7; i++) {
        const inputId = 's6p' + i;
        const userAnswer = normalizeFraction(document.getElementById(inputId).value);
        const correctAnswer = answers[inputId];
        
        const li = document.createElement('li');
        
        if (userAnswer === correctAnswer) {
            score++;
            li.innerHTML = '<strong>Ejercicio ' + i + ':</strong> ‚úÖ Correcto';
            li.style.color = '#4CAF50';
        } else {
            li.innerHTML = '<strong>Ejercicio ' + i + ':</strong> ‚ùå Incorrecto. Respuesta correcta: ' + correctAnswer;
            li.style.color = '#F44336';
        }
        
        resultList.appendChild(li);
    }
    
    document.getElementById('s6PracticeScore').textContent = score + '/7';
    document.getElementById('s6PracticeResults').style.display = 'block';
    
    if (score >= 5) {
        document.getElementById('completeS6PracticeButton').style.display = 'block';
    }
    
    // Scroll a resultados
    document.getElementById('s6PracticeResults').scrollIntoView({ behavior: 'smooth' });
}

function completeS6Practice() {
    session6Progress.practice = true;
    saveSession6Progress();
    updateSession6UI();
    showScreen('session6GameScreen');
}

// === COMPLETAR SESI√ìN 6 ===


function completeSession6() {
    session6Progress.game = true;
    saveSession6Progress();
    
    // Marcar Sesi√≥n 6 como completada
    if (!completedSections.includes(6)) {
        completedSections.push(6);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
    }
    
    // Actualizar progreso de actividades
    activityProgress.sesion6 = 4;
    localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
    
    updateSession6UI();
    
    // QUIT√â updateSectionCards() porque est√° causando el error
    // En su lugar llamamos directamente a la pantalla √©pica
    
    // Mostrar pantalla √©pica de finalizaci√≥n
    showCompletionScreen();
}

function showCompletionScreen() {
    showScreen('homeScreen');
    
    setTimeout(function() {
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
           overflow-y: scroll;
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.98), rgba(49, 27, 146, 0.98));
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease;
        `;
        
    overlay.innerHTML = `
    <div style="text-align: center; max-width: 800px; width: 100%; padding: 30px 20px; background: white; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: scaleIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: auto;">
        <div style="font-size: 4em; margin-bottom: 10px; animation: rotate 2s ease-in-out;">üèÜ</div>
        <h1 style="color: #FFD700; font-size: 2em; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
            ¬°FELICITACIONES!
        </h1>
        <h2 style="color: #1A237E; font-size: 1.5em; margin-bottom: 20px;">
            ¬°Has Completado TODA la Unidad Did√°ctica!
        </h2>
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 20px; border-radius: 15px; margin: 20px 0; border: 3px solid #4CAF50;">
            <p style="font-size: 1.1em; color: #1B5E20; line-height: 1.6; margin-bottom: 10px;">
                üåü <strong>Eres oficialmente un Maestro de las Matem√°ticas</strong> üåü<br><br>
                Has demostrado dominio completo en:
            </p>
            <div style="text-align: left; display: inline-block; font-size: 1em; color: #2E7D32; line-height: 1.6;">
                ‚úÖ N√∫meros Enteros y Operaciones con Signos<br>
                ‚úÖ Multiplicaci√≥n y Divisi√≥n de Enteros<br>
                ‚úÖ Jerarqu√≠a Completa de Operaciones<br>
                ‚úÖ Fracciones: Concepto y Simplificaci√≥n<br>
                ‚úÖ Suma y Resta de Fracciones<br>
                ‚úÖ Multiplicaci√≥n y Divisi√≥n de Fracciones<br>
                ‚úÖ Jerarqu√≠a con Fracciones
            </div>
        </div>
        <div style="background: linear-gradient(135deg, #FFF9C4, #FFF59D); padding: 20px; border-radius: 15px; margin: 20px 0; border: 3px solid #FDD835;">
            <h3 style="color: #F57F17; font-size: 1.4em; margin-bottom: 10px;">üéì ¬°Ya est√°s listo!</h3>
            <p style="font-size: 1.1em; color: #F57F17; font-weight: 600; line-height: 1.5;">
                Ahora puedes realizar el <strong>POSTEST</strong><br>
                para demostrar todo lo que has aprendido.
            </p>
        </div>
        <button onclick="cerrarPantallaFinal()" style="padding: 18px 45px; font-size: 1.2em; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 700; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5); margin-top: 15px;">
            üöÄ ¬°Ir al Inicio y Hacer el Postest!
        </button>
    </div>
`;
        
        document.body.appendChild(overlay);
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes scaleIn {
                from { transform: scale(0.5); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            @keyframes rotate {
                0%, 100% { transform: rotate(0deg); }
                25% { transform: rotate(-10deg); }
                75% { transform: rotate(10deg); }
            }
        `;
        document.head.appendChild(style);
    }, 500);
}

function cerrarPantallaFinal() {
    const overlay = document.querySelector('div[style*="z-index: 10000"]');
    if (overlay) {
        overlay.style.animation = 'fadeOut 0.5s ease';
        setTimeout(function() {
            overlay.remove();
        }, 500);
    }
    
    // Actualizar las tarjetas de sesiones despu√©s de cerrar
    location.reload(); // Recarga la p√°gina para mostrar todo completo
}


function abrirJuegoNumerus() {
    const confirmacion = confirm(
        "‚ö†Ô∏è ADVERTENCIA IMPORTANTE ‚ö†Ô∏è\n\n" +
        "Este juego est√° optimizado para ser jugado en COMPUTADORES.\n\n" +
        "‚ùå NO funcionar√° correctamente en celulares o tablets.\n\n" +
        "üñ•Ô∏è Por favor, aseg√∫rate de estar usando un computador antes de continuar.\n\n" +
        "¬øDeseas continuar?"
    );
    
    if (confirmacion) {
        window.open('https://andres5050-sudo.github.io/juegogamificadosesion6/', '_blank');
    }
}

// === INICIALIZACI√ìN AL CARGAR ===
document.addEventListener('DOMContentLoaded', function() {
    updateSession6UI();
});
</script>
</body>
</html>